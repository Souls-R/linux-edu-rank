<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Universidade Federal de Campina Grande</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Universidade Federal de Campina Grande</h1>
    <div class="pagination">
        <span>[1]</span>
    </div>
    <hr>
    <pre>commit d196c9a5d4e150cdff675662214c80c69b906958
Author: Ivo Calado &lt;ivocalado@embedded.ufcg.edu.br&gt;
Date:   Mon Oct 11 20:40:04 2010 +0200

    dccp: generalise data-loss condition
    
    This patch generalises the task of determining data loss from RFC 4340, 7.7.1.
    
    Let S_A, S_B be sequence numbers such that S_B is "after" S_A, and let
    N_B be the NDP count of packet S_B. Then, using modulo-2^48 arithmetic,
     D = S_B - S_A - 1  is an upper bound of the number of lost data packets,
     D - N_B            is an approximation of the number of lost data packets
                        (there are cases where this is not exact).
    
    The patch implements this as
     dccp_loss_count(S_A, S_B, N_B) := max(S_B - S_A - 1 - N_B, 0)
    
    Signed-off-by: Ivo Calado &lt;ivocalado@embedded.ufcg.edu.br&gt;
    Signed-off-by: Erivaldo Xavier &lt;desadoc@gmail.com&gt;
    Signed-off-by: Leandro Sales &lt;leandroal@gmail.com&gt;
    Signed-off-by: Gerrit Renker &lt;gerrit@erg.abdn.ac.uk&gt;

diff --git a/net/dccp/dccp.h b/net/dccp/dccp.h
index e051c774ef5c..60f4f9622ab3 100644
--- a/net/dccp/dccp.h
+++ b/net/dccp/dccp.h
@@ -153,18 +153,27 @@ static inline u64 max48(const u64 seq1, const u64 seq2)
 }
 
 /**
- * dccp_loss_free  -  Evaluates condition for data loss from RFC 4340, 7.7.1
- * @s1:	 start sequence number
- * @s2:  end sequence number
+ * dccp_loss_count - Approximate the number of lost data packets in a burst loss
+ * @s1:  last known sequence number before the loss ('hole')
+ * @s2:  first sequence number seen after the 'hole'
  * @ndp: NDP count on packet with sequence number @s2
- * Returns true if the sequence range s1...s2 has no data loss.
  */
-static inline bool dccp_loss_free(const u64 s1, const u64 s2, const u64 ndp)
+static inline u64 dccp_loss_count(const u64 s1, const u64 s2, const u64 ndp)
 {
 	s64 delta = dccp_delta_seqno(s1, s2);
 
 	WARN_ON(delta &lt; 0);
-	return (u64)delta &lt;= ndp + 1;
+	delta -= ndp + 1;
+
+	return delta &gt; 0 ? delta : 0;
+}
+
+/**
+ * dccp_loss_free - Evaluate condition for data loss from RFC 4340, 7.7.1
+ */
+static inline bool dccp_loss_free(const u64 s1, const u64 s2, const u64 ndp)
+{
+	return dccp_loss_count(s1, s2, ndp) == 0;
 }
 
 enum {</pre>
    <div class="pagination">
        <span>[1]</span>
    <div>
</body>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by State University of New York at Stony Brook</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by State University of New York at Stony Brook</h1>
    <div class="pagination">
        <a href='9_3.html'>&lt;&lt;Prev</a><a href='9.html'>1</a><a href='9_2.html'>2</a><a href='9_3.html'>3</a><span>[4]</span><a href='9_5.html'>5</a><a href='9_6.html'>6</a><a href='9_7.html'>7</a><a href='9_8.html'>8</a><a href='9_9.html'>9</a><a href='9_10.html'>10</a><a href='9_11.html'>11</a><a href='9_12.html'>12</a><a href='9_13.html'>13</a><a href='9_14.html'>14</a><a href='9_5.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 40fad04b224db982cce5f6226ebe3ceb6529b781
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:29 2006 -0800

    [PATCH] struct path: convert pcmcia
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/drivers/pcmcia/pcmcia_ioctl.c b/drivers/pcmcia/pcmcia_ioctl.c
index d077870c6731..327372b7a54e 100644
--- a/drivers/pcmcia/pcmcia_ioctl.c
+++ b/drivers/pcmcia/pcmcia_ioctl.c
@@ -486,7 +486,7 @@ static ssize_t ds_read(struct file *file, char __user *buf,
     user_info_t *user;
     int ret;
 
-    ds_dbg(2, "ds_read(socket %d)\n", iminor(file-&gt;f_dentry-&gt;d_inode));
+    ds_dbg(2, "ds_read(socket %d)\n", iminor(file-&gt;f_path.dentry-&gt;d_inode));
 
     if (count &lt; 4)
 	return -EINVAL;
@@ -511,7 +511,7 @@ static ssize_t ds_read(struct file *file, char __user *buf,
 static ssize_t ds_write(struct file *file, const char __user *buf,
 			size_t count, loff_t *ppos)
 {
-    ds_dbg(2, "ds_write(socket %d)\n", iminor(file-&gt;f_dentry-&gt;d_inode));
+    ds_dbg(2, "ds_write(socket %d)\n", iminor(file-&gt;f_path.dentry-&gt;d_inode));
 
     if (count != 4)
 	return -EINVAL;
@@ -529,7 +529,7 @@ static u_int ds_poll(struct file *file, poll_table *wait)
     struct pcmcia_socket *s;
     user_info_t *user;
 
-    ds_dbg(2, "ds_poll(socket %d)\n", iminor(file-&gt;f_dentry-&gt;d_inode));
+    ds_dbg(2, "ds_poll(socket %d)\n", iminor(file-&gt;f_path.dentry-&gt;d_inode));
 
     user = file-&gt;private_data;
     if (CHECK_USER(user))</pre><hr><pre>commit 46cc65a767f458aec4d342b814a661a15dc31be1
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:28 2006 -0800

    [PATCH] struct path: convert pci
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/drivers/pci/proc.c b/drivers/pci/proc.c
index 99cf33379769..4a6760a3b31f 100644
--- a/drivers/pci/proc.c
+++ b/drivers/pci/proc.c
@@ -23,7 +23,7 @@ static loff_t
 proc_bus_pci_lseek(struct file *file, loff_t off, int whence)
 {
 	loff_t new = -1;
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 
 	mutex_lock(&amp;inode-&gt;i_mutex);
 	switch (whence) {
@@ -48,7 +48,7 @@ proc_bus_pci_lseek(struct file *file, loff_t off, int whence)
 static ssize_t
 proc_bus_pci_read(struct file *file, char __user *buf, size_t nbytes, loff_t *ppos)
 {
-	const struct inode *ino = file-&gt;f_dentry-&gt;d_inode;
+	const struct inode *ino = file-&gt;f_path.dentry-&gt;d_inode;
 	const struct proc_dir_entry *dp = PDE(ino);
 	struct pci_dev *dev = dp-&gt;data;
 	unsigned int pos = *ppos;
@@ -130,7 +130,7 @@ proc_bus_pci_read(struct file *file, char __user *buf, size_t nbytes, loff_t *pp
 static ssize_t
 proc_bus_pci_write(struct file *file, const char __user *buf, size_t nbytes, loff_t *ppos)
 {
-	const struct inode *ino = file-&gt;f_dentry-&gt;d_inode;
+	const struct inode *ino = file-&gt;f_path.dentry-&gt;d_inode;
 	const struct proc_dir_entry *dp = PDE(ino);
 	struct pci_dev *dev = dp-&gt;data;
 	int pos = *ppos;
@@ -245,7 +245,7 @@ static int proc_bus_pci_ioctl(struct inode *inode, struct file *file, unsigned i
 #ifdef HAVE_PCI_MMAP
 static int proc_bus_pci_mmap(struct file *file, struct vm_area_struct *vma)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	const struct proc_dir_entry *dp = PDE(inode);
 	struct pci_dev *dev = dp-&gt;data;
 	struct pci_filp_private *fpriv = file-&gt;private_data;</pre><hr><pre>commit 0c5a5566892de5b240c89b9f72eb1c2e861206a0
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:28 2006 -0800

    [PATCH] struct path: convert parisc
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/parisc/hpux/sys_hpux.c b/arch/parisc/hpux/sys_hpux.c
index 2e2dc4f2c853..d88309209f56 100644
--- a/arch/parisc/hpux/sys_hpux.c
+++ b/arch/parisc/hpux/sys_hpux.c
@@ -237,7 +237,7 @@ asmlinkage long hpux_fstatfs(unsigned int fd, struct hpux_statfs __user * buf)
 	file = fget(fd);
 	if (!file)
 		goto out;
-	error = vfs_statfs_hpux(file-&gt;f_dentry, &amp;tmp);
+	error = vfs_statfs_hpux(file-&gt;f_path.dentry, &amp;tmp);
 	if (!error &amp;&amp; copy_to_user(buf, &amp;tmp, sizeof(tmp)))
 		error = -EFAULT;
 	fput(file);</pre><hr><pre>commit 1fb1430b14db30b8f113ddb4db389d316386f20b
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:27 2006 -0800

    [PATCH] struct path: convert oprofile
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/drivers/oprofile/buffer_sync.c b/drivers/oprofile/buffer_sync.c
index 43e521e99126..78c2e6e4b42e 100644
--- a/drivers/oprofile/buffer_sync.c
+++ b/drivers/oprofile/buffer_sync.c
@@ -220,8 +220,8 @@ static unsigned long get_exec_dcookie(struct mm_struct * mm)
 			continue;
 		if (!(vma-&gt;vm_flags &amp; VM_EXECUTABLE))
 			continue;
-		cookie = fast_get_dcookie(vma-&gt;vm_file-&gt;f_dentry,
-			vma-&gt;vm_file-&gt;f_vfsmnt);
+		cookie = fast_get_dcookie(vma-&gt;vm_file-&gt;f_path.dentry,
+			vma-&gt;vm_file-&gt;f_path.mnt);
 		break;
 	}
 
@@ -246,8 +246,8 @@ static unsigned long lookup_dcookie(struct mm_struct * mm, unsigned long addr, o
 			continue;
 
 		if (vma-&gt;vm_file) {
-			cookie = fast_get_dcookie(vma-&gt;vm_file-&gt;f_dentry,
-				vma-&gt;vm_file-&gt;f_vfsmnt);
+			cookie = fast_get_dcookie(vma-&gt;vm_file-&gt;f_path.dentry,
+				vma-&gt;vm_file-&gt;f_path.mnt);
 			*offset = (vma-&gt;vm_pgoff &lt;&lt; PAGE_SHIFT) + addr -
 				vma-&gt;vm_start;
 		} else {</pre><hr><pre>commit 80a067801d8cc9384f17991b90811f87ceab8225
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:26 2006 -0800

    [PATCH] struct path: convert openpromfs
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/openpromfs/inode.c b/fs/openpromfs/inode.c
index 26f44e0074ec..99c0bc37ba09 100644
--- a/fs/openpromfs/inode.c
+++ b/fs/openpromfs/inode.c
@@ -262,7 +262,7 @@ static struct dentry *openpromfs_lookup(struct inode *dir, struct dentry *dentry
 
 static int openpromfs_readdir(struct file * filp, void * dirent, filldir_t filldir)
 {
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct op_inode_info *oi = OP_I(inode);
 	struct device_node *dp = oi-&gt;u.node;
 	struct device_node *child;</pre><hr><pre>commit d28c91740ae2cd1d963f9e4e3889789894cb6d52
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:25 2006 -0800

    [PATCH] struct path: convert ocfs2
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/ocfs2/aops.c b/fs/ocfs2/aops.c
index 2f7268e81520..ef6cd30108a9 100644
--- a/fs/ocfs2/aops.c
+++ b/fs/ocfs2/aops.c
@@ -595,7 +595,7 @@ static void ocfs2_dio_end_io(struct kiocb *iocb,
 			     ssize_t bytes,
 			     void *private)
 {
-	struct inode *inode = iocb-&gt;ki_filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = iocb-&gt;ki_filp-&gt;f_path.dentry-&gt;d_inode;
 
 	/* this io's submitter should not have unlocked this before we could */
 	BUG_ON(!ocfs2_iocb_is_rw_locked(iocb));
@@ -611,7 +611,7 @@ static ssize_t ocfs2_direct_IO(int rw,
 			       unsigned long nr_segs)
 {
 	struct file *file = iocb-&gt;ki_filp;
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode-&gt;i_mapping-&gt;host;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode-&gt;i_mapping-&gt;host;
 	int ret;
 
 	mlog_entry_void();
diff --git a/fs/ocfs2/dir.c b/fs/ocfs2/dir.c
index baad2aa27c14..66821e178167 100644
--- a/fs/ocfs2/dir.c
+++ b/fs/ocfs2/dir.c
@@ -79,7 +79,7 @@ int ocfs2_readdir(struct file * filp, void * dirent, filldir_t filldir)
 	struct buffer_head * bh, * tmp;
 	struct ocfs2_dir_entry * de;
 	int err;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct super_block * sb = inode-&gt;i_sb;
 	unsigned int ra_sectors = 16;
 	int lock_level = 0;
diff --git a/fs/ocfs2/dlm/dlmfs.c b/fs/ocfs2/dlm/dlmfs.c
index 941acf14e61f..b7f0ba97a1a2 100644
--- a/fs/ocfs2/dlm/dlmfs.c
+++ b/fs/ocfs2/dlm/dlmfs.c
@@ -176,7 +176,7 @@ static ssize_t dlmfs_file_read(struct file *filp,
 	int bytes_left;
 	ssize_t readlen;
 	char *lvb_buf;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 
 	mlog(0, "inode %lu, count = %zu, *ppos = %llu\n",
 		inode-&gt;i_ino, count, *ppos);
@@ -220,7 +220,7 @@ static ssize_t dlmfs_file_write(struct file *filp,
 	int bytes_left;
 	ssize_t writelen;
 	char *lvb_buf;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 
 	mlog(0, "inode %lu, count = %zu, *ppos = %llu\n",
 		inode-&gt;i_ino, count, *ppos);
diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.c
index 8786b3c490aa..e9a82ad95c1e 100644
--- a/fs/ocfs2/file.c
+++ b/fs/ocfs2/file.c
@@ -68,7 +68,7 @@ static int ocfs2_file_open(struct inode *inode, struct file *file)
 	struct ocfs2_inode_info *oi = OCFS2_I(inode);
 
 	mlog_entry("(0x%p, 0x%p, '%.*s')\n", inode, file,
-		   file-&gt;f_dentry-&gt;d_name.len, file-&gt;f_dentry-&gt;d_name.name);
+		   file-&gt;f_path.dentry-&gt;d_name.len, file-&gt;f_path.dentry-&gt;d_name.name);
 
 	spin_lock(&amp;oi-&gt;ip_lock);
 
@@ -98,8 +98,8 @@ static int ocfs2_file_release(struct inode *inode, struct file *file)
 	struct ocfs2_inode_info *oi = OCFS2_I(inode);
 
 	mlog_entry("(0x%p, 0x%p, '%.*s')\n", inode, file,
-		       file-&gt;f_dentry-&gt;d_name.len,
-		       file-&gt;f_dentry-&gt;d_name.name);
+		       file-&gt;f_path.dentry-&gt;d_name.len,
+		       file-&gt;f_path.dentry-&gt;d_name.name);
 
 	spin_lock(&amp;oi-&gt;ip_lock);
 	if (!--oi-&gt;ip_open_count)
@@ -1131,13 +1131,13 @@ static ssize_t ocfs2_file_aio_write(struct kiocb *iocb,
 {
 	int ret, rw_level, have_alloc_sem = 0;
 	struct file *filp = iocb-&gt;ki_filp;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	int appending = filp-&gt;f_flags &amp; O_APPEND ? 1 : 0;
 
 	mlog_entry("(0x%p, %u, '%.*s')\n", filp,
 		   (unsigned int)nr_segs,
-		   filp-&gt;f_dentry-&gt;d_name.len,
-		   filp-&gt;f_dentry-&gt;d_name.name);
+		   filp-&gt;f_path.dentry-&gt;d_name.len,
+		   filp-&gt;f_path.dentry-&gt;d_name.name);
 
 	/* happy write of zero bytes */
 	if (iocb-&gt;ki_left == 0)
@@ -1159,7 +1159,7 @@ static ssize_t ocfs2_file_aio_write(struct kiocb *iocb,
 		goto out;
 	}
 
-	ret = ocfs2_prepare_inode_for_write(filp-&gt;f_dentry, &amp;iocb-&gt;ki_pos,
+	ret = ocfs2_prepare_inode_for_write(filp-&gt;f_path.dentry, &amp;iocb-&gt;ki_pos,
 					    iocb-&gt;ki_left, appending);
 	if (ret &lt; 0) {
 		mlog_errno(ret);
@@ -1207,12 +1207,12 @@ static ssize_t ocfs2_file_splice_write(struct pipe_inode_info *pipe,
 				       unsigned int flags)
 {
 	int ret;
-	struct inode *inode = out-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = out-&gt;f_path.dentry-&gt;d_inode;
 
 	mlog_entry("(0x%p, 0x%p, %u, '%.*s')\n", out, pipe,
 		   (unsigned int)len,
-		   out-&gt;f_dentry-&gt;d_name.len,
-		   out-&gt;f_dentry-&gt;d_name.name);
+		   out-&gt;f_path.dentry-&gt;d_name.len,
+		   out-&gt;f_path.dentry-&gt;d_name.name);
 
 	inode_double_lock(inode, pipe-&gt;inode);
 
@@ -1222,7 +1222,7 @@ static ssize_t ocfs2_file_splice_write(struct pipe_inode_info *pipe,
 		goto out;
 	}
 
-	ret = ocfs2_prepare_inode_for_write(out-&gt;f_dentry, ppos, len, 0);
+	ret = ocfs2_prepare_inode_for_write(out-&gt;f_path.dentry, ppos, len, 0);
 	if (ret &lt; 0) {
 		mlog_errno(ret);
 		goto out_unlock;
@@ -1247,12 +1247,12 @@ static ssize_t ocfs2_file_splice_read(struct file *in,
 				      unsigned int flags)
 {
 	int ret = 0;
-	struct inode *inode = in-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = in-&gt;f_path.dentry-&gt;d_inode;
 
 	mlog_entry("(0x%p, 0x%p, %u, '%.*s')\n", in, pipe,
 		   (unsigned int)len,
-		   in-&gt;f_dentry-&gt;d_name.len,
-		   in-&gt;f_dentry-&gt;d_name.name);
+		   in-&gt;f_path.dentry-&gt;d_name.len,
+		   in-&gt;f_path.dentry-&gt;d_name.name);
 
 	/*
 	 * See the comment in ocfs2_file_aio_read()
@@ -1278,12 +1278,12 @@ static ssize_t ocfs2_file_aio_read(struct kiocb *iocb,
 {
 	int ret = 0, rw_level = -1, have_alloc_sem = 0, lock_level = 0;
 	struct file *filp = iocb-&gt;ki_filp;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 
 	mlog_entry("(0x%p, %u, '%.*s')\n", filp,
 		   (unsigned int)nr_segs,
-		   filp-&gt;f_dentry-&gt;d_name.len,
-		   filp-&gt;f_dentry-&gt;d_name.name);
+		   filp-&gt;f_path.dentry-&gt;d_name.len,
+		   filp-&gt;f_path.dentry-&gt;d_name.name);
 
 	if (!inode) {
 		ret = -EINVAL;</pre><hr><pre>commit 6db5fc5d536560e31978c6911b1f5662e42083ac
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:25 2006 -0800

    [PATCH] struct path: convert netlink
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/net/netlink/af_netlink.c b/net/netlink/af_netlink.c
index 3baafb10f8f3..276131fe56dd 100644
--- a/net/netlink/af_netlink.c
+++ b/net/netlink/af_netlink.c
@@ -699,7 +699,7 @@ static struct sock *netlink_getsockbypid(struct sock *ssk, u32 pid)
 
 struct sock *netlink_getsockbyfilp(struct file *filp)
 {
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct sock *sock;
 
 	if (!S_ISSOCK(inode-&gt;i_mode))</pre><hr><pre>commit 6df81ab22700aadbbefaf0aa00bb9a18f9f54028
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:24 2006 -0800

    [PATCH] struct path: convert netfilter
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/net/ipv4/netfilter/ipt_CLUSTERIP.c b/net/ipv4/netfilter/ipt_CLUSTERIP.c
index 098365062234..fef56ae61abe 100644
--- a/net/ipv4/netfilter/ipt_CLUSTERIP.c
+++ b/net/ipv4/netfilter/ipt_CLUSTERIP.c
@@ -683,7 +683,7 @@ static ssize_t clusterip_proc_write(struct file *file, const char __user *input,
 {
 #define PROC_WRITELEN	10
 	char buffer[PROC_WRITELEN+1];
-	struct proc_dir_entry *pde = PDE(file-&gt;f_dentry-&gt;d_inode);
+	struct proc_dir_entry *pde = PDE(file-&gt;f_path.dentry-&gt;d_inode);
 	struct clusterip_config *c = pde-&gt;data;
 	unsigned long nodenum;
 
diff --git a/net/ipv4/netfilter/ipt_recent.c b/net/ipv4/netfilter/ipt_recent.c
index 126db44e71a8..4db0e73c56f1 100644
--- a/net/ipv4/netfilter/ipt_recent.c
+++ b/net/ipv4/netfilter/ipt_recent.c
@@ -401,7 +401,7 @@ static int recent_seq_open(struct inode *inode, struct file *file)
 static ssize_t recent_proc_write(struct file *file, const char __user *input,
 				 size_t size, loff_t *loff)
 {
-	struct proc_dir_entry *pde = PDE(file-&gt;f_dentry-&gt;d_inode);
+	struct proc_dir_entry *pde = PDE(file-&gt;f_path.dentry-&gt;d_inode);
 	struct recent_table *t = pde-&gt;data;
 	struct recent_entry *e;
 	char buf[sizeof("+255.255.255.255")], *c = buf;</pre><hr><pre>commit 3126a42c4d40c2b963f880cd5c1e00f0b4fb0dc9
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:23 2006 -0800

    [PATCH] struct path: convert net
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/net/socket.c b/net/socket.c
index 29ea1de43ecb..4e396312f8d5 100644
--- a/net/socket.c
+++ b/net/socket.c
@@ -362,20 +362,20 @@ static int sock_attach_fd(struct socket *sock, struct file *file)
 	this.name = name;
 	this.hash = 0;
 
-	file-&gt;f_dentry = d_alloc(sock_mnt-&gt;mnt_sb-&gt;s_root, &amp;this);
-	if (unlikely(!file-&gt;f_dentry))
+	file-&gt;f_path.dentry = d_alloc(sock_mnt-&gt;mnt_sb-&gt;s_root, &amp;this);
+	if (unlikely(!file-&gt;f_path.dentry))
 		return -ENOMEM;
 
-	file-&gt;f_dentry-&gt;d_op = &amp;sockfs_dentry_operations;
+	file-&gt;f_path.dentry-&gt;d_op = &amp;sockfs_dentry_operations;
 	/*
 	 * We dont want to push this dentry into global dentry hash table.
 	 * We pretend dentry is already hashed, by unsetting DCACHE_UNHASHED
 	 * This permits a working /proc/$pid/fd/XXX on sockets
 	 */
-	file-&gt;f_dentry-&gt;d_flags &amp;= ~DCACHE_UNHASHED;
-	d_instantiate(file-&gt;f_dentry, SOCK_INODE(sock));
-	file-&gt;f_vfsmnt = mntget(sock_mnt);
-	file-&gt;f_mapping = file-&gt;f_dentry-&gt;d_inode-&gt;i_mapping;
+	file-&gt;f_path.dentry-&gt;d_flags &amp;= ~DCACHE_UNHASHED;
+	d_instantiate(file-&gt;f_path.dentry, SOCK_INODE(sock));
+	file-&gt;f_path.mnt = mntget(sock_mnt);
+	file-&gt;f_mapping = file-&gt;f_path.dentry-&gt;d_inode-&gt;i_mapping;
 
 	sock-&gt;file = file;
 	file-&gt;f_op = SOCK_INODE(sock)-&gt;i_fop = &amp;socket_file_ops;
@@ -413,7 +413,7 @@ static struct socket *sock_from_file(struct file *file, int *err)
 	if (file-&gt;f_op == &amp;socket_file_ops)
 		return file-&gt;private_data;	/* set in sock_map_fd */
 
-	inode = file-&gt;f_dentry-&gt;d_inode;
+	inode = file-&gt;f_path.dentry-&gt;d_inode;
 	if (!S_ISSOCK(inode-&gt;i_mode)) {
 		*err = -ENOTSOCK;
 		return NULL;</pre><hr><pre>commit 92e5baef8578a03335059a3dec933955c361edc1
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:22 2006 -0800

    [PATCH] struct path: convert ncpfs
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/ncpfs/dir.c b/fs/ncpfs/dir.c
index 458b3b785194..73747772c3bb 100644
--- a/fs/ncpfs/dir.c
+++ b/fs/ncpfs/dir.c
@@ -402,7 +402,7 @@ static time_t ncp_obtain_mtime(struct dentry *dentry)
 
 static int ncp_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
-	struct dentry *dentry = filp-&gt;f_dentry;
+	struct dentry *dentry = filp-&gt;f_path.dentry;
 	struct inode *inode = dentry-&gt;d_inode;
 	struct page *page = NULL;
 	struct ncp_server *server = NCP_SERVER(inode);
@@ -554,7 +554,7 @@ static int
 ncp_fill_cache(struct file *filp, void *dirent, filldir_t filldir,
 		struct ncp_cache_control *ctrl, struct ncp_entry_info *entry)
 {
-	struct dentry *newdent, *dentry = filp-&gt;f_dentry;
+	struct dentry *newdent, *dentry = filp-&gt;f_path.dentry;
 	struct inode *newino, *inode = dentry-&gt;d_inode;
 	struct ncp_cache_control ctl = *ctrl;
 	struct qstr qname;
@@ -649,7 +649,7 @@ static void
 ncp_read_volume_list(struct file *filp, void *dirent, filldir_t filldir,
 			struct ncp_cache_control *ctl)
 {
-	struct dentry *dentry = filp-&gt;f_dentry;
+	struct dentry *dentry = filp-&gt;f_path.dentry;
 	struct inode *inode = dentry-&gt;d_inode;
 	struct ncp_server *server = NCP_SERVER(inode);
 	struct ncp_volume_info info;
@@ -685,7 +685,7 @@ static void
 ncp_do_readdir(struct file *filp, void *dirent, filldir_t filldir,
 						struct ncp_cache_control *ctl)
 {
-	struct dentry *dentry = filp-&gt;f_dentry;
+	struct dentry *dentry = filp-&gt;f_path.dentry;
 	struct inode *dir = dentry-&gt;d_inode;
 	struct ncp_server *server = NCP_SERVER(dir);
 	struct nw_search_sequence seq;
diff --git a/fs/ncpfs/file.c b/fs/ncpfs/file.c
index df37524b85db..b91fea03b1c3 100644
--- a/fs/ncpfs/file.c
+++ b/fs/ncpfs/file.c
@@ -101,7 +101,7 @@ int ncp_make_open(struct inode *inode, int right)
 static ssize_t
 ncp_file_read(struct file *file, char __user *buf, size_t count, loff_t *ppos)
 {
-	struct dentry *dentry = file-&gt;f_dentry;
+	struct dentry *dentry = file-&gt;f_path.dentry;
 	struct inode *inode = dentry-&gt;d_inode;
 	size_t already_read = 0;
 	off_t pos;
@@ -182,7 +182,7 @@ ncp_file_read(struct file *file, char __user *buf, size_t count, loff_t *ppos)
 static ssize_t
 ncp_file_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	struct dentry *dentry = file-&gt;f_dentry;
+	struct dentry *dentry = file-&gt;f_path.dentry;
 	struct inode *inode = dentry-&gt;d_inode;
 	size_t already_written = 0;
 	off_t pos;
diff --git a/fs/ncpfs/inode.c b/fs/ncpfs/inode.c
index fae53243bb92..47462ac94474 100644
--- a/fs/ncpfs/inode.c
+++ b/fs/ncpfs/inode.c
@@ -471,7 +471,7 @@ static int ncp_fill_super(struct super_block *sb, void *raw_data, int silent)
 	if (!ncp_filp)
 		goto out;
 	error = -ENOTSOCK;
-	sock_inode = ncp_filp-&gt;f_dentry-&gt;d_inode;
+	sock_inode = ncp_filp-&gt;f_path.dentry-&gt;d_inode;
 	if (!S_ISSOCK(sock_inode-&gt;i_mode))
 		goto out_fput;
 	sock = SOCKET_I(sock_inode);
@@ -504,7 +504,7 @@ static int ncp_fill_super(struct super_block *sb, void *raw_data, int silent)
 		if (!server-&gt;info_filp)
 			goto out_fput;
 		error = -ENOTSOCK;
-		sock_inode = server-&gt;info_filp-&gt;f_dentry-&gt;d_inode;
+		sock_inode = server-&gt;info_filp-&gt;f_path.dentry-&gt;d_inode;
 		if (!S_ISSOCK(sock_inode-&gt;i_mode))
 			goto out_fput2;
 		info_sock = SOCKET_I(sock_inode);
diff --git a/fs/ncpfs/ioctl.c b/fs/ncpfs/ioctl.c
index 589d1eac55c1..8843a83d4ef0 100644
--- a/fs/ncpfs/ioctl.c
+++ b/fs/ncpfs/ioctl.c
@@ -35,7 +35,7 @@ static int
 ncp_get_fs_info(struct ncp_server * server, struct file *file,
 		struct ncp_fs_info __user *arg)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	struct ncp_fs_info info;
 
 	if ((file_permission(file, MAY_WRITE) != 0)
@@ -65,7 +65,7 @@ static int
 ncp_get_fs_info_v2(struct ncp_server * server, struct file *file,
 		   struct ncp_fs_info_v2 __user * arg)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	struct ncp_fs_info_v2 info2;
 
 	if ((file_permission(file, MAY_WRITE) != 0)
@@ -136,7 +136,7 @@ static int
 ncp_get_compat_fs_info_v2(struct ncp_server * server, struct file *file,
 		   struct compat_ncp_fs_info_v2 __user * arg)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	struct compat_ncp_fs_info_v2 info2;
 
 	if ((file_permission(file, MAY_WRITE) != 0)
@@ -824,7 +824,7 @@ int ncp_ioctl(struct inode *inode, struct file *filp,
 #ifdef CONFIG_COMPAT
 long ncp_compat_ioctl(struct file *file, unsigned int cmd, unsigned long arg)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	int ret;
 
 	lock_kernel();
diff --git a/fs/ncpfs/mmap.c b/fs/ncpfs/mmap.c
index e7d5a3097fe6..70a69115500f 100644
--- a/fs/ncpfs/mmap.c
+++ b/fs/ncpfs/mmap.c
@@ -29,7 +29,7 @@ static struct page* ncp_file_mmap_nopage(struct vm_area_struct *area,
 				     unsigned long address, int *type)
 {
 	struct file *file = area-&gt;vm_file;
-	struct dentry *dentry = file-&gt;f_dentry;
+	struct dentry *dentry = file-&gt;f_path.dentry;
 	struct inode *inode = dentry-&gt;d_inode;
 	struct page* page;
 	char *pg_addr;
@@ -106,7 +106,7 @@ static struct vm_operations_struct ncp_file_mmap =
 /* This is used for a general mmap of a ncp file */
 int ncp_mmap(struct file *file, struct vm_area_struct *vma)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	
 	DPRINTK("ncp_mmap: called\n");
 </pre>
    <div class="pagination">
        <a href='9_3.html'>&lt;&lt;Prev</a><a href='9.html'>1</a><a href='9_2.html'>2</a><a href='9_3.html'>3</a><span>[4]</span><a href='9_5.html'>5</a><a href='9_6.html'>6</a><a href='9_7.html'>7</a><a href='9_8.html'>8</a><a href='9_9.html'>9</a><a href='9_10.html'>10</a><a href='9_11.html'>11</a><a href='9_12.html'>12</a><a href='9_13.html'>13</a><a href='9_14.html'>14</a><a href='9_5.html'>Next&gt;&gt;</a>
    <div>
</body>

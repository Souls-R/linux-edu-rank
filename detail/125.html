<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by University of Colorado at Boulder</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by University of Colorado at Boulder</h1>
    <div class="pagination">
        <span>[1]</span>
    </div>
    <hr>
    <pre>commit 121c7ad4ef3f3a9e697c4b8b78d74e4d6847d9e4
Author: kaoudis &lt;kaoudis@colorado.edu&gt;
Date:   Wed Jan 14 21:01:58 2015 -0700

    NVMe: within nvme_free_queues(), delete RCU sychro/deferred free
    
    Converting from to blk-queue got rid of the driver's RCU
    locking-on-queue, so removing unnecessary RCU locking-on-queue
    artefacts.
    
    Reviewed-by: Keith Busch &lt;keith.busch@intel.com&gt;
    
    Signed-off-by: Kelly Nicole Kaoudis &lt;kaoudis@colorado.edu&gt;
    Signed-off-by: Jens Axboe &lt;axboe@fb.com&gt;

diff --git a/drivers/block/nvme-core.c b/drivers/block/nvme-core.c
index f7d083bb3bd5..f4aa64160838 100644
--- a/drivers/block/nvme-core.c
+++ b/drivers/block/nvme-core.c
@@ -1108,21 +1108,14 @@ static void nvme_free_queue(struct nvme_queue *nvmeq)
 
 static void nvme_free_queues(struct nvme_dev *dev, int lowest)
 {
-	LLIST_HEAD(q_list);
-	struct nvme_queue *nvmeq, *next;
-	struct llist_node *entry;
 	int i;
 
 	for (i = dev-&gt;queue_count - 1; i &gt;= lowest; i--) {
 		struct nvme_queue *nvmeq = dev-&gt;queues[i];
-		llist_add(&amp;nvmeq-&gt;node, &amp;q_list);
 		dev-&gt;queue_count--;
 		dev-&gt;queues[i] = NULL;
-	}
-	synchronize_rcu();
-	entry = llist_del_all(&amp;q_list);
-	llist_for_each_entry_safe(nvmeq, next, entry, node)
 		nvme_free_queue(nvmeq);
+	}
 }
 
 /**</pre>
    <div class="pagination">
        <span>[1]</span>
    <div>
</body>

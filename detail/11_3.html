<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Peking University</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Peking University</h1>
    <div class="pagination">
        <a href='11_2.html'>&lt;&lt;Prev</a><a href='11.html'>1</a><a href='11_2.html'>2</a><span>[3]</span><a href='11_4.html'>4</a><a href='11_5.html'>5</a><a href='11_6.html'>6</a><a href='11_7.html'>7</a><a href='11_8.html'>8</a><a href='11_9.html'>9</a><a href='11_10.html'>10</a><a href='11_4.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit a70fc7d0d1beb4c6d3ce1eb1a18624fa59538f40
Author: Liu Junqi &lt;liujunqi@pku.edu.cn&gt;
Date:   Thu Nov 25 12:47:27 2021 +0800

    staging: unisys: visornic: fixed a typo cant -&gt; can't
    
    Fixed a typo: cant -&gt; can't in visornic_main.c.
    
    Signed-off-by: Liu Junqi &lt;liujunqi@pku.edu.cn&gt;
    Link: https://lore.kernel.org/r/20211125044729.594727-1-liujunqi@pku.edu.cn
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;

diff --git a/drivers/staging/unisys/visornic/visornic_main.c b/drivers/staging/unisys/visornic/visornic_main.c
index 62cd9b783732..18be80648825 100644
--- a/drivers/staging/unisys/visornic/visornic_main.c
+++ b/drivers/staging/unisys/visornic/visornic_main.c
@@ -1590,7 +1590,7 @@ static void send_rcv_posts_if_needed(struct visornic_devdata *devdata)
 	netdev = devdata-&gt;netdev;
 	rcv_bufs_allocated = 0;
 	/* this code is trying to prevent getting stuck here forever,
-	 * but still retry it if you cant allocate them all this time.
+	 * but still retry it if you can't allocate them all this time.
 	 */
 	cur_num_rcv_bufs_to_alloc = devdata-&gt;num_rcv_bufs_could_not_alloc;
 	while (cur_num_rcv_bufs_to_alloc &gt; 0) {</pre><hr><pre>commit 515f49702423f3a9b1bb6b6d89057bb47f799062
Author: Liu Junqi &lt;liujunqi@pku.edu.cn&gt;
Date:   Thu Nov 18 11:37:38 2021 +0800

    staging: unisys: visorhba: use tab to indent instead of whitespace
    
    changed the whitespace to tab to comply with kernel coding style.
    
    Signed-off-by: Liu Junqi &lt;liujunqi@pku.edu.cn&gt;
    Link: https://lore.kernel.org/r/20211118033737.576775-1-liujunqi@pku.edu.cn
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;

diff --git a/drivers/staging/unisys/visorhba/visorhba_main.c b/drivers/staging/unisys/visorhba/visorhba_main.c
index 694644112447..8eee131e834d 100644
--- a/drivers/staging/unisys/visorhba/visorhba_main.c
+++ b/drivers/staging/unisys/visorhba/visorhba_main.c
@@ -266,7 +266,7 @@ static int forward_taskmgmt_command(enum task_mgmt_types tasktype,
 					 &amp;notifyevent, &amp;notifyresult);
 	if (ret) {
 		dev_dbg(&amp;scsidev-&gt;sdev_gendev,
-		        "visorhba: setup_scsitaskmgmt_handles returned %d\n", ret);
+			"visorhba: setup_scsitaskmgmt_handles returned %d\n", ret);
 		return FAILED;
 	}
 </pre><hr><pre>commit d4ffd5df9d18031b6a53f934388726775b4452d3
Author: Jiashuo Liang &lt;liangjs@pku.edu.cn&gt;
Date:   Fri Jul 30 11:01:52 2021 +0800

    x86/fault: Fix wrong signal when vsyscall fails with pkey
    
    The function __bad_area_nosemaphore() calls kernelmode_fixup_or_oops()
    with the parameter @signal being actually @pkey, which will send a
    signal numbered with the argument in @pkey.
    
    This bug can be triggered when the kernel fails to access user-given
    memory pages that are protected by a pkey, so it can go down the
    do_user_addr_fault() path and pass the !user_mode() check in
    __bad_area_nosemaphore().
    
    Most cases will simply run the kernel fixup code to make an -EFAULT. But
    when another condition current-&gt;thread.sig_on_uaccess_err is met, which
    is only used to emulate vsyscall, the kernel will generate the wrong
    signal.
    
    Add a new parameter @pkey to kernelmode_fixup_or_oops() to fix this.
    
     [ bp: Massage commit message, fix build error as reported by the 0day
       bot: https://lkml.kernel.org/r/202109202245.APvuT8BX-lkp@intel.com ]
    
    Fixes: 5042d40a264c ("x86/fault: Bypass no_context() for implicit kernel faults from usermode")
    Reported-by: kernel test robot &lt;lkp@intel.com&gt;
    Signed-off-by: Jiashuo Liang &lt;liangjs@pku.edu.cn&gt;
    Signed-off-by: Borislav Petkov &lt;bp@suse.de&gt;
    Acked-by: Dave Hansen &lt;dave.hansen@linux.intel.com&gt;
    Link: https://lkml.kernel.org/r/20210730030152.249106-1-liangjs@pku.edu.cn

diff --git a/arch/x86/include/asm/pkeys.h b/arch/x86/include/asm/pkeys.h
index 5c7bcaa79623..1d5f14aff5f6 100644
--- a/arch/x86/include/asm/pkeys.h
+++ b/arch/x86/include/asm/pkeys.h
@@ -2,8 +2,6 @@
 #ifndef _ASM_X86_PKEYS_H
 #define _ASM_X86_PKEYS_H
 
-#define ARCH_DEFAULT_PKEY	0
-
 /*
  * If more than 16 keys are ever supported, a thorough audit
  * will be necessary to ensure that the types that store key
diff --git a/arch/x86/mm/fault.c b/arch/x86/mm/fault.c
index b2eefdefc108..84a2c8c4af73 100644
--- a/arch/x86/mm/fault.c
+++ b/arch/x86/mm/fault.c
@@ -710,7 +710,8 @@ page_fault_oops(struct pt_regs *regs, unsigned long error_code,
 
 static noinline void
 kernelmode_fixup_or_oops(struct pt_regs *regs, unsigned long error_code,
-			 unsigned long address, int signal, int si_code)
+			 unsigned long address, int signal, int si_code,
+			 u32 pkey)
 {
 	WARN_ON_ONCE(user_mode(regs));
 
@@ -735,8 +736,12 @@ kernelmode_fixup_or_oops(struct pt_regs *regs, unsigned long error_code,
 
 			set_signal_archinfo(address, error_code);
 
-			/* XXX: hwpoison faults will set the wrong code. */
-			force_sig_fault(signal, si_code, (void __user *)address);
+			if (si_code == SEGV_PKUERR) {
+				force_sig_pkuerr((void __user *)address, pkey);
+			} else {
+				/* XXX: hwpoison faults will set the wrong code. */
+				force_sig_fault(signal, si_code, (void __user *)address);
+			}
 		}
 
 		/*
@@ -798,7 +803,8 @@ __bad_area_nosemaphore(struct pt_regs *regs, unsigned long error_code,
 	struct task_struct *tsk = current;
 
 	if (!user_mode(regs)) {
-		kernelmode_fixup_or_oops(regs, error_code, address, pkey, si_code);
+		kernelmode_fixup_or_oops(regs, error_code, address,
+					 SIGSEGV, si_code, pkey);
 		return;
 	}
 
@@ -930,7 +936,8 @@ do_sigbus(struct pt_regs *regs, unsigned long error_code, unsigned long address,
 {
 	/* Kernel mode? Handle exceptions or die: */
 	if (!user_mode(regs)) {
-		kernelmode_fixup_or_oops(regs, error_code, address, SIGBUS, BUS_ADRERR);
+		kernelmode_fixup_or_oops(regs, error_code, address,
+					 SIGBUS, BUS_ADRERR, ARCH_DEFAULT_PKEY);
 		return;
 	}
 
@@ -1396,7 +1403,8 @@ void do_user_addr_fault(struct pt_regs *regs,
 		 */
 		if (!user_mode(regs))
 			kernelmode_fixup_or_oops(regs, error_code, address,
-						 SIGBUS, BUS_ADRERR);
+						 SIGBUS, BUS_ADRERR,
+						 ARCH_DEFAULT_PKEY);
 		return;
 	}
 
@@ -1416,7 +1424,8 @@ void do_user_addr_fault(struct pt_regs *regs,
 		return;
 
 	if (fatal_signal_pending(current) &amp;&amp; !user_mode(regs)) {
-		kernelmode_fixup_or_oops(regs, error_code, address, 0, 0);
+		kernelmode_fixup_or_oops(regs, error_code, address,
+					 0, 0, ARCH_DEFAULT_PKEY);
 		return;
 	}
 
@@ -1424,7 +1433,8 @@ void do_user_addr_fault(struct pt_regs *regs,
 		/* Kernel mode? Handle exceptions or die: */
 		if (!user_mode(regs)) {
 			kernelmode_fixup_or_oops(regs, error_code, address,
-						 SIGSEGV, SEGV_MAPERR);
+						 SIGSEGV, SEGV_MAPERR,
+						 ARCH_DEFAULT_PKEY);
 			return;
 		}
 
diff --git a/include/linux/pkeys.h b/include/linux/pkeys.h
index 6beb26b7151d..86be8bf27b41 100644
--- a/include/linux/pkeys.h
+++ b/include/linux/pkeys.h
@@ -4,6 +4,8 @@
 
 #include &lt;linux/mm.h&gt;
 
+#define ARCH_DEFAULT_PKEY	0
+
 #ifdef CONFIG_ARCH_HAS_PKEYS
 #include &lt;asm/pkeys.h&gt;
 #else /* ! CONFIG_ARCH_HAS_PKEYS */</pre><hr><pre>commit 5405b42c2f08efe67b531799ba2fdb35bac93e70
Author: Jiashuo Liang &lt;liangjs@pku.edu.cn&gt;
Date:   Tue Jun 1 16:52:03 2021 +0800

    x86/fault: Don't send SIGSEGV twice on SEGV_PKUERR
    
    __bad_area_nosemaphore() calls both force_sig_pkuerr() and
    force_sig_fault() when handling SEGV_PKUERR. This does not cause
    problems because the second signal is filtered by the legacy_queue()
    check in __send_signal() because in both cases, the signal is SIGSEGV,
    the second one seeing that the first one is already pending.
    
    This causes the kernel to do unnecessary work so send the signal only
    once for SEGV_PKUERR.
    
     [ bp: Massage commit message. ]
    
    Fixes: 9db812dbb29d ("signal/x86: Call force_sig_pkuerr from __bad_area_nosemaphore")
    Suggested-by: "Eric W. Biederman" &lt;ebiederm@xmission.com&gt;
    Signed-off-by: Jiashuo Liang &lt;liangjs@pku.edu.cn&gt;
    Signed-off-by: Borislav Petkov &lt;bp@suse.de&gt;
    Acked-by: "Eric W. Biederman" &lt;ebiederm@xmission.com&gt;
    Link: https://lkml.kernel.org/r/20210601085203.40214-1-liangjs@pku.edu.cn

diff --git a/arch/x86/mm/fault.c b/arch/x86/mm/fault.c
index 1c548ad00752..6bda7f67d737 100644
--- a/arch/x86/mm/fault.c
+++ b/arch/x86/mm/fault.c
@@ -836,8 +836,8 @@ __bad_area_nosemaphore(struct pt_regs *regs, unsigned long error_code,
 
 	if (si_code == SEGV_PKUERR)
 		force_sig_pkuerr((void __user *)address, pkey);
-
-	force_sig_fault(SIGSEGV, si_code, (void __user *)address);
+	else
+		force_sig_fault(SIGSEGV, si_code, (void __user *)address);
 
 	local_irq_disable();
 }</pre><hr><pre>commit dd3b8c329aa270027fba61a02a12600972dc3983
Author: Guan Xuetao &lt;gxt@pku.edu.cn&gt;
Date:   Wed Mar 21 21:10:56 2018 +0800

    MAINTAINERS: UNICORE32: Change email account
    
    Change email account for unicore32 arch and pkunity soc drivers
    Since old email server mprc.pku.edu.cn was blocked in recent years
    
    Signed-off-by: Guan Xuetao &lt;gxt@pku.edu.cn&gt;
    Cc: Arnd Bergmann &lt;arnd@arndb.de&gt;
    Signed-off-by: Arnd Bergmann &lt;arnd@arndb.de&gt;

diff --git a/MAINTAINERS b/MAINTAINERS
index 48486a505a4e..f86f3b253a10 100644
--- a/MAINTAINERS
+++ b/MAINTAINERS
@@ -10930,7 +10930,7 @@ F:	include/linux/pktcdvd.h
 F:	include/uapi/linux/pktcdvd.h
 
 PKUNITY SOC DRIVERS
-M:	Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;
+M:	Guan Xuetao &lt;gxt@pku.edu.cn&gt;
 W:	http://mprc.pku.edu.cn/~guanxuetao/linux
 S:	Maintained
 T:	git git://github.com/gxt/linux.git
@@ -14154,7 +14154,7 @@ F:	include/linux/uwb.h
 F:	include/linux/uwb/
 
 UNICORE32 ARCHITECTURE:
-M:	Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;
+M:	Guan Xuetao &lt;gxt@pku.edu.cn&gt;
 W:	http://mprc.pku.edu.cn/~guanxuetao/linux
 S:	Maintained
 T:	git git://github.com/gxt/linux.git</pre><hr><pre>commit 2b1193d5287004edfbf89407149a3159656f47f1
Author: John Hunter &lt;zhaojunwang@pku.edu.cn&gt;
Date:   Tue Apr 14 17:07:22 2015 +0800

    drm: fix trivial typo mistake
    
    Signed-off-by: John Hunter &lt;zhjwpku@gmail.com&gt;
    Signed-off-by: Daniel Vetter &lt;daniel.vetter@ffwll.ch&gt;

diff --git a/include/drm/drm_crtc.h b/include/drm/drm_crtc.h
index 97c33b40005f..b009d707f562 100644
--- a/include/drm/drm_crtc.h
+++ b/include/drm/drm_crtc.h
@@ -975,7 +975,7 @@ struct drm_mode_set {
  * struct drm_mode_config_funcs - basic driver provided mode setting functions
  * @fb_create: create a new framebuffer object
  * @output_poll_changed: function to handle output configuration changes
- * @atomic_check: check whether a give atomic state update is possible
+ * @atomic_check: check whether a given atomic state update is possible
  * @atomic_commit: commit an atomic state update previously verified with
  * 	atomic_check()
  *</pre><hr><pre>commit 16d78bc2e4d69df962a750ac37ce69dd8eda401b
Author: John Hunter &lt;zhaojunwang@pku.edu.cn&gt;
Date:   Tue Apr 7 19:38:50 2015 +0800

    drm: Fix some typos
    
    Signed-off-by: John Hunter &lt;zhjwpku@gmail.com&gt;
    Signed-off-by: Daniel Vetter &lt;daniel.vetter@ffwll.ch&gt;

diff --git a/drivers/gpu/drm/drm_atomic.c b/drivers/gpu/drm/drm_atomic.c
index 57efdbeff008..0537f327b145 100644
--- a/drivers/gpu/drm/drm_atomic.c
+++ b/drivers/gpu/drm/drm_atomic.c
@@ -780,7 +780,7 @@ drm_atomic_set_crtc_for_plane(struct drm_plane_state *plane_state,
 EXPORT_SYMBOL(drm_atomic_set_crtc_for_plane);
 
 /**
- * drm_atomic_set_fb_for_plane - set crtc for plane
+ * drm_atomic_set_fb_for_plane - set framebuffer for plane
  * @plane_state: atomic state object for the plane
  * @fb: fb to use for the plane
  *
@@ -933,7 +933,7 @@ EXPORT_SYMBOL(drm_atomic_connectors_for_crtc);
  *
  * This function should be used by legacy entry points which don't understand
  * -EDEADLK semantics. For simplicity this one will grab all modeset locks after
- *  the slowpath completed.
+ * the slowpath completed.
  */
 void drm_atomic_legacy_backoff(struct drm_atomic_state *state)
 {</pre><hr><pre>commit 0388df05088def7ce5f3dd1b2293f05739be2a23
Author: John Hunter &lt;zhaojunwang@pku.edu.cn&gt;
Date:   Tue Mar 17 15:30:28 2015 +0800

    drm: change connector to tmp_connector
    
    This wasn't too harmful since we already look at connector,
    which has the same effect as the loop for any non-cloned configs.
    Only when we have a cloned configuration is it important to look
    at other connectors. Furthermore existing userspace always changes
    dpms on all of them anyway.
    
    Signed-off-by: JohnHunter &lt;zhjwpku@gmail.com&gt;
    Signed-off-by: Daniel Vetter &lt;daniel.vetter@ffwll.ch&gt;

diff --git a/drivers/gpu/drm/drm_atomic_helper.c b/drivers/gpu/drm/drm_atomic_helper.c
index 52e7e18c102a..d9ed9a54fd1e 100644
--- a/drivers/gpu/drm/drm_atomic_helper.c
+++ b/drivers/gpu/drm/drm_atomic_helper.c
@@ -2001,10 +2001,10 @@ void drm_atomic_helper_connector_dpms(struct drm_connector *connector,
 	WARN_ON(!drm_modeset_is_locked(&amp;config-&gt;connection_mutex));
 
 	list_for_each_entry(tmp_connector, &amp;config-&gt;connector_list, head) {
-		if (connector-&gt;state-&gt;crtc != crtc)
+		if (tmp_connector-&gt;state-&gt;crtc != crtc)
 			continue;
 
-		if (connector-&gt;dpms == DRM_MODE_DPMS_ON) {
+		if (tmp_connector-&gt;dpms == DRM_MODE_DPMS_ON) {
 			active = true;
 			break;
 		}</pre><hr><pre>commit f98bd3eff592fa708bb260cf3c6403e443cd40b7
Author: John Hunter &lt;zhaojunwang@pku.edu.cn&gt;
Date:   Tue Mar 17 15:30:26 2015 +0800

    drm: Fix some typo mistake of the annotations
    
    There are some mistakes that the function name in the annotaions
    is not matching the real function name.
    And some duplication word in annotations
    
    Signed-off-by: John Hunter &lt;zhjwpku@gmail.com&gt;
    Signed-off-by: Daniel Vetter &lt;daniel.vetter@ffwll.ch&gt;

diff --git a/drivers/gpu/drm/drm_atomic_helper.c b/drivers/gpu/drm/drm_atomic_helper.c
index 5bcb4baeb9cb..52e7e18c102a 100644
--- a/drivers/gpu/drm/drm_atomic_helper.c
+++ b/drivers/gpu/drm/drm_atomic_helper.c
@@ -346,7 +346,7 @@ needs_modeset(struct drm_crtc_state *state)
 }
 
 /**
- * drm_atomic_helper_check - validate state object for modeset changes
+ * drm_atomic_helper_check_modeset - validate state object for modeset changes
  * @dev: DRM device
  * @state: the driver state object
  *
@@ -461,7 +461,7 @@ drm_atomic_helper_check_modeset(struct drm_device *dev,
 EXPORT_SYMBOL(drm_atomic_helper_check_modeset);
 
 /**
- * drm_atomic_helper_check - validate state object for modeset changes
+ * drm_atomic_helper_check_planes - validate state object for planes changes
  * @dev: DRM device
  * @state: the driver state object
  *
@@ -605,7 +605,7 @@ disable_outputs(struct drm_device *dev, struct drm_atomic_state *old_state)
 
 		/*
 		 * Each encoder has at most one connector (since we always steal
-		 * it away), so we won't call call disable hooks twice.
+		 * it away), so we won't call disable hooks twice.
 		 */
 		if (encoder-&gt;bridge)
 			encoder-&gt;bridge-&gt;funcs-&gt;disable(encoder-&gt;bridge);
@@ -757,7 +757,7 @@ crtc_set_mode(struct drm_device *dev, struct drm_atomic_state *old_state)
 
 		/*
 		 * Each encoder has at most one connector (since we always steal
-		 * it away), so we won't call call mode_set hooks twice.
+		 * it away), so we won't call mode_set hooks twice.
 		 */
 		if (funcs-&gt;mode_set)
 			funcs-&gt;mode_set(encoder, mode, adjusted_mode);
@@ -858,7 +858,7 @@ void drm_atomic_helper_commit_modeset_enables(struct drm_device *dev,
 
 		/*
 		 * Each encoder has at most one connector (since we always steal
-		 * it away), so we won't call call enable hooks twice.
+		 * it away), so we won't call enable hooks twice.
 		 */
 		if (encoder-&gt;bridge)
 			encoder-&gt;bridge-&gt;funcs-&gt;pre_enable(encoder-&gt;bridge);
@@ -1025,7 +1025,7 @@ int drm_atomic_helper_commit(struct drm_device *dev,
 
 	/*
 	 * Everything below can be run asynchronously without the need to grab
-	 * any modeset locks at all under one conditions: It must be guaranteed
+	 * any modeset locks at all under one condition: It must be guaranteed
 	 * that the asynchronous work has either been cancelled (if the driver
 	 * supports it, which at least requires that the framebuffers get
 	 * cleaned up with drm_atomic_helper_cleanup_planes()) or completed</pre><hr><pre>commit ceebf4d5016bd1182b214eafd46ebd24d6cdf668
Author: Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;
Date:   Tue May 27 07:53:10 2014 +0800

    UniCore32: Change git tree location information in MAINTAINERS
    
    UniCore32 git repo has moved to github.
    Branch 'unicore32' is used for prepared patches, and automatically merged to linux-next.
    Branch 'unicore32-working' is used for development.
    
    Signed-off-by: Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;

diff --git a/MAINTAINERS b/MAINTAINERS
index e36d18d8f0eb..ddf53ff84053 100644
--- a/MAINTAINERS
+++ b/MAINTAINERS
@@ -6960,7 +6960,7 @@ PKUNITY SOC DRIVERS
 M:	Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;
 W:	http://mprc.pku.edu.cn/~guanxuetao/linux
 S:	Maintained
-T:	git git://git.kernel.org/pub/scm/linux/kernel/git/epip/linux-2.6-unicore32.git
+T:	git git://github.com/gxt/linux.git
 F:	drivers/input/serio/i8042-unicore32io.h
 F:	drivers/i2c/busses/i2c-puv3.c
 F:	drivers/video/fb-puv3.c
@@ -9277,7 +9277,7 @@ UNICORE32 ARCHITECTURE:
 M:	Guan Xuetao &lt;gxt@mprc.pku.edu.cn&gt;
 W:	http://mprc.pku.edu.cn/~guanxuetao/linux
 S:	Maintained
-T:	git git://git.kernel.org/pub/scm/linux/kernel/git/epip/linux-2.6-unicore32.git
+T:	git git://github.com/gxt/linux.git
 F:	arch/unicore32/
 
 UNIFDEF</pre>
    <div class="pagination">
        <a href='11_2.html'>&lt;&lt;Prev</a><a href='11.html'>1</a><a href='11_2.html'>2</a><span>[3]</span><a href='11_4.html'>4</a><a href='11_5.html'>5</a><a href='11_6.html'>6</a><a href='11_7.html'>7</a><a href='11_8.html'>8</a><a href='11_9.html'>9</a><a href='11_10.html'>10</a><a href='11_4.html'>Next&gt;&gt;</a>
    <div>
</body>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Virginia Tech</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Virginia Tech</h1>
    <div class="pagination">
        <a href='10_9.html'>&lt;&lt;Prev</a><a href='10.html'>1</a><a href='10_2.html'>2</a><a href='10_3.html'>3</a><a href='10_4.html'>4</a><a href='10_5.html'>5</a><a href='10_6.html'>6</a><a href='10_7.html'>7</a><a href='10_8.html'>8</a><a href='10_9.html'>9</a><span>[10]</span><a href='10_11.html'>11</a><a href='10_12.html'>12</a><a href='10_11.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 7f6ab07293c8ee6a64783b01840189f894dc3f16
Author: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
Date:   Tue Dec 22 19:36:51 2015 -0500

    drivers/staging/lustre: Clean up another C warnining: set but not used
    
    drivers/staging/lustre/lustre/fid/../include/lustre_cfg.h: In function 'lustre_cfg_free':
    drivers/staging/lustre/lustre/fid/../include/lustre_cfg.h:253:6: warning: variable 'len' set but not used [-Wunused-but-set-variable]
      int len;
    
    Yep, we're just gonna call kfree, no need to calculate len. Bye-bye.
    
    Signed-off-by: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;

diff --git a/drivers/staging/lustre/lustre/include/lustre_cfg.h b/drivers/staging/lustre/lustre/include/lustre_cfg.h
index eb6b292b7b25..d30d8b054c92 100644
--- a/drivers/staging/lustre/lustre/include/lustre_cfg.h
+++ b/drivers/staging/lustre/lustre/include/lustre_cfg.h
@@ -252,10 +252,6 @@ static inline struct lustre_cfg *lustre_cfg_new(int cmd,
 
 static inline void lustre_cfg_free(struct lustre_cfg *lcfg)
 {
-	int len;
-
-	len = lustre_cfg_len(lcfg-&gt;lcfg_bufcount, lcfg-&gt;lcfg_buflens);
-
 	kfree(lcfg);
 	return;
 }</pre><hr><pre>commit f65a0922f024d44a73fa113a833e55f4a5033597
Author: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
Date:   Tue Dec 22 19:36:50 2015 -0500

    drivers/staging/lustre: Fix set-but-unused whinge.
    
    drivers/staging/lustre/lustre/fid/lproc_fid.c: In function 'ldebugfs_fid_write_common':
    drivers/staging/lustre/lustre/fid/lproc_fid.c:67:6: warning: variable 'rc' set but not used [-Wunused-but-set-variable]
      int rc;
    
    We fix it by *using* the return code to help bulletproof it.  It says it's
    test code - it should be *more* bulletproof than production, not less.
    
    Signed-off-by: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;

diff --git a/drivers/staging/lustre/lustre/fid/lproc_fid.c b/drivers/staging/lustre/lustre/fid/lproc_fid.c
index 39f2aa32e984..0320b6e83576 100644
--- a/drivers/staging/lustre/lustre/fid/lproc_fid.c
+++ b/drivers/staging/lustre/lustre/fid/lproc_fid.c
@@ -85,6 +85,8 @@ ldebugfs_fid_write_common(const char __user *buffer, size_t count,
 	rc = sscanf(kernbuf, "[%llx - %llx]\n",
 		    (unsigned long long *)&amp;tmp.lsr_start,
 		    (unsigned long long *)&amp;tmp.lsr_end);
+	if (rc != 2)
+		return -EINVAL;
 	if (!range_is_sane(&amp;tmp) || range_is_zero(&amp;tmp) ||
 	    tmp.lsr_start &lt; range-&gt;lsr_start || tmp.lsr_end &gt; range-&gt;lsr_end)
 		return -EINVAL;</pre><hr><pre>commit b8947b399dbbce510183521d80f361df462e4383
Author: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
Date:   Tue Dec 22 19:36:49 2015 -0500

    drivers/staging/lustre: Silence warning about 'inline'
    
    Low-hanging fruit first:
    
      CC [M]  drivers/staging/lustre/lustre/fid/fid_request.o
    In file included from drivers/staging/lustre/lustre/fid/../include/lustre_net.h:66:0,
                     from drivers/staging/lustre/lustre/fid/../include/lustre_lib.h:64,
                     from drivers/staging/lustre/lustre/fid/../include/obd.h:52,
                     from drivers/staging/lustre/lustre/fid/fid_request.c:48:
    drivers/staging/lustre/lustre/fid/../include/lu_object.h:765:1: warning: 'inline' is not at beginning of declaration [-Wold-style-declaration]
     static const inline struct lu_device_operations *
     ^
    
    So we just swap inline and const.  272 warnings gone. :)
    
    Signed-off-by: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;

diff --git a/drivers/staging/lustre/lustre/include/lu_object.h b/drivers/staging/lustre/lustre/include/lu_object.h
index ee1dbb257d5d..0b22e5ee99ac 100644
--- a/drivers/staging/lustre/lustre/include/lu_object.h
+++ b/drivers/staging/lustre/lustre/include/lu_object.h
@@ -756,7 +756,7 @@ static inline const struct lu_fid *lu_object_fid(const struct lu_object *o)
 /**
  * return device operations vector for this object
  */
-static const inline struct lu_device_operations *
+static inline const struct lu_device_operations *
 lu_object_ops(const struct lu_object *o)
 {
 	return o-&gt;lo_dev-&gt;ld_ops;</pre><hr><pre>commit e8dd2d2d641cb2724ee10e76c0ad02e04289c017
Author: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
Date:   Sat Aug 29 17:49:16 2015 -0400

    Silence compiler warning in arch/x86/kvm/emulate.c
    
    Compiler warning:
    
     CC [M]  arch/x86/kvm/emulate.o
    arch/x86/kvm/emulate.c: In function "__do_insn_fetch_bytes":
    arch/x86/kvm/emulate.c:814:9: warning: "linear" may be used uninitialized in this function [-Wmaybe-uninitialized]
    
    GCC is smart enough to realize that the inlined __linearize may return before
    setting the value of linear, but not smart enough to realize the same
    X86EMU_CONTINUE blocks actual use of the value.  However, the value of
    'linear' can only be set to one value, so hoisting the one line of code
    upwards makes GCC happy with the code.
    
    Reported-by: Aruna Hewapathirane &lt;aruna.hewapathirane@gmail.com&gt;
    Tested-by: Aruna Hewapathirane &lt;aruna.hewapathirane@gmail.com&gt;
    Signed-off-by: Valdis Kletnieks &lt;valdis.kletnieks@vt.edu&gt;
    Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;

diff --git a/arch/x86/kvm/emulate.c b/arch/x86/kvm/emulate.c
index e7a4fde5d631..b372a7557c16 100644
--- a/arch/x86/kvm/emulate.c
+++ b/arch/x86/kvm/emulate.c
@@ -650,6 +650,7 @@ static __always_inline int __linearize(struct x86_emulate_ctxt *ctxt,
 	u16 sel;
 
 	la = seg_base(ctxt, addr.seg) + addr.ea;
+	*linear = la;
 	*max_size = 0;
 	switch (mode) {
 	case X86EMUL_MODE_PROT64:
@@ -693,7 +694,6 @@ static __always_inline int __linearize(struct x86_emulate_ctxt *ctxt,
 	}
 	if (insn_aligned(ctxt, size) &amp;&amp; ((la &amp; (size - 1)) != 0))
 		return emulate_gp(ctxt, 0);
-	*linear = la;
 	return X86EMUL_CONTINUE;
 bad:
 	if (addr.seg == VCPU_SREG_SS)</pre><hr><pre>commit 9261dc1de11e158a5f6b4b92c8bf1ef4a02dbf0d
Author: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
Date:   Fri Jan 2 11:19:57 2015 -0500

    x86/build/defconfig: Enable USB_EHCI_TT_NEWSCHED=y
    
    Some Gentoo users are encountering problems because
    USB_EHCI_TT_NEWSCHED isn't set in the defconfig (and Gentoo
    differs from other distros in not providing a distro .config).
    Alan Stern has said there's no reason to not set it, and the
    ability to turn it off at all should probably be yanked:
    
      http://article.gmane.org/gmane.linux.usb.general/119920
    
    This addresses issue:
    
      https://bugs.gentoo.org/show_bug.cgi?id=533472
    
    (The problem also theoretically affects the sh, arm, mips,
    powerpc, and sparc archs, but those would be other patches if
    this one that fixes 98% of the problem is accepted).
    
    Signed-off-by: Valdis Kletnieks &lt;valdis.kletnieks@vt.edu&gt;
    Acked-by: Alan Stern &lt;stern@rowland.harvard.edu&gt;
    Signed-off-by: Ingo Molnar &lt;mingo@kernel.org&gt;

diff --git a/arch/x86/configs/i386_defconfig b/arch/x86/configs/i386_defconfig
index 419819d6dab3..aaa1118bf01e 100644
--- a/arch/x86/configs/i386_defconfig
+++ b/arch/x86/configs/i386_defconfig
@@ -248,7 +248,7 @@ CONFIG_USB=y
 CONFIG_USB_ANNOUNCE_NEW_DEVICES=y
 CONFIG_USB_MON=y
 CONFIG_USB_EHCI_HCD=y
-# CONFIG_USB_EHCI_TT_NEWSCHED is not set
+CONFIG_USB_EHCI_TT_NEWSCHED=y
 CONFIG_USB_OHCI_HCD=y
 CONFIG_USB_UHCI_HCD=y
 CONFIG_USB_PRINTER=y
diff --git a/arch/x86/configs/x86_64_defconfig b/arch/x86/configs/x86_64_defconfig
index 4c311ddd973b..315b86106572 100644
--- a/arch/x86/configs/x86_64_defconfig
+++ b/arch/x86/configs/x86_64_defconfig
@@ -243,7 +243,7 @@ CONFIG_USB=y
 CONFIG_USB_ANNOUNCE_NEW_DEVICES=y
 CONFIG_USB_MON=y
 CONFIG_USB_EHCI_HCD=y
-# CONFIG_USB_EHCI_TT_NEWSCHED is not set
+CONFIG_USB_EHCI_TT_NEWSCHED=y
 CONFIG_USB_OHCI_HCD=y
 CONFIG_USB_UHCI_HCD=y
 CONFIG_USB_PRINTER=y</pre><hr><pre>commit 69204cf7eb9c5a72067ce6922d4699378251d053
Author: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
Date:   Tue Dec 9 16:15:50 2014 -0500

    net: fix suspicious rcu_dereference_check in net/sched/sch_fq_codel.c
    
    commit 46e5da40ae (net: qdisc: use rcu prefix and silence
     sparse warnings) triggers a spurious warning:
    
    net/sched/sch_fq_codel.c:97 suspicious rcu_dereference_check() usage!
    
    The code should be using the _bh variant of rcu_dereference.
    
    Signed-off-by: Valdis Kletnieks &lt;valdis.kletnieks@vt.edu&gt;
    Acked-by: Eric Dumazet &lt;edumazet@google.com&gt;
    Acked-by: John Fastabend &lt;john.r.fastabend@intel.com&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/net/sched/sch_fq_codel.c b/net/sched/sch_fq_codel.c
index b9ca32ebc1de..1e52decb7b59 100644
--- a/net/sched/sch_fq_codel.c
+++ b/net/sched/sch_fq_codel.c
@@ -94,7 +94,7 @@ static unsigned int fq_codel_classify(struct sk_buff *skb, struct Qdisc *sch,
 	    TC_H_MIN(skb-&gt;priority) &lt;= q-&gt;flows_cnt)
 		return TC_H_MIN(skb-&gt;priority);
 
-	filter = rcu_dereference(q-&gt;filter_list);
+	filter = rcu_dereference_bh(q-&gt;filter_list);
 	if (!filter)
 		return fq_codel_hash(q, skb) + 1;
 </pre><hr><pre>commit d4bf205da618bbd0b038e404d646f14e76915718
Author: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
Date:   Sun Oct 12 23:09:08 2014 -0400

    pstore: Fix duplicate {console,ftrace}-efi entries
    
    The pstore filesystem still creates duplicate filename/inode pairs for
    some pstore types.  Add the id to the filename to prevent that.
    
    Before patch:
    
    [/sys/fs/pstore] ls -li
    total 0
    1250 -r--r--r--. 1 root root 67 Sep 29 17:09 console-efi
    1250 -r--r--r--. 1 root root 67 Sep 29 17:09 console-efi
    1250 -r--r--r--. 1 root root 67 Sep 29 17:09 console-efi
    1250 -r--r--r--. 1 root root 67 Sep 29 17:09 console-efi
    1250 -r--r--r--. 1 root root 67 Sep 29 17:09 console-efi
    1250 -r--r--r--. 1 root root 67 Sep 29 17:09 console-efi
    1250 -r--r--r--. 1 root root 67 Sep 29 17:09 console-efi
    1250 -r--r--r--. 1 root root 67 Sep 29 17:09 console-efi
    1250 -r--r--r--. 1 root root 67 Sep 29 17:09 console-efi
    
    After:
    
    [/sys/fs/pstore] ls -li
    total 0
    1232 -r--r--r--. 1 root root 148 Sep 29 17:09 console-efi-141202499100000
    1231 -r--r--r--. 1 root root  67 Sep 29 17:09 console-efi-141202499200000
    1230 -r--r--r--. 1 root root 148 Sep 29 17:44 console-efi-141202705400000
    1229 -r--r--r--. 1 root root  67 Sep 29 17:44 console-efi-141202705500000
    1228 -r--r--r--. 1 root root  67 Sep 29 20:42 console-efi-141203772600000
    1227 -r--r--r--. 1 root root 148 Sep 29 23:42 console-efi-141204854900000
    1226 -r--r--r--. 1 root root  67 Sep 29 23:42 console-efi-141204855000000
    1225 -r--r--r--. 1 root root 148 Sep 29 23:59 console-efi-141204954200000
    1224 -r--r--r--. 1 root root  67 Sep 29 23:59 console-efi-141204954400000
    
    Signed-off-by: Valdis Kletnieks &lt;valdis.kletnieks@vt.edu&gt;
    Acked-by: Kees Cook &lt;keescook@chromium.org&gt;
    Cc: stable@vger.kernel.org # 3.6+
    Signed-off-by: Tony Luck &lt;tony.luck@intel.com&gt;

diff --git a/fs/pstore/inode.c b/fs/pstore/inode.c
index 192297b0090d..fafb7a02a5d6 100644
--- a/fs/pstore/inode.c
+++ b/fs/pstore/inode.c
@@ -320,10 +320,10 @@ int pstore_mkfile(enum pstore_type_id type, char *psname, u64 id, int count,
 						compressed ? ".enc.z" : "");
 		break;
 	case PSTORE_TYPE_CONSOLE:
-		sprintf(name, "console-%s", psname);
+		sprintf(name, "console-%s-%lld", psname, id);
 		break;
 	case PSTORE_TYPE_FTRACE:
-		sprintf(name, "ftrace-%s", psname);
+		sprintf(name, "ftrace-%s-%lld", psname, id);
 		break;
 	case PSTORE_TYPE_MCE:
 		sprintf(name, "mce-%s-%lld", psname, id);</pre><hr><pre>commit 79d99c305fd4edb9ee11ff57f43dc961ad684ab6
Author: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
Date:   Mon Sep 8 18:09:48 2014 -0400

    staging/rtl8192u - check for skb alloc failure
    
    It's possible for dev_alloc_skb() to fail. Propagate the error to the caller,
    so it can clean up and drop the packet. The sender should end up retransmitting
    the packet, hopefully at a time we're prepared to allocate skb's again.
    
    Reported-By: Nicholas Krause &lt;xerofoify@gmail.com&gt;
    Signed-Off-By: Valdis Kletnieks &lt;valdis.kletnieks@vt.edu&gt;
    
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;

diff --git a/drivers/staging/rtl8192u/ieee80211/ieee80211_rx.c b/drivers/staging/rtl8192u/ieee80211/ieee80211_rx.c
index 40da37fdbcdc..73de9e9669f6 100644
--- a/drivers/staging/rtl8192u/ieee80211/ieee80211_rx.c
+++ b/drivers/staging/rtl8192u/ieee80211/ieee80211_rx.c
@@ -847,6 +847,8 @@ static u8 parse_subframe(struct sk_buff *skb,
 #else
 			/* Allocate new skb for releasing to upper layer */
 			sub_skb = dev_alloc_skb(nSubframe_Length + 12);
+			if (!sub_skb)
+				return 0;
 			skb_reserve(sub_skb, 12);
 			data_ptr = (u8 *)skb_put(sub_skb, nSubframe_Length);
 			memcpy(data_ptr, skb-&gt;data, nSubframe_Length);</pre><hr><pre>commit 015af06e103fa47af29ada0f564301c81d4973b2
Author: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
Date:   Tue May 27 14:28:59 2014 -0400

    kernel/workqueue.c: pr_warning/pr_warn &amp; printk/pr_info
    
    This commit did an incorrect printk-&gt;pr_info conversion. If we were
    converting to pr_info() we should lose the log_level parameter. The problem is
    that this is called (indirectly) by show_regs_print_info(), which is called
    with various log_levels (from _INFO clear to _EMERG). So we leave it as
    a printk() call so the desired log_level is applied.
    
    Not a full revert, as the other half of the patch is correct.
    
    Signed-off-by: Valdis Kletnieks &lt;valdis.kletnieks@vt.edu&gt;
    Signed-off-by: Tejun Heo &lt;tj@kernel.org&gt;

diff --git a/kernel/workqueue.c b/kernel/workqueue.c
index bc3c18892b7d..90a0fa592b72 100644
--- a/kernel/workqueue.c
+++ b/kernel/workqueue.c
@@ -4440,7 +4440,7 @@ void print_worker_info(const char *log_lvl, struct task_struct *task)
 		probe_kernel_read(desc, worker-&gt;desc, sizeof(desc) - 1);
 
 	if (fn || name[0] || desc[0]) {
-		pr_info("%sWorkqueue: %s %pf", log_lvl, name, fn);
+		printk("%sWorkqueue: %s %pf", log_lvl, name, fn);
 		if (desc[0])
 			pr_cont(" (%s)", desc);
 		pr_cont("\n");</pre><hr><pre>commit 5d1fadc1472396d602f0eeb10d37519e2a14e8bc
Author: Valdis Kletnieks &lt;Valdis.Kletnieks@vt.edu&gt;
Date:   Wed Feb 27 17:03:13 2013 -0800

    kernel/signal.c: fix suboptimal printk usage
    
    Several printk's were missing KERN_INFO and KERN_CONT flags.  In
    addition, a printk that was outside a #if/#endif should have been
    inside, which would result in stray blank line on non-x86 boxes.
    
    Signed-off-by: Valdis Kletnieks &lt;valdis.kletnieks@vt.edu&gt;
    Cc: Oleg Nesterov &lt;oleg@redhat.com&gt;
    Signed-off-by: Andrew Morton &lt;akpm@linux-foundation.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;

diff --git a/kernel/signal.c b/kernel/signal.c
index c6209135cca4..2676aac4103d 100644
--- a/kernel/signal.c
+++ b/kernel/signal.c
@@ -1157,11 +1157,11 @@ static int send_signal(int sig, struct siginfo *info, struct task_struct *t,
 static void print_fatal_signal(int signr)
 {
 	struct pt_regs *regs = signal_pt_regs();
-	printk("%s/%d: potentially unexpected fatal signal %d.\n",
+	printk(KERN_INFO "%s/%d: potentially unexpected fatal signal %d.\n",
 		current-&gt;comm, task_pid_nr(current), signr);
 
 #if defined(__i386__) &amp;&amp; !defined(__arch_um__)
-	printk("code at %08lx: ", regs-&gt;ip);
+	printk(KERN_INFO "code at %08lx: ", regs-&gt;ip);
 	{
 		int i;
 		for (i = 0; i &lt; 16; i++) {
@@ -1169,11 +1169,11 @@ static void print_fatal_signal(int signr)
 
 			if (get_user(insn, (unsigned char *)(regs-&gt;ip + i)))
 				break;
-			printk("%02x ", insn);
+			printk(KERN_CONT "%02x ", insn);
 		}
 	}
+	printk(KERN_CONT "\n");
 #endif
-	printk("\n");
 	preempt_disable();
 	show_regs(regs);
 	preempt_enable();</pre>
    <div class="pagination">
        <a href='10_9.html'>&lt;&lt;Prev</a><a href='10.html'>1</a><a href='10_2.html'>2</a><a href='10_3.html'>3</a><a href='10_4.html'>4</a><a href='10_5.html'>5</a><a href='10_6.html'>6</a><a href='10_7.html'>7</a><a href='10_8.html'>8</a><a href='10_9.html'>9</a><span>[10]</span><a href='10_11.html'>11</a><a href='10_12.html'>12</a><a href='10_11.html'>Next&gt;&gt;</a>
    <div>
</body>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by State University of New York at Stony Brook</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by State University of New York at Stony Brook</h1>
    <div class="pagination">
        <a href='9_11.html'>&lt;&lt;Prev</a><a href='9.html'>1</a><a href='9_2.html'>2</a><a href='9_3.html'>3</a><a href='9_4.html'>4</a><a href='9_5.html'>5</a><a href='9_6.html'>6</a><a href='9_7.html'>7</a><a href='9_8.html'>8</a><a href='9_9.html'>9</a><a href='9_10.html'>10</a><a href='9_11.html'>11</a><span>[12]</span><a href='9_13.html'>13</a><a href='9_14.html'>14</a><a href='9_13.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 867fa491a2722cee6964a30dfda86e0e02dcb400
Author: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:47 2006 -0800

    [PATCH] configfs: change uses of f_{dentry, vfsmnt} to use f_path
    
    Change all the uses of f_{dentry,vfsmnt} to f_path.{dentry,mnt} in the
    configfs filesystem.
    
    Signed-off-by: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/configfs/dir.c b/fs/configfs/dir.c
index c398861f78a5..1814ba446809 100644
--- a/fs/configfs/dir.c
+++ b/fs/configfs/dir.c
@@ -980,7 +980,7 @@ int configfs_rename_dir(struct config_item * item, const char *new_name)
 
 static int configfs_dir_open(struct inode *inode, struct file *file)
 {
-	struct dentry * dentry = file-&gt;f_dentry;
+	struct dentry * dentry = file-&gt;f_path.dentry;
 	struct configfs_dirent * parent_sd = dentry-&gt;d_fsdata;
 
 	mutex_lock(&amp;dentry-&gt;d_inode-&gt;i_mutex);
@@ -993,7 +993,7 @@ static int configfs_dir_open(struct inode *inode, struct file *file)
 
 static int configfs_dir_close(struct inode *inode, struct file *file)
 {
-	struct dentry * dentry = file-&gt;f_dentry;
+	struct dentry * dentry = file-&gt;f_path.dentry;
 	struct configfs_dirent * cursor = file-&gt;private_data;
 
 	mutex_lock(&amp;dentry-&gt;d_inode-&gt;i_mutex);
@@ -1013,7 +1013,7 @@ static inline unsigned char dt_type(struct configfs_dirent *sd)
 
 static int configfs_readdir(struct file * filp, void * dirent, filldir_t filldir)
 {
-	struct dentry *dentry = filp-&gt;f_dentry;
+	struct dentry *dentry = filp-&gt;f_path.dentry;
 	struct configfs_dirent * parent_sd = dentry-&gt;d_fsdata;
 	struct configfs_dirent *cursor = filp-&gt;private_data;
 	struct list_head *p, *q = &amp;cursor-&gt;s_sibling;
@@ -1070,7 +1070,7 @@ static int configfs_readdir(struct file * filp, void * dirent, filldir_t filldir
 
 static loff_t configfs_dir_lseek(struct file * file, loff_t offset, int origin)
 {
-	struct dentry * dentry = file-&gt;f_dentry;
+	struct dentry * dentry = file-&gt;f_path.dentry;
 
 	mutex_lock(&amp;dentry-&gt;d_inode-&gt;i_mutex);
 	switch (origin) {
@@ -1080,7 +1080,7 @@ static loff_t configfs_dir_lseek(struct file * file, loff_t offset, int origin)
 			if (offset &gt;= 0)
 				break;
 		default:
-			mutex_unlock(&amp;file-&gt;f_dentry-&gt;d_inode-&gt;i_mutex);
+			mutex_unlock(&amp;file-&gt;f_path.dentry-&gt;d_inode-&gt;i_mutex);
 			return -EINVAL;
 	}
 	if (offset != file-&gt;f_pos) {
diff --git a/fs/configfs/file.c b/fs/configfs/file.c
index cf33fac68c84..2a7cb086e80c 100644
--- a/fs/configfs/file.c
+++ b/fs/configfs/file.c
@@ -134,7 +134,7 @@ configfs_read_file(struct file *file, char __user *buf, size_t count, loff_t *pp
 
 	down(&amp;buffer-&gt;sem);
 	if (buffer-&gt;needs_read_fill) {
-		if ((retval = fill_read_buffer(file-&gt;f_dentry,buffer)))
+		if ((retval = fill_read_buffer(file-&gt;f_path.dentry,buffer)))
 			goto out;
 	}
 	pr_debug("%s: count = %zd, ppos = %lld, buf = %s\n",
@@ -222,7 +222,7 @@ configfs_write_file(struct file *file, const char __user *buf, size_t count, lof
 	down(&amp;buffer-&gt;sem);
 	len = fill_write_buffer(buffer, buf, count);
 	if (len &gt; 0)
-		len = flush_write_buffer(file-&gt;f_dentry, buffer, count);
+		len = flush_write_buffer(file-&gt;f_path.dentry, buffer, count);
 	if (len &gt; 0)
 		*ppos += len;
 	up(&amp;buffer-&gt;sem);
@@ -231,8 +231,8 @@ configfs_write_file(struct file *file, const char __user *buf, size_t count, lof
 
 static int check_perm(struct inode * inode, struct file * file)
 {
-	struct config_item *item = configfs_get_config_item(file-&gt;f_dentry-&gt;d_parent);
-	struct configfs_attribute * attr = to_attr(file-&gt;f_dentry);
+	struct config_item *item = configfs_get_config_item(file-&gt;f_path.dentry-&gt;d_parent);
+	struct configfs_attribute * attr = to_attr(file-&gt;f_path.dentry);
 	struct configfs_buffer * buffer;
 	struct configfs_item_operations * ops = NULL;
 	int error = 0;
@@ -305,8 +305,8 @@ static int configfs_open_file(struct inode * inode, struct file * filp)
 
 static int configfs_release(struct inode * inode, struct file * filp)
 {
-	struct config_item * item = to_item(filp-&gt;f_dentry-&gt;d_parent);
-	struct configfs_attribute * attr = to_attr(filp-&gt;f_dentry);
+	struct config_item * item = to_item(filp-&gt;f_path.dentry-&gt;d_parent);
+	struct configfs_attribute * attr = to_attr(filp-&gt;f_path.dentry);
 	struct module * owner = attr-&gt;ca_owner;
 	struct configfs_buffer * buffer = filp-&gt;private_data;
 </pre><hr><pre>commit a4669ed8ed982dab494c5d4f2b32921e5a6531d8
Author: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:46 2006 -0800

    [PATCH] autofs4: change uses of f_{dentry, vfsmnt} to use f_path
    
    Change all the uses of f_{dentry,vfsmnt} to f_path.{dentry,mnt} in the autofs4
    filesystem.
    
    Signed-off-by: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/autofs4/autofs_i.h b/fs/autofs4/autofs_i.h
index b13f32c8aeee..216b1a364ccb 100644
--- a/fs/autofs4/autofs_i.h
+++ b/fs/autofs4/autofs_i.h
@@ -150,7 +150,8 @@ static inline int autofs4_ispending(struct dentry *dentry)
 
 static inline void autofs4_copy_atime(struct file *src, struct file *dst)
 {
-	dst-&gt;f_dentry-&gt;d_inode-&gt;i_atime = src-&gt;f_dentry-&gt;d_inode-&gt;i_atime;
+	dst-&gt;f_path.dentry-&gt;d_inode-&gt;i_atime =
+		src-&gt;f_path.dentry-&gt;d_inode-&gt;i_atime;
 	return;
 }
 
diff --git a/fs/autofs4/root.c b/fs/autofs4/root.c
index c1493524da4d..8d05b9f7578d 100644
--- a/fs/autofs4/root.c
+++ b/fs/autofs4/root.c
@@ -74,7 +74,7 @@ struct inode_operations autofs4_dir_inode_operations = {
 static int autofs4_root_readdir(struct file *file, void *dirent,
 				filldir_t filldir)
 {
-	struct autofs_sb_info *sbi = autofs4_sbi(file-&gt;f_dentry-&gt;d_sb);
+	struct autofs_sb_info *sbi = autofs4_sbi(file-&gt;f_path.dentry-&gt;d_sb);
 	int oz_mode = autofs4_oz_mode(sbi);
 
 	DPRINTK("called, filp-&gt;f_pos = %lld", file-&gt;f_pos);
@@ -95,8 +95,8 @@ static int autofs4_root_readdir(struct file *file, void *dirent,
 
 static int autofs4_dir_open(struct inode *inode, struct file *file)
 {
-	struct dentry *dentry = file-&gt;f_dentry;
-	struct vfsmount *mnt = file-&gt;f_vfsmnt;
+	struct dentry *dentry = file-&gt;f_path.dentry;
+	struct vfsmount *mnt = file-&gt;f_path.mnt;
 	struct autofs_sb_info *sbi = autofs4_sbi(dentry-&gt;d_sb);
 	struct dentry *cursor;
 	int status;
@@ -172,7 +172,7 @@ static int autofs4_dir_open(struct inode *inode, struct file *file)
 
 static int autofs4_dir_close(struct inode *inode, struct file *file)
 {
-	struct dentry *dentry = file-&gt;f_dentry;
+	struct dentry *dentry = file-&gt;f_path.dentry;
 	struct autofs_sb_info *sbi = autofs4_sbi(dentry-&gt;d_sb);
 	struct dentry *cursor = file-&gt;private_data;
 	int status = 0;
@@ -204,7 +204,7 @@ static int autofs4_dir_close(struct inode *inode, struct file *file)
 
 static int autofs4_dir_readdir(struct file *file, void *dirent, filldir_t filldir)
 {
-	struct dentry *dentry = file-&gt;f_dentry;
+	struct dentry *dentry = file-&gt;f_path.dentry;
 	struct autofs_sb_info *sbi = autofs4_sbi(dentry-&gt;d_sb);
 	struct dentry *cursor = file-&gt;private_data;
 	int status;
@@ -858,14 +858,14 @@ static int autofs4_root_ioctl(struct inode *inode, struct file *filp,
 		return autofs4_ask_reghost(sbi, p);
 
 	case AUTOFS_IOC_ASKUMOUNT:
-		return autofs4_ask_umount(filp-&gt;f_vfsmnt, p);
+		return autofs4_ask_umount(filp-&gt;f_path.mnt, p);
 
 	/* return a single thing to expire */
 	case AUTOFS_IOC_EXPIRE:
-		return autofs4_expire_run(inode-&gt;i_sb,filp-&gt;f_vfsmnt,sbi, p);
+		return autofs4_expire_run(inode-&gt;i_sb,filp-&gt;f_path.mnt,sbi, p);
 	/* same as above, but can send multiple expires through pipe */
 	case AUTOFS_IOC_EXPIRE_MULTI:
-		return autofs4_expire_multi(inode-&gt;i_sb,filp-&gt;f_vfsmnt,sbi, p);
+		return autofs4_expire_multi(inode-&gt;i_sb,filp-&gt;f_path.mnt,sbi, p);
 
 	default:
 		return -ENOSYS;</pre><hr><pre>commit 81ed19b076f518e793283ccbd004fd0888877201
Author: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:46 2006 -0800

    [PATCH] autofs: change uses of f_{dentry, vfsmnt} to use f_path
    
    Change all the uses of f_{dentry,vfsmnt} to f_path.{dentry,mnt} in the autofs
    filesystem.
    
    Signed-off-by: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/autofs/root.c b/fs/autofs/root.c
index 368a1c33a3c8..e698c51d2b02 100644
--- a/fs/autofs/root.c
+++ b/fs/autofs/root.c
@@ -45,7 +45,7 @@ static int autofs_root_readdir(struct file *filp, void *dirent, filldir_t filldi
 	struct autofs_dir_ent *ent = NULL;
 	struct autofs_dirhash *dirhash;
 	struct autofs_sb_info *sbi;
-	struct inode * inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode * inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	off_t onr, nr;
 
 	lock_kernel();
@@ -557,7 +557,7 @@ static int autofs_root_ioctl(struct inode *inode, struct file *filp,
 	case AUTOFS_IOC_SETTIMEOUT:
 		return autofs_get_set_timeout(sbi, argp);
 	case AUTOFS_IOC_EXPIRE:
-		return autofs_expire_run(inode-&gt;i_sb, sbi, filp-&gt;f_vfsmnt,
+		return autofs_expire_run(inode-&gt;i_sb, sbi, filp-&gt;f_path.mnt,
 					 argp);
 	default:
 		return -ENOSYS;</pre><hr><pre>commit 010596cc311131421c7be3a73ee7174bda16d322
Author: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:45 2006 -0800

    [PATCH] affs: change uses of f_{dentry, vfsmnt} to use f_path
    
    Change all the uses of f_{dentry,vfsmnt} to f_path.{dentry,mnt} in the affs
    filesystem.
    
    Signed-off-by: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/affs/dir.c b/fs/affs/dir.c
index 5d9649fa1814..cad3ee340063 100644
--- a/fs/affs/dir.c
+++ b/fs/affs/dir.c
@@ -41,7 +41,7 @@ struct inode_operations affs_dir_inode_operations = {
 static int
 affs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
-	struct inode		*inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode		*inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct super_block	*sb = inode-&gt;i_sb;
 	struct buffer_head	*dir_bh;
 	struct buffer_head	*fh_bh;
@@ -71,7 +71,7 @@ affs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 		stored++;
 	}
 	if (f_pos == 1) {
-		if (filldir(dirent, "..", 2, f_pos, parent_ino(filp-&gt;f_dentry), DT_DIR) &lt; 0)
+		if (filldir(dirent, "..", 2, f_pos, parent_ino(filp-&gt;f_path.dentry), DT_DIR) &lt; 0)
 			return stored;
 		filp-&gt;f_pos = f_pos = 2;
 		stored++;</pre><hr><pre>commit d6f787bceeab37cd6b0823872efe01b2a20effb5
Author: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:45 2006 -0800

    [PATCH] 9p: change uses of f_{dentry,vfsmnt} to use f_path
    
    Change all the uses of f_{dentry,vfsmnt} to f_path.{dentry,mnt} in the 9p
    filesystem.
    
    Signed-off-by: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/9p/vfs_addr.c b/fs/9p/vfs_addr.c
index 9dfd259a70b4..cc24abf232d5 100644
--- a/fs/9p/vfs_addr.c
+++ b/fs/9p/vfs_addr.c
@@ -54,7 +54,7 @@ static int v9fs_vfs_readpage(struct file *filp, struct page *page)
 	int retval = -EIO;
 	loff_t offset = page_offset(page);
 	int count = PAGE_CACHE_SIZE;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct v9fs_session_info *v9ses = v9fs_inode2v9ses(inode);
 	int rsize = v9ses-&gt;maxdata - V9FS_IOHDRSZ;
 	struct v9fs_fid *v9f = filp-&gt;private_data;
diff --git a/fs/9p/vfs_dir.c b/fs/9p/vfs_dir.c
index 905c882f4e2f..3129688143ea 100644
--- a/fs/9p/vfs_dir.c
+++ b/fs/9p/vfs_dir.c
@@ -71,7 +71,7 @@ static inline int dt_type(struct v9fs_stat *mistat)
 static int v9fs_dir_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
 	struct v9fs_fcall *fcall = NULL;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct v9fs_session_info *v9ses = v9fs_inode2v9ses(inode);
 	struct v9fs_fid *file = filp-&gt;private_data;
 	unsigned int i, n, s;
@@ -80,7 +80,7 @@ static int v9fs_dir_readdir(struct file *filp, void *dirent, filldir_t filldir)
 	struct v9fs_stat stat;
 	int over = 0;
 
-	dprintk(DEBUG_VFS, "name %s\n", filp-&gt;f_dentry-&gt;d_name.name);
+	dprintk(DEBUG_VFS, "name %s\n", filp-&gt;f_path.dentry-&gt;d_name.name);
 
 	fid = file-&gt;fid;
 
diff --git a/fs/9p/vfs_file.c b/fs/9p/vfs_file.c
index 79e6f9cd7340..e86a07151280 100644
--- a/fs/9p/vfs_file.c
+++ b/fs/9p/vfs_file.c
@@ -60,7 +60,7 @@ int v9fs_file_open(struct inode *inode, struct file *file)
 
 	dprintk(DEBUG_VFS, "inode: %p file: %p \n", inode, file);
 
-	vfid = v9fs_fid_lookup(file-&gt;f_dentry);
+	vfid = v9fs_fid_lookup(file-&gt;f_path.dentry);
 	if (!vfid) {
 		dprintk(DEBUG_ERROR, "Couldn't resolve fid from dentry\n");
 		return -EBADF;
@@ -133,7 +133,7 @@ int v9fs_file_open(struct inode *inode, struct file *file)
 static int v9fs_file_lock(struct file *filp, int cmd, struct file_lock *fl)
 {
 	int res = 0;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 
 	dprintk(DEBUG_VFS, "filp: %p lock: %p\n", filp, fl);
 
@@ -161,7 +161,7 @@ static ssize_t
 v9fs_file_read(struct file *filp, char __user * data, size_t count,
 	       loff_t * offset)
 {
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct v9fs_session_info *v9ses = v9fs_inode2v9ses(inode);
 	struct v9fs_fid *v9f = filp-&gt;private_data;
 	struct v9fs_fcall *fcall = NULL;
@@ -225,7 +225,7 @@ static ssize_t
 v9fs_file_write(struct file *filp, const char __user * data,
 		size_t count, loff_t * offset)
 {
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct v9fs_session_info *v9ses = v9fs_inode2v9ses(inode);
 	struct v9fs_fid *v9fid = filp-&gt;private_data;
 	struct v9fs_fcall *fcall;</pre><hr><pre>commit d3ac7f892b7d07d61d0895caa4f6e190e43112f8
Author: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:44 2006 -0800

    [PATCH] mm: change uses of f_{dentry,vfsmnt} to use f_path
    
    Change all the uses of f_{dentry,vfsmnt} to f_path.{dentry,mnt} in linux/mm/.
    
    Signed-off-by: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/mm/fadvise.c b/mm/fadvise.c
index 168c78a121bb..0df4c899e979 100644
--- a/mm/fadvise.c
+++ b/mm/fadvise.c
@@ -38,7 +38,7 @@ asmlinkage long sys_fadvise64_64(int fd, loff_t offset, loff_t len, int advice)
 	if (!file)
 		return -EBADF;
 
-	if (S_ISFIFO(file-&gt;f_dentry-&gt;d_inode-&gt;i_mode)) {
+	if (S_ISFIFO(file-&gt;f_path.dentry-&gt;d_inode-&gt;i_mode)) {
 		ret = -ESPIPE;
 		goto out;
 	}
diff --git a/mm/filemap.c b/mm/filemap.c
index af7e2f5caea9..606432f71b3a 100644
--- a/mm/filemap.c
+++ b/mm/filemap.c
@@ -2269,7 +2269,7 @@ __generic_file_aio_write_nolock(struct kiocb *iocb, const struct iovec *iov,
 	if (count == 0)
 		goto out;
 
-	err = remove_suid(file-&gt;f_dentry);
+	err = remove_suid(file-&gt;f_path.dentry);
 	if (err)
 		goto out;
 
diff --git a/mm/filemap_xip.c b/mm/filemap_xip.c
index b4fd0d7c9bfb..8d667617f558 100644
--- a/mm/filemap_xip.c
+++ b/mm/filemap_xip.c
@@ -379,7 +379,7 @@ xip_file_write(struct file *filp, const char __user *buf, size_t len,
 	if (count == 0)
 		goto out_backing;
 
-	ret = remove_suid(filp-&gt;f_dentry);
+	ret = remove_suid(filp-&gt;f_path.dentry);
 	if (ret)
 		goto out_backing;
 
diff --git a/mm/mmap.c b/mm/mmap.c
index 7be110e98d4c..9717337293c3 100644
--- a/mm/mmap.c
+++ b/mm/mmap.c
@@ -188,7 +188,7 @@ static void __remove_shared_vm_struct(struct vm_area_struct *vma,
 		struct file *file, struct address_space *mapping)
 {
 	if (vma-&gt;vm_flags &amp; VM_DENYWRITE)
-		atomic_inc(&amp;file-&gt;f_dentry-&gt;d_inode-&gt;i_writecount);
+		atomic_inc(&amp;file-&gt;f_path.dentry-&gt;d_inode-&gt;i_writecount);
 	if (vma-&gt;vm_flags &amp; VM_SHARED)
 		mapping-&gt;i_mmap_writable--;
 
@@ -399,7 +399,7 @@ static inline void __vma_link_file(struct vm_area_struct *vma)
 		struct address_space *mapping = file-&gt;f_mapping;
 
 		if (vma-&gt;vm_flags &amp; VM_DENYWRITE)
-			atomic_dec(&amp;file-&gt;f_dentry-&gt;d_inode-&gt;i_writecount);
+			atomic_dec(&amp;file-&gt;f_path.dentry-&gt;d_inode-&gt;i_writecount);
 		if (vma-&gt;vm_flags &amp; VM_SHARED)
 			mapping-&gt;i_mmap_writable++;
 
@@ -907,7 +907,7 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
 	 *  mounted, in which case we dont add PROT_EXEC.)
 	 */
 	if ((prot &amp; PROT_READ) &amp;&amp; (current-&gt;personality &amp; READ_IMPLIES_EXEC))
-		if (!(file &amp;&amp; (file-&gt;f_vfsmnt-&gt;mnt_flags &amp; MNT_NOEXEC)))
+		if (!(file &amp;&amp; (file-&gt;f_path.mnt-&gt;mnt_flags &amp; MNT_NOEXEC)))
 			prot |= PROT_EXEC;
 
 	if (!len)
@@ -960,7 +960,7 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
 			return -EAGAIN;
 	}
 
-	inode = file ? file-&gt;f_dentry-&gt;d_inode : NULL;
+	inode = file ? file-&gt;f_path.dentry-&gt;d_inode : NULL;
 
 	if (file) {
 		switch (flags &amp; MAP_TYPE) {
@@ -989,7 +989,7 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
 		case MAP_PRIVATE:
 			if (!(file-&gt;f_mode &amp; FMODE_READ))
 				return -EACCES;
-			if (file-&gt;f_vfsmnt-&gt;mnt_flags &amp; MNT_NOEXEC) {
+			if (file-&gt;f_path.mnt-&gt;mnt_flags &amp; MNT_NOEXEC) {
 				if (vm_flags &amp; VM_EXEC)
 					return -EPERM;
 				vm_flags &amp;= ~VM_MAYEXEC;
diff --git a/mm/shmem.c b/mm/shmem.c
index c820b4f77b8d..4bb28d218eb5 100644
--- a/mm/shmem.c
+++ b/mm/shmem.c
@@ -1225,7 +1225,7 @@ static int shmem_getpage(struct inode *inode, unsigned long idx,
 
 struct page *shmem_nopage(struct vm_area_struct *vma, unsigned long address, int *type)
 {
-	struct inode *inode = vma-&gt;vm_file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = vma-&gt;vm_file-&gt;f_path.dentry-&gt;d_inode;
 	struct page *page = NULL;
 	unsigned long idx;
 	int error;
@@ -1248,7 +1248,7 @@ static int shmem_populate(struct vm_area_struct *vma,
 	unsigned long addr, unsigned long len,
 	pgprot_t prot, unsigned long pgoff, int nonblock)
 {
-	struct inode *inode = vma-&gt;vm_file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = vma-&gt;vm_file-&gt;f_path.dentry-&gt;d_inode;
 	struct mm_struct *mm = vma-&gt;vm_mm;
 	enum sgp_type sgp = nonblock? SGP_QUICK: SGP_CACHE;
 	unsigned long size;
@@ -1293,14 +1293,14 @@ static int shmem_populate(struct vm_area_struct *vma,
 #ifdef CONFIG_NUMA
 int shmem_set_policy(struct vm_area_struct *vma, struct mempolicy *new)
 {
-	struct inode *i = vma-&gt;vm_file-&gt;f_dentry-&gt;d_inode;
+	struct inode *i = vma-&gt;vm_file-&gt;f_path.dentry-&gt;d_inode;
 	return mpol_set_shared_policy(&amp;SHMEM_I(i)-&gt;policy, vma, new);
 }
 
 struct mempolicy *
 shmem_get_policy(struct vm_area_struct *vma, unsigned long addr)
 {
-	struct inode *i = vma-&gt;vm_file-&gt;f_dentry-&gt;d_inode;
+	struct inode *i = vma-&gt;vm_file-&gt;f_path.dentry-&gt;d_inode;
 	unsigned long idx;
 
 	idx = ((addr - vma-&gt;vm_start) &gt;&gt; PAGE_SHIFT) + vma-&gt;vm_pgoff;
@@ -1310,7 +1310,7 @@ shmem_get_policy(struct vm_area_struct *vma, unsigned long addr)
 
 int shmem_lock(struct file *file, int lock, struct user_struct *user)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	struct shmem_inode_info *info = SHMEM_I(inode);
 	int retval = -ENOMEM;
 
@@ -1422,7 +1422,7 @@ shmem_prepare_write(struct file *file, struct page *page, unsigned offset, unsig
 static ssize_t
 shmem_file_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	struct inode	*inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode	*inode = file-&gt;f_path.dentry-&gt;d_inode;
 	loff_t		pos;
 	unsigned long	written;
 	ssize_t		err;
@@ -1442,7 +1442,7 @@ shmem_file_write(struct file *file, const char __user *buf, size_t count, loff_t
 	if (err || !count)
 		goto out;
 
-	err = remove_suid(file-&gt;f_dentry);
+	err = remove_suid(file-&gt;f_path.dentry);
 	if (err)
 		goto out;
 
@@ -1524,7 +1524,7 @@ shmem_file_write(struct file *file, const char __user *buf, size_t count, loff_t
 
 static void do_shmem_file_read(struct file *filp, loff_t *ppos, read_descriptor_t *desc, read_actor_t actor)
 {
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct address_space *mapping = inode-&gt;i_mapping;
 	unsigned long index, offset;
 
@@ -2493,8 +2493,8 @@ struct file *shmem_file_setup(char *name, loff_t size, unsigned long flags)
 	d_instantiate(dentry, inode);
 	inode-&gt;i_size = size;
 	inode-&gt;i_nlink = 0;	/* It is unlinked */
-	file-&gt;f_vfsmnt = mntget(shm_mnt);
-	file-&gt;f_dentry = dentry;
+	file-&gt;f_path.mnt = mntget(shm_mnt);
+	file-&gt;f_path.dentry = dentry;
 	file-&gt;f_mapping = inode-&gt;i_mapping;
 	file-&gt;f_op = &amp;shmem_file_operations;
 	file-&gt;f_mode = FMODE_WRITE | FMODE_READ;
diff --git a/mm/swapfile.c b/mm/swapfile.c
index c5431072f422..b9fc0e5de6d5 100644
--- a/mm/swapfile.c
+++ b/mm/swapfile.c
@@ -1357,10 +1357,10 @@ static int swap_show(struct seq_file *swap, void *v)
 	}
 
 	file = ptr-&gt;swap_file;
-	len = seq_path(swap, file-&gt;f_vfsmnt, file-&gt;f_dentry, " \t\n\\");
+	len = seq_path(swap, file-&gt;f_path.mnt, file-&gt;f_path.dentry, " \t\n\\");
 	seq_printf(swap, "%*s%s\t%u\t%u\t%d\n",
 		       len &lt; 40 ? 40 - len : 1, " ",
-		       S_ISBLK(file-&gt;f_dentry-&gt;d_inode-&gt;i_mode) ?
+		       S_ISBLK(file-&gt;f_path.dentry-&gt;d_inode-&gt;i_mode) ?
 				"partition" : "file\t",
 		       ptr-&gt;pages &lt;&lt; (PAGE_SHIFT - 10),
 		       ptr-&gt;inuse_pages &lt;&lt; (PAGE_SHIFT - 10),</pre><hr><pre>commit f3a43f3f64bff8e205c3702f6b4804d66e306848
Author: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:43 2006 -0800

    [PATCH] kernel: change uses of f_{dentry, vfsmnt} to use f_path
    
    Change all the uses of f_{dentry,vfsmnt} to f_path.{dentry,mnt} in
    linux/kernel/.
    
    Signed-off-by: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/kernel/acct.c b/kernel/acct.c
index 69a40c9777a2..70d0d88e5554 100644
--- a/kernel/acct.c
+++ b/kernel/acct.c
@@ -118,7 +118,7 @@ static int check_free_space(struct file *file)
 	spin_unlock(&amp;acct_globals.lock);
 
 	/* May block */
-	if (vfs_statfs(file-&gt;f_dentry, &amp;sbuf))
+	if (vfs_statfs(file-&gt;f_path.dentry, &amp;sbuf))
 		return res;
 	suspend = sbuf.f_blocks * SUSPEND;
 	resume = sbuf.f_blocks * RESUME;
@@ -194,7 +194,7 @@ static void acct_file_reopen(struct file *file)
 		add_timer(&amp;acct_globals.timer);
 	}
 	if (old_acct) {
-		mnt_unpin(old_acct-&gt;f_vfsmnt);
+		mnt_unpin(old_acct-&gt;f_path.mnt);
 		spin_unlock(&amp;acct_globals.lock);
 		do_acct_process(old_acct);
 		filp_close(old_acct, NULL);
@@ -212,7 +212,7 @@ static int acct_on(char *name)
 	if (IS_ERR(file))
 		return PTR_ERR(file);
 
-	if (!S_ISREG(file-&gt;f_dentry-&gt;d_inode-&gt;i_mode)) {
+	if (!S_ISREG(file-&gt;f_path.dentry-&gt;d_inode-&gt;i_mode)) {
 		filp_close(file, NULL);
 		return -EACCES;
 	}
@@ -229,11 +229,11 @@ static int acct_on(char *name)
 	}
 
 	spin_lock(&amp;acct_globals.lock);
-	mnt_pin(file-&gt;f_vfsmnt);
+	mnt_pin(file-&gt;f_path.mnt);
 	acct_file_reopen(file);
 	spin_unlock(&amp;acct_globals.lock);
 
-	mntput(file-&gt;f_vfsmnt);	/* it's pinned, now give up active reference */
+	mntput(file-&gt;f_path.mnt); /* it's pinned, now give up active reference */
 
 	return 0;
 }
@@ -283,7 +283,7 @@ asmlinkage long sys_acct(const char __user *name)
 void acct_auto_close_mnt(struct vfsmount *m)
 {
 	spin_lock(&amp;acct_globals.lock);
-	if (acct_globals.file &amp;&amp; acct_globals.file-&gt;f_vfsmnt == m)
+	if (acct_globals.file &amp;&amp; acct_globals.file-&gt;f_path.mnt == m)
 		acct_file_reopen(NULL);
 	spin_unlock(&amp;acct_globals.lock);
 }
@@ -299,7 +299,7 @@ void acct_auto_close(struct super_block *sb)
 {
 	spin_lock(&amp;acct_globals.lock);
 	if (acct_globals.file &amp;&amp;
-	    acct_globals.file-&gt;f_vfsmnt-&gt;mnt_sb == sb) {
+	    acct_globals.file-&gt;f_path.mnt-&gt;mnt_sb == sb) {
 		acct_file_reopen(NULL);
 	}
 	spin_unlock(&amp;acct_globals.lock);
diff --git a/kernel/fork.c b/kernel/fork.c
index f387a1393ca5..597707819327 100644
--- a/kernel/fork.c
+++ b/kernel/fork.c
@@ -252,7 +252,7 @@ static inline int dup_mmap(struct mm_struct *mm, struct mm_struct *oldmm)
 		anon_vma_link(tmp);
 		file = tmp-&gt;vm_file;
 		if (file) {
-			struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+			struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 			get_file(file);
 			if (tmp-&gt;vm_flags &amp; VM_DENYWRITE)
 				atomic_dec(&amp;inode-&gt;i_writecount);
diff --git a/kernel/futex.c b/kernel/futex.c
index 95989a3b4168..5a737de857d3 100644
--- a/kernel/futex.c
+++ b/kernel/futex.c
@@ -166,7 +166,7 @@ static inline int match_futex(union futex_key *key1, union futex_key *key2)
 /*
  * Get parameters which are the keys for a futex.
  *
- * For shared mappings, it's (page-&gt;index, vma-&gt;vm_file-&gt;f_dentry-&gt;d_inode,
+ * For shared mappings, it's (page-&gt;index, vma-&gt;vm_file-&gt;f_path.dentry-&gt;d_inode,
  * offset_within_page).  For private mappings, it's (uaddr, current-&gt;mm).
  * We can usually work out the index without swapping in the page.
  *
@@ -223,7 +223,7 @@ static int get_futex_key(u32 __user *uaddr, union futex_key *key)
 	/*
 	 * Linear file mappings are also simple.
 	 */
-	key-&gt;shared.inode = vma-&gt;vm_file-&gt;f_dentry-&gt;d_inode;
+	key-&gt;shared.inode = vma-&gt;vm_file-&gt;f_path.dentry-&gt;d_inode;
 	key-&gt;both.offset++; /* Bit 0 of offset indicates inode-based key. */
 	if (likely(!(vma-&gt;vm_flags &amp; VM_NONLINEAR))) {
 		key-&gt;shared.pgoff = (((address - vma-&gt;vm_start) &gt;&gt; PAGE_SHIFT)
@@ -1528,9 +1528,9 @@ static int futex_fd(u32 __user *uaddr, int signal)
 		goto out;
 	}
 	filp-&gt;f_op = &amp;futex_fops;
-	filp-&gt;f_vfsmnt = mntget(futex_mnt);
-	filp-&gt;f_dentry = dget(futex_mnt-&gt;mnt_root);
-	filp-&gt;f_mapping = filp-&gt;f_dentry-&gt;d_inode-&gt;i_mapping;
+	filp-&gt;f_path.mnt = mntget(futex_mnt);
+	filp-&gt;f_path.dentry = dget(futex_mnt-&gt;mnt_root);
+	filp-&gt;f_mapping = filp-&gt;f_path.dentry-&gt;d_inode-&gt;i_mapping;
 
 	if (signal) {
 		err = __f_setown(filp, task_pid(current), PIDTYPE_PID, 1);
diff --git a/kernel/relay.c b/kernel/relay.c
index 75a3a9a7efc2..818e514729cf 100644
--- a/kernel/relay.c
+++ b/kernel/relay.c
@@ -959,7 +959,7 @@ static inline ssize_t relay_file_read_subbufs(struct file *filp,
 	if (!desc-&gt;count)
 		return 0;
 
-	mutex_lock(&amp;filp-&gt;f_dentry-&gt;d_inode-&gt;i_mutex);
+	mutex_lock(&amp;filp-&gt;f_path.dentry-&gt;d_inode-&gt;i_mutex);
 	do {
 		if (!relay_file_read_avail(buf, *ppos))
 			break;
@@ -979,7 +979,7 @@ static inline ssize_t relay_file_read_subbufs(struct file *filp,
 			*ppos = relay_file_read_end_pos(buf, read_start, ret);
 		}
 	} while (desc-&gt;count &amp;&amp; ret);
-	mutex_unlock(&amp;filp-&gt;f_dentry-&gt;d_inode-&gt;i_mutex);
+	mutex_unlock(&amp;filp-&gt;f_path.dentry-&gt;d_inode-&gt;i_mutex);
 
 	return desc-&gt;written;
 }
diff --git a/kernel/sysctl.c b/kernel/sysctl.c
index 8e9f00fd6d18..9846db93a595 100644
--- a/kernel/sysctl.c
+++ b/kernel/sysctl.c
@@ -1614,7 +1614,7 @@ static ssize_t do_rw_proc(int write, struct file * file, char __user * buf,
 			  size_t count, loff_t *ppos)
 {
 	int op;
-	struct proc_dir_entry *de = PDE(file-&gt;f_dentry-&gt;d_inode);
+	struct proc_dir_entry *de = PDE(file-&gt;f_path.dentry-&gt;d_inode);
 	struct ctl_table *table;
 	size_t res;
 	ssize_t error = -ENOTDIR;</pre><hr><pre>commit c941192aafe053ae445fb22f5d89bd34794c5442
Author: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:43 2006 -0800

    [PATCH] x86_64: change uses of f_{dentry, vfsmnt} to use f_path
    
    Change all the uses of f_{dentry,vfsmnt} to f_path.{dentry,mnt} in the x86_64
    arch code.
    
    Signed-off-by: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/x86_64/ia32/ia32_aout.c b/arch/x86_64/ia32/ia32_aout.c
index 396d3c100011..be87df506f39 100644
--- a/arch/x86_64/ia32/ia32_aout.c
+++ b/arch/x86_64/ia32/ia32_aout.c
@@ -272,7 +272,7 @@ static int load_aout_binary(struct linux_binprm * bprm, struct pt_regs * regs)
 	if ((N_MAGIC(ex) != ZMAGIC &amp;&amp; N_MAGIC(ex) != OMAGIC &amp;&amp;
 	     N_MAGIC(ex) != QMAGIC &amp;&amp; N_MAGIC(ex) != NMAGIC) ||
 	    N_TRSIZE(ex) || N_DRSIZE(ex) ||
-	    i_size_read(bprm-&gt;file-&gt;f_dentry-&gt;d_inode) &lt; ex.a_text+ex.a_data+N_SYMSIZE(ex)+N_TXTOFF(ex)) {
+	    i_size_read(bprm-&gt;file-&gt;f_path.dentry-&gt;d_inode) &lt; ex.a_text+ex.a_data+N_SYMSIZE(ex)+N_TXTOFF(ex)) {
 		return -ENOEXEC;
 	}
 
@@ -357,7 +357,7 @@ static int load_aout_binary(struct linux_binprm * bprm, struct pt_regs * regs)
 		{
 			printk(KERN_WARNING 
 			       "fd_offset is not page aligned. Please convert program: %s\n",
-			       bprm-&gt;file-&gt;f_dentry-&gt;d_name.name);
+			       bprm-&gt;file-&gt;f_path.dentry-&gt;d_name.name);
 			error_time = jiffies;
 		}
 #endif
@@ -440,7 +440,7 @@ static int load_aout_library(struct file *file)
 	int retval;
 	struct exec ex;
 
-	inode = file-&gt;f_dentry-&gt;d_inode;
+	inode = file-&gt;f_path.dentry-&gt;d_inode;
 
 	retval = -ENOEXEC;
 	error = kernel_read(file, 0, (char *) &amp;ex, sizeof(ex));
@@ -471,7 +471,7 @@ static int load_aout_library(struct file *file)
 		{
 			printk(KERN_WARNING 
 			       "N_TXTOFF is not page aligned. Please convert library: %s\n",
-			       file-&gt;f_dentry-&gt;d_name.name);
+			       file-&gt;f_path.dentry-&gt;d_name.name);
 			error_time = jiffies;
 		}
 #endif</pre><hr><pre>commit aab4c5a51cd6defc374ba1961c996781656d5283
Author: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:42 2006 -0800

    [PATCH] i386: change uses of f_{dentry, vfsmnt} to use f_path
    
    Change all the uses of f_{dentry,vfsmnt} to f_path.{dentry,mnt} in the i386
    arch code.
    
    Signed-off-by: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/i386/kernel/cpuid.c b/arch/i386/kernel/cpuid.c
index db6dd20c3589..51130b39cd2e 100644
--- a/arch/i386/kernel/cpuid.c
+++ b/arch/i386/kernel/cpuid.c
@@ -116,7 +116,7 @@ static ssize_t cpuid_read(struct file *file, char __user *buf,
 	char __user *tmp = buf;
 	u32 data[4];
 	u32 reg = *ppos;
-	int cpu = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int cpu = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 
 	if (count % 16)
 		return -EINVAL;	/* Invalid chunk size */
@@ -134,7 +134,7 @@ static ssize_t cpuid_read(struct file *file, char __user *buf,
 
 static int cpuid_open(struct inode *inode, struct file *file)
 {
-	unsigned int cpu = iminor(file-&gt;f_dentry-&gt;d_inode);
+	unsigned int cpu = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	struct cpuinfo_x86 *c = &amp;(cpu_data)[cpu];
 
 	if (cpu &gt;= NR_CPUS || !cpu_online(cpu))
diff --git a/arch/i386/kernel/msr.c b/arch/i386/kernel/msr.c
index 1d1a56cae340..4a472a17d1c6 100644
--- a/arch/i386/kernel/msr.c
+++ b/arch/i386/kernel/msr.c
@@ -172,7 +172,7 @@ static ssize_t msr_read(struct file *file, char __user * buf,
 	u32 __user *tmp = (u32 __user *) buf;
 	u32 data[2];
 	u32 reg = *ppos;
-	int cpu = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int cpu = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	int err;
 
 	if (count % 8)
@@ -196,7 +196,7 @@ static ssize_t msr_write(struct file *file, const char __user *buf,
 	const u32 __user *tmp = (const u32 __user *)buf;
 	u32 data[2];
 	u32 reg = *ppos;
-	int cpu = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int cpu = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	int err;
 
 	if (count % 8)
@@ -216,7 +216,7 @@ static ssize_t msr_write(struct file *file, const char __user *buf,
 
 static int msr_open(struct inode *inode, struct file *file)
 {
-	unsigned int cpu = iminor(file-&gt;f_dentry-&gt;d_inode);
+	unsigned int cpu = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	struct cpuinfo_x86 *c = &amp;(cpu_data)[cpu];
 
 	if (cpu &gt;= NR_CPUS || !cpu_online(cpu))</pre><hr><pre>commit 20d29372d3facfd078b4c7703637b951914d6759
Author: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:41 2006 -0800

    [PATCH] ntfs: change uses of f_{dentry, vfsmnt} to use f_path
    
    Change all the uses of f_{dentry,vfsmnt} to f_path.{dentry,mnt} in the ntfs
    filesystem code.
    
    Signed-off-by: Josef "Jeff" Sipek &lt;jsipek@cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/ntfs/dir.c b/fs/ntfs/dir.c
index 85c36b8ca452..8296c29ae3b8 100644
--- a/fs/ntfs/dir.c
+++ b/fs/ntfs/dir.c
@@ -1101,7 +1101,7 @@ static int ntfs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
 	s64 ia_pos, ia_start, prev_ia_pos, bmp_pos;
 	loff_t fpos, i_size;
-	struct inode *bmp_vi, *vdir = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *bmp_vi, *vdir = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct super_block *sb = vdir-&gt;i_sb;
 	ntfs_inode *ndir = NTFS_I(vdir);
 	ntfs_volume *vol = NTFS_SB(sb);
@@ -1136,9 +1136,9 @@ static int ntfs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 	if (fpos == 1) {
 		ntfs_debug("Calling filldir for .. with len 2, fpos 0x1, "
 				"inode 0x%lx, DT_DIR.",
-				(unsigned long)parent_ino(filp-&gt;f_dentry));
+				(unsigned long)parent_ino(filp-&gt;f_path.dentry));
 		rc = filldir(dirent, "..", 2, fpos,
-				parent_ino(filp-&gt;f_dentry), DT_DIR);
+				parent_ino(filp-&gt;f_path.dentry), DT_DIR);
 		if (rc)
 			goto done;
 		fpos++;
diff --git a/fs/ntfs/file.c b/fs/ntfs/file.c
index ae2fe0016d2c..076c9420c257 100644
--- a/fs/ntfs/file.c
+++ b/fs/ntfs/file.c
@@ -2162,7 +2162,7 @@ static ssize_t ntfs_file_aio_write_nolock(struct kiocb *iocb,
 		goto out;
 	if (!count)
 		goto out;
-	err = remove_suid(file-&gt;f_dentry);
+	err = remove_suid(file-&gt;f_path.dentry);
 	if (err)
 		goto out;
 	file_update_time(file);</pre>
    <div class="pagination">
        <a href='9_11.html'>&lt;&lt;Prev</a><a href='9.html'>1</a><a href='9_2.html'>2</a><a href='9_3.html'>3</a><a href='9_4.html'>4</a><a href='9_5.html'>5</a><a href='9_6.html'>6</a><a href='9_7.html'>7</a><a href='9_8.html'>8</a><a href='9_9.html'>9</a><a href='9_10.html'>10</a><a href='9_11.html'>11</a><span>[12]</span><a href='9_13.html'>13</a><a href='9_14.html'>14</a><a href='9_13.html'>Next&gt;&gt;</a>
    <div>
</body>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Nanjing University</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Nanjing University</h1>
    <div class="pagination">
        <span>[1]</span>
    </div>
    <hr>
    <pre>commit 64a19591a2938b170aa736443d5d3bf4c51e1388
Author: Chen Lu &lt;181250012@smail.nju.edu.cn&gt;
Date:   Mon Oct 18 13:22:38 2021 +0800

    riscv: fix misalgned trap vector base address
    
    The trap vector marked by label .Lsecondary_park must align on a
    4-byte boundary, as the {m,s}tvec is defined to require 4-byte
    alignment.
    
    Signed-off-by: Chen Lu &lt;181250012@smail.nju.edu.cn&gt;
    Reviewed-by: Anup Patel &lt;anup.patel@wdc.com&gt;
    Fixes: e011995e826f ("RISC-V: Move relocate and few other functions out of __init")
    Cc: stable@vger.kernel.org
    Signed-off-by: Palmer Dabbelt &lt;palmerdabbelt@google.com&gt;

diff --git a/arch/riscv/kernel/head.S b/arch/riscv/kernel/head.S
index fce5184b22c3..52c5ff9804c5 100644
--- a/arch/riscv/kernel/head.S
+++ b/arch/riscv/kernel/head.S
@@ -193,6 +193,7 @@ setup_trap_vector:
 	csrw CSR_SCRATCH, zero
 	ret
 
+.align 2
 .Lsecondary_park:
 	/* We lack SMP support or have too many harts, so park this hart */
 	wfi</pre><hr><pre>commit 4480879251fb89b1c5585112b1ccc8c3333b41af
Author: Huaping Zhou &lt;zhp@smail.nju.edu.cn&gt;
Date:   Wed Jun 26 17:47:49 2019 +0200

    net/smc: hold conns_lock before calling smc_lgr_register_conn()
    
    After smc_lgr_create(), the newly created link group is added
    to smc_lgr_list, thus is accessible from other context.
    Although link group creation is serialized by
    smc_create_lgr_pending, the new link group may still be accessed
    concurrently. For example, if ib_device is no longer active,
    smc_ib_port_event_work() will call smc_port_terminate(), which
    in turn will call __smc_lgr_terminate() on every link group of
    this device. So conns_lock is required here.
    
    Signed-off-by: Huaping Zhou &lt;zhp@smail.nju.edu.cn&gt;
    Signed-off-by: Ursula Braun &lt;ubraun@linux.ibm.com&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/net/smc/smc_core.c b/net/smc/smc_core.c
index 2d2850adc2a3..4ca50ddf8d16 100644
--- a/net/smc/smc_core.c
+++ b/net/smc/smc_core.c
@@ -652,7 +652,10 @@ int smc_conn_create(struct smc_sock *smc, struct smc_init_info *ini)
 		rc = smc_lgr_create(smc, ini);
 		if (rc)
 			goto out;
+		lgr = conn-&gt;lgr;
+		write_lock_bh(&amp;lgr-&gt;conns_lock);
 		smc_lgr_register_conn(conn); /* add smc conn to lgr */
+		write_unlock_bh(&amp;lgr-&gt;conns_lock);
 	}
 	conn-&gt;local_tx_ctrl.common.type = SMC_CDC_MSG_TYPE;
 	conn-&gt;local_tx_ctrl.len = SMC_WR_TX_SIZE;</pre>
    <div class="pagination">
        <span>[1]</span>
    <div>
</body>

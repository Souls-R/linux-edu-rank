<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by University of Washington</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by University of Washington</h1>
    <div class="pagination">
        <a href='13_7.html'>&lt;&lt;Prev</a><a href='13.html'>1</a><a href='13_2.html'>2</a><a href='13_3.html'>3</a><a href='13_4.html'>4</a><a href='13_5.html'>5</a><a href='13_6.html'>6</a><a href='13_7.html'>7</a><span>[8]</span>
    </div>
    <hr>
    <pre>commit 92b1f905637bbd79fcd430a09737fd97061eb405
Author: David Rientjes &lt;rientjes@cs.washington.edu&gt;
Date:   Wed Nov 8 19:49:15 2006 -0800

    [PATCH] drivers cris: return on NULL dev_alloc_skb()
    
    If the next descriptor array entry cannot be allocated by dev_alloc_skb(),
    return immediately so it is not dereferenced later.  We cannot register the
    device with a partial descriptor list.
    
    Cc: Mikael Starvik &lt;starvik@axis.com&gt;
    Signed-off-by: David Rientjes &lt;rientjes@cs.washington.edu&gt;
    Cc: Jeff Garzik &lt;jeff@garzik.org&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Jeff Garzik &lt;jeff@garzik.org&gt;

diff --git a/drivers/net/cris/eth_v10.c b/drivers/net/cris/eth_v10.c
index 966b563e42bb..a03d781f6d0a 100644
--- a/drivers/net/cris/eth_v10.c
+++ b/drivers/net/cris/eth_v10.c
@@ -509,6 +509,8 @@ etrax_ethernet_init(void)
 		 * does not share cacheline with any other data (to avoid cache bug)
 		 */
 		RxDescList[i].skb = dev_alloc_skb(MAX_MEDIA_DATA_SIZE + 2 * L1_CACHE_BYTES);
+		if (!RxDescList[i].skb)
+			return -ENOMEM;
 		RxDescList[i].descr.ctrl   = 0;
 		RxDescList[i].descr.sw_len = MAX_MEDIA_DATA_SIZE;
 		RxDescList[i].descr.next   = virt_to_phys(&amp;RxDescList[i + 1]);</pre><hr><pre>commit 2ceaac755423cb93c1bb2f59ebd1a06f027ac095
Author: David Rientjes &lt;rientjes@cs.washington.edu&gt;
Date:   Mon Oct 30 14:19:25 2006 -0800

    [PATCH] net s2io: return on NULL dev_alloc_skb()
    
    Checks for NULL dev_alloc_skb() and returns on true to avoid subsequent
    dereference.
    
    Cc: Jeff Garzik &lt;jgarzik@pobox.com&gt;
    Cc: Christoph Hellwig &lt;hch@infrared.org&gt;
    Signed-off-by: David Rientjes &lt;rientjes@cs.washington.edu&gt;
    Signed-off-by: Jeff Garzik &lt;jeff@garzik.org&gt;

diff --git a/drivers/net/s2io.c b/drivers/net/s2io.c
index a231ab7d28dd..33569ec9dbfc 100644
--- a/drivers/net/s2io.c
+++ b/drivers/net/s2io.c
@@ -5985,6 +5985,11 @@ static int set_rxd_buffer_pointer(nic_t *sp, RxD_t *rxdp, buffAdd_t *ba,
 			((RxD3_t*)rxdp)-&gt;Buffer1_ptr = *temp1;
 		} else {
 			*skb = dev_alloc_skb(size);
+			if (!(*skb)) {
+				DBG_PRINT(ERR_DBG, "%s: dev_alloc_skb failed\n",
+					  dev-&gt;name);
+				return -ENOMEM;
+			}
 			((RxD3_t*)rxdp)-&gt;Buffer2_ptr = *temp2 =
 				pci_map_single(sp-&gt;pdev, (*skb)-&gt;data,
 					       dev-&gt;mtu + 4,
@@ -6007,7 +6012,11 @@ static int set_rxd_buffer_pointer(nic_t *sp, RxD_t *rxdp, buffAdd_t *ba,
 			((RxD3_t*)rxdp)-&gt;Buffer2_ptr = *temp2;
 		} else {
 			*skb = dev_alloc_skb(size);
-
+			if (!(*skb)) {
+				DBG_PRINT(ERR_DBG, "%s: dev_alloc_skb failed\n",
+					  dev-&gt;name);
+				return -ENOMEM;
+			}
 			((RxD3_t*)rxdp)-&gt;Buffer0_ptr = *temp0 =
 				pci_map_single(sp-&gt;pdev, ba-&gt;ba_0, BUF0_LEN,
 					       PCI_DMA_FROMDEVICE);</pre><hr><pre>commit f3ef9ead31ae995251b420ac98398bd7545bf4e1
Author: David Rientjes &lt;rientjes@cs.washington.edu&gt;
Date:   Mon Sep 25 16:24:57 2006 -0700

    [PATCH] do not free non slab allocated per_cpu_pageset
    
    Stops panic associated with attempting to free a non slab-allocated
    per_cpu_pageset.
    
    Signed-off-by: David Rientjes &lt;rientjes@cs.washington.edu&gt;
    Acked-by: Christoph Lameter &lt;clameter@sgi.com&gt;
    Cc: &lt;stable@kernel.org&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/mm/page_alloc.c b/mm/page_alloc.c
index 3b5358a0561f..8a52ba9fe693 100644
--- a/mm/page_alloc.c
+++ b/mm/page_alloc.c
@@ -1845,8 +1845,10 @@ static inline void free_zone_pagesets(int cpu)
 	for_each_zone(zone) {
 		struct per_cpu_pageset *pset = zone_pcp(zone, cpu);
 
+		/* Free per_cpu_pageset if it is slab allocated */
+		if (pset != &amp;boot_pageset[cpu])
+			kfree(pset);
 		zone_pcp(zone, cpu) = NULL;
-		kfree(pset);
 	}
 }
 </pre><hr><pre>commit 62fe78e90dc25b269362034487dc450cd8453e8c
Author: Sam Revitch &lt;samr7@cs.washington.edu&gt;
Date:   Wed May 10 15:09:17 2006 +0200

    [ALSA] hda-codec - Add support for Apple Mac Mini (early 2006)
    
    Add support for some audio quirks of the Apple Mac Mini (early 2006)
    
    Signed-off-by: Sam Revitch &lt;samr7@cs.washington.edu&gt;
    Signed-off-by: Takashi Iwai &lt;tiwai@suse.de&gt;

diff --git a/sound/pci/hda/patch_sigmatel.c b/sound/pci/hda/patch_sigmatel.c
index 6d8224dc033b..36f199442fdc 100644
--- a/sound/pci/hda/patch_sigmatel.c
+++ b/sound/pci/hda/patch_sigmatel.c
@@ -41,6 +41,7 @@
 #define STAC_REF		0
 #define STAC_D945GTP3		1
 #define STAC_D945GTP5		2
+#define STAC_MACMINI		3
 
 struct sigmatel_spec {
 	struct snd_kcontrol_new *mixers[4];
@@ -52,6 +53,7 @@ struct sigmatel_spec {
 	unsigned int mic_switch: 1;
 	unsigned int alt_switch: 1;
 	unsigned int hp_detect: 1;
+	unsigned int gpio_mute: 1;
 
 	/* playback */
 	struct hda_multi_out multiout;
@@ -293,6 +295,7 @@ static unsigned int *stac922x_brd_tbl[] = {
 	ref922x_pin_configs,
 	d945gtp3_pin_configs,
 	d945gtp5_pin_configs,
+	NULL,		/* STAC_MACMINI */
 };
 
 static struct hda_board_config stac922x_cfg_tbl[] = {
@@ -324,6 +327,9 @@ static struct hda_board_config stac922x_cfg_tbl[] = {
 	{ .pci_subvendor = PCI_VENDOR_ID_INTEL,
 	  .pci_subdevice = 0x0417,
 	  .config = STAC_D945GTP5 },	/* Intel D975XBK - 5 Stack */
+	{ .pci_subvendor = 0x8384,
+	  .pci_subdevice = 0x7680,
+	  .config = STAC_MACMINI },	/* Apple Mac Mini (early 2006) */
 	{} /* terminator */
 };
 
@@ -841,6 +847,19 @@ static int stac92xx_auto_create_analog_input_ctls(struct hda_codec *codec, const
 		}
 	}
 
+	if (imux-&gt;num_items == 1) {
+		/*
+		 * Set the current input for the muxes.
+		 * The STAC9221 has two input muxes with identical source
+		 * NID lists.  Hopefully this won't get confused.
+		 */
+		for (i = 0; i &lt; spec-&gt;num_muxes; i++) {
+			snd_hda_codec_write(codec, spec-&gt;mux_nids[i], 0,
+					    AC_VERB_SET_CONNECT_SEL,
+					    imux-&gt;items[0].index);
+		}
+	}
+
 	return 0;
 }
 
@@ -946,6 +965,45 @@ static int stac9200_parse_auto_config(struct hda_codec *codec)
 	return 1;
 }
 
+/*
+ * Early 2006 Intel Macintoshes with STAC9220X5 codecs seem to have a
+ * funky external mute control using GPIO pins.
+ */
+
+static void stac922x_gpio_mute(struct hda_codec *codec, int pin, int muted)
+{
+	unsigned int gpiostate, gpiomask, gpiodir;
+
+	gpiostate = snd_hda_codec_read(codec, codec-&gt;afg, 0,
+				       AC_VERB_GET_GPIO_DATA, 0);
+
+	if (!muted)
+		gpiostate |= (1 &lt;&lt; pin);
+	else
+		gpiostate &amp;= ~(1 &lt;&lt; pin);
+
+	gpiomask = snd_hda_codec_read(codec, codec-&gt;afg, 0,
+				      AC_VERB_GET_GPIO_MASK, 0);
+	gpiomask |= (1 &lt;&lt; pin);
+
+	gpiodir = snd_hda_codec_read(codec, codec-&gt;afg, 0,
+				     AC_VERB_GET_GPIO_DIRECTION, 0);
+	gpiodir |= (1 &lt;&lt; pin);
+
+	/* AppleHDA seems to do this -- WTF is this verb?? */
+	snd_hda_codec_write(codec, codec-&gt;afg, 0, 0x7e7, 0);
+
+	snd_hda_codec_write(codec, codec-&gt;afg, 0,
+			    AC_VERB_SET_GPIO_MASK, gpiomask);
+	snd_hda_codec_write(codec, codec-&gt;afg, 0,
+			    AC_VERB_SET_GPIO_DIRECTION, gpiodir);
+
+	msleep(1);
+
+	snd_hda_codec_write(codec, codec-&gt;afg, 0,
+			    AC_VERB_SET_GPIO_DATA, gpiostate);
+}
+
 static int stac92xx_init(struct hda_codec *codec)
 {
 	struct sigmatel_spec *spec = codec-&gt;spec;
@@ -982,6 +1040,11 @@ static int stac92xx_init(struct hda_codec *codec)
 		stac92xx_auto_set_pinctl(codec, cfg-&gt;dig_in_pin,
 					 AC_PINCTL_IN_EN);
 
+	if (spec-&gt;gpio_mute) {
+		stac922x_gpio_mute(codec, 0, 0);
+		stac922x_gpio_mute(codec, 1, 0);
+	}
+
 	return 0;
 }
 
@@ -1132,7 +1195,7 @@ static int patch_stac922x(struct hda_codec *codec)
 	spec-&gt;board_config = snd_hda_check_board_config(codec, stac922x_cfg_tbl);
 	if (spec-&gt;board_config &lt; 0)
                 snd_printdd(KERN_INFO "hda_codec: Unknown model for STAC922x, using BIOS defaults\n");
-	else {
+	else if (stac922x_brd_tbl[spec-&gt;board_config] != NULL) {
 		spec-&gt;num_pins = 10;
 		spec-&gt;pin_nids = stac922x_pin_nids;
 		spec-&gt;pin_configs = stac922x_brd_tbl[spec-&gt;board_config];
@@ -1154,6 +1217,9 @@ static int patch_stac922x(struct hda_codec *codec)
 		return err;
 	}
 
+	if (spec-&gt;board_config == STAC_MACMINI)
+		spec-&gt;gpio_mute = 1;
+
 	codec-&gt;patch_ops = stac92xx_patch_ops;
 
 	return 0;</pre><hr><pre>commit 9c782e3b2083c33b5a14c9955cf15f32ea88116b
Author: Alex Shepard &lt;ashepard@u.washington.edu&gt;
Date:   Sun Jan 15 01:57:00 2006 +0100

    Spelling fix in IPW2100 and IPW2200 Kconfig entries
    
    s/remvoed/removed/
    
    Signed-off-by: Alex Shepard &lt;ashepard@u.washington.edu&gt;
    Signed-off-by: Adrian Bunk &lt;bunk@stusta.de&gt;

diff --git a/drivers/net/wireless/Kconfig b/drivers/net/wireless/Kconfig
index c1a6e69f7905..e90687495ccc 100644
--- a/drivers/net/wireless/Kconfig
+++ b/drivers/net/wireless/Kconfig
@@ -160,7 +160,7 @@ config IPW2100
           &lt;http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html&gt;.
  
           If you want to compile the driver as a module ( = code which can be
-          inserted in and remvoed from the running kernel whenever you want),
+          inserted in and removed from the running kernel whenever you want),
           say M here and read &lt;file:Documentation/modules.txt&gt;.  The module
           will be called ipw2100.ko.
 	
@@ -213,7 +213,7 @@ config IPW2200
           &lt;http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html&gt;.
  
           If you want to compile the driver as a module ( = code which can be
-          inserted in and remvoed from the running kernel whenever you want),
+          inserted in and removed from the running kernel whenever you want),
           say M here and read &lt;file:Documentation/modules.txt&gt;.  The module
           will be called ipw2200.ko.
 </pre>
    <div class="pagination">
        <a href='13_7.html'>&lt;&lt;Prev</a><a href='13.html'>1</a><a href='13_2.html'>2</a><a href='13_3.html'>3</a><a href='13_4.html'>4</a><a href='13_5.html'>5</a><a href='13_6.html'>6</a><a href='13_7.html'>7</a><span>[8]</span>
    <div>
</body>

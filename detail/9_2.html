<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by State University of New York at Stony Brook</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by State University of New York at Stony Brook</h1>
    <div class="pagination">
        <a href='9.html'>&lt;&lt;Prev</a><a href='9.html'>1</a><span>[2]</span><a href='9_3.html'>3</a><a href='9_4.html'>4</a><a href='9_5.html'>5</a><a href='9_6.html'>6</a><a href='9_7.html'>7</a><a href='9_8.html'>8</a><a href='9_9.html'>9</a><a href='9_10.html'>10</a><a href='9_11.html'>11</a><a href='9_12.html'>12</a><a href='9_13.html'>13</a><a href='9_14.html'>14</a><a href='9_3.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 763454d6108ad1c6d4e1013321aef8bf5efb3a4f
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:45 2006 -0800

    [PATCH] struct path: convert ufs
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/ufs/dir.c b/fs/ufs/dir.c
index 7f0a0aa63584..433b6f68403a 100644
--- a/fs/ufs/dir.c
+++ b/fs/ufs/dir.c
@@ -426,7 +426,7 @@ static int
 ufs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
 	loff_t pos = filp-&gt;f_pos;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct super_block *sb = inode-&gt;i_sb;
 	unsigned int offset = pos &amp; ~PAGE_CACHE_MASK;
 	unsigned long n = pos &gt;&gt; PAGE_CACHE_SHIFT;</pre><hr><pre>commit 5096e933a943c23bd9314b0ac7e14d07073cb2e5
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:44 2006 -0800

    [PATCH] struct path: convert udf
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/udf/dir.c b/fs/udf/dir.c
index 8c28efa3b8ff..2391c9150c49 100644
--- a/fs/udf/dir.c
+++ b/fs/udf/dir.c
@@ -77,7 +77,7 @@ const struct file_operations udf_dir_operations = {
 
 int udf_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
-	struct inode *dir = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *dir = filp-&gt;f_path.dentry-&gt;d_inode;
 	int result;
 
 	lock_kernel();
@@ -225,7 +225,7 @@ do_udf_readdir(struct inode * dir, struct file *filp, filldir_t filldir, void *d
 
 		if ( cfi.fileCharacteristics &amp; FID_FILE_CHAR_PARENT )
 		{
-			iblock = parent_ino(filp-&gt;f_dentry);
+			iblock = parent_ino(filp-&gt;f_path.dentry);
 			flen = 2;
 			memcpy(fname, "..", flen);
 			dt_type = DT_DIR;
diff --git a/fs/udf/file.c b/fs/udf/file.c
index 7aedd552cba1..d81f2db7b0e3 100644
--- a/fs/udf/file.c
+++ b/fs/udf/file.c
@@ -108,7 +108,7 @@ static ssize_t udf_file_aio_write(struct kiocb *iocb, const struct iovec *iov,
 {
 	ssize_t retval;
 	struct file *file = iocb-&gt;ki_filp;
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	int err, pos;
 	size_t count = iocb-&gt;ki_left;
 </pre><hr><pre>commit 5495ca657d854ac57733ce5a52eee52255b3f4d8
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:43 2006 -0800

    [PATCH] struct path: convert sysv
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/sysv/dir.c b/fs/sysv/dir.c
index f2bef962d309..ebf7007fa161 100644
--- a/fs/sysv/dir.c
+++ b/fs/sysv/dir.c
@@ -70,7 +70,7 @@ static struct page * dir_get_page(struct inode *dir, unsigned long n)
 static int sysv_readdir(struct file * filp, void * dirent, filldir_t filldir)
 {
 	unsigned long pos = filp-&gt;f_pos;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct super_block *sb = inode-&gt;i_sb;
 	unsigned offset = pos &amp; ~PAGE_CACHE_MASK;
 	unsigned long n = pos &gt;&gt; PAGE_CACHE_SHIFT;</pre><hr><pre>commit 303b46bb77a4b1679fd39d7ab5597630743e0ff5
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:42 2006 -0800

    [PATCH] struct path: convert sunrpc
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/net/sunrpc/auth_gss/auth_gss.c b/net/sunrpc/auth_gss/auth_gss.c
index a02ecc1f230d..e1a104abb782 100644
--- a/net/sunrpc/auth_gss/auth_gss.c
+++ b/net/sunrpc/auth_gss/auth_gss.c
@@ -501,7 +501,7 @@ gss_pipe_downcall(struct file *filp, const char __user *src, size_t mlen)
 	if (!buf)
 		goto out;
 
-	clnt = RPC_I(filp-&gt;f_dentry-&gt;d_inode)-&gt;private;
+	clnt = RPC_I(filp-&gt;f_path.dentry-&gt;d_inode)-&gt;private;
 	err = -EFAULT;
 	if (copy_from_user(buf, src, mlen))
 		goto err;
diff --git a/net/sunrpc/cache.c b/net/sunrpc/cache.c
index d96fd466a9a4..80aff0474572 100644
--- a/net/sunrpc/cache.c
+++ b/net/sunrpc/cache.c
@@ -670,7 +670,7 @@ cache_read(struct file *filp, char __user *buf, size_t count, loff_t *ppos)
 {
 	struct cache_reader *rp = filp-&gt;private_data;
 	struct cache_request *rq;
-	struct cache_detail *cd = PDE(filp-&gt;f_dentry-&gt;d_inode)-&gt;data;
+	struct cache_detail *cd = PDE(filp-&gt;f_path.dentry-&gt;d_inode)-&gt;data;
 	int err;
 
 	if (count == 0)
@@ -747,7 +747,7 @@ cache_write(struct file *filp, const char __user *buf, size_t count,
 	    loff_t *ppos)
 {
 	int err;
-	struct cache_detail *cd = PDE(filp-&gt;f_dentry-&gt;d_inode)-&gt;data;
+	struct cache_detail *cd = PDE(filp-&gt;f_path.dentry-&gt;d_inode)-&gt;data;
 
 	if (count == 0)
 		return 0;
@@ -778,7 +778,7 @@ cache_poll(struct file *filp, poll_table *wait)
 	unsigned int mask;
 	struct cache_reader *rp = filp-&gt;private_data;
 	struct cache_queue *cq;
-	struct cache_detail *cd = PDE(filp-&gt;f_dentry-&gt;d_inode)-&gt;data;
+	struct cache_detail *cd = PDE(filp-&gt;f_path.dentry-&gt;d_inode)-&gt;data;
 
 	poll_wait(filp, &amp;queue_wait, wait);
 
@@ -1254,7 +1254,7 @@ static struct file_operations content_file_operations = {
 static ssize_t read_flush(struct file *file, char __user *buf,
 			    size_t count, loff_t *ppos)
 {
-	struct cache_detail *cd = PDE(file-&gt;f_dentry-&gt;d_inode)-&gt;data;
+	struct cache_detail *cd = PDE(file-&gt;f_path.dentry-&gt;d_inode)-&gt;data;
 	char tbuf[20];
 	unsigned long p = *ppos;
 	int len;
@@ -1275,7 +1275,7 @@ static ssize_t read_flush(struct file *file, char __user *buf,
 static ssize_t write_flush(struct file * file, const char __user * buf,
 			     size_t count, loff_t *ppos)
 {
-	struct cache_detail *cd = PDE(file-&gt;f_dentry-&gt;d_inode)-&gt;data;
+	struct cache_detail *cd = PDE(file-&gt;f_path.dentry-&gt;d_inode)-&gt;data;
 	char tbuf[20];
 	char *ep;
 	long flushtime;
diff --git a/net/sunrpc/rpc_pipe.c b/net/sunrpc/rpc_pipe.c
index 19703aa9659e..89273d35e0cc 100644
--- a/net/sunrpc/rpc_pipe.c
+++ b/net/sunrpc/rpc_pipe.c
@@ -214,7 +214,7 @@ rpc_pipe_release(struct inode *inode, struct file *filp)
 static ssize_t
 rpc_pipe_read(struct file *filp, char __user *buf, size_t len, loff_t *offset)
 {
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct rpc_inode *rpci = RPC_I(inode);
 	struct rpc_pipe_msg *msg;
 	int res = 0;
@@ -257,7 +257,7 @@ rpc_pipe_read(struct file *filp, char __user *buf, size_t len, loff_t *offset)
 static ssize_t
 rpc_pipe_write(struct file *filp, const char __user *buf, size_t len, loff_t *offset)
 {
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct rpc_inode *rpci = RPC_I(inode);
 	int res;
 
@@ -275,7 +275,7 @@ rpc_pipe_poll(struct file *filp, struct poll_table_struct *wait)
 	struct rpc_inode *rpci;
 	unsigned int mask = 0;
 
-	rpci = RPC_I(filp-&gt;f_dentry-&gt;d_inode);
+	rpci = RPC_I(filp-&gt;f_path.dentry-&gt;d_inode);
 	poll_wait(filp, &amp;rpci-&gt;waitq, wait);
 
 	mask = POLLOUT | POLLWRNORM;
@@ -290,7 +290,7 @@ static int
 rpc_pipe_ioctl(struct inode *ino, struct file *filp,
 		unsigned int cmd, unsigned long arg)
 {
-	struct rpc_inode *rpci = RPC_I(filp-&gt;f_dentry-&gt;d_inode);
+	struct rpc_inode *rpci = RPC_I(filp-&gt;f_path.dentry-&gt;d_inode);
 	int len;
 
 	switch (cmd) {</pre><hr><pre>commit 1250ca4c8f48de482ec7c476cb024fe93ad1fbb3
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:41 2006 -0800

    [PATCH] struct path: convert sparc64
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/sparc64/kernel/binfmt_aout32.c b/arch/sparc64/kernel/binfmt_aout32.c
index d7caa60a0074..f205fc7cbcd0 100644
--- a/arch/sparc64/kernel/binfmt_aout32.c
+++ b/arch/sparc64/kernel/binfmt_aout32.c
@@ -209,7 +209,7 @@ static int load_aout32_binary(struct linux_binprm * bprm, struct pt_regs * regs)
 	if ((N_MAGIC(ex) != ZMAGIC &amp;&amp; N_MAGIC(ex) != OMAGIC &amp;&amp;
 	     N_MAGIC(ex) != QMAGIC &amp;&amp; N_MAGIC(ex) != NMAGIC) ||
 	    N_TRSIZE(ex) || N_DRSIZE(ex) ||
-	    bprm-&gt;file-&gt;f_dentry-&gt;d_inode-&gt;i_size &lt; ex.a_text+ex.a_data+N_SYMSIZE(ex)+N_TXTOFF(ex)) {
+	    bprm-&gt;file-&gt;f_path.dentry-&gt;d_inode-&gt;i_size &lt; ex.a_text+ex.a_data+N_SYMSIZE(ex)+N_TXTOFF(ex)) {
 		return -ENOEXEC;
 	}
 
@@ -349,7 +349,7 @@ static int load_aout32_library(struct file *file)
 	int retval;
 	struct exec ex;
 
-	inode = file-&gt;f_dentry-&gt;d_inode;
+	inode = file-&gt;f_path.dentry-&gt;d_inode;
 
 	retval = -ENOEXEC;
 	error = kernel_read(file, 0, (char *) &amp;ex, sizeof(ex));
diff --git a/arch/sparc64/kernel/sys_sunos32.c b/arch/sparc64/kernel/sys_sunos32.c
index 7da72d3b322a..4446f66590fa 100644
--- a/arch/sparc64/kernel/sys_sunos32.c
+++ b/arch/sparc64/kernel/sys_sunos32.c
@@ -83,7 +83,7 @@ asmlinkage u32 sunos_mmap(u32 addr, u32 len, u32 prot, u32 flags, u32 fd, u32 of
  		file = fget(fd);
 		if (!file)
 			goto out;
-		inode = file-&gt;f_dentry-&gt;d_inode;
+		inode = file-&gt;f_path.dentry-&gt;d_inode;
 		if (imajor(inode) == MEM_MAJOR &amp;&amp; iminor(inode) == 5) {
 			flags |= MAP_ANONYMOUS;
 			fput(file);
@@ -615,7 +615,7 @@ sunos_nfs_get_server_fd (int fd, struct sockaddr_in *addr)
 	if (!file)
 		return 0;
 
-	inode = file-&gt;f_dentry-&gt;d_inode;
+	inode = file-&gt;f_path.dentry-&gt;d_inode;
 
 	socket = SOCKET_I(inode);
 	local.sin_family = AF_INET;
diff --git a/arch/sparc64/solaris/fs.c b/arch/sparc64/solaris/fs.c
index 12a940cc791f..61be597bf430 100644
--- a/arch/sparc64/solaris/fs.c
+++ b/arch/sparc64/solaris/fs.c
@@ -449,7 +449,7 @@ asmlinkage int solaris_fstatvfs(unsigned int fd, u32 buf)
 	error = -EBADF;
 	file = fget(fd);
 	if (file) {
-		error = report_statvfs(file-&gt;f_vfsmnt, file-&gt;f_dentry-&gt;d_inode, buf);
+		error = report_statvfs(file-&gt;f_path.mnt, file-&gt;f_path.dentry-&gt;d_inode, buf);
 		fput(file);
 	}
 
@@ -481,7 +481,7 @@ asmlinkage int solaris_fstatvfs64(unsigned int fd, u32 buf)
 	file = fget(fd);
 	if (file) {
 		lock_kernel();
-		error = report_statvfs64(file-&gt;f_vfsmnt, file-&gt;f_dentry-&gt;d_inode, buf);
+		error = report_statvfs64(file-&gt;f_path.mnt, file-&gt;f_path.dentry-&gt;d_inode, buf);
 		unlock_kernel();
 		fput(file);
 	}
diff --git a/arch/sparc64/solaris/ioctl.c b/arch/sparc64/solaris/ioctl.c
index be0a054e3ed6..330743c5b3d8 100644
--- a/arch/sparc64/solaris/ioctl.c
+++ b/arch/sparc64/solaris/ioctl.c
@@ -299,8 +299,8 @@ static inline int solaris_sockmod(unsigned int fd, unsigned int cmd, u32 arg)
 	rcu_read_lock();
 	fdt = files_fdtable(current-&gt;files);
 	if (! fdt-&gt;fd[fd] ||
-	    ! fdt-&gt;fd[fd]-&gt;f_dentry ||
-	    ! (ino = fdt-&gt;fd[fd]-&gt;f_dentry-&gt;d_inode) ||
+	    ! fdt-&gt;fd[fd]-&gt;f_path.dentry ||
+	    ! (ino = fdt-&gt;fd[fd]-&gt;f_path.dentry-&gt;d_inode) ||
 	    ! S_ISSOCK(ino-&gt;i_mode)) {
 		rcu_read_unlock();
 		return TBADF;
@@ -480,7 +480,7 @@ static inline int solaris_S(struct file *filp, unsigned int fd, unsigned int cmd
         struct sol_socket_struct *sock;
         struct module_info *mi;
 
-        ino = filp-&gt;f_dentry-&gt;d_inode;
+        ino = filp-&gt;f_path.dentry-&gt;d_inode;
         if (!S_ISSOCK(ino-&gt;i_mode))
 		return -EBADF;
         sock = filp-&gt;private_data;
diff --git a/arch/sparc64/solaris/misc.c b/arch/sparc64/solaris/misc.c
index e84241d5f7f4..bca16e8c95c3 100644
--- a/arch/sparc64/solaris/misc.c
+++ b/arch/sparc64/solaris/misc.c
@@ -77,7 +77,7 @@ static u32 do_solaris_mmap(u32 addr, u32 len, u32 prot, u32 flags, u32 fd, u64 o
 		if (!file)
 			goto out;
 		else {
-			struct inode * inode = file-&gt;f_dentry-&gt;d_inode;
+			struct inode * inode = file-&gt;f_path.dentry-&gt;d_inode;
 			if(imajor(inode) == MEM_MAJOR &amp;&amp;
 			   iminor(inode) == 5) {
 				flags |= MAP_ANONYMOUS;
diff --git a/arch/sparc64/solaris/socksys.c b/arch/sparc64/solaris/socksys.c
index 7c90e41fd3be..89a4757f192f 100644
--- a/arch/sparc64/solaris/socksys.c
+++ b/arch/sparc64/solaris/socksys.c
@@ -96,13 +96,13 @@ static int socksys_open(struct inode * inode, struct file * filp)
 	 * No shit.  WTF is it supposed to do, anyway?
 	 *
 	 * Try instead:
-	 * d_delete(filp-&gt;f_dentry), then d_instantiate with sock inode
+	 * d_delete(filp-&gt;f_path.dentry), then d_instantiate with sock inode
 	 */
-	dentry = filp-&gt;f_dentry;
-	filp-&gt;f_dentry = dget(fcheck(fd)-&gt;f_dentry);
-	filp-&gt;f_dentry-&gt;d_inode-&gt;i_rdev = inode-&gt;i_rdev;
-	filp-&gt;f_dentry-&gt;d_inode-&gt;i_flock = inode-&gt;i_flock;
-	SOCKET_I(filp-&gt;f_dentry-&gt;d_inode)-&gt;file = filp;
+	dentry = filp-&gt;f_path.dentry;
+	filp-&gt;f_path.dentry = dget(fcheck(fd)-&gt;f_path.dentry);
+	filp-&gt;f_path.dentry-&gt;d_inode-&gt;i_rdev = inode-&gt;i_rdev;
+	filp-&gt;f_path.dentry-&gt;d_inode-&gt;i_flock = inode-&gt;i_flock;
+	SOCKET_I(filp-&gt;f_path.dentry-&gt;d_inode)-&gt;file = filp;
 	filp-&gt;f_op = &amp;socksys_file_ops;
         sock = (struct sol_socket_struct*) 
         	mykmalloc(sizeof(struct sol_socket_struct), GFP_KERNEL);
@@ -148,7 +148,7 @@ static unsigned int socksys_poll(struct file * filp, poll_table * wait)
 	struct inode *ino;
 	unsigned int mask = 0;
 
-	ino=filp-&gt;f_dentry-&gt;d_inode;
+	ino=filp-&gt;f_path.dentry-&gt;d_inode;
 	if (ino &amp;&amp; S_ISSOCK(ino-&gt;i_mode)) {
 		struct sol_socket_struct *sock;
 		sock = (struct sol_socket_struct*)filp-&gt;private_data;
diff --git a/arch/sparc64/solaris/timod.c b/arch/sparc64/solaris/timod.c
index b84e5456b025..a9d32ceabf26 100644
--- a/arch/sparc64/solaris/timod.c
+++ b/arch/sparc64/solaris/timod.c
@@ -147,7 +147,7 @@ static void timod_wake_socket(unsigned int fd)
 
 	SOLD("wakeing socket");
 	fdt = files_fdtable(current-&gt;files);
-	sock = SOCKET_I(fdt-&gt;fd[fd]-&gt;f_dentry-&gt;d_inode);
+	sock = SOCKET_I(fdt-&gt;fd[fd]-&gt;f_path.dentry-&gt;d_inode);
 	wake_up_interruptible(&amp;sock-&gt;wait);
 	read_lock(&amp;sock-&gt;sk-&gt;sk_callback_lock);
 	if (sock-&gt;fasync_list &amp;&amp; !test_bit(SOCK_ASYNC_WAITDATA, &amp;sock-&gt;flags))
@@ -361,7 +361,7 @@ int timod_putmsg(unsigned int fd, char __user *ctl_buf, int ctl_len,
 
 	fdt = files_fdtable(current-&gt;files);
 	filp = fdt-&gt;fd[fd];
-	ino = filp-&gt;f_dentry-&gt;d_inode;
+	ino = filp-&gt;f_path.dentry-&gt;d_inode;
 	sock = (struct sol_socket_struct *)filp-&gt;private_data;
 	SOLD("entry");
 	if (get_user(ret, (int __user *)A(ctl_buf)))
@@ -644,7 +644,7 @@ int timod_getmsg(unsigned int fd, char __user *ctl_buf, int ctl_maxlen, s32 __us
 	SOLDD(("%u %p %d %p %p %d %p %d\n", fd, ctl_buf, ctl_maxlen, ctl_len, data_buf, data_maxlen, data_len, *flags_p));
 	fdt = files_fdtable(current-&gt;files);
 	filp = fdt-&gt;fd[fd];
-	ino = filp-&gt;f_dentry-&gt;d_inode;
+	ino = filp-&gt;f_path.dentry-&gt;d_inode;
 	sock = (struct sol_socket_struct *)filp-&gt;private_data;
 	SOLDD(("%p %p\n", sock-&gt;pfirst, sock-&gt;pfirst ? sock-&gt;pfirst-&gt;next : NULL));
 	if ( ctl_maxlen &gt; 0 &amp;&amp; !sock-&gt;pfirst &amp;&amp; SOCKET_I(ino)-&gt;type == SOCK_STREAM
@@ -865,7 +865,7 @@ asmlinkage int solaris_getmsg(unsigned int fd, u32 arg1, u32 arg2, u32 arg3)
 	filp = fdt-&gt;fd[fd];
 	if(!filp) goto out;
 
-	ino = filp-&gt;f_dentry-&gt;d_inode;
+	ino = filp-&gt;f_path.dentry-&gt;d_inode;
 	if (!ino || !S_ISSOCK(ino-&gt;i_mode))
 		goto out;
 
@@ -933,7 +933,7 @@ asmlinkage int solaris_putmsg(unsigned int fd, u32 arg1, u32 arg2, u32 arg3)
 	filp = fdt-&gt;fd[fd];
 	if(!filp) goto out;
 
-	ino = filp-&gt;f_dentry-&gt;d_inode;
+	ino = filp-&gt;f_path.dentry-&gt;d_inode;
 	if (!ino) goto out;
 
 	if (!S_ISSOCK(ino-&gt;i_mode) &amp;&amp;</pre><hr><pre>commit 45e079810a27d4a072347d90d405948f95cee812
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:41 2006 -0800

    [PATCH] struct path: convert sparc
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/sparc/kernel/sys_sunos.c b/arch/sparc/kernel/sys_sunos.c
index 6f3ac548ee66..0bf8c165fc92 100644
--- a/arch/sparc/kernel/sys_sunos.c
+++ b/arch/sparc/kernel/sys_sunos.c
@@ -94,8 +94,8 @@ asmlinkage unsigned long sunos_mmap(unsigned long addr, unsigned long len,
 	 * SunOS is so stupid some times... hmph!
 	 */
 	if (file) {
-		if (imajor(file-&gt;f_dentry-&gt;d_inode) == MEM_MAJOR &amp;&amp;
-		    iminor(file-&gt;f_dentry-&gt;d_inode) == 5) {
+		if (imajor(file-&gt;f_path.dentry-&gt;d_inode) == MEM_MAJOR &amp;&amp;
+		    iminor(file-&gt;f_path.dentry-&gt;d_inode) == 5) {
 			flags |= MAP_ANONYMOUS;
 			fput(file);
 			file = NULL;
@@ -655,7 +655,7 @@ sunos_nfs_get_server_fd (int fd, struct sockaddr_in *addr)
 	if (!file)
 		goto out;
 
-	inode = file-&gt;f_dentry-&gt;d_inode;
+	inode = file-&gt;f_path.dentry-&gt;d_inode;
 
 	socket = SOCKET_I(inode);
 	local.sin_family = AF_INET;</pre><hr><pre>commit 7bc563239e4c276afebd11d2e6e67ddc0cc65f0d
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:40 2006 -0800

    [PATCH] struct path: convert sound
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/sound/core/info.c b/sound/core/info.c
index 0b4aab3225e5..54591e2eb6ee 100644
--- a/sound/core/info.c
+++ b/sound/core/info.c
@@ -488,7 +488,7 @@ static long snd_info_entry_ioctl(struct file *file, unsigned int cmd,
 
 static int snd_info_entry_mmap(struct file *file, struct vm_area_struct *vma)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	struct snd_info_private_data *data;
 	struct snd_info_entry *entry;
 
diff --git a/sound/core/pcm_native.c b/sound/core/pcm_native.c
index 6ea67b16c676..b52e89393fa3 100644
--- a/sound/core/pcm_native.c
+++ b/sound/core/pcm_native.c
@@ -1604,7 +1604,7 @@ static struct file *snd_pcm_file_fd(int fd)
 	file = fget(fd);
 	if (!file)
 		return NULL;
-	inode = file-&gt;f_dentry-&gt;d_inode;
+	inode = file-&gt;f_path.dentry-&gt;d_inode;
 	if (!S_ISCHR(inode-&gt;i_mode) ||
 	    imajor(inode) != snd_major) {
 		fput(file);
diff --git a/sound/oss/dmasound/dmasound_core.c b/sound/oss/dmasound/dmasound_core.c
index 87bd3100aef3..80b836e80d99 100644
--- a/sound/oss/dmasound/dmasound_core.c
+++ b/sound/oss/dmasound/dmasound_core.c
@@ -1051,7 +1051,7 @@ static int sq_release(struct inode *inode, struct file *file)
 
 	if (file-&gt;f_mode &amp; FMODE_WRITE) {
 		if (write_sq.busy)
-			rc = sq_fsync(file, file-&gt;f_dentry);
+			rc = sq_fsync(file, file-&gt;f_path.dentry);
 
 		sq_reset_output() ; /* make sure dma is stopped and all is quiet */
 		write_sq_release_buffers();
@@ -1217,7 +1217,7 @@ static int sq_ioctl(struct inode *inode, struct file *file, u_int cmd,
 		if ((file-&gt;f_mode &amp; FMODE_READ) &amp;&amp; dmasound.mach.record)
 			sq_reset_input() ;
 		if (file-&gt;f_mode &amp; FMODE_WRITE) {
-			result = sq_fsync(file, file-&gt;f_dentry);
+			result = sq_fsync(file, file-&gt;f_path.dentry);
 			sq_reset_output() ;
 		}
 		/* if we are the shared resource owner then release them */
diff --git a/sound/oss/msnd_pinnacle.c b/sound/oss/msnd_pinnacle.c
index d5146790f5e3..24110d63b136 100644
--- a/sound/oss/msnd_pinnacle.c
+++ b/sound/oss/msnd_pinnacle.c
@@ -1007,7 +1007,7 @@ static int dsp_write(const char __user *buf, size_t len)
 
 static ssize_t dev_read(struct file *file, char __user *buf, size_t count, loff_t *off)
 {
-	int minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	if (minor == dev.dsp_minor)
 		return dsp_read(buf, count);
 	else
@@ -1016,7 +1016,7 @@ static ssize_t dev_read(struct file *file, char __user *buf, size_t count, loff_
 
 static ssize_t dev_write(struct file *file, const char __user *buf, size_t count, loff_t *off)
 {
-	int minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	if (minor == dev.dsp_minor)
 		return dsp_write(buf, count);
 	else
diff --git a/sound/oss/soundcard.c b/sound/oss/soundcard.c
index 8fb8e7f99556..a89108cb74ea 100644
--- a/sound/oss/soundcard.c
+++ b/sound/oss/soundcard.c
@@ -141,7 +141,7 @@ static int get_mixer_levels(void __user * arg)
 
 static ssize_t sound_read(struct file *file, char __user *buf, size_t count, loff_t *ppos)
 {
-	int dev = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int dev = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	int ret = -EINVAL;
 
 	/*
@@ -174,7 +174,7 @@ static ssize_t sound_read(struct file *file, char __user *buf, size_t count, lof
 
 static ssize_t sound_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	int dev = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int dev = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	int ret = -EINVAL;
 	
 	lock_kernel();
@@ -393,7 +393,7 @@ static int sound_ioctl(struct inode *inode, struct file *file,
 
 static unsigned int sound_poll(struct file *file, poll_table * wait)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	int dev = iminor(inode);
 
 	DEB(printk("sound_poll(dev=%d)\n", dev));
@@ -418,7 +418,7 @@ static int sound_mmap(struct file *file, struct vm_area_struct *vma)
 	int dev_class;
 	unsigned long size;
 	struct dma_buffparms *dmap = NULL;
-	int dev = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int dev = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 
 	dev_class = dev &amp; 0x0f;
 	dev &gt;&gt;= 4;
diff --git a/sound/sound_firmware.c b/sound/sound_firmware.c
index 3a181d4c0dc6..3304344713ae 100644
--- a/sound/sound_firmware.c
+++ b/sound/sound_firmware.c
@@ -19,7 +19,7 @@ static int do_mod_firmware_load(const char *fn, char **fp)
 		printk(KERN_INFO "Unable to load '%s'.\n", fn);
 		return 0;
 	}
-	l = filp-&gt;f_dentry-&gt;d_inode-&gt;i_size;
+	l = filp-&gt;f_path.dentry-&gt;d_inode-&gt;i_size;
 	if (l &lt;= 0 || l &gt; 131072)
 	{
 		printk(KERN_INFO "Invalid firmware '%s'\n", fn);</pre><hr><pre>commit 17b75e69493f655a09908045eddbb48718aef5de
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:39 2006 -0800

    [PATCH] struct path: convert smbfs
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/smbfs/cache.c b/fs/smbfs/cache.c
index 74b86d9725a6..8182f0542a21 100644
--- a/fs/smbfs/cache.c
+++ b/fs/smbfs/cache.c
@@ -125,7 +125,7 @@ smb_fill_cache(struct file *filp, void *dirent, filldir_t filldir,
 	       struct smb_cache_control *ctrl, struct qstr *qname,
 	       struct smb_fattr *entry)
 {
-	struct dentry *newdent, *dentry = filp-&gt;f_dentry;
+	struct dentry *newdent, *dentry = filp-&gt;f_path.dentry;
 	struct inode *newino, *inode = dentry-&gt;d_inode;
 	struct smb_cache_control ctl = *ctrl;
 	int valid = 0;
diff --git a/fs/smbfs/dir.c b/fs/smbfs/dir.c
index 70d9c5a37f5a..b1e58d1ac9ca 100644
--- a/fs/smbfs/dir.c
+++ b/fs/smbfs/dir.c
@@ -78,7 +78,7 @@ struct inode_operations smb_dir_inode_operations_unix =
 static int 
 smb_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
-	struct dentry *dentry = filp-&gt;f_dentry;
+	struct dentry *dentry = filp-&gt;f_path.dentry;
 	struct inode *dir = dentry-&gt;d_inode;
 	struct smb_sb_info *server = server_from_dentry(dentry);
 	union  smb_dir_cache *cache = NULL;
@@ -238,12 +238,12 @@ smb_readdir(struct file *filp, void *dirent, filldir_t filldir)
 static int
 smb_dir_open(struct inode *dir, struct file *file)
 {
-	struct dentry *dentry = file-&gt;f_dentry;
+	struct dentry *dentry = file-&gt;f_path.dentry;
 	struct smb_sb_info *server;
 	int error = 0;
 
 	VERBOSE("(%s/%s)\n", dentry-&gt;d_parent-&gt;d_name.name,
-		file-&gt;f_dentry-&gt;d_name.name);
+		file-&gt;f_path.dentry-&gt;d_name.name);
 
 	/*
 	 * Directory timestamps in the core protocol aren't updated
diff --git a/fs/smbfs/file.c b/fs/smbfs/file.c
index 50784d13c87b..e50533a79517 100644
--- a/fs/smbfs/file.c
+++ b/fs/smbfs/file.c
@@ -102,7 +102,7 @@ static int
 smb_readpage(struct file *file, struct page *page)
 {
 	int		error;
-	struct dentry  *dentry = file-&gt;f_dentry;
+	struct dentry  *dentry = file-&gt;f_path.dentry;
 
 	page_cache_get(page);
 	error = smb_readpage_sync(dentry, page);
@@ -205,7 +205,7 @@ static int
 smb_updatepage(struct file *file, struct page *page, unsigned long offset,
 	       unsigned int count)
 {
-	struct dentry *dentry = file-&gt;f_dentry;
+	struct dentry *dentry = file-&gt;f_path.dentry;
 
 	DEBUG1("(%s/%s %d@%lld)\n", DENTRY_PATH(dentry), count,
 		((unsigned long long)page-&gt;index &lt;&lt; PAGE_CACHE_SHIFT) + offset);
@@ -218,7 +218,7 @@ smb_file_aio_read(struct kiocb *iocb, const struct iovec *iov,
 			unsigned long nr_segs, loff_t pos)
 {
 	struct file * file = iocb-&gt;ki_filp;
-	struct dentry * dentry = file-&gt;f_dentry;
+	struct dentry * dentry = file-&gt;f_path.dentry;
 	ssize_t	status;
 
 	VERBOSE("file %s/%s, count=%lu@%lu\n", DENTRY_PATH(dentry),
@@ -243,7 +243,7 @@ smb_file_aio_read(struct kiocb *iocb, const struct iovec *iov,
 static int
 smb_file_mmap(struct file * file, struct vm_area_struct * vma)
 {
-	struct dentry * dentry = file-&gt;f_dentry;
+	struct dentry * dentry = file-&gt;f_path.dentry;
 	int	status;
 
 	VERBOSE("file %s/%s, address %lu - %lu\n",
@@ -264,7 +264,7 @@ static ssize_t
 smb_file_sendfile(struct file *file, loff_t *ppos,
 		  size_t count, read_actor_t actor, void *target)
 {
-	struct dentry *dentry = file-&gt;f_dentry;
+	struct dentry *dentry = file-&gt;f_path.dentry;
 	ssize_t status;
 
 	VERBOSE("file %s/%s, pos=%Ld, count=%d\n",
@@ -323,7 +323,7 @@ smb_file_aio_write(struct kiocb *iocb, const struct iovec *iov,
 			       unsigned long nr_segs, loff_t pos)
 {
 	struct file * file = iocb-&gt;ki_filp;
-	struct dentry * dentry = file-&gt;f_dentry;
+	struct dentry * dentry = file-&gt;f_path.dentry;
 	ssize_t	result;
 
 	VERBOSE("file %s/%s, count=%lu@%lu\n",
@@ -355,7 +355,7 @@ static int
 smb_file_open(struct inode *inode, struct file * file)
 {
 	int result;
-	struct dentry *dentry = file-&gt;f_dentry;
+	struct dentry *dentry = file-&gt;f_path.dentry;
 	int smb_mode = (file-&gt;f_mode &amp; O_ACCMODE) - 1;
 
 	lock_kernel();
diff --git a/fs/smbfs/proc.c b/fs/smbfs/proc.c
index 40e174db9872..a5ced9e0c6c4 100644
--- a/fs/smbfs/proc.c
+++ b/fs/smbfs/proc.c
@@ -873,7 +873,7 @@ smb_newconn(struct smb_sb_info *server, struct smb_conn_opt *opt)
 	filp = fget(opt-&gt;fd);
 	if (!filp)
 		goto out;
-	if (!smb_valid_socket(filp-&gt;f_dentry-&gt;d_inode))
+	if (!smb_valid_socket(filp-&gt;f_path.dentry-&gt;d_inode))
 		goto out_putf;
 
 	server-&gt;sock_file = filp;
@@ -898,7 +898,7 @@ smb_newconn(struct smb_sb_info *server, struct smb_conn_opt *opt)
 	/*
 	 * Store the server in sock user_data (Only used by sunrpc)
 	 */
-	sk = SOCKET_I(filp-&gt;f_dentry-&gt;d_inode)-&gt;sk;
+	sk = SOCKET_I(filp-&gt;f_path.dentry-&gt;d_inode)-&gt;sk;
 	sk-&gt;sk_user_data = server;
 
 	/* chain into the data_ready callback */
@@ -1939,7 +1939,7 @@ static int
 smb_proc_readdir_short(struct file *filp, void *dirent, filldir_t filldir,
 		       struct smb_cache_control *ctl)
 {
-	struct dentry *dir = filp-&gt;f_dentry;
+	struct dentry *dir = filp-&gt;f_path.dentry;
 	struct smb_sb_info *server = server_from_dentry(dir);
 	struct qstr qname;
 	struct smb_fattr fattr;
@@ -2291,7 +2291,7 @@ static int
 smb_proc_readdir_long(struct file *filp, void *dirent, filldir_t filldir,
 		      struct smb_cache_control *ctl)
 {
-	struct dentry *dir = filp-&gt;f_dentry;
+	struct dentry *dir = filp-&gt;f_path.dentry;
 	struct smb_sb_info *server = server_from_dentry(dir);
 	struct qstr qname;
 	struct smb_fattr fattr;
@@ -2859,7 +2859,7 @@ static int
 smb_proc_readdir_null(struct file *filp, void *dirent, filldir_t filldir,
 		      struct smb_cache_control *ctl)
 {
-	struct smb_sb_info *server = server_from_dentry(filp-&gt;f_dentry);
+	struct smb_sb_info *server = server_from_dentry(filp-&gt;f_path.dentry);
 
 	if (smb_proc_ops_wait(server) &lt; 0)
 		return -EIO;
diff --git a/fs/smbfs/sock.c b/fs/smbfs/sock.c
index 6815b1b12b68..92ea6b2367d7 100644
--- a/fs/smbfs/sock.c
+++ b/fs/smbfs/sock.c
@@ -82,10 +82,10 @@ server_sock(struct smb_sb_info *server)
 	if (server &amp;&amp; (file = server-&gt;sock_file))
 	{
 #ifdef SMBFS_PARANOIA
-		if (!smb_valid_socket(file-&gt;f_dentry-&gt;d_inode))
+		if (!smb_valid_socket(file-&gt;f_path.dentry-&gt;d_inode))
 			PARANOIA("bad socket!\n");
 #endif
-		return SOCKET_I(file-&gt;f_dentry-&gt;d_inode);
+		return SOCKET_I(file-&gt;f_path.dentry-&gt;d_inode);
 	}
 	return NULL;
 }</pre><hr><pre>commit c943c4b49c75f3cae89e5d993ce1ae859395caa2
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:38 2006 -0800

    [PATCH] struct path: convert sh
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/sh/oprofile/op_model_sh7750.c b/arch/sh/oprofile/op_model_sh7750.c
index c265185b22a7..60402eec4b4d 100644
--- a/arch/sh/oprofile/op_model_sh7750.c
+++ b/arch/sh/oprofile/op_model_sh7750.c
@@ -142,7 +142,7 @@ static u64 sh7750_read_counter(int counter)
  */
 static inline int to_counter(struct file *file)
 {
-	const unsigned char *name = file-&gt;f_dentry-&gt;d_parent-&gt;d_name.name;
+	const unsigned char *name = file-&gt;f_path.dentry-&gt;d_parent-&gt;d_name.name;
 
 	return (int)simple_strtol(name, NULL, 10);
 }</pre><hr><pre>commit 3d5ff529ea222461a5fa3c4df05cbdc5eb56864d
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:38 2006 -0800

    [PATCH] struct path: convert selinux
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/security/selinux/hooks.c b/security/selinux/hooks.c
index f5df8c70a9b5..3753416eb9b9 100644
--- a/security/selinux/hooks.c
+++ b/security/selinux/hooks.c
@@ -1120,8 +1120,8 @@ static int file_has_perm(struct task_struct *tsk,
 {
 	struct task_security_struct *tsec = tsk-&gt;security;
 	struct file_security_struct *fsec = file-&gt;f_security;
-	struct vfsmount *mnt = file-&gt;f_vfsmnt;
-	struct dentry *dentry = file-&gt;f_dentry;
+	struct vfsmount *mnt = file-&gt;f_path.mnt;
+	struct dentry *dentry = file-&gt;f_path.dentry;
 	struct inode *inode = dentry-&gt;d_inode;
 	struct avc_audit_data ad;
 	int rc;
@@ -1581,7 +1581,7 @@ static int selinux_bprm_alloc_security(struct linux_binprm *bprm)
 static int selinux_bprm_set_security(struct linux_binprm *bprm)
 {
 	struct task_security_struct *tsec;
-	struct inode *inode = bprm-&gt;file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = bprm-&gt;file-&gt;f_path.dentry-&gt;d_inode;
 	struct inode_security_struct *isec;
 	struct bprm_security_struct *bsec;
 	u32 newsid;
@@ -1621,10 +1621,10 @@ static int selinux_bprm_set_security(struct linux_binprm *bprm)
 	}
 
 	AVC_AUDIT_DATA_INIT(&amp;ad, FS);
-	ad.u.fs.mnt = bprm-&gt;file-&gt;f_vfsmnt;
-	ad.u.fs.dentry = bprm-&gt;file-&gt;f_dentry;
+	ad.u.fs.mnt = bprm-&gt;file-&gt;f_path.mnt;
+	ad.u.fs.dentry = bprm-&gt;file-&gt;f_path.dentry;
 
-	if (bprm-&gt;file-&gt;f_vfsmnt-&gt;mnt_flags &amp; MNT_NOSUID)
+	if (bprm-&gt;file-&gt;f_path.mnt-&gt;mnt_flags &amp; MNT_NOSUID)
 		newsid = tsec-&gt;sid;
 
         if (tsec-&gt;sid == newsid) {
@@ -1708,7 +1708,7 @@ static inline void flush_unauthorized_files(struct files_struct * files)
 			   than using file_has_perm, as this particular open
 			   file may belong to another process and we are only
 			   interested in the inode-based check here. */
-			struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+			struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 			if (inode_has_perm(current, inode,
 					   FILE__READ | FILE__WRITE, NULL)) {
 				drop_tty = 1;
@@ -2420,7 +2420,7 @@ static int selinux_inode_listsecurity(struct inode *inode, char *buffer, size_t
 static int selinux_file_permission(struct file *file, int mask)
 {
 	int rc;
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 
 	if (!mask) {
 		/* No permission to check.  Existence test. */
@@ -2597,7 +2597,7 @@ static int selinux_file_fcntl(struct file *file, unsigned int cmd,
 
 	switch (cmd) {
 	        case F_SETFL:
-			if (!file-&gt;f_dentry || !file-&gt;f_dentry-&gt;d_inode) {
+			if (!file-&gt;f_path.dentry || !file-&gt;f_path.dentry-&gt;d_inode) {
 				err = -EINVAL;
 				break;
 			}
@@ -2623,7 +2623,7 @@ static int selinux_file_fcntl(struct file *file, unsigned int cmd,
 		case F_SETLK64:
 	        case F_SETLKW64:
 #endif
-			if (!file-&gt;f_dentry || !file-&gt;f_dentry-&gt;d_inode) {
+			if (!file-&gt;f_path.dentry || !file-&gt;f_path.dentry-&gt;d_inode) {
 				err = -EINVAL;
 				break;
 			}
diff --git a/security/selinux/selinuxfs.c b/security/selinux/selinuxfs.c
index cd244419c980..c8bf6e172f6e 100644
--- a/security/selinux/selinuxfs.c
+++ b/security/selinux/selinuxfs.c
@@ -448,7 +448,7 @@ static ssize_t (*write_op[])(struct file *, char *, size_t) = {
 
 static ssize_t selinux_transaction_write(struct file *file, const char __user *buf, size_t size, loff_t *pos)
 {
-	ino_t ino =  file-&gt;f_dentry-&gt;d_inode-&gt;i_ino;
+	ino_t ino =  file-&gt;f_path.dentry-&gt;d_inode-&gt;i_ino;
 	char *data;
 	ssize_t rv;
 
@@ -805,7 +805,7 @@ static ssize_t sel_read_bool(struct file *filep, char __user *buf,
 		goto out;
 	}
 
-	inode = filep-&gt;f_dentry-&gt;d_inode;
+	inode = filep-&gt;f_path.dentry-&gt;d_inode;
 	cur_enforcing = security_get_bool_value(inode-&gt;i_ino - BOOL_INO_OFFSET);
 	if (cur_enforcing &lt; 0) {
 		ret = cur_enforcing;
@@ -864,7 +864,7 @@ static ssize_t sel_write_bool(struct file *filep, const char __user *buf,
 	if (new_value)
 		new_value = 1;
 
-	inode = filep-&gt;f_dentry-&gt;d_inode;
+	inode = filep-&gt;f_path.dentry-&gt;d_inode;
 	bool_pending_values[inode-&gt;i_ino - BOOL_INO_OFFSET] = new_value;
 	length = count;
 
@@ -965,7 +965,7 @@ static void sel_remove_bools(struct dentry *de)
 	file_list_lock();
 	list_for_each(p, &amp;sb-&gt;s_files) {
 		struct file * filp = list_entry(p, struct file, f_u.fu_list);
-		struct dentry * dentry = filp-&gt;f_dentry;
+		struct dentry * dentry = filp-&gt;f_path.dentry;
 
 		if (dentry-&gt;d_parent != de) {
 			continue;</pre>
    <div class="pagination">
        <a href='9.html'>&lt;&lt;Prev</a><a href='9.html'>1</a><span>[2]</span><a href='9_3.html'>3</a><a href='9_4.html'>4</a><a href='9_5.html'>5</a><a href='9_6.html'>6</a><a href='9_7.html'>7</a><a href='9_8.html'>8</a><a href='9_9.html'>9</a><a href='9_10.html'>10</a><a href='9_11.html'>11</a><a href='9_12.html'>12</a><a href='9_13.html'>13</a><a href='9_14.html'>14</a><a href='9_3.html'>Next&gt;&gt;</a>
    <div>
</body>

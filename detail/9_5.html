<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by State University of New York at Stony Brook</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by State University of New York at Stony Brook</h1>
    <div class="pagination">
        <a href='9_4.html'>&lt;&lt;Prev</a><a href='9.html'>1</a><a href='9_2.html'>2</a><a href='9_3.html'>3</a><a href='9_4.html'>4</a><span>[5]</span><a href='9_6.html'>6</a><a href='9_7.html'>7</a><a href='9_8.html'>8</a><a href='9_9.html'>9</a><a href='9_10.html'>10</a><a href='9_11.html'>11</a><a href='9_12.html'>12</a><a href='9_13.html'>13</a><a href='9_14.html'>14</a><a href='9_6.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 17506041de973bdc718b9a255d822e571b12b421
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:22 2006 -0800

    [PATCH] struct path: convert nbd
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/drivers/block/nbd.c b/drivers/block/nbd.c
index 7bf2cfbd6285..090796bef78f 100644
--- a/drivers/block/nbd.c
+++ b/drivers/block/nbd.c
@@ -537,7 +537,7 @@ static int nbd_ioctl(struct inode *inode, struct file *file,
 		error = -EINVAL;
 		file = fget(arg);
 		if (file) {
-			inode = file-&gt;f_dentry-&gt;d_inode;
+			inode = file-&gt;f_path.dentry-&gt;d_inode;
 			if (S_ISSOCK(inode-&gt;i_mode)) {
 				lo-&gt;file = file;
 				lo-&gt;sock = SOCKET_I(inode);</pre><hr><pre>commit e9536ae7205d255bc94616b72910fc6e16c861fe
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:21 2006 -0800

    [PATCH] struct path: convert mm
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/mm/mempolicy.c b/mm/mempolicy.c
index b917d6fdc1bb..da9463946556 100644
--- a/mm/mempolicy.c
+++ b/mm/mempolicy.c
@@ -1857,7 +1857,7 @@ int show_numa_map(struct seq_file *m, void *v)
 
 	if (file) {
 		seq_printf(m, " file=");
-		seq_path(m, file-&gt;f_vfsmnt, file-&gt;f_dentry, "\n\t= ");
+		seq_path(m, file-&gt;f_path.mnt, file-&gt;f_path.dentry, "\n\t= ");
 	} else if (vma-&gt;vm_start &lt;= mm-&gt;brk &amp;&amp; vma-&gt;vm_end &gt;= mm-&gt;start_brk) {
 		seq_printf(m, " heap");
 	} else if (vma-&gt;vm_start &lt;= mm-&gt;start_stack &amp;&amp;
diff --git a/mm/nommu.c b/mm/nommu.c
index af874569d0f1..23fb033e596d 100644
--- a/mm/nommu.c
+++ b/mm/nommu.c
@@ -523,7 +523,7 @@ static int validate_mmap_request(struct file *file,
 		 */
 		mapping = file-&gt;f_mapping;
 		if (!mapping)
-			mapping = file-&gt;f_dentry-&gt;d_inode-&gt;i_mapping;
+			mapping = file-&gt;f_path.dentry-&gt;d_inode-&gt;i_mapping;
 
 		capabilities = 0;
 		if (mapping &amp;&amp; mapping-&gt;backing_dev_info)
@@ -532,7 +532,7 @@ static int validate_mmap_request(struct file *file,
 		if (!capabilities) {
 			/* no explicit capabilities set, so assume some
 			 * defaults */
-			switch (file-&gt;f_dentry-&gt;d_inode-&gt;i_mode &amp; S_IFMT) {
+			switch (file-&gt;f_path.dentry-&gt;d_inode-&gt;i_mode &amp; S_IFMT) {
 			case S_IFREG:
 			case S_IFBLK:
 				capabilities = BDI_CAP_MAP_COPY;
@@ -563,11 +563,11 @@ static int validate_mmap_request(struct file *file,
 			    !(file-&gt;f_mode &amp; FMODE_WRITE))
 				return -EACCES;
 
-			if (IS_APPEND(file-&gt;f_dentry-&gt;d_inode) &amp;&amp;
+			if (IS_APPEND(file-&gt;f_path.dentry-&gt;d_inode) &amp;&amp;
 			    (file-&gt;f_mode &amp; FMODE_WRITE))
 				return -EACCES;
 
-			if (locks_verify_locked(file-&gt;f_dentry-&gt;d_inode))
+			if (locks_verify_locked(file-&gt;f_path.dentry-&gt;d_inode))
 				return -EAGAIN;
 
 			if (!(capabilities &amp; BDI_CAP_MAP_DIRECT))
@@ -598,7 +598,7 @@ static int validate_mmap_request(struct file *file,
 
 		/* handle executable mappings and implied executable
 		 * mappings */
-		if (file-&gt;f_vfsmnt-&gt;mnt_flags &amp; MNT_NOEXEC) {
+		if (file-&gt;f_path.mnt-&gt;mnt_flags &amp; MNT_NOEXEC) {
 			if (prot &amp; PROT_EXEC)
 				return -EPERM;
 		}
@@ -833,7 +833,7 @@ unsigned long do_mmap_pgoff(struct file *file,
 				continue;
 
 			/* search for overlapping mappings on the same file */
-			if (vma-&gt;vm_file-&gt;f_dentry-&gt;d_inode != file-&gt;f_dentry-&gt;d_inode)
+			if (vma-&gt;vm_file-&gt;f_path.dentry-&gt;d_inode != file-&gt;f_path.dentry-&gt;d_inode)
 				continue;
 
 			if (vma-&gt;vm_pgoff &gt;= pgoff + pglen)
diff --git a/mm/readahead.c b/mm/readahead.c
index a386f2b6b335..c0df5ed05f62 100644
--- a/mm/readahead.c
+++ b/mm/readahead.c
@@ -450,7 +450,7 @@ static int make_ahead_window(struct address_space *mapping, struct file *filp,
  *
  * Note that @filp is purely used for passing on to the -&gt;readpage[s]()
  * handler: it may refer to a different file from @mapping (so we may not use
- * @filp-&gt;f_mapping or @filp-&gt;f_dentry-&gt;d_inode here).
+ * @filp-&gt;f_mapping or @filp-&gt;f_path.dentry-&gt;d_inode here).
  * Also, @ra may not be equal to &amp;@filp-&gt;f_ra.
  *
  */
diff --git a/mm/tiny-shmem.c b/mm/tiny-shmem.c
index 5f2cbf0f153c..c7f6e1914bc4 100644
--- a/mm/tiny-shmem.c
+++ b/mm/tiny-shmem.c
@@ -79,8 +79,8 @@ struct file *shmem_file_setup(char *name, loff_t size, unsigned long flags)
 	d_instantiate(dentry, inode);
 	inode-&gt;i_nlink = 0;	/* It is unlinked */
 
-	file-&gt;f_vfsmnt = mntget(shm_mnt);
-	file-&gt;f_dentry = dentry;
+	file-&gt;f_path.mnt = mntget(shm_mnt);
+	file-&gt;f_path.dentry = dentry;
 	file-&gt;f_mapping = inode-&gt;i_mapping;
 	file-&gt;f_op = &amp;ramfs_file_operations;
 	file-&gt;f_mode = FMODE_WRITE | FMODE_READ;</pre><hr><pre>commit 1b04fe9a8ef10774174897b15d753b9de85fe9e9
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:20 2006 -0800

    [PATCH] struct path: convert mips
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/mips/kernel/rtlx.c b/arch/mips/kernel/rtlx.c
index 8c8c8324f775..5a99e3e0c96d 100644
--- a/arch/mips/kernel/rtlx.c
+++ b/arch/mips/kernel/rtlx.c
@@ -415,7 +415,7 @@ static unsigned int file_poll(struct file *file, poll_table * wait)
 	int minor;
 	unsigned int mask = 0;
 
-	minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 
 	poll_wait(file, &amp;channel_wqs[minor].rt_queue, wait);
 	poll_wait(file, &amp;channel_wqs[minor].lx_queue, wait);
@@ -437,7 +437,7 @@ static unsigned int file_poll(struct file *file, poll_table * wait)
 static ssize_t file_read(struct file *file, char __user * buffer, size_t count,
 			 loff_t * ppos)
 {
-	int minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 
 	/* data available? */
 	if (!rtlx_read_poll(minor, (file-&gt;f_flags &amp; O_NONBLOCK) ? 0 : 1)) {
@@ -454,7 +454,7 @@ static ssize_t file_write(struct file *file, const char __user * buffer,
 	struct rtlx_channel *rt;
 	DECLARE_WAITQUEUE(wait, current);
 
-	minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	rt = &amp;rtlx-&gt;channel[minor];
 
 	/* any space left... */
diff --git a/arch/mips/kernel/sysirix.c b/arch/mips/kernel/sysirix.c
index 93c74fefff76..6c2406a93f2b 100644
--- a/arch/mips/kernel/sysirix.c
+++ b/arch/mips/kernel/sysirix.c
@@ -732,7 +732,7 @@ asmlinkage int irix_fstatfs(unsigned int fd, struct irix_statfs __user *buf)
 		goto out;
 	}
 
-	error = vfs_statfs(file-&gt;f_dentry, &amp;kbuf);
+	error = vfs_statfs(file-&gt;f_path.dentry, &amp;kbuf);
 	if (error)
 		goto out_f;
 
@@ -1041,7 +1041,7 @@ asmlinkage unsigned long irix_mmap32(unsigned long addr, size_t len, int prot,
 			unsigned long old_pos;
 			long max_size = offset + len;
 
-			if (max_size &gt; file-&gt;f_dentry-&gt;d_inode-&gt;i_size) {
+			if (max_size &gt; file-&gt;f_path.dentry-&gt;d_inode-&gt;i_size) {
 				old_pos = sys_lseek (fd, max_size - 1, 0);
 				sys_write (fd, (void __user *) "", 1);
 				sys_lseek (fd, old_pos, 0);
@@ -1406,7 +1406,7 @@ asmlinkage int irix_fstatvfs(int fd, struct irix_statvfs __user *buf)
 		error = -EBADF;
 		goto out;
 	}
-	error = vfs_statfs(file-&gt;f_dentry, &amp;kbuf);
+	error = vfs_statfs(file-&gt;f_path.dentry, &amp;kbuf);
 	if (error)
 		goto out_f;
 
@@ -1526,7 +1526,7 @@ asmlinkage int irix_mmap64(struct pt_regs *regs)
 			unsigned long old_pos;
 			long max_size = off2 + len;
 
-			if (max_size &gt; file-&gt;f_dentry-&gt;d_inode-&gt;i_size) {
+			if (max_size &gt; file-&gt;f_path.dentry-&gt;d_inode-&gt;i_size) {
 				old_pos = sys_lseek (fd, max_size - 1, 0);
 				sys_write (fd, (void __user *) "", 1);
 				sys_lseek (fd, old_pos, 0);
@@ -1658,7 +1658,7 @@ asmlinkage int irix_fstatvfs64(int fd, struct irix_statvfs __user *buf)
 		error = -EBADF;
 		goto out;
 	}
-	error = vfs_statfs(file-&gt;f_dentry, &amp;kbuf);
+	error = vfs_statfs(file-&gt;f_path.dentry, &amp;kbuf);
 	if (error)
 		goto out_f;
 
diff --git a/arch/mips/kernel/vpe.c b/arch/mips/kernel/vpe.c
index 51ddd2166898..666bef484dcb 100644
--- a/arch/mips/kernel/vpe.c
+++ b/arch/mips/kernel/vpe.c
@@ -1179,7 +1179,7 @@ static ssize_t vpe_write(struct file *file, const char __user * buffer,
 	size_t ret = count;
 	struct vpe *v;
 
-	minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	if ((v = get_vpe(minor)) == NULL)
 		return -ENODEV;
 
diff --git a/arch/mips/lasat/sysctl.c b/arch/mips/lasat/sysctl.c
index 6dd7ae1b7c25..da35d4555491 100644
--- a/arch/mips/lasat/sysctl.c
+++ b/arch/mips/lasat/sysctl.c
@@ -286,11 +286,11 @@ int proc_lasat_eeprom_value(ctl_table *table, int write, struct file *filp,
 		mutex_unlock(&amp;lasat_info_mutex);
 		return r;
 	}
-	if (filp &amp;&amp; filp-&gt;f_dentry)
+	if (filp &amp;&amp; filp-&gt;f_path.dentry)
 	{
-		if (!strcmp(filp-&gt;f_dentry-&gt;d_name.name, "prid"))
+		if (!strcmp(filp-&gt;f_path.dentry-&gt;d_name.name, "prid"))
 			lasat_board_info.li_eeprom_info.prid = lasat_board_info.li_prid;
-		if (!strcmp(filp-&gt;f_dentry-&gt;d_name.name, "debugaccess"))
+		if (!strcmp(filp-&gt;f_path.dentry-&gt;d_name.name, "debugaccess"))
 			lasat_board_info.li_eeprom_info.debugaccess = lasat_board_info.li_debugaccess;
 	}
 	lasat_write_eeprom_info();</pre><hr><pre>commit dcf258ae682c2dbbe1a34624f2b3f56353d3874d
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:19 2006 -0800

    [PATCH] struct path: convert minix
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/minix/dir.c b/fs/minix/dir.c
index 2b0a389d1987..ab782c4086f5 100644
--- a/fs/minix/dir.c
+++ b/fs/minix/dir.c
@@ -82,7 +82,7 @@ static inline void *minix_next_entry(void *de, struct minix_sb_info *sbi)
 static int minix_readdir(struct file * filp, void * dirent, filldir_t filldir)
 {
 	unsigned long pos = filp-&gt;f_pos;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct super_block *sb = inode-&gt;i_sb;
 	unsigned offset = pos &amp; ~PAGE_CACHE_MASK;
 	unsigned long n = pos &gt;&gt; PAGE_CACHE_SHIFT;</pre><hr><pre>commit c649bb9c55e78dcff0e1383c13d91e0bfc2abb4a
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:19 2006 -0800

    [PATCH] struct path: convert md
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/drivers/md/bitmap.c b/drivers/md/bitmap.c
index d6f614738bbd..5432d07c074d 100644
--- a/drivers/md/bitmap.c
+++ b/drivers/md/bitmap.c
@@ -212,8 +212,8 @@ char *file_path(struct file *file, char *buf, int count)
 	if (!buf)
 		return NULL;
 
-	d = file-&gt;f_dentry;
-	v = file-&gt;f_vfsmnt;
+	d = file-&gt;f_path.dentry;
+	v = file-&gt;f_path.mnt;
 
 	buf = d_path(d, v, buf, count);
 
@@ -349,7 +349,7 @@ static struct page *read_page(struct file *file, unsigned long index,
 			      unsigned long count)
 {
 	struct page *page = NULL;
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	struct buffer_head *bh;
 	sector_t block;
 
@@ -662,7 +662,7 @@ static void bitmap_file_put(struct bitmap *bitmap)
 	bitmap_file_unmap(bitmap);
 
 	if (file) {
-		struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+		struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 		invalidate_inode_pages(inode-&gt;i_mapping);
 		fput(file);
 	}
diff --git a/drivers/md/dm-linear.c b/drivers/md/dm-linear.c
index 00234909b3db..4a1cee48e652 100644
--- a/drivers/md/dm-linear.c
+++ b/drivers/md/dm-linear.c
@@ -108,7 +108,7 @@ static int linear_ioctl(struct dm_target *ti, struct inode *inode,
 	struct dentry fake_dentry = {};
 
 	fake_file.f_mode = lc-&gt;dev-&gt;mode;
-	fake_file.f_dentry = &amp;fake_dentry;
+	fake_file.f_path.dentry = &amp;fake_dentry;
 	fake_dentry.d_inode = bdev-&gt;bd_inode;
 
 	return blkdev_driver_ioctl(bdev-&gt;bd_inode, &amp;fake_file, bdev-&gt;bd_disk, cmd, arg);
diff --git a/drivers/md/dm-mpath.c b/drivers/md/dm-mpath.c
index e9dfe2c98059..dda4109292bc 100644
--- a/drivers/md/dm-mpath.c
+++ b/drivers/md/dm-mpath.c
@@ -1272,7 +1272,7 @@ static int multipath_ioctl(struct dm_target *ti, struct inode *inode,
 	struct dentry fake_dentry = {};
 	int r = 0;
 
-	fake_file.f_dentry = &amp;fake_dentry;
+	fake_file.f_path.dentry = &amp;fake_dentry;
 
 	spin_lock_irqsave(&amp;m-&gt;lock, flags);
 
diff --git a/drivers/md/md.c b/drivers/md/md.c
index 3ce7a5d81d81..53bd46dba0cb 100644
--- a/drivers/md/md.c
+++ b/drivers/md/md.c
@@ -4846,8 +4846,8 @@ static int md_seq_show(struct seq_file *seq, void *v)
 				chunk_kb ? "KB" : "B");
 			if (bitmap-&gt;file) {
 				seq_printf(seq, ", file: ");
-				seq_path(seq, bitmap-&gt;file-&gt;f_vfsmnt,
-					 bitmap-&gt;file-&gt;f_dentry," \t\n");
+				seq_path(seq, bitmap-&gt;file-&gt;f_path.mnt,
+					 bitmap-&gt;file-&gt;f_path.dentry," \t\n");
 			}
 
 			seq_printf(seq, "\n");</pre><hr><pre>commit 225a719f79fbc4d0cd9d9ebc5b2e3ac0e95845aa
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:18 2006 -0800

    [PATCH] struct path: convert lockd
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/lockd/clntlock.c b/fs/lockd/clntlock.c
index b85a0ad2cfb6..92681c9e9b20 100644
--- a/fs/lockd/clntlock.c
+++ b/fs/lockd/clntlock.c
@@ -126,7 +126,7 @@ __be32 nlmclnt_grant(const struct sockaddr_in *addr, const struct nlm_lock *lock
 			continue;
 		if (!nlm_cmp_addr(&amp;block-&gt;b_host-&gt;h_addr, addr))
 			continue;
-		if (nfs_compare_fh(NFS_FH(fl_blocked-&gt;fl_file-&gt;f_dentry-&gt;d_inode) ,fh) != 0)
+		if (nfs_compare_fh(NFS_FH(fl_blocked-&gt;fl_file-&gt;f_path.dentry-&gt;d_inode) ,fh) != 0)
 			continue;
 		/* Alright, we found a lock. Set the return status
 		 * and wake up the caller
diff --git a/fs/lockd/clntproc.c b/fs/lockd/clntproc.c
index 497c3cd59d52..80a1a6dccc8f 100644
--- a/fs/lockd/clntproc.c
+++ b/fs/lockd/clntproc.c
@@ -129,7 +129,7 @@ static void nlmclnt_setlockargs(struct nlm_rqst *req, struct file_lock *fl)
 
 	nlmclnt_next_cookie(&amp;argp-&gt;cookie);
 	argp-&gt;state   = nsm_local_state;
-	memcpy(&amp;lock-&gt;fh, NFS_FH(fl-&gt;fl_file-&gt;f_dentry-&gt;d_inode), sizeof(struct nfs_fh));
+	memcpy(&amp;lock-&gt;fh, NFS_FH(fl-&gt;fl_file-&gt;f_path.dentry-&gt;d_inode), sizeof(struct nfs_fh));
 	lock-&gt;caller  = utsname()-&gt;nodename;
 	lock-&gt;oh.data = req-&gt;a_owner;
 	lock-&gt;oh.len  = snprintf(req-&gt;a_owner, sizeof(req-&gt;a_owner), "%u@%s",
diff --git a/fs/lockd/svclock.c b/fs/lockd/svclock.c
index 7e219b938552..5c054b20fd5e 100644
--- a/fs/lockd/svclock.c
+++ b/fs/lockd/svclock.c
@@ -343,8 +343,8 @@ nlmsvc_lock(struct svc_rqst *rqstp, struct nlm_file *file,
 	__be32			ret;
 
 	dprintk("lockd: nlmsvc_lock(%s/%ld, ty=%d, pi=%d, %Ld-%Ld, bl=%d)\n",
-				file-&gt;f_file-&gt;f_dentry-&gt;d_inode-&gt;i_sb-&gt;s_id,
-				file-&gt;f_file-&gt;f_dentry-&gt;d_inode-&gt;i_ino,
+				file-&gt;f_file-&gt;f_path.dentry-&gt;d_inode-&gt;i_sb-&gt;s_id,
+				file-&gt;f_file-&gt;f_path.dentry-&gt;d_inode-&gt;i_ino,
 				lock-&gt;fl.fl_type, lock-&gt;fl.fl_pid,
 				(long long)lock-&gt;fl.fl_start,
 				(long long)lock-&gt;fl.fl_end,
@@ -420,8 +420,8 @@ nlmsvc_testlock(struct nlm_file *file, struct nlm_lock *lock,
 				       struct nlm_lock *conflock)
 {
 	dprintk("lockd: nlmsvc_testlock(%s/%ld, ty=%d, %Ld-%Ld)\n",
-				file-&gt;f_file-&gt;f_dentry-&gt;d_inode-&gt;i_sb-&gt;s_id,
-				file-&gt;f_file-&gt;f_dentry-&gt;d_inode-&gt;i_ino,
+				file-&gt;f_file-&gt;f_path.dentry-&gt;d_inode-&gt;i_sb-&gt;s_id,
+				file-&gt;f_file-&gt;f_path.dentry-&gt;d_inode-&gt;i_ino,
 				lock-&gt;fl.fl_type,
 				(long long)lock-&gt;fl.fl_start,
 				(long long)lock-&gt;fl.fl_end);
@@ -454,8 +454,8 @@ nlmsvc_unlock(struct nlm_file *file, struct nlm_lock *lock)
 	int	error;
 
 	dprintk("lockd: nlmsvc_unlock(%s/%ld, pi=%d, %Ld-%Ld)\n",
-				file-&gt;f_file-&gt;f_dentry-&gt;d_inode-&gt;i_sb-&gt;s_id,
-				file-&gt;f_file-&gt;f_dentry-&gt;d_inode-&gt;i_ino,
+				file-&gt;f_file-&gt;f_path.dentry-&gt;d_inode-&gt;i_sb-&gt;s_id,
+				file-&gt;f_file-&gt;f_path.dentry-&gt;d_inode-&gt;i_ino,
 				lock-&gt;fl.fl_pid,
 				(long long)lock-&gt;fl.fl_start,
 				(long long)lock-&gt;fl.fl_end);
@@ -483,8 +483,8 @@ nlmsvc_cancel_blocked(struct nlm_file *file, struct nlm_lock *lock)
 	int status = 0;
 
 	dprintk("lockd: nlmsvc_cancel(%s/%ld, pi=%d, %Ld-%Ld)\n",
-				file-&gt;f_file-&gt;f_dentry-&gt;d_inode-&gt;i_sb-&gt;s_id,
-				file-&gt;f_file-&gt;f_dentry-&gt;d_inode-&gt;i_ino,
+				file-&gt;f_file-&gt;f_path.dentry-&gt;d_inode-&gt;i_sb-&gt;s_id,
+				file-&gt;f_file-&gt;f_path.dentry-&gt;d_inode-&gt;i_ino,
 				lock-&gt;fl.fl_pid,
 				(long long)lock-&gt;fl.fl_start,
 				(long long)lock-&gt;fl.fl_end);
diff --git a/fs/lockd/svcsubs.c b/fs/lockd/svcsubs.c
index e83024e16042..c0df00c74ce3 100644
--- a/fs/lockd/svcsubs.c
+++ b/fs/lockd/svcsubs.c
@@ -43,7 +43,7 @@ static inline void nlm_debug_print_fh(char *msg, struct nfs_fh *f)
 
 static inline void nlm_debug_print_file(char *msg, struct nlm_file *file)
 {
-	struct inode *inode = file-&gt;f_file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_file-&gt;f_path.dentry-&gt;d_inode;
 
 	dprintk("lockd: %s %s/%ld\n",
 		msg, inode-&gt;i_sb-&gt;s_id, inode-&gt;i_ino);
diff --git a/include/linux/lockd/lockd.h b/include/linux/lockd/lockd.h
index 8c39654549d8..0c962b82a9de 100644
--- a/include/linux/lockd/lockd.h
+++ b/include/linux/lockd/lockd.h
@@ -206,7 +206,7 @@ void		  nlmsvc_invalidate_all(void);
 static __inline__ struct inode *
 nlmsvc_file_inode(struct nlm_file *file)
 {
-	return file-&gt;f_file-&gt;f_dentry-&gt;d_inode;
+	return file-&gt;f_file-&gt;f_path.dentry-&gt;d_inode;
 }
 
 /*</pre><hr><pre>commit a7a005fd12b84392becca311f2a20d5bf2a1b7af
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:17 2006 -0800

    [PATCH] struct path: convert kernel
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/kernel/auditsc.c b/kernel/auditsc.c
index b6cb802fbcd1..298897559ca4 100644
--- a/kernel/auditsc.c
+++ b/kernel/auditsc.c
@@ -781,8 +781,8 @@ static void audit_log_task_info(struct audit_buffer *ab, struct task_struct *tsk
 			if ((vma-&gt;vm_flags &amp; VM_EXECUTABLE) &amp;&amp;
 			    vma-&gt;vm_file) {
 				audit_log_d_path(ab, "exe=",
-						 vma-&gt;vm_file-&gt;f_dentry,
-						 vma-&gt;vm_file-&gt;f_vfsmnt);
+						 vma-&gt;vm_file-&gt;f_path.dentry,
+						 vma-&gt;vm_file-&gt;f_path.mnt);
 				break;
 			}
 			vma = vma-&gt;vm_next;
diff --git a/kernel/cpuset.c b/kernel/cpuset.c
index 0a6b4d89f9a0..2c3b4431472b 100644
--- a/kernel/cpuset.c
+++ b/kernel/cpuset.c
@@ -413,8 +413,8 @@ static struct file_system_type cpuset_fs_type = {
  *
  *
  * When reading/writing to a file:
- *	- the cpuset to use in file-&gt;f_dentry-&gt;d_parent-&gt;d_fsdata
- *	- the 'cftype' of the file is file-&gt;f_dentry-&gt;d_fsdata
+ *	- the cpuset to use in file-&gt;f_path.dentry-&gt;d_parent-&gt;d_fsdata
+ *	- the 'cftype' of the file is file-&gt;f_path.dentry-&gt;d_fsdata
  */
 
 struct cftype {
@@ -1284,8 +1284,8 @@ static ssize_t cpuset_common_file_write(struct file *file,
 					const char __user *userbuf,
 					size_t nbytes, loff_t *unused_ppos)
 {
-	struct cpuset *cs = __d_cs(file-&gt;f_dentry-&gt;d_parent);
-	struct cftype *cft = __d_cft(file-&gt;f_dentry);
+	struct cpuset *cs = __d_cs(file-&gt;f_path.dentry-&gt;d_parent);
+	struct cftype *cft = __d_cft(file-&gt;f_path.dentry);
 	cpuset_filetype_t type = cft-&gt;private;
 	char *buffer;
 	char *pathbuf = NULL;
@@ -1367,7 +1367,7 @@ static ssize_t cpuset_file_write(struct file *file, const char __user *buf,
 						size_t nbytes, loff_t *ppos)
 {
 	ssize_t retval = 0;
-	struct cftype *cft = __d_cft(file-&gt;f_dentry);
+	struct cftype *cft = __d_cft(file-&gt;f_path.dentry);
 	if (!cft)
 		return -ENODEV;
 
@@ -1417,8 +1417,8 @@ static int cpuset_sprintf_memlist(char *page, struct cpuset *cs)
 static ssize_t cpuset_common_file_read(struct file *file, char __user *buf,
 				size_t nbytes, loff_t *ppos)
 {
-	struct cftype *cft = __d_cft(file-&gt;f_dentry);
-	struct cpuset *cs = __d_cs(file-&gt;f_dentry-&gt;d_parent);
+	struct cftype *cft = __d_cft(file-&gt;f_path.dentry);
+	struct cpuset *cs = __d_cs(file-&gt;f_path.dentry-&gt;d_parent);
 	cpuset_filetype_t type = cft-&gt;private;
 	char *page;
 	ssize_t retval = 0;
@@ -1476,7 +1476,7 @@ static ssize_t cpuset_file_read(struct file *file, char __user *buf, size_t nbyt
 								loff_t *ppos)
 {
 	ssize_t retval = 0;
-	struct cftype *cft = __d_cft(file-&gt;f_dentry);
+	struct cftype *cft = __d_cft(file-&gt;f_path.dentry);
 	if (!cft)
 		return -ENODEV;
 
@@ -1498,7 +1498,7 @@ static int cpuset_file_open(struct inode *inode, struct file *file)
 	if (err)
 		return err;
 
-	cft = __d_cft(file-&gt;f_dentry);
+	cft = __d_cft(file-&gt;f_path.dentry);
 	if (!cft)
 		return -ENODEV;
 	if (cft-&gt;open)
@@ -1511,7 +1511,7 @@ static int cpuset_file_open(struct inode *inode, struct file *file)
 
 static int cpuset_file_release(struct inode *inode, struct file *file)
 {
-	struct cftype *cft = __d_cft(file-&gt;f_dentry);
+	struct cftype *cft = __d_cft(file-&gt;f_path.dentry);
 	if (cft-&gt;release)
 		return cft-&gt;release(inode, file);
 	return 0;
@@ -1700,7 +1700,7 @@ static int pid_array_to_buf(char *buf, int sz, pid_t *a, int npids)
  */
 static int cpuset_tasks_open(struct inode *unused, struct file *file)
 {
-	struct cpuset *cs = __d_cs(file-&gt;f_dentry-&gt;d_parent);
+	struct cpuset *cs = __d_cs(file-&gt;f_path.dentry-&gt;d_parent);
 	struct ctr_struct *ctr;
 	pid_t *pidarray;
 	int npids;</pre><hr><pre>commit ff273773bfd4f2131bad1318e56519fcceac2339
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:16 2006 -0800

    [PATCH] struct path: convert jfs
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/jfs/jfs_dtree.c b/fs/jfs/jfs_dtree.c
index ecb2216d881c..47bc0b5d1324 100644
--- a/fs/jfs/jfs_dtree.c
+++ b/fs/jfs/jfs_dtree.c
@@ -3009,7 +3009,7 @@ static inline struct jfs_dirent *next_jfs_dirent(struct jfs_dirent *dirent)
  */
 int jfs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
-	struct inode *ip = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *ip = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct nls_table *codepage = JFS_SBI(ip-&gt;i_sb)-&gt;nls_tab;
 	int rc = 0;
 	loff_t dtpos;	/* legacy OS/2 style position */</pre><hr><pre>commit ec2e203c8297d576c74a101cebd657bc1f180dd1
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:16 2006 -0800

    [PATCH] struct path: convert jffs2
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/jffs2/dir.c b/fs/jffs2/dir.c
index 9def6adf4a5d..da6034d50718 100644
--- a/fs/jffs2/dir.c
+++ b/fs/jffs2/dir.c
@@ -123,11 +123,11 @@ static int jffs2_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
 	struct jffs2_inode_info *f;
 	struct jffs2_sb_info *c;
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct jffs2_full_dirent *fd;
 	unsigned long offset, curofs;
 
-	D1(printk(KERN_DEBUG "jffs2_readdir() for dir_i #%lu\n", filp-&gt;f_dentry-&gt;d_inode-&gt;i_ino));
+	D1(printk(KERN_DEBUG "jffs2_readdir() for dir_i #%lu\n", filp-&gt;f_path.dentry-&gt;d_inode-&gt;i_ino));
 
 	f = JFFS2_INODE_INFO(inode);
 	c = JFFS2_SB_INFO(inode-&gt;i_sb);
@@ -141,7 +141,7 @@ static int jffs2_readdir(struct file *filp, void *dirent, filldir_t filldir)
 		offset++;
 	}
 	if (offset == 1) {
-		unsigned long pino = parent_ino(filp-&gt;f_dentry);
+		unsigned long pino = parent_ino(filp-&gt;f_path.dentry);
 		D1(printk(KERN_DEBUG "Dirent 1: \"..\", ino #%lu\n", pino));
 		if (filldir(dirent, "..", 2, 1, pino, DT_DIR) &lt; 0)
 			goto out;</pre><hr><pre>commit 4d832d460e13dd9c2cc93739ac0fd75bd8645e93
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:37:15 2006 -0800

    [PATCH] struct path: convert jffs
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/jffs/inode-v23.c b/fs/jffs/inode-v23.c
index 9f15bce92022..7b40c69f44eb 100644
--- a/fs/jffs/inode-v23.c
+++ b/fs/jffs/inode-v23.c
@@ -566,7 +566,7 @@ static int
 jffs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
 	struct jffs_file *f;
-	struct dentry *dentry = filp-&gt;f_dentry;
+	struct dentry *dentry = filp-&gt;f_path.dentry;
 	struct inode *inode = dentry-&gt;d_inode;
 	struct jffs_control *c = (struct jffs_control *)inode-&gt;i_sb-&gt;s_fs_info;
 	int j;
@@ -1372,7 +1372,7 @@ jffs_file_write(struct file *filp, const char *buf, size_t count,
 	struct jffs_control *c;
 	struct jffs_file *f;
 	struct jffs_node *node;
-	struct dentry *dentry = filp-&gt;f_dentry;
+	struct dentry *dentry = filp-&gt;f_path.dentry;
 	struct inode *inode = dentry-&gt;d_inode;
 	int recoverable = 0;
 	size_t written = 0;
@@ -1380,7 +1380,7 @@ jffs_file_write(struct file *filp, const char *buf, size_t count,
 	loff_t pos = *ppos;
 	int err;
 
-	inode = filp-&gt;f_dentry-&gt;d_inode;
+	inode = filp-&gt;f_path.dentry-&gt;d_inode;
 
 	D2(printk("***jffs_file_write(): inode: 0x%p (ino: %lu), "
 		  "filp: 0x%p, buf: 0x%p, count: %d\n",</pre>
    <div class="pagination">
        <a href='9_4.html'>&lt;&lt;Prev</a><a href='9.html'>1</a><a href='9_2.html'>2</a><a href='9_3.html'>3</a><a href='9_4.html'>4</a><span>[5]</span><a href='9_6.html'>6</a><a href='9_7.html'>7</a><a href='9_8.html'>8</a><a href='9_9.html'>9</a><a href='9_10.html'>10</a><a href='9_11.html'>11</a><a href='9_12.html'>12</a><a href='9_13.html'>13</a><a href='9_14.html'>14</a><a href='9_6.html'>Next&gt;&gt;</a>
    <div>
</body>

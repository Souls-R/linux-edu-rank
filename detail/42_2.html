<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Stanford University</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Stanford University</h1>
    <div class="pagination">
        <a href='42.html'>&lt;&lt;Prev</a><a href='42.html'>1</a><span>[2]</span>
    </div>
    <hr>
    <pre>commit 21dbfd291fe704986fab63a129f89ed2de471329
Author: Remi Machet &lt;rmachet@slac.stanford.edu&gt;
Date:   Tue Apr 22 03:36:48 2008 +1000

    [POWERPC] Use default values if necessary in mv64x60 I2C initialization
    
    I2C parameters freq_m and freq_n are assigned defaults in the code,
    but if properties for those parameters are not found in the open
    firmware description the init routine returns an error and doesn't
    create the platform device.
    
    This changes the code so that it doesn't return an error if the
    properties are not found but instead uses the default values.
    
    Signed-off-by: Remi Machet (rmachet@slac.stanford.edu)
    Acked-by: Dale Farnsworth &lt;dale@farnsworth.org&gt;
    Signed-off-by: Paul Mackerras &lt;paulus@samba.org&gt;

diff --git a/arch/powerpc/sysdev/mv64x60_dev.c b/arch/powerpc/sysdev/mv64x60_dev.c
index 047b31027fa6..c8d9257f431b 100644
--- a/arch/powerpc/sysdev/mv64x60_dev.c
+++ b/arch/powerpc/sysdev/mv64x60_dev.c
@@ -338,15 +338,13 @@ static int __init mv64x60_i2c_device_setup(struct device_node *np, int id)
 
 	pdata.freq_m = 8;	/* default */
 	prop = of_get_property(np, "freq_m", NULL);
-	if (!prop)
-		return -ENODEV;
-	pdata.freq_m = *prop;
+	if (prop)
+		pdata.freq_m = *prop;
 
 	pdata.freq_m = 3;	/* default */
 	prop = of_get_property(np, "freq_n", NULL);
-	if (!prop)
-		return -ENODEV;
-	pdata.freq_n = *prop;
+	if (prop)
+		pdata.freq_n = *prop;
 
 	pdata.timeout = 1000;				/* default: 1 second */
 </pre>
    <div class="pagination">
        <a href='42.html'>&lt;&lt;Prev</a><a href='42.html'>1</a><span>[2]</span>
    <div>
</body>

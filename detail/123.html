<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by University of California, Davis</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by University of California, Davis</h1>
    <div class="pagination">
        <span>[1]</span>
    </div>
    <hr>
    <pre>commit 9c7fe83530a351845719acf1dda0587e8c743588
Author: Daniel DeFreez &lt;dcdefreez@ucdavis.edu&gt;
Date:   Tue Apr 19 19:57:45 2016 -0400

    GFS2: Add calls to gfs2_holder_uninit in two error handlers
    
    This patch fixes two locations that do not call gfs2_holder_uninit
    if gfs2_glock_nq returns an error.
    
    Signed-off-by: Daniel DeFreez &lt;dcdefreez@ucdavis.edu&gt;
    Signed-off-by: Bob Peterson &lt;rpeterso@redhat.com&gt;

diff --git a/fs/gfs2/aops.c b/fs/gfs2/aops.c
index aa016e4b8bec..58dd0061134b 100644
--- a/fs/gfs2/aops.c
+++ b/fs/gfs2/aops.c
@@ -1063,7 +1063,7 @@ static ssize_t gfs2_direct_IO(struct kiocb *iocb, struct iov_iter *iter,
 	gfs2_holder_init(ip-&gt;i_gl, LM_ST_DEFERRED, 0, &amp;gh);
 	rv = gfs2_glock_nq(&amp;gh);
 	if (rv)
-		return rv;
+		goto out_uninit;
 	rv = gfs2_ok_for_dio(ip, offset);
 	if (rv != 1)
 		goto out; /* dio not valid, fall back to buffered i/o */
@@ -1102,6 +1102,7 @@ static ssize_t gfs2_direct_IO(struct kiocb *iocb, struct iov_iter *iter,
 				  offset, gfs2_get_block_direct, NULL, NULL, 0);
 out:
 	gfs2_glock_dq(&amp;gh);
+out_uninit:
 	gfs2_holder_uninit(&amp;gh);
 	return rv;
 }
diff --git a/fs/gfs2/file.c b/fs/gfs2/file.c
index fd9a10e4518d..f33fd92e5f49 100644
--- a/fs/gfs2/file.c
+++ b/fs/gfs2/file.c
@@ -160,7 +160,7 @@ static int gfs2_get_flags(struct file *filp, u32 __user *ptr)
 	gfs2_holder_init(ip-&gt;i_gl, LM_ST_SHARED, 0, &amp;gh);
 	error = gfs2_glock_nq(&amp;gh);
 	if (error)
-		return error;
+		goto out_uninit;
 
 	fsflags = fsflags_cvt(gfs2_to_fsflags, ip-&gt;i_diskflags);
 	if (!S_ISDIR(inode-&gt;i_mode) &amp;&amp; ip-&gt;i_diskflags &amp; GFS2_DIF_JDATA)
@@ -169,6 +169,7 @@ static int gfs2_get_flags(struct file *filp, u32 __user *ptr)
 		error = -EFAULT;
 
 	gfs2_glock_dq(&amp;gh);
+out_uninit:
 	gfs2_holder_uninit(&amp;gh);
 	return error;
 }</pre>
    <div class="pagination">
        <span>[1]</span>
    <div>
</body>

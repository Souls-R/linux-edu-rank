<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Concordia University Wisconsin</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Concordia University Wisconsin</h1>
    <div class="pagination">
        <span>[1]</span><a href='20_2.html'>2</a><a href='20_3.html'>3</a><a href='20_4.html'>4</a><a href='20_5.html'>5</a><a href='20_2.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit aef6a62d8b517f7472105971d5e221ef55a320be
Author: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
Date:   Mon Feb 27 12:25:33 2012 -0600

    iwlegacy: remove unused enum il4965_calib_enabled_state
    
    Remove the enum il4965_calib_enabled_state because it is not used.
    
    Signed-off-by: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
    Signed-off-by: John W. Linville &lt;linville@tuxdriver.com&gt;

diff --git a/drivers/net/wireless/iwlegacy/common.h b/drivers/net/wireless/iwlegacy/common.h
index d0de922cb937..5f5017767b99 100644
--- a/drivers/net/wireless/iwlegacy/common.h
+++ b/drivers/net/wireless/iwlegacy/common.h
@@ -956,11 +956,6 @@ enum il4965_chain_noise_state {
 	IL_CHAIN_NOISE_DONE,
 };
 
-enum il4965_calib_enabled_state {
-	IL_CALIB_DISABLED = 0,	/* must be 0 */
-	IL_CALIB_ENABLED = 1,
-};
-
 enum ucode_type {
 	UCODE_NONE = 0,
 	UCODE_INIT,</pre><hr><pre>commit d7b6b6a64301d6b0c632c8b9563a27aeeb09e967
Author: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
Date:   Mon Feb 27 12:25:32 2012 -0600

    iwlegacy: remove enum iw_calib and related code
    
    Remove the enum il_calib. It defined one identifier: IL_CALIB_MAX.
    Remove the function il4965_calib_free_results. It was doing nothing
    because IL_CALIB_MAX is zero. Next, remove calib_results from the
    il_priv structure and also remove the associated return
    type/struct il_calib_result.
    
    Signed-off-by: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
    Signed-off-by: John W. Linville &lt;linville@tuxdriver.com&gt;

diff --git a/drivers/net/wireless/iwlegacy/4965-calib.c b/drivers/net/wireless/iwlegacy/4965-calib.c
index 47c20e3d5605..e78bdefb8952 100644
--- a/drivers/net/wireless/iwlegacy/4965-calib.c
+++ b/drivers/net/wireless/iwlegacy/4965-calib.c
@@ -79,18 +79,6 @@ struct stats_general_data {
 	u32 beacon_energy_c;
 };
 
-void
-il4965_calib_free_results(struct il_priv *il)
-{
-	int i;
-
-	for (i = 0; i &lt; IL_CALIB_MAX; i++) {
-		kfree(il-&gt;calib_results[i].buf);
-		il-&gt;calib_results[i].buf = NULL;
-		il-&gt;calib_results[i].buf_len = 0;
-	}
-}
-
 /*****************************************************************************
  * RUNTIME calibrations framework
  *****************************************************************************/
diff --git a/drivers/net/wireless/iwlegacy/4965-mac.c b/drivers/net/wireless/iwlegacy/4965-mac.c
index 2329033e23d7..7b54dbb338be 100644
--- a/drivers/net/wireless/iwlegacy/4965-mac.c
+++ b/drivers/net/wireless/iwlegacy/4965-mac.c
@@ -6347,7 +6347,6 @@ il4965_init_drv(struct il_priv *il)
 static void
 il4965_uninit_drv(struct il_priv *il)
 {
-	il4965_calib_free_results(il);
 	il_free_geos(il);
 	il_free_channel_map(il);
 	kfree(il-&gt;scan_cmd);
diff --git a/drivers/net/wireless/iwlegacy/4965.h b/drivers/net/wireless/iwlegacy/4965.h
index 208a4564d063..1db677689cfe 100644
--- a/drivers/net/wireless/iwlegacy/4965.h
+++ b/drivers/net/wireless/iwlegacy/4965.h
@@ -927,7 +927,6 @@ void il4965_chain_noise_calibration(struct il_priv *il, void *stat_resp);
 void il4965_sensitivity_calibration(struct il_priv *il, void *resp);
 void il4965_init_sensitivity(struct il_priv *il);
 void il4965_reset_run_time_calib(struct il_priv *il);
-void il4965_calib_free_results(struct il_priv *il);
 
 /* Debug */
 #ifdef CONFIG_IWLEGACY_DEBUGFS
diff --git a/drivers/net/wireless/iwlegacy/common.h b/drivers/net/wireless/iwlegacy/common.h
index 6ed9871f1c4b..d0de922cb937 100644
--- a/drivers/net/wireless/iwlegacy/common.h
+++ b/drivers/net/wireless/iwlegacy/common.h
@@ -961,21 +961,6 @@ enum il4965_calib_enabled_state {
 	IL_CALIB_ENABLED = 1,
 };
 
-/*
- * enum il_calib
- * defines the order in which results of initial calibrations
- * should be sent to the runtime uCode
- */
-enum il_calib {
-	IL_CALIB_MAX,
-};
-
-/* Opaque calibration results */
-struct il_calib_result {
-	void *buf;
-	size_t buf_len;
-};
-
 enum ucode_type {
 	UCODE_NONE = 0,
 	UCODE_INIT,
@@ -1195,9 +1180,6 @@ struct il_priv {
 	s32 temperature;	/* degrees Kelvin */
 	s32 last_temperature;
 
-	/* init calibration results */
-	struct il_calib_result calib_results[IL_CALIB_MAX];
-
 	/* Scan related variables */
 	unsigned long scan_start;
 	unsigned long scan_start_tsf;</pre><hr><pre>commit 08db1ab7fa4cab08c1e24f373439d472d054a921
Author: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
Date:   Mon Feb 27 12:25:31 2012 -0600

    iwlegacy: Kconfig: Change Debug Option to be more clear
    
    Since the menuconfig system doesn't indent the debug options
    for the 3945 /4965, add some text to make it clear which
    debug options are being configured.
    
    Signed-off-by: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
    Signed-off-by: John W. Linville &lt;linville@tuxdriver.com&gt;

diff --git a/drivers/net/wireless/iwlegacy/Kconfig b/drivers/net/wireless/iwlegacy/Kconfig
index 4d81b80b16e6..fb919727b8bb 100644
--- a/drivers/net/wireless/iwlegacy/Kconfig
+++ b/drivers/net/wireless/iwlegacy/Kconfig
@@ -60,7 +60,7 @@ config IWL3945
 	  say M here and read &lt;file:Documentation/kbuild/modules.txt&gt;.  The
 	  module will be called iwl3945.
 
-menu "Debugging Options"
+menu "iwl3945 / iwl4965 Debugging Options"
 	depends on IWLEGACY
 
 config IWLEGACY_DEBUG</pre><hr><pre>commit 649921499c7116d5283b02ec432ff42229aefccd
Author: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
Date:   Mon Feb 27 12:25:30 2012 -0600

    iwlegacy: Kconfig: Move Debugging Options
    
    Move the debug options so they appear below the 3945 / 4965 options.
    
    Signed-off-by: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
    Signed-off-by: John W. Linville &lt;linville@tuxdriver.com&gt;

diff --git a/drivers/net/wireless/iwlegacy/Kconfig b/drivers/net/wireless/iwlegacy/Kconfig
index 05bd375cb845..4d81b80b16e6 100644
--- a/drivers/net/wireless/iwlegacy/Kconfig
+++ b/drivers/net/wireless/iwlegacy/Kconfig
@@ -6,45 +6,6 @@ config IWLEGACY
 	select LEDS_TRIGGERS
 	select MAC80211_LEDS
 
-menu "Debugging Options"
-	depends on IWLEGACY
-
-config IWLEGACY_DEBUG
-	bool "Enable full debugging output in iwlegacy (iwl 3945/4965) drivers"
-	depends on IWLEGACY
-	---help---
-	  This option will enable debug tracing output for the iwlegacy
-	  drivers.
-
-	  This will result in the kernel module being ~100k larger.  You can
-	  control which debug output is sent to the kernel log by setting the
-	  value in
-
-		/sys/class/net/wlan0/device/debug_level
-
-	  This entry will only exist if this option is enabled.
-
-	  To set a value, simply echo an 8-byte hex value to the same file:
-
-		  % echo 0x43fff &gt; /sys/class/net/wlan0/device/debug_level
-
-	  You can find the list of debug mask values in:
-		  drivers/net/wireless/iwlegacy/common.h
-
-	  If this is your first time using this driver, you should say Y here
-	  as the debug information can assist others in helping you resolve
-	  any problems you may encounter.
-
-config IWLEGACY_DEBUGFS
-        bool "iwlegacy (iwl 3945/4965) debugfs support"
-        depends on IWLEGACY &amp;&amp; MAC80211_DEBUGFS
-        ---help---
-	  Enable creation of debugfs files for the iwlegacy drivers. This
-	  is a low-impact option that allows getting insight into the
-	  driver's state at runtime.
-
-endmenu
-
 config IWL4965
 	tristate "Intel Wireless WiFi 4965AGN (iwl4965)"
 	depends on PCI &amp;&amp; MAC80211
@@ -98,3 +59,42 @@ config IWL3945
 	  inserted in and removed from the running kernel whenever you want),
 	  say M here and read &lt;file:Documentation/kbuild/modules.txt&gt;.  The
 	  module will be called iwl3945.
+
+menu "Debugging Options"
+	depends on IWLEGACY
+
+config IWLEGACY_DEBUG
+	bool "Enable full debugging output in iwlegacy (iwl 3945/4965) drivers"
+	depends on IWLEGACY
+	---help---
+	  This option will enable debug tracing output for the iwlegacy
+	  drivers.
+
+	  This will result in the kernel module being ~100k larger.  You can
+	  control which debug output is sent to the kernel log by setting the
+	  value in
+
+		/sys/class/net/wlan0/device/debug_level
+
+	  This entry will only exist if this option is enabled.
+
+	  To set a value, simply echo an 8-byte hex value to the same file:
+
+		  % echo 0x43fff &gt; /sys/class/net/wlan0/device/debug_level
+
+	  You can find the list of debug mask values in:
+		  drivers/net/wireless/iwlegacy/common.h
+
+	  If this is your first time using this driver, you should say Y here
+	  as the debug information can assist others in helping you resolve
+	  any problems you may encounter.
+
+config IWLEGACY_DEBUGFS
+        bool "iwlegacy (iwl 3945/4965) debugfs support"
+        depends on IWLEGACY &amp;&amp; MAC80211_DEBUGFS
+        ---help---
+	  Enable creation of debugfs files for the iwlegacy drivers. This
+	  is a low-impact option that allows getting insight into the
+	  driver's state at runtime.
+
+endmenu</pre><hr><pre>commit 42f1c01b79d54a00012c553b95fc7fe266d82394
Author: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
Date:   Fri Jan 20 17:10:35 2012 -0600

    coccicheck: change handling of C={1,2} when M= is set
    
    This patch reverts a portion of d0bc1fb4 so that coccicheck will
    work properly when C=1 or C=2.
    
    Reported-and-tested-by: Brice Goglin &lt;Brice.Goglin@inria.fr&gt;
    Signed-off-by: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
    Signed-off-by: Julia Lawall &lt;Julia.Lawall@lip6.fr&gt;
    Signed-off-by: Michal Marek &lt;mmarek@suse.cz&gt;

diff --git a/scripts/coccicheck b/scripts/coccicheck
index 3c2776466d87..823e972149e5 100755
--- a/scripts/coccicheck
+++ b/scripts/coccicheck
@@ -9,15 +9,10 @@ if [ "$C" = "1" -o "$C" = "2" ]; then
 #    FLAGS="-ignore_unknown_options -very_quiet"
 #    OPTIONS=$*
 
-    if [ "$KBUILD_EXTMOD" = "" ] ; then
-        # Workaround for Coccinelle &lt; 0.2.3
-        FLAGS="-I $srctree/include -very_quiet"
-        shift $(( $# - 1 ))
-        OPTIONS=$1
-    else
-	echo M= is not currently supported when C=1 or C=2
-	exit 1
-    fi
+# Workaround for Coccinelle &lt; 0.2.3
+	FLAGS="-I $srctree/include -very_quiet"
+	shift $(( $# - 1 ))
+	OPTIONS=$1
 else
     ONLINE=0
     FLAGS="-very_quiet"</pre><hr><pre>commit 28aa41fb8d555b120edefd7fdf879b156a1c9f3a
Author: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
Date:   Sun Jan 15 14:44:34 2012 -0600

    staging: android: ram_console use kmemdup instead of kmalloc
    
    Replace kmalloc + memcpy will kmemdup in ram_console_late_init
    
    Signed-off-by: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;

diff --git a/drivers/staging/android/ram_console.c b/drivers/staging/android/ram_console.c
index 6d4d67924f22..0cb3f3c227fc 100644
--- a/drivers/staging/android/ram_console.c
+++ b/drivers/staging/android/ram_console.c
@@ -411,15 +411,14 @@ static int __init ram_console_late_init(void)
 	if (ram_console_old_log == NULL)
 		return 0;
 #ifdef CONFIG_ANDROID_RAM_CONSOLE_EARLY_INIT
-	ram_console_old_log = kmalloc(ram_console_old_log_size, GFP_KERNEL);
+	ram_console_old_log = kmemdup(ram_console_old_log_init_buffer,
+					ram_console_old_log_size, GFP_KERNEL);
 	if (ram_console_old_log == NULL) {
 		printk(KERN_ERR
 		       "ram_console: failed to allocate buffer for old log\n");
 		ram_console_old_log_size = 0;
 		return 0;
 	}
-	memcpy(ram_console_old_log,
-	       ram_console_old_log_init_buffer, ram_console_old_log_size);
 #endif
 	entry = create_proc_entry("last_kmsg", S_IFREG | S_IRUGO, NULL);
 	if (!entry) {</pre><hr><pre>commit 65b2576c9d3970e5c19aad5d2b56372ba56186a9
Author: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
Date:   Fri Jan 20 17:10:35 2012 -0600

    coccicheck: change handling of C={1,2} when M= is set
    
    This patch reverts a portion of d0bc1fb4 so that coccicheck will
    work properly when C=1 or C=2.
    
    Reported-and-tested-by: Brice Goglin &lt;Brice.Goglin@inria.fr&gt;
    Signed-off-by: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
    Signed-off-by: Julia Lawall &lt;Julia.Lawall@lip6.fr&gt;
    Signed-off-by: Michal Marek &lt;mmarek@suse.cz&gt;

diff --git a/scripts/coccicheck b/scripts/coccicheck
index 3c2776466d87..823e972149e5 100755
--- a/scripts/coccicheck
+++ b/scripts/coccicheck
@@ -9,15 +9,10 @@ if [ "$C" = "1" -o "$C" = "2" ]; then
 #    FLAGS="-ignore_unknown_options -very_quiet"
 #    OPTIONS=$*
 
-    if [ "$KBUILD_EXTMOD" = "" ] ; then
-        # Workaround for Coccinelle &lt; 0.2.3
-        FLAGS="-I $srctree/include -very_quiet"
-        shift $(( $# - 1 ))
-        OPTIONS=$1
-    else
-	echo M= is not currently supported when C=1 or C=2
-	exit 1
-    fi
+# Workaround for Coccinelle &lt; 0.2.3
+	FLAGS="-I $srctree/include -very_quiet"
+	shift $(( $# - 1 ))
+	OPTIONS=$1
 else
     ONLINE=0
     FLAGS="-very_quiet"</pre><hr><pre>commit f95ab20972cfefa8ee5428d6c3afd4cb8eacabf4
Author: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
Date:   Sat Nov 5 20:59:44 2011 -0500

    coccinelle.txt: update documentation to include M= option
    
    Adding documentation for the new M= option which limits Coccinelle
    to a specific set of directories.
    
    Signed-off-by: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
    Acked-by: Julia Lawall &lt;julia.lawall@lip6.fr&gt;
    Signed-off-by: Michal Marek &lt;mmarek@suse.cz&gt;

diff --git a/Documentation/coccinelle.txt b/Documentation/coccinelle.txt
index 96b690348ba1..cf44eb6499b4 100644
--- a/Documentation/coccinelle.txt
+++ b/Documentation/coccinelle.txt
@@ -102,9 +102,15 @@ or
 	make coccicheck COCCI=&lt;my_SP.cocci&gt; MODE=report
 
 
- Using Coccinelle on (modified) files
-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+ Controlling Which Files are Processed by Coccinelle
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+By default the entire kernel source tree is checked.
+
+To apply Coccinelle to a specific directory, M= can be used.
+For example, to check drivers/net/wireless/ one may write:
 
+    make coccicheck M=drivers/net/wireless/
+    
 To apply Coccinelle on a file basis, instead of a directory basis, the
 following command may be used:
 </pre><hr><pre>commit d0bc1fb4672b978b608400a5112249cdbc28f9ae
Author: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
Date:   Sat Nov 5 20:59:43 2011 -0500

    coccicheck: add M= option to control which dir is processed
    
    Examples:
            make coccicheck M=drivers/net/wireless/
            make coccicheck SUBDIRS=drivers/net/wireless/
    
    Version 2:
            fix patch file names when using M=
            tell coccinelle where the include files are
    
    Version 3:
            Add second include option to support out of tree development
            Fix error message
    
    Signed-off-by: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
    Acked-by: Julia Lawall &lt;julia.lawall@lip6.fr&gt;
    Signed-off-by: Michal Marek &lt;mmarek@suse.cz&gt;

diff --git a/scripts/coccicheck b/scripts/coccicheck
index 1bb1a1bd2daa..3c2776466d87 100755
--- a/scripts/coccicheck
+++ b/scripts/coccicheck
@@ -9,14 +9,23 @@ if [ "$C" = "1" -o "$C" = "2" ]; then
 #    FLAGS="-ignore_unknown_options -very_quiet"
 #    OPTIONS=$*
 
-# Workaround for Coccinelle &lt; 0.2.3
-    FLAGS="-I $srctree/include -very_quiet"
-    shift $(( $# - 1 ))
-    OPTIONS=$1
+    if [ "$KBUILD_EXTMOD" = "" ] ; then
+        # Workaround for Coccinelle &lt; 0.2.3
+        FLAGS="-I $srctree/include -very_quiet"
+        shift $(( $# - 1 ))
+        OPTIONS=$1
+    else
+	echo M= is not currently supported when C=1 or C=2
+	exit 1
+    fi
 else
     ONLINE=0
     FLAGS="-very_quiet"
-    OPTIONS="-dir $srctree"
+    if [ "$KBUILD_EXTMOD" = "" ] ; then
+        OPTIONS="-dir $srctree"
+    else
+        OPTIONS="-dir $KBUILD_EXTMOD -patch $srctree -I $srctree/include -I $KBUILD_EXTMOD/include"
+    fi
 fi
 
 if [ ! -x "$SPATCH" ]; then</pre><hr><pre>commit 9b5e2f463ac6f53789bd5ce43d2bb4b4c01e8607
Author: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
Date:   Tue Sep 6 19:11:35 2011 -0500

    iwlegacy: debugfs_ops should depend on CONFIG_IWLEGACY_DEBUGFS
    
    Only setup structs related to debugfs_ops when CONFIG_IWLEGACY_DEBUGFS is set.
    
    Signed-off-by: Greg Dietsche &lt;Gregory.Dietsche@cuw.edu&gt;
    Signed-off-by: Stanislaw Gruszka &lt;sgruszka@redhat.com&gt;

diff --git a/drivers/net/wireless/iwlegacy/3945.c b/drivers/net/wireless/iwlegacy/3945.c
index 7367dbb75ec6..863664f9ba8b 100644
--- a/drivers/net/wireless/iwlegacy/3945.c
+++ b/drivers/net/wireless/iwlegacy/3945.c
@@ -2671,11 +2671,13 @@ static struct il_lib_ops il3945_lib = {
 	.send_tx_power = il3945_send_tx_power,
 	.is_valid_rtc_data_addr = il3945_hw_valid_rtc_data_addr,
 
+#ifdef CONFIG_IWLEGACY_DEBUGFS
 	.debugfs_ops = {
 			.rx_stats_read = il3945_ucode_rx_stats_read,
 			.tx_stats_read = il3945_ucode_tx_stats_read,
 			.general_stats_read = il3945_ucode_general_stats_read,
 			},
+#endif
 };
 
 static const struct il_legacy_ops il3945_legacy_ops = {
diff --git a/drivers/net/wireless/iwlegacy/3945.h b/drivers/net/wireless/iwlegacy/3945.h
index 00d3336fd16b..2b2895c544d7 100644
--- a/drivers/net/wireless/iwlegacy/3945.h
+++ b/drivers/net/wireless/iwlegacy/3945.h
@@ -621,27 +621,6 @@ ssize_t il3945_ucode_tx_stats_read(struct file *file, char __user *user_buf,
 ssize_t il3945_ucode_general_stats_read(struct file *file,
 					char __user *user_buf, size_t count,
 					loff_t *ppos);
-#else
-static ssize_t
-il3945_ucode_rx_stats_read(struct file *file, char __user *user_buf,
-			   size_t count, loff_t *ppos)
-{
-	return 0;
-}
-
-static ssize_t
-il3945_ucode_tx_stats_read(struct file *file, char __user *user_buf,
-			   size_t count, loff_t *ppos)
-{
-	return 0;
-}
-
-static ssize_t
-il3945_ucode_general_stats_read(struct file *file, char __user *user_buf,
-				size_t count, loff_t *ppos)
-{
-	return 0;
-}
 #endif
 
 #endif
diff --git a/drivers/net/wireless/iwlegacy/4965.c b/drivers/net/wireless/iwlegacy/4965.c
index ac80a0069124..84c54dccf195 100644
--- a/drivers/net/wireless/iwlegacy/4965.c
+++ b/drivers/net/wireless/iwlegacy/4965.c
@@ -2333,11 +2333,13 @@ static struct il_lib_ops il4965_lib = {
 	.temp_ops = {
 		     .temperature = il4965_temperature_calib,
 		     },
+#ifdef CONFIG_IWLEGACY_DEBUGFS
 	.debugfs_ops = {
 			.rx_stats_read = il4965_ucode_rx_stats_read,
 			.tx_stats_read = il4965_ucode_tx_stats_read,
 			.general_stats_read = il4965_ucode_general_stats_read,
 			},
+#endif
 };
 
 static const struct il_legacy_ops il4965_legacy_ops = {
diff --git a/drivers/net/wireless/iwlegacy/4965.h b/drivers/net/wireless/iwlegacy/4965.h
index ded8b922a44e..74472314bc37 100644
--- a/drivers/net/wireless/iwlegacy/4965.h
+++ b/drivers/net/wireless/iwlegacy/4965.h
@@ -956,27 +956,6 @@ ssize_t il4965_ucode_tx_stats_read(struct file *file, char __user *user_buf,
 ssize_t il4965_ucode_general_stats_read(struct file *file,
 					char __user *user_buf, size_t count,
 					loff_t *ppos);
-#else
-static ssize_t
-il4965_ucode_rx_stats_read(struct file *file, char __user *user_buf,
-			   size_t count, loff_t *ppos)
-{
-	return 0;
-}
-
-static ssize_t
-il4965_ucode_tx_stats_read(struct file *file, char __user *user_buf,
-			   size_t count, loff_t *ppos)
-{
-	return 0;
-}
-
-static ssize_t
-il4965_ucode_general_stats_read(struct file *file, char __user *user_buf,
-				size_t count, loff_t *ppos)
-{
-	return 0;
-}
 #endif
 
 /****************************/
diff --git a/drivers/net/wireless/iwlegacy/common.h b/drivers/net/wireless/iwlegacy/common.h
index d0975ab8b908..1bc0b02f559c 100644
--- a/drivers/net/wireless/iwlegacy/common.h
+++ b/drivers/net/wireless/iwlegacy/common.h
@@ -1631,6 +1631,7 @@ struct il_apm_ops {
 	void (*config) (struct il_priv *il);
 };
 
+#ifdef CONFIG_IWLEGACY_DEBUGFS
 struct il_debugfs_ops {
 	ssize_t(*rx_stats_read) (struct file *file, char __user *user_buf,
 				 size_t count, loff_t *ppos);
@@ -1640,6 +1641,7 @@ struct il_debugfs_ops {
 				      char __user *user_buf, size_t count,
 				      loff_t *ppos);
 };
+#endif
 
 struct il_temp_ops {
 	void (*temperature) (struct il_priv *il);
@@ -1683,7 +1685,9 @@ struct il_lib_ops {
 	/* temperature */
 	struct il_temp_ops temp_ops;
 
+#ifdef CONFIG_IWLEGACY_DEBUGFS
 	struct il_debugfs_ops debugfs_ops;
+#endif
 
 };
 </pre>
    <div class="pagination">
        <span>[1]</span><a href='20_2.html'>2</a><a href='20_3.html'>3</a><a href='20_4.html'>4</a><a href='20_5.html'>5</a><a href='20_2.html'>Next&gt;&gt;</a>
    <div>
</body>

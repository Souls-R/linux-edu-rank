<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by University of Cincinnati</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by University of Cincinnati</h1>
    <div class="pagination">
        <span>[1]</span>
    </div>
    <hr>
    <pre>commit 024a0a3cfb4c98cb3c6c81ec70672c6a925cf164
Author: Shan Lu &lt;shanlu@cs.uiuc.edu&gt;
Date:   Tue Mar 6 02:42:03 2007 -0800

    network: add the missing phy_device speed information to phy_mii_ioctl
    
    Function `phy_mii_ioctl' returns physical device's information based on
    user requests.  When requested to return the basic mode control register
    information (BMCR), the original implementation only returns the physical
    device's duplex information and forgets to return speed information, which
    should not be because BMCR register is used to hold both duplex and speed
    information.
    
    The patch checks the BMCR value against speed-related flags and fills the
    return structure's speed field accordingly.
    
    Signed-off-by: Shan &lt;shanlu@cs.uiuc.edu&gt;
    Cc: Jeff Garzik &lt;jeff@garzik.org&gt;
    Signed-off-by: Andrew Morton &lt;akpm@linux-foundation.org&gt;
    Signed-off-by: Jeff Garzik &lt;jeff@garzik.org&gt;

diff --git a/drivers/net/phy/phy.c b/drivers/net/phy/phy.c
index a602d06d85ab..eed433d6056a 100644
--- a/drivers/net/phy/phy.c
+++ b/drivers/net/phy/phy.c
@@ -382,6 +382,12 @@ int phy_mii_ioctl(struct phy_device *phydev,
 					phydev-&gt;duplex = DUPLEX_FULL;
 				else
 					phydev-&gt;duplex = DUPLEX_HALF;
+				if ((!phydev-&gt;autoneg) &amp;&amp;
+						(val &amp; BMCR_SPEED1000))
+					phydev-&gt;speed = SPEED_1000;
+				else if ((!phydev-&gt;autoneg) &amp;&amp;
+						(val &amp; BMCR_SPEED100))
+					phydev-&gt;speed = SPEED_100;
 				break;
 			case MII_ADVERTISE:
 				phydev-&gt;advertising = val;</pre>
    <div class="pagination">
        <span>[1]</span>
    <div>
</body>

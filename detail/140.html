<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Jagiellonian University Cracow</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Jagiellonian University Cracow</h1>
    <div class="pagination">
        <span>[1]</span>
    </div>
    <hr>
    <pre>commit 97e7e4f391cac2b00417b581b432533d245d4fd0
Author: Witold Baryluk &lt;baryluk@smp.if.uj.edu.pl&gt;
Date:   Tue Mar 17 21:15:44 2009 +0100

    tracing: optimization of branch tracer
    
    Impact: better performance for if branch tracer
    
    Use an array to count the hit and misses of a conditional instead
    of using another conditional. This cuts down on saturation of branch
    predictions and increases performance of modern pipelined architectures.
    
    Signed-off-by: Witold Baryluk &lt;baryluk@smp.if.uj.edu.pl&gt;
    Signed-off-by: Steven Rostedt &lt;srostedt@redhat.com&gt;

diff --git a/include/linux/compiler.h b/include/linux/compiler.h
index d95da1020f1c..6faa7e549de4 100644
--- a/include/linux/compiler.h
+++ b/include/linux/compiler.h
@@ -68,6 +68,7 @@ struct ftrace_branch_data {
 			unsigned long miss;
 			unsigned long hit;
 		};
+		unsigned long miss_hit[2];
 	};
 };
 
@@ -125,10 +126,7 @@ void ftrace_likely_update(struct ftrace_branch_data *f, int val, int expect);
 				.line = __LINE__,			\
 			};						\
 		______r = !!(cond);					\
-		if (______r)						\
-			______f.hit++;					\
-		else							\
-			______f.miss++;					\
+		______f.miss_hit[______r]++;					\
 		______r;						\
 	}))
 #endif /* CONFIG_PROFILE_ALL_BRANCHES */</pre>
    <div class="pagination">
        <span>[1]</span>
    <div>
</body>

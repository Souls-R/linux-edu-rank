<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by University of Maine System</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by University of Maine System</h1>
    <div class="pagination">
        <span>[1]</span><a href='22_2.html'>2</a><a href='22_3.html'>3</a><a href='22_4.html'>4</a><a href='22_2.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 3143906c2770778d89b730e0342b745d1b4a8303
Author: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
Date:   Thu Aug 1 14:30:43 2019 -0400

    perf.data documentation: Clarify HEADER_SAMPLE_TOPOLOGY format
    
    The perf.data file format documentation for HEADER_SAMPLE_TOPOLOGY
    specifies the layout in a confusing manner that doesn't match the rest
    of the document.  This patch attempts to describe things consistent with
    the rest of the file.
    
    Signed-off-by: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
    Acked-by: Jiri Olsa &lt;jolsa@kernel.org&gt;
    Cc: Adrian Hunter &lt;adrian.hunter@intel.com&gt;
    Cc: Alexander Shishkin &lt;alexander.shishkin@linux.intel.com&gt;
    Cc: Andi Kleen &lt;ak@linux.intel.com&gt;
    Cc: Chong Jiang &lt;chongjiang@chromium.org&gt;
    Cc: Namhyung Kim &lt;namhyung@kernel.org&gt;
    Cc: Peter Zijlstra &lt;peterz@infradead.org&gt;
    Cc: Simon Que &lt;sque@chromium.org&gt;
    Link: http://lkml.kernel.org/r/alpine.DEB.2.21.1908011425240.14303@macbook-air
    Signed-off-by: Arnaldo Carvalho de Melo &lt;acme@redhat.com&gt;

diff --git a/tools/perf/Documentation/perf.data-file-format.txt b/tools/perf/Documentation/perf.data-file-format.txt
index d030c87ed9f5..b0152e1095c5 100644
--- a/tools/perf/Documentation/perf.data-file-format.txt
+++ b/tools/perf/Documentation/perf.data-file-format.txt
@@ -298,16 +298,21 @@ Physical memory map and its node assignments.
 
 The format of data in MEM_TOPOLOGY is as follows:
 
-   0 - version          | for future changes
-   8 - block_size_bytes | /sys/devices/system/memory/block_size_bytes
-  16 - count            | number of nodes
-
-For each node we store map of physical indexes:
-
-  32 - node id          | node index
-  40 - size             | size of bitmap
-  48 - bitmap           | bitmap of memory indexes that belongs to node
-                        | /sys/devices/system/node/node&lt;NODE&gt;/memory&lt;INDEX&gt;
+	u64 version;            // Currently 1
+	u64 block_size_bytes;   // /sys/devices/system/memory/block_size_bytes
+	u64 count;              // number of nodes
+
+struct memory_node {
+        u64 node_id;            // node index
+        u64 size;               // size of bitmap
+        struct bitmap {
+		/* size of bitmap again */
+                u64 bitmapsize;
+		/* bitmap of memory indexes that belongs to node     */
+		/* /sys/devices/system/node/node&lt;NODE&gt;/memory&lt;INDEX&gt; */
+                u64 entries[(bitmapsize/64)+1];
+        }
+}[count];
 
 The MEM_TOPOLOGY can be displayed with following command:
 </pre><hr><pre>commit 2e9a06dda10aea81a17c623f08534dac6735434a
Author: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
Date:   Thu Jul 25 11:57:43 2019 -0400

    perf tools: Fix perf.data documentation units for memory size
    
    The perf.data-file-format documentation incorrectly says the
    HEADER_TOTAL_MEM results are in bytes.  The results are in kilobytes
    (perf reads the value from /proc/meminfo)
    
    Signed-off-by: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
    Cc: Alexander Shishkin &lt;alexander.shishkin@linux.intel.com&gt;
    Cc: Jiri Olsa &lt;jolsa@redhat.com&gt;
    Cc: Namhyung Kim &lt;namhyung@kernel.org&gt;
    Cc: Peter Zijlstra &lt;peterz@infradead.org&gt;
    Link: http://lkml.kernel.org/r/alpine.DEB.2.21.1907251155500.22624@macbook-air
    Signed-off-by: Arnaldo Carvalho de Melo &lt;acme@redhat.com&gt;

diff --git a/tools/perf/Documentation/perf.data-file-format.txt b/tools/perf/Documentation/perf.data-file-format.txt
index 5f54feb19977..d030c87ed9f5 100644
--- a/tools/perf/Documentation/perf.data-file-format.txt
+++ b/tools/perf/Documentation/perf.data-file-format.txt
@@ -126,7 +126,7 @@ vendor,family,model,stepping. For example: GenuineIntel,6,69,1
 
 	HEADER_TOTAL_MEM = 10,
 
-An uint64_t with the total memory in bytes.
+An uint64_t with the total memory in kilobytes.
 
 	HEADER_CMDLINE = 11,
 </pre><hr><pre>commit 7622236ceb167aa3857395f9bdaf871442aa467e
Author: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
Date:   Tue Jul 23 11:06:01 2019 -0400

    perf header: Fix divide by zero error if f_header.attr_size==0
    
    So I have been having lots of trouble with hand-crafted perf.data files
    causing segfaults and the like, so I have started fuzzing the perf tool.
    
    First issue found:
    
    If f_header.attr_size is 0 in the perf.data file, then perf will crash
    with a divide-by-zero error.
    
    Committer note:
    
    Added a pr_err() to tell the user why the command failed.
    
    Signed-off-by: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
    Cc: Alexander Shishkin &lt;alexander.shishkin@linux.intel.com&gt;
    Cc: Jiri Olsa &lt;jolsa@redhat.com&gt;
    Cc: Namhyung Kim &lt;namhyung@kernel.org&gt;
    Cc: Peter Zijlstra &lt;peterz@infradead.org&gt;
    Link: http://lkml.kernel.org/r/alpine.DEB.2.21.1907231100440.14532@macbook-air
    Signed-off-by: Arnaldo Carvalho de Melo &lt;acme@redhat.com&gt;

diff --git a/tools/perf/util/header.c b/tools/perf/util/header.c
index 20111f8da5cb..47877f0f6667 100644
--- a/tools/perf/util/header.c
+++ b/tools/perf/util/header.c
@@ -3559,6 +3559,13 @@ int perf_session__read_header(struct perf_session *session)
 			   data-&gt;file.path);
 	}
 
+	if (f_header.attr_size == 0) {
+		pr_err("ERROR: The %s file's attr size field is 0 which is unexpected.\n"
+		       "Was the 'perf record' command properly terminated?\n",
+		       data-&gt;file.path);
+		return -EINVAL;
+	}
+
 	nr_attrs = f_header.attrs.size / f_header.attr_size;
 	lseek(fd, f_header.attrs.offset, SEEK_SET);
 </pre><hr><pre>commit 33b88e708e7dfa58dc896da2a98f5719d2eb315c
Author: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
Date:   Tue May 2 14:08:50 2017 -0400

    perf/x86: Fix Broadwell-EP DRAM RAPL events
    
    It appears as though the Broadwell-EP DRAM units share the special
    units quirk with Haswell-EP/KNL.
    
    Without this patch, you get really high results (a single DRAM using 20W
    of power).
    
    The powercap driver in drivers/powercap/intel_rapl.c already has this
    change.
    
    Signed-off-by: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
    Cc: Alexander Shishkin &lt;alexander.shishkin@linux.intel.com&gt;
    Cc: Arnaldo Carvalho de Melo &lt;acme@redhat.com&gt;
    Cc: Jiri Olsa &lt;jolsa@redhat.com&gt;
    Cc: Kan Liang &lt;kan.liang@intel.com&gt;
    Cc: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
    Cc: Peter Zijlstra &lt;peterz@infradead.org&gt;
    Cc: Stephane Eranian &lt;eranian@gmail.com&gt;
    Cc: Stephane Eranian &lt;eranian@google.com&gt;
    Cc: Thomas Gleixner &lt;tglx@linutronix.de&gt;
    Cc: linux-kernel@vger.kernel.org
    Cc: &lt;stable@vger.kernel.org&gt;
    Signed-off-by: Ingo Molnar &lt;mingo@kernel.org&gt;

diff --git a/arch/x86/events/intel/rapl.c b/arch/x86/events/intel/rapl.c
index 9d05c7e67f60..a45e2114a846 100644
--- a/arch/x86/events/intel/rapl.c
+++ b/arch/x86/events/intel/rapl.c
@@ -761,7 +761,7 @@ static const struct x86_cpu_id rapl_cpu_match[] __initconst = {
 
 	X86_RAPL_MODEL_MATCH(INTEL_FAM6_BROADWELL_CORE,   hsw_rapl_init),
 	X86_RAPL_MODEL_MATCH(INTEL_FAM6_BROADWELL_GT3E,   hsw_rapl_init),
-	X86_RAPL_MODEL_MATCH(INTEL_FAM6_BROADWELL_X,	  hsw_rapl_init),
+	X86_RAPL_MODEL_MATCH(INTEL_FAM6_BROADWELL_X,	  hsx_rapl_init),
 	X86_RAPL_MODEL_MATCH(INTEL_FAM6_BROADWELL_XEON_D, hsw_rapl_init),
 
 	X86_RAPL_MODEL_MATCH(INTEL_FAM6_XEON_PHI_KNL, knl_rapl_init),</pre><hr><pre>commit 9cc2617de5b9222abb39cd02e90d57dfea99c6d7
Author: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
Date:   Wed Dec 9 11:34:45 2015 -0500

    perf/x86/amd: Remove l1-dcache-stores event for AMD
    
    This is a long standing bug with the l1-dcache-stores generic event on
    AMD machines.  My perf_event testsuite has been complaining about this
    for years and I'm finally getting around to trying to get it fixed.
    
    The data_cache_refills:system event does not make sense for l1-dcache-stores.
    Maybe this was a typo and it was meant to be for l1-dcache-store-misses?
    
    In any case, the values returned are nowhere near correct for l1-dcache-stores
    and in fact the umask values for the event have completely changed with
    fam15h so it makes even less sense than ever.  So just remove it.
    
    Signed-off-by: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
    Signed-off-by: Peter Zijlstra (Intel) &lt;peterz@infradead.org&gt;
    Cc: Arnaldo Carvalho de Melo &lt;acme@redhat.com&gt;
    Cc: Jiri Olsa &lt;jolsa@redhat.com&gt;
    Cc: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
    Cc: Peter Zijlstra &lt;peterz@infradead.org&gt;
    Cc: Stephane Eranian &lt;eranian@google.com&gt;
    Cc: Thomas Gleixner &lt;tglx@linutronix.de&gt;
    Link: http://lkml.kernel.org/r/alpine.DEB.2.20.1512091134350.24311@vincent-weaver-1.umelst.maine.edu
    Signed-off-by: Ingo Molnar &lt;mingo@kernel.org&gt;

diff --git a/arch/x86/kernel/cpu/perf_event_amd.c b/arch/x86/kernel/cpu/perf_event_amd.c
index 1cee5d2d7ece..05e76bf65781 100644
--- a/arch/x86/kernel/cpu/perf_event_amd.c
+++ b/arch/x86/kernel/cpu/perf_event_amd.c
@@ -18,7 +18,7 @@ static __initconst const u64 amd_hw_cache_event_ids
 		[ C(RESULT_MISS)   ] = 0x0141, /* Data Cache Misses          */
 	},
 	[ C(OP_WRITE) ] = {
-		[ C(RESULT_ACCESS) ] = 0x0142, /* Data Cache Refills :system */
+		[ C(RESULT_ACCESS) ] = 0,
 		[ C(RESULT_MISS)   ] = 0,
 	},
 	[ C(OP_PREFETCH) ] = {</pre><hr><pre>commit 1996388e9f4e3444db8273bc08d25164d2967c21
Author: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
Date:   Mon Jul 14 15:33:25 2014 -0400

    perf/x86/intel: Use proper dTLB-load-misses event on IvyBridge
    
    This was discussed back in February:
    
            https://lkml.org/lkml/2014/2/18/956
    
    But I never saw a patch come out of it.
    
    On IvyBridge we share the SandyBridge cache event tables, but the
    dTLB-load-miss event is not compatible.  Patch it up after
    the fact to the proper DTLB_LOAD_MISSES.DEMAND_LD_MISS_CAUSES_A_WALK
    
    Signed-off-by: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
    Signed-off-by: Peter Zijlstra &lt;peterz@infradead.org&gt;
    Cc: Arnaldo Carvalho de Melo &lt;acme@kernel.org&gt;
    Cc: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
    Link: http://lkml.kernel.org/r/alpine.DEB.2.11.1407141528200.17214@vincent-weaver-1.umelst.maine.edu
    Signed-off-by: Ingo Molnar &lt;mingo@kernel.org&gt;

diff --git a/arch/x86/kernel/cpu/perf_event_intel.c b/arch/x86/kernel/cpu/perf_event_intel.c
index 07846d738bdb..c206815b9556 100644
--- a/arch/x86/kernel/cpu/perf_event_intel.c
+++ b/arch/x86/kernel/cpu/perf_event_intel.c
@@ -2474,6 +2474,9 @@ __init int intel_pmu_init(void)
 	case 62: /* IvyBridge EP */
 		memcpy(hw_cache_event_ids, snb_hw_cache_event_ids,
 		       sizeof(hw_cache_event_ids));
+		/* dTLB-load-misses on IVB is different than SNB */
+		hw_cache_event_ids[C(DTLB)][C(OP_READ)][C(RESULT_MISS)] = 0x8108; /* DTLB_LOAD_MISSES.DEMAND_LD_MISS_CAUSES_A_WALK */
+
 		memcpy(hw_cache_extra_regs, snb_hw_cache_extra_regs,
 		       sizeof(hw_cache_extra_regs));
 </pre><hr><pre>commit cc56d673a9902aecd1c03bea6479eaff6de6967a
Author: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
Date:   Thu Jun 19 14:40:09 2014 -0400

    powerpc, perf: Use common PMU interrupt disabled code
    
    Transition to using the new generic PERF_PMU_CAP_NO_INTERRUPT method for
    failing a sampling event when no PMU interrupt is available.
    
    Signed-off-by: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
    Signed-off-by: Peter Zijlstra &lt;peterz@infradead.org&gt;
    Link: http://lkml.kernel.org/r/alpine.DEB.2.10.1406191435440.27913@vincent-weaver-1.umelst.maine.edu
    Cc: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
    Cc: Cody P Schafer &lt;cody@linux.vnet.ibm.com&gt;
    Cc: Michael Ellerman &lt;mpe@ellerman.id.au&gt;
    Cc: Paul Mackerras &lt;paulus@samba.org&gt;
    Cc: linux-kernel@vger.kernel.org
    Cc: linuxppc-dev@lists.ozlabs.org
    Signed-off-by: Ingo Molnar &lt;mingo@kernel.org&gt;

diff --git a/arch/powerpc/perf/hv-24x7.c b/arch/powerpc/perf/hv-24x7.c
index e0766b82e165..66d0f179650f 100644
--- a/arch/powerpc/perf/hv-24x7.c
+++ b/arch/powerpc/perf/hv-24x7.c
@@ -387,8 +387,7 @@ static int h_24x7_event_init(struct perf_event *event)
 	    event-&gt;attr.exclude_hv     ||
 	    event-&gt;attr.exclude_idle   ||
 	    event-&gt;attr.exclude_host   ||
-	    event-&gt;attr.exclude_guest  ||
-	    is_sampling_event(event)) /* no sampling */
+	    event-&gt;attr.exclude_guest)
 		return -EINVAL;
 
 	/* no branch sampling */
@@ -513,6 +512,9 @@ static int hv_24x7_init(void)
 	if (!hv_page_cache)
 		return -ENOMEM;
 
+	/* sampling not supported */
+	h_24x7_pmu.capabilities |= PERF_PMU_CAP_NO_INTERRUPT;
+
 	r = perf_pmu_register(&amp;h_24x7_pmu, h_24x7_pmu.name, -1);
 	if (r)
 		return r;
diff --git a/arch/powerpc/perf/hv-gpci.c b/arch/powerpc/perf/hv-gpci.c
index c9d399a2df82..15fc76c93022 100644
--- a/arch/powerpc/perf/hv-gpci.c
+++ b/arch/powerpc/perf/hv-gpci.c
@@ -210,8 +210,7 @@ static int h_gpci_event_init(struct perf_event *event)
 	    event-&gt;attr.exclude_hv     ||
 	    event-&gt;attr.exclude_idle   ||
 	    event-&gt;attr.exclude_host   ||
-	    event-&gt;attr.exclude_guest  ||
-	    is_sampling_event(event)) /* no sampling */
+	    event-&gt;attr.exclude_guest)
 		return -EINVAL;
 
 	/* no branch sampling */
@@ -284,6 +283,9 @@ static int hv_gpci_init(void)
 		return -ENODEV;
 	}
 
+	/* sampling not supported */
+	h_gpci_pmu.capabilities |= PERF_PMU_CAP_NO_INTERRUPT;
+
 	r = perf_pmu_register(&amp;h_gpci_pmu, h_gpci_pmu.name, -1);
 	if (r)
 		return r;</pre><hr><pre>commit a10d60c08cc3bbea9195e2b36440f557373623eb
Author: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
Date:   Sun Jun 15 02:06:15 2014 -0400

    sh, perf: Use common PMU interrupt disabled code
    
    Transition to using the new generic PERF_PMU_CAP_NO_INTERRUPT method for
    failing a sampling event when no PMU interrupt is available.
    
    Signed-off-by: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
    Signed-off-by: Peter Zijlstra &lt;peterz@infradead.org&gt;
    Cc: Arnaldo Carvalho de Melo &lt;acme@kernel.org&gt;
    Cc: Paul Mackerras &lt;paulus@samba.org&gt;
    Cc: linux-sh@vger.kernel.org
    Link: http://lkml.kernel.org/r/alpine.DEB.2.10.1406150205300.16738@vincent-weaver-1.umelst.maine.edu
    Signed-off-by: Ingo Molnar &lt;mingo@kernel.org&gt;

diff --git a/arch/sh/kernel/perf_event.c b/arch/sh/kernel/perf_event.c
index 02331672b6db..7cfd7f153966 100644
--- a/arch/sh/kernel/perf_event.c
+++ b/arch/sh/kernel/perf_event.c
@@ -128,14 +128,6 @@ static int __hw_perf_event_init(struct perf_event *event)
 	if (!sh_pmu_initialized())
 		return -ENODEV;
 
-	/*
-	 * All of the on-chip counters are "limited", in that they have
-	 * no interrupts, and are therefore unable to do sampling without
-	 * further work and timer assistance.
-	 */
-	if (hwc-&gt;sample_period)
-		return -EINVAL;
-
 	/*
 	 * See if we need to reserve the counter.
 	 *
@@ -392,6 +384,13 @@ int register_sh_pmu(struct sh_pmu *_pmu)
 
 	pr_info("Performance Events: %s support registered\n", _pmu-&gt;name);
 
+	/*
+	 * All of the on-chip counters are "limited", in that they have
+	 * no interrupts, and are therefore unable to do sampling without
+	 * further work and timer assistance.
+	 */
+	pmu.capabilities |= PERF_PMU_CAP_NO_INTERRUPT;
+
 	WARN_ON(_pmu-&gt;num_events &gt; MAX_HWEVENTS);
 
 	perf_pmu_register(&amp;pmu, "cpu", PERF_TYPE_RAW);</pre><hr><pre>commit 97b1198fece06d495270222bcf5fde4c8cb0b5b0
Author: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
Date:   Sun Jun 15 02:05:23 2014 -0400

    s390, perf: Use common PMU interrupt disabled code
    
    Transition to using the new generic PERF_PMU_CAP_NO_INTERRUPT method for
    failing a sampling event when no PMU interrupt is available.
    
    Signed-off-by: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
    Signed-off-by: Peter Zijlstra &lt;peterz@infradead.org&gt;
    Cc: Heiko Carstens &lt;heiko.carstens@de.ibm.com&gt;
    Cc: Hendrik Brueckner &lt;brueckner@linux.vnet.ibm.com&gt;
    Cc: Martin Schwidefsky &lt;schwidefsky@de.ibm.com&gt;
    Cc: Paul Gortmaker &lt;paul.gortmaker@windriver.com&gt;
    Cc: Thomas Huth &lt;thuth@linux.vnet.ibm.com&gt;
    Cc: linux390@de.ibm.com
    Cc: linux-s390@vger.kernel.org
    Link: http://lkml.kernel.org/r/alpine.DEB.2.10.1406150204290.16738@vincent-weaver-1.umelst.maine.edu
    Signed-off-by: Ingo Molnar &lt;mingo@kernel.org&gt;

diff --git a/arch/s390/kernel/perf_cpum_cf.c b/arch/s390/kernel/perf_cpum_cf.c
index ea75d011a6fc..d3194de7ae1e 100644
--- a/arch/s390/kernel/perf_cpum_cf.c
+++ b/arch/s390/kernel/perf_cpum_cf.c
@@ -411,12 +411,6 @@ static int cpumf_pmu_event_init(struct perf_event *event)
 	case PERF_TYPE_HARDWARE:
 	case PERF_TYPE_HW_CACHE:
 	case PERF_TYPE_RAW:
-		/* The CPU measurement counter facility does not have overflow
-		 * interrupts to do sampling.  Sampling must be provided by
-		 * external means, for example, by timers.
-		 */
-		if (is_sampling_event(event))
-			return -ENOENT;
 		err = __hw_perf_event_init(event);
 		break;
 	default:
@@ -681,6 +675,12 @@ static int __init cpumf_pmu_init(void)
 		goto out;
 	}
 
+	/* The CPU measurement counter facility does not have overflow
+	 * interrupts to do sampling.  Sampling must be provided by
+	 * external means, for example, by timers.
+	 */
+	cpumf_pmu.capabilities |= PERF_PMU_CAP_NO_INTERRUPT;
+
 	cpumf_pmu.attr_groups = cpumf_cf_event_group();
 	rc = perf_pmu_register(&amp;cpumf_pmu, "cpum_cf", PERF_TYPE_RAW);
 	if (rc) {</pre><hr><pre>commit 1b92722fafe2003e49ec904f33c0020ade36bd16
Author: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
Date:   Sun Jun 15 02:03:13 2014 -0400

    metag, perf: Use common PMU interrupt disabled code
    
    Transition to using the new generic PERF_PMU_CAP_NO_INTERRUPT method for
    failing a sampling event when no PMU interrupt is available.
    
    Signed-off-by: Vince Weaver &lt;vincent.weaver@maine.edu&gt;
    Acked-by: James Hogan &lt;james.hogan@imgtec.com&gt;
    Signed-off-by: Peter Zijlstra &lt;peterz@infradead.org&gt;
    Cc: Arnaldo Carvalho de Melo &lt;acme@kernel.org&gt;
    Cc: Paul Mackerras &lt;paulus@samba.org&gt;
    Cc: linux-metag@vger.kernel.org
    Link: http://lkml.kernel.org/r/alpine.DEB.2.10.1406150202050.16738@vincent-weaver-1.umelst.maine.edu
    Signed-off-by: Ingo Molnar &lt;mingo@kernel.org&gt;

diff --git a/arch/metag/kernel/perf/perf_event.c b/arch/metag/kernel/perf/perf_event.c
index 5cc4d4dcf3cf..02c08737f6aa 100644
--- a/arch/metag/kernel/perf/perf_event.c
+++ b/arch/metag/kernel/perf/perf_event.c
@@ -567,16 +567,6 @@ static int _hw_perf_event_init(struct perf_event *event)
 	if (mapping == -1)
 		return -EINVAL;
 
-	/*
-	 * Early cores have "limited" counters - they have no overflow
-	 * interrupts - and so are unable to do sampling without extra work
-	 * and timer assistance.
-	 */
-	if (metag_pmu-&gt;max_period == 0) {
-		if (hwc-&gt;sample_period)
-			return -EINVAL;
-	}
-
 	/*
 	 * Don't assign an index until the event is placed into the hardware.
 	 * -1 signifies that we're still deciding where to put it. On SMP
@@ -866,6 +856,15 @@ static int __init init_hw_perf_events(void)
 	pr_info("enabled with %s PMU driver, %d counters available\n",
 			metag_pmu-&gt;name, metag_pmu-&gt;max_events);
 
+	/*
+	 * Early cores have "limited" counters - they have no overflow
+	 * interrupts - and so are unable to do sampling without extra work
+	 * and timer assistance.
+	 */
+	if (metag_pmu-&gt;max_period == 0) {
+		metag_pmu-&gt;pmu.capabilities |= PERF_PMU_CAP_NO_INTERRUPT;
+	}
+
 	/* Initialise the active events and reservation mutex */
 	atomic_set(&amp;metag_pmu-&gt;active_events, 0);
 	mutex_init(&amp;metag_pmu-&gt;reserve_mutex);</pre>
    <div class="pagination">
        <span>[1]</span><a href='22_2.html'>2</a><a href='22_3.html'>3</a><a href='22_4.html'>4</a><a href='22_2.html'>Next&gt;&gt;</a>
    <div>
</body>

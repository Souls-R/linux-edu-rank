<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Huazhong University of Science and Technology</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Huazhong University of Science and Technology</h1>
    <div class="pagination">
        <a href='14_4.html'>&lt;&lt;Prev</a><a href='14.html'>1</a><a href='14_2.html'>2</a><a href='14_3.html'>3</a><a href='14_4.html'>4</a><span>[5]</span><a href='14_6.html'>6</a><a href='14_7.html'>7</a><a href='14_8.html'>8</a><a href='14_6.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit d184d60aa301e424cd0cf7de90b40744710a2417
Author: Zhengkang Huang &lt;zkhuang@hust.edu.cn&gt;
Date:   Wed Apr 19 18:03:03 2023 +0800

    platform/chrome: wilco_ec: remove return value check of debugfs_create_dir()
    
    Smatch complains that:
    wilco_ec_debugfs_probe() warn: 'debug_info-&gt;dir' is an error
    pointer or valid
    
    Debugfs checks are generally not supposed to be checked
    for errors and it is not necessary here.
    
    Just delete the dead code.
    
    Signed-off-by: Zhengkang Huang &lt;zkhuang@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Signed-off-by: Tzung-Bi Shih &lt;tzungbi@kernel.org&gt;
    Link: https://lore.kernel.org/r/20230419100303.343379-1-zkhuang@hust.edu.cn

diff --git a/drivers/platform/chrome/wilco_ec/debugfs.c b/drivers/platform/chrome/wilco_ec/debugfs.c
index a812788a0bdc..7a13f13b16cd 100644
--- a/drivers/platform/chrome/wilco_ec/debugfs.c
+++ b/drivers/platform/chrome/wilco_ec/debugfs.c
@@ -251,8 +251,6 @@ static int wilco_ec_debugfs_probe(struct platform_device *pdev)
 		return 0;
 	debug_info-&gt;ec = ec;
 	debug_info-&gt;dir = debugfs_create_dir("wilco_ec", NULL);
-	if (!debug_info-&gt;dir)
-		return 0;
 	debugfs_create_file("raw", 0644, debug_info-&gt;dir, NULL, &amp;fops_raw);
 	debugfs_create_file("h1_gpio", 0444, debug_info-&gt;dir, ec,
 			    &amp;fops_h1_gpio);</pre><hr><pre>commit 3c690a0d64f5964977050a91b6bba8de09c13d94
Author: Lanzhe Li &lt;u202212060@hust.edu.cn&gt;
Date:   Sun Apr 9 21:02:29 2023 +0800

    Bluetooth: fix inconsistent indenting
    
    Fixed a wrong indentation before "return".This line uses a 7 space
    indent instead of a tab.
    
    Signed-off-by: Lanzhe Li &lt;u202212060@hust.edu.cn&gt;
    Signed-off-by: Luiz Augusto von Dentz &lt;luiz.von.dentz@intel.com&gt;

diff --git a/net/bluetooth/hci_debugfs.c b/net/bluetooth/hci_debugfs.c
index b7f682922a16..ec0df2f9188e 100644
--- a/net/bluetooth/hci_debugfs.c
+++ b/net/bluetooth/hci_debugfs.c
@@ -189,7 +189,7 @@ static int uuids_show(struct seq_file *f, void *p)
 	}
 	hci_dev_unlock(hdev);
 
-       return 0;
+	return 0;
 }
 
 DEFINE_SHOW_ATTRIBUTE(uuids);</pre><hr><pre>commit b148b9abc8444c9e0579a6bbe47b2da6adf5a150
Author: Wang Zhang &lt;silver_code@hust.edu.cn&gt;
Date:   Fri Apr 21 23:10:09 2023 +0800

    net: ethernet: mediatek: remove return value check of `mtk_wed_hw_add_debugfs`
    
    Smatch complains that:
    mtk_wed_hw_add_debugfs() warn: 'dir' is an error pointer or valid
    
    Debugfs checks are generally not supposed to be checked
    for errors and it is not necessary here.
    
    fix it by just deleting the dead code.
    
    Signed-off-by: Wang Zhang &lt;silver_code@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/net/ethernet/mediatek/mtk_wed_debugfs.c b/drivers/net/ethernet/mediatek/mtk_wed_debugfs.c
index 56f663439721..b244c02c5b51 100644
--- a/drivers/net/ethernet/mediatek/mtk_wed_debugfs.c
+++ b/drivers/net/ethernet/mediatek/mtk_wed_debugfs.c
@@ -252,8 +252,6 @@ void mtk_wed_hw_add_debugfs(struct mtk_wed_hw *hw)
 
 	snprintf(hw-&gt;dirname, sizeof(hw-&gt;dirname), "wed%d", hw-&gt;index);
 	dir = debugfs_create_dir(hw-&gt;dirname, NULL);
-	if (!dir)
-		return;
 
 	hw-&gt;debugfs_dir = dir;
 	debugfs_create_u32("regidx", 0600, dir, &amp;hw-&gt;debugfs_reg);</pre><hr><pre>commit eb74bfcfa99415f1a65ce021b8ac2256b7ed50bc
Author: Yingsha Xu &lt;ysxu@hust.edu.cn&gt;
Date:   Wed Apr 19 18:45:47 2023 +0800

    wifi: mac80211: remove return value check of debugfs_create_dir()
    
    Smatch complains that:
    debugfs_hw_add() warn: 'statsd' is an error pointer or valid
    
    Debugfs checks are generally not supposed to be checked for errors
    and it is not necessary here.
    
    Just delete the dead code.
    
    Signed-off-by: Yingsha Xu &lt;ysxu@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Link: https://lore.kernel.org/r/20230419104548.30124-1-ysxu@hust.edu.cn
    Signed-off-by: Johannes Berg &lt;johannes.berg@intel.com&gt;

diff --git a/net/mac80211/debugfs.c b/net/mac80211/debugfs.c
index dfb9f55e2685..207f772bd8ce 100644
--- a/net/mac80211/debugfs.c
+++ b/net/mac80211/debugfs.c
@@ -673,10 +673,6 @@ void debugfs_hw_add(struct ieee80211_local *local)
 
 	statsd = debugfs_create_dir("statistics", phyd);
 
-	/* if the dir failed, don't put all the other things into the root! */
-	if (!statsd)
-		return;
-
 #ifdef CONFIG_MAC80211_DEBUG_COUNTERS
 	DEBUGFS_STATS_ADD(dot11TransmittedFragmentCount);
 	DEBUGFS_STATS_ADD(dot11MulticastTransmittedFrameCount);</pre><hr><pre>commit d6f712f53b79f5017cdcefafb7a5aea9ec52da5d
Author: Yinhao Hu &lt;dddddd@hust.edu.cn&gt;
Date:   Wed Apr 12 13:58:52 2023 +0800

    usb: chipidea: fix missing goto in `ci_hdrc_probe`
    
    From the comment of ci_usb_phy_init, it returns an error code if
    usb_phy_init has failed, and it should do some clean up, not just
    return directly.
    
    Fix this by goto the error handling.
    
    Fixes: 74475ede784d ("usb: chipidea: move PHY operation to core")
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Acked-by: Peter Chen &lt;peter.chen@kernel.org&gt;
    Signed-off-by: Yinhao Hu &lt;dddddd@hust.edu.cn&gt;
    Link: https://lore.kernel.org/r/20230412055852.971991-1-dddddd@hust.edu.cn
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;

diff --git a/drivers/usb/chipidea/core.c b/drivers/usb/chipidea/core.c
index d1d252c87e4f..798cb077867a 100644
--- a/drivers/usb/chipidea/core.c
+++ b/drivers/usb/chipidea/core.c
@@ -1108,7 +1108,7 @@ static int ci_hdrc_probe(struct platform_device *pdev)
 	ret = ci_usb_phy_init(ci);
 	if (ret) {
 		dev_err(dev, "unable to init phy: %d\n", ret);
-		return ret;
+		goto ulpi_exit;
 	}
 
 	ci-&gt;hw_bank.phys = res-&gt;start;</pre><hr><pre>commit 359f5b0d4e26b7a7bcc574d6148b31a17cefe47d
Author: Li Lanzhe &lt;u202212060@hust.edu.cn&gt;
Date:   Wed Apr 19 07:50:29 2023 -0400

    spi: spi-rockchip: Fix missing unwind goto in rockchip_sfc_probe()
    
    If devm_request_irq() fails, then we are directly return 'ret' without
    clk_disable_unprepare(sfc-&gt;clk) and clk_disable_unprepare(sfc-&gt;hclk).
    
    Fix this by changing direct return to a goto 'err_irq'.
    
    Fixes: 0b89fc0a367e ("spi: rockchip-sfc: add rockchip serial flash controller")
    Signed-off-by: Li Lanzhe &lt;u202212060@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Link: https://lore.kernel.org/r/20230419115030.6029-1-u202212060@hust.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/drivers/spi/spi-rockchip-sfc.c b/drivers/spi/spi-rockchip-sfc.c
index bd87d3c92dd3..69347b6bf60c 100644
--- a/drivers/spi/spi-rockchip-sfc.c
+++ b/drivers/spi/spi-rockchip-sfc.c
@@ -632,7 +632,7 @@ static int rockchip_sfc_probe(struct platform_device *pdev)
 	if (ret) {
 		dev_err(dev, "Failed to request irq\n");
 
-		return ret;
+		goto err_irq;
 	}
 
 	ret = rockchip_sfc_init(sfc);</pre><hr><pre>commit 1c34890273a020d61d6127ade3f68ed1cb21c16a
Author: Liliang Ye &lt;yll@hust.edu.cn&gt;
Date:   Mon Apr 3 23:26:47 2023 +0800

    ASoC: fsl_mqs: move of_node_put() to the correct location
    
    of_node_put() should have been done directly after
    mqs_priv-&gt;regmap = syscon_node_to_regmap(gpr_np);
    otherwise it creates a reference leak on the success path.
    
    To fix this, of_node_put() is moved to the correct location, and change
    all the gotos to direct returns.
    
    Fixes: a9d273671440 ("ASoC: fsl_mqs: Fix error handling in probe")
    Signed-off-by: Liliang Ye &lt;yll@hust.edu.cn&gt;
    Reviewed-by: Dan Carpenter &lt;error27@gmail.com&gt;
    Link: https://lore.kernel.org/r/20230403152647.17638-1-yll@hust.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/sound/soc/fsl/fsl_mqs.c b/sound/soc/fsl/fsl_mqs.c
index 3fb3d3e4d09a..49ae7f6267d3 100644
--- a/sound/soc/fsl/fsl_mqs.c
+++ b/sound/soc/fsl/fsl_mqs.c
@@ -210,10 +210,10 @@ static int fsl_mqs_probe(struct platform_device *pdev)
 		}
 
 		mqs_priv-&gt;regmap = syscon_node_to_regmap(gpr_np);
+		of_node_put(gpr_np);
 		if (IS_ERR(mqs_priv-&gt;regmap)) {
 			dev_err(&amp;pdev-&gt;dev, "failed to get gpr regmap\n");
-			ret = PTR_ERR(mqs_priv-&gt;regmap);
-			goto err_free_gpr_np;
+			return PTR_ERR(mqs_priv-&gt;regmap);
 		}
 	} else {
 		regs = devm_platform_ioremap_resource(pdev, 0);
@@ -242,8 +242,7 @@ static int fsl_mqs_probe(struct platform_device *pdev)
 	if (IS_ERR(mqs_priv-&gt;mclk)) {
 		dev_err(&amp;pdev-&gt;dev, "failed to get the clock: %ld\n",
 			PTR_ERR(mqs_priv-&gt;mclk));
-		ret = PTR_ERR(mqs_priv-&gt;mclk);
-		goto err_free_gpr_np;
+		return PTR_ERR(mqs_priv-&gt;mclk);
 	}
 
 	dev_set_drvdata(&amp;pdev-&gt;dev, mqs_priv);
@@ -252,13 +251,9 @@ static int fsl_mqs_probe(struct platform_device *pdev)
 	ret = devm_snd_soc_register_component(&amp;pdev-&gt;dev, &amp;soc_codec_fsl_mqs,
 			&amp;fsl_mqs_dai, 1);
 	if (ret)
-		goto err_free_gpr_np;
-	return 0;
-
-err_free_gpr_np:
-	of_node_put(gpr_np);
+		return ret;
 
-	return ret;
+	return 0;
 }
 
 static void fsl_mqs_remove(struct platform_device *pdev)</pre><hr><pre>commit 5c47cdebbaeb7724df6f9f46917c93e53f791547
Author: Jiefeng Li &lt;jiefeng_li@hust.edu.cn&gt;
Date:   Wed Apr 12 14:22:34 2023 +0800

    wifi: mt76: mt7921: fix missing unwind goto in `mt7921u_probe`
    
    `mt7921u_dma_init` can only return zero or negative number according to its
    definition. When it returns non-zero number, there exists an error and this
    function should handle this error rather than return directly.
    
    Fixes: 0d2afe09fad5 ("mt76: mt7921: add mt7921u driver")
    Signed-off-by: Jiefeng Li &lt;jiefeng_li@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Reviewed-by: Sridhar Samudrala &lt;sridhar.samudrala@intel.com&gt;
    Signed-off-by: Felix Fietkau &lt;nbd@nbd.name&gt;

diff --git a/drivers/net/wireless/mediatek/mt76/mt7921/usb.c b/drivers/net/wireless/mediatek/mt76/mt7921/usb.c
index 9b05e4577cdf..1f302c430339 100644
--- a/drivers/net/wireless/mediatek/mt76/mt7921/usb.c
+++ b/drivers/net/wireless/mediatek/mt76/mt7921/usb.c
@@ -259,7 +259,7 @@ static int mt7921u_probe(struct usb_interface *usb_intf,
 
 	ret = mt7921u_dma_init(dev, false);
 	if (ret)
-		return ret;
+		goto error;
 
 	hw = mt76_hw(dev);
 	/* check hw sg support in order to enable AMSDU */</pre><hr><pre>commit c4a413e56d16a2ae84e6d8992f215c4dcc7fac20
Author: YAN SHI &lt;m202071378@hust.edu.cn&gt;
Date:   Wed Apr 12 11:35:29 2023 +0800

    regulator: stm32-pwr: fix of_iomap leak
    
    Smatch reports:
    drivers/regulator/stm32-pwr.c:166 stm32_pwr_regulator_probe() warn:
    'base' from of_iomap() not released on lines: 151,166.
    
    In stm32_pwr_regulator_probe(), base is not released
    when devm_kzalloc() fails to allocate memory or
    devm_regulator_register() fails to register a new regulator device,
    which may cause a leak.
    
    To fix this issue, replace of_iomap() with
    devm_platform_ioremap_resource(). devm_platform_ioremap_resource()
    is a specialized function for platform devices.
    It allows 'base' to be automatically released whether the probe
    function succeeds or fails.
    
    Besides, use IS_ERR(base) instead of !base
    as the return value of devm_platform_ioremap_resource()
    can either be a pointer to the remapped memory or
    an ERR_PTR() encoded error code if the operation fails.
    
    Fixes: dc62f951a6a8 ("regulator: stm32-pwr: Fix return value check in stm32_pwr_regulator_probe()")
    Signed-off-by: YAN SHI &lt;m202071378@hust.edu.cn&gt;
    Reported-by: kernel test robot &lt;lkp@intel.com&gt;
    Link: https://lore.kernel.org/oe-kbuild-all/202304111750.o2643eJN-lkp@intel.com/
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Link: https://lore.kernel.org/r/20230412033529.18890-1-m202071378@hust.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/drivers/regulator/stm32-pwr.c b/drivers/regulator/stm32-pwr.c
index 2803a199826f..68aa9d92953d 100644
--- a/drivers/regulator/stm32-pwr.c
+++ b/drivers/regulator/stm32-pwr.c
@@ -129,17 +129,16 @@ static const struct regulator_desc stm32_pwr_desc[] = {
 
 static int stm32_pwr_regulator_probe(struct platform_device *pdev)
 {
-	struct device_node *np = pdev-&gt;dev.of_node;
 	struct stm32_pwr_reg *priv;
 	void __iomem *base;
 	struct regulator_dev *rdev;
 	struct regulator_config config = { };
 	int i, ret = 0;
 
-	base = of_iomap(np, 0);
-	if (!base) {
+	base = devm_platform_ioremap_resource(pdev, 0);
+	if (IS_ERR(base)) {
 		dev_err(&amp;pdev-&gt;dev, "Unable to map IO memory\n");
-		return -ENOMEM;
+		return PTR_ERR(base);
 	}
 
 	config.dev = &amp;pdev-&gt;dev;</pre><hr><pre>commit d93ee84e3eb5d1afc081e57ca37f1411a01f2c94
Author: Ying Liu &lt;lyre@hust.edu.cn&gt;
Date:   Wed Apr 12 01:09:12 2023 +0800

    ASoC: tas5720: add missing unwind goto in tas5720_codec_probe
    
    Smatch complains that missing unwind goto in tas5720_codec_probe.
    
    When tas5720 has an invalid devtype, it is expected to invoke
    regulator_bulk_disable to handle the failure. But the default
    option return an error code directly. Fix it by reusing the
    probe_fail label.
    
    Signed-off-by: Ying Liu &lt;lyre@hust.edu.cn&gt;
    Link: https://lore.kernel.org/r/20230411170912.1939906-1-lyre@hust.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/sound/soc/codecs/tas5720.c b/sound/soc/codecs/tas5720.c
index de6d01c8fdd3..4d27b60bd804 100644
--- a/sound/soc/codecs/tas5720.c
+++ b/sound/soc/codecs/tas5720.c
@@ -339,7 +339,8 @@ static int tas5720_codec_probe(struct snd_soc_component *component)
 		break;
 	default:
 		dev_err(component-&gt;dev, "unexpected private driver data\n");
-		return -EINVAL;
+		ret = -EINVAL;
+		goto probe_fail;
 	}
 
 	if (device_id != expected_device_id)</pre>
    <div class="pagination">
        <a href='14_4.html'>&lt;&lt;Prev</a><a href='14.html'>1</a><a href='14_2.html'>2</a><a href='14_3.html'>3</a><a href='14_4.html'>4</a><span>[5]</span><a href='14_6.html'>6</a><a href='14_7.html'>7</a><a href='14_8.html'>8</a><a href='14_6.html'>Next&gt;&gt;</a>
    <div>
</body>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Zhejiang University</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Zhejiang University</h1>
    <div class="pagination">
        <a href='6_33.html'>&lt;&lt;Prev</a><a href='6.html'>1</a><a href='6_2.html'>2</a><a href='6_3.html'>3</a><a href='6_4.html'>4</a><a href='6_5.html'>5</a><a href='6_6.html'>6</a><a href='6_7.html'>7</a><a href='6_8.html'>8</a><a href='6_9.html'>9</a><a href='6_10.html'>10</a><a href='6_11.html'>11</a><a href='6_12.html'>12</a><a href='6_13.html'>13</a><a href='6_14.html'>14</a><a href='6_15.html'>15</a><a href='6_16.html'>16</a><a href='6_17.html'>17</a><a href='6_18.html'>18</a><a href='6_19.html'>19</a><a href='6_20.html'>20</a><a href='6_21.html'>21</a><a href='6_22.html'>22</a><a href='6_23.html'>23</a><a href='6_24.html'>24</a><a href='6_25.html'>25</a><a href='6_26.html'>26</a><a href='6_27.html'>27</a><a href='6_28.html'>28</a><a href='6_29.html'>29</a><a href='6_30.html'>30</a><a href='6_31.html'>31</a><a href='6_32.html'>32</a><a href='6_33.html'>33</a><span>[34]</span><a href='6_35.html'>35</a><a href='6_36.html'>36</a><a href='6_35.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 282a04bf1d8029eb98585cb5db3fd70fe8bc91f7
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Wed May 20 20:46:47 2020 +0800

    wlcore: fix runtime pm imbalance in wlcore_regdomain_config
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    the call returns an error code. Thus a pairing decrement is needed
    on the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Acked-by: Tony Lindgren &lt;tony@atomide.com&gt;
    Signed-off-by: Kalle Valo &lt;kvalo@codeaurora.org&gt;
    Link: https://lore.kernel.org/r/20200520124649.10848-1-dinghao.liu@zju.edu.cn

diff --git a/drivers/net/wireless/ti/wlcore/main.c b/drivers/net/wireless/ti/wlcore/main.c
index 4421fc656b1c..fa4ced9864c0 100644
--- a/drivers/net/wireless/ti/wlcore/main.c
+++ b/drivers/net/wireless/ti/wlcore/main.c
@@ -3665,8 +3665,10 @@ void wlcore_regdomain_config(struct wl1271 *wl)
 		goto out;
 
 	ret = pm_runtime_get_sync(wl-&gt;dev);
-	if (ret &lt; 0)
+	if (ret &lt; 0) {
+		pm_runtime_put_autosuspend(wl-&gt;dev);
 		goto out;
+	}
 
 	ret = wlcore_cmd_regdomain_config_locked(wl);
 	if (ret &lt; 0) {</pre><hr><pre>commit 9604617e998b49f7695fea1479ed82421ef8c9f0
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Wed May 20 20:42:38 2020 +0800

    wlcore: fix runtime pm imbalance in wl1271_tx_work
    
    There are two error handling paths in this functon. When
    wlcore_tx_work_locked() returns an error code, we should
    decrease the runtime PM usage counter the same way as the
    error handling path beginning from pm_runtime_get_sync().
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Acked-by: Tony Lindgren &lt;tony@atomide.com&gt;
    Signed-off-by: Kalle Valo &lt;kvalo@codeaurora.org&gt;
    Link: https://lore.kernel.org/r/20200520124241.9931-1-dinghao.liu@zju.edu.cn

diff --git a/drivers/net/wireless/ti/wlcore/tx.c b/drivers/net/wireless/ti/wlcore/tx.c
index 90e56d4c3df3..e20e18cd04ae 100644
--- a/drivers/net/wireless/ti/wlcore/tx.c
+++ b/drivers/net/wireless/ti/wlcore/tx.c
@@ -863,6 +863,7 @@ void wl1271_tx_work(struct work_struct *work)
 
 	ret = wlcore_tx_work_locked(wl);
 	if (ret &lt; 0) {
+		pm_runtime_put_noidle(wl-&gt;dev);
 		wl12xx_queue_recovery_work(wl);
 		goto out;
 	}</pre><hr><pre>commit 65bd91dd6957390c42a0491b9622cf31a2cdb140
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Fri May 29 09:22:28 2020 +0800

    ASoC: img-i2s-out: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    the call returns an error code. Thus a pairing decrement is needed
    on the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Link: https://lore.kernel.org/r/20200529012230.5863-1-dinghao.liu@zju.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/sound/soc/img/img-i2s-out.c b/sound/soc/img/img-i2s-out.c
index db052ec17d5d..b56a18e7f3ac 100644
--- a/sound/soc/img/img-i2s-out.c
+++ b/sound/soc/img/img-i2s-out.c
@@ -347,8 +347,10 @@ static int img_i2s_out_set_fmt(struct snd_soc_dai *dai, unsigned int fmt)
 	chan_control_mask = IMG_I2S_OUT_CHAN_CTL_CLKT_MASK;
 
 	ret = pm_runtime_get_sync(i2s-&gt;dev);
-	if (ret &lt; 0)
+	if (ret &lt; 0) {
+		pm_runtime_put_noidle(i2s-&gt;dev);
 		return ret;
+	}
 
 	img_i2s_out_disable(i2s);
 
@@ -488,8 +490,10 @@ static int img_i2s_out_probe(struct platform_device *pdev)
 			goto err_pm_disable;
 	}
 	ret = pm_runtime_get_sync(&amp;pdev-&gt;dev);
-	if (ret &lt; 0)
+	if (ret &lt; 0) {
+		pm_runtime_put_noidle(&amp;pdev-&gt;dev);
 		goto err_suspend;
+	}
 
 	reg = IMG_I2S_OUT_CTL_FRM_SIZE_MASK;
 	img_i2s_out_writel(i2s, reg, IMG_I2S_OUT_CTL);</pre><hr><pre>commit 1c1dbb2c02623db18a50c61b175f19aead800b4e
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Thu May 21 11:13:49 2020 +0800

    PCI: tegra194: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced.
    
    Link: https://lore.kernel.org/r/20200521031355.7022-1-dinghao.liu@zju.edu.cn
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: Lorenzo Pieralisi &lt;lorenzo.pieralisi@arm.com&gt;
    Acked-by: Thierry Reding &lt;treding@nvidia.com&gt;
    Acked-by: Vidya Sagar &lt;vidyas@nvidia.com&gt;

diff --git a/drivers/pci/controller/dwc/pcie-tegra194.c b/drivers/pci/controller/dwc/pcie-tegra194.c
index ae30a2fd3716..2c0d2ce16b47 100644
--- a/drivers/pci/controller/dwc/pcie-tegra194.c
+++ b/drivers/pci/controller/dwc/pcie-tegra194.c
@@ -1623,7 +1623,7 @@ static int tegra_pcie_config_rp(struct tegra_pcie_dw *pcie)
 	ret = pinctrl_pm_select_default_state(dev);
 	if (ret &lt; 0) {
 		dev_err(dev, "Failed to configure sideband pins: %d\n", ret);
-		goto fail_pinctrl;
+		goto fail_pm_get_sync;
 	}
 
 	tegra_pcie_init_controller(pcie);
@@ -1650,9 +1650,8 @@ static int tegra_pcie_config_rp(struct tegra_pcie_dw *pcie)
 
 fail_host_init:
 	tegra_pcie_deinit_controller(pcie);
-fail_pinctrl:
-	pm_runtime_put_sync(dev);
 fail_pm_get_sync:
+	pm_runtime_put_sync(dev);
 	pm_runtime_disable(dev);
 	return ret;
 }</pre><hr><pre>commit b2e5575a8d04028d17f6c914eea31036589bc79a
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sat May 23 14:17:26 2020 +0800

    extcon: arizona: Fix runtime PM imbalance on error
    
    When arizona_request_irq() returns an error code, a
    pairing runtime PM usage counter decrement is needed
    to keep the counter balanced. For error paths after
    this function, things are the same.
    
    Also, remove calls to pm_runtime_disable() when
    pm_runtime_enable() has not been executed.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: Chanwoo Choi &lt;cw00.choi@samsung.com&gt;

diff --git a/drivers/extcon/extcon-arizona.c b/drivers/extcon/extcon-arizona.c
index 7401733db08b..aae82db542a5 100644
--- a/drivers/extcon/extcon-arizona.c
+++ b/drivers/extcon/extcon-arizona.c
@@ -1460,7 +1460,7 @@ static int arizona_extcon_probe(struct platform_device *pdev)
 	if (!info-&gt;input) {
 		dev_err(arizona-&gt;dev, "Can't allocate input dev\n");
 		ret = -ENOMEM;
-		goto err_register;
+		return ret;
 	}
 
 	info-&gt;input-&gt;name = "Headset";
@@ -1492,7 +1492,7 @@ static int arizona_extcon_probe(struct platform_device *pdev)
 		if (ret != 0) {
 			dev_err(arizona-&gt;dev, "Failed to request GPIO%d: %d\n",
 				pdata-&gt;micd_pol_gpio, ret);
-			goto err_register;
+			return ret;
 		}
 
 		info-&gt;micd_pol_gpio = gpio_to_desc(pdata-&gt;micd_pol_gpio);
@@ -1515,7 +1515,7 @@ static int arizona_extcon_probe(struct platform_device *pdev)
 			dev_err(arizona-&gt;dev,
 				"Failed to get microphone polarity GPIO: %d\n",
 				ret);
-			goto err_register;
+			return ret;
 		}
 	}
 
@@ -1672,7 +1672,7 @@ static int arizona_extcon_probe(struct platform_device *pdev)
 	if (ret != 0) {
 		dev_err(&amp;pdev-&gt;dev, "Failed to get JACKDET rise IRQ: %d\n",
 			ret);
-		goto err_gpio;
+		goto err_pm;
 	}
 
 	ret = arizona_set_irq_wake(arizona, jack_irq_rise, 1);
@@ -1721,14 +1721,14 @@ static int arizona_extcon_probe(struct platform_device *pdev)
 		dev_warn(arizona-&gt;dev, "Failed to set MICVDD to bypass: %d\n",
 			 ret);
 
-	pm_runtime_put(&amp;pdev-&gt;dev);
-
 	ret = input_register_device(info-&gt;input);
 	if (ret) {
 		dev_err(&amp;pdev-&gt;dev, "Can't register input device: %d\n", ret);
 		goto err_hpdet;
 	}
 
+	pm_runtime_put(&amp;pdev-&gt;dev);
+
 	return 0;
 
 err_hpdet:
@@ -1743,10 +1743,11 @@ static int arizona_extcon_probe(struct platform_device *pdev)
 	arizona_set_irq_wake(arizona, jack_irq_rise, 0);
 err_rise:
 	arizona_free_irq(arizona, jack_irq_rise, info);
+err_pm:
+	pm_runtime_put(&amp;pdev-&gt;dev);
+	pm_runtime_disable(&amp;pdev-&gt;dev);
 err_gpio:
 	gpiod_put(info-&gt;micd_pol_gpio);
-err_register:
-	pm_runtime_disable(&amp;pdev-&gt;dev);
 	return ret;
 }
 </pre><hr><pre>commit 117858bd63fb2ebcdfcc27b09fd65cb44511ea4c
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sat May 23 20:47:58 2020 +0800

    spi: tegra20-sflash: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Link: https://lore.kernel.org/r/20200523124758.28604-1-dinghao.liu@zju.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/drivers/spi/spi-tegra20-sflash.c b/drivers/spi/spi-tegra20-sflash.c
index 514429379206..02cf5f463ba6 100644
--- a/drivers/spi/spi-tegra20-sflash.c
+++ b/drivers/spi/spi-tegra20-sflash.c
@@ -491,6 +491,7 @@ static int tegra_sflash_probe(struct platform_device *pdev)
 	ret = pm_runtime_get_sync(&amp;pdev-&gt;dev);
 	if (ret &lt; 0) {
 		dev_err(&amp;pdev-&gt;dev, "pm runtime get failed, e = %d\n", ret);
+		pm_runtime_put_noidle(&amp;pdev-&gt;dev);
 		goto exit_pm_disable;
 	}
 </pre><hr><pre>commit faedcc17ad183acfa5d74758ebc4f21aef341f11
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sat May 23 20:29:09 2020 +0800

    spi: tegra20-slink: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Link: https://lore.kernel.org/r/20200523122909.25247-1-dinghao.liu@zju.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/drivers/spi/spi-tegra20-slink.c b/drivers/spi/spi-tegra20-slink.c
index 7f4d932dade7..a07b72e9c344 100644
--- a/drivers/spi/spi-tegra20-slink.c
+++ b/drivers/spi/spi-tegra20-slink.c
@@ -1118,6 +1118,7 @@ static int tegra_slink_probe(struct platform_device *pdev)
 	ret = pm_runtime_get_sync(&amp;pdev-&gt;dev);
 	if (ret &lt; 0) {
 		dev_err(&amp;pdev-&gt;dev, "pm runtime get failed, e = %d\n", ret);
+		pm_runtime_put_noidle(&amp;pdev-&gt;dev);
 		goto exit_pm_disable;
 	}
 	tspi-&gt;def_command_reg  = SLINK_M_S;</pre><hr><pre>commit cddc36f3fd706b1046a4d4608359c0003f72db32
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sat May 23 20:57:04 2020 +0800

    spi: tegra114: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Link: https://lore.kernel.org/r/20200523125704.30300-1-dinghao.liu@zju.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/drivers/spi/spi-tegra114.c b/drivers/spi/spi-tegra114.c
index 83edabdb41ad..c2c58871a947 100644
--- a/drivers/spi/spi-tegra114.c
+++ b/drivers/spi/spi-tegra114.c
@@ -1398,6 +1398,7 @@ static int tegra_spi_probe(struct platform_device *pdev)
 	ret = pm_runtime_get_sync(&amp;pdev-&gt;dev);
 	if (ret &lt; 0) {
 		dev_err(&amp;pdev-&gt;dev, "pm runtime get failed, e = %d\n", ret);
+		pm_runtime_put_noidle(&amp;pdev-&gt;dev);
 		goto exit_pm_disable;
 	}
 </pre><hr><pre>commit 920bef64cc5fa0e955be357bfc876179729df216
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Wed May 27 10:46:22 2020 +0800

    ASoC: wm8962: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    the call returns an error code. Thus a pairing decrement is needed
    on the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Acked-by: Charles Keepax &lt;ckeepax@opensource.cirrus.com&gt;
    Link: https://lore.kernel.org/r/20200527024625.9937-1-dinghao.liu@zju.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/sound/soc/codecs/wm8962.c b/sound/soc/codecs/wm8962.c
index 08d19df8a700..1cc23a05ffe4 100644
--- a/sound/soc/codecs/wm8962.c
+++ b/sound/soc/codecs/wm8962.c
@@ -2880,6 +2880,7 @@ static int wm8962_set_fll(struct snd_soc_component *component, int fll_id, int s
 
 	ret = pm_runtime_get_sync(component-&gt;dev);
 	if (ret &lt; 0) {
+		pm_runtime_put_noidle(component-&gt;dev);
 		dev_err(component-&gt;dev, "Failed to resume device: %d\n", ret);
 		return ret;
 	}
@@ -3012,6 +3013,7 @@ static irqreturn_t wm8962_irq(int irq, void *data)
 
 	ret = pm_runtime_get_sync(dev);
 	if (ret &lt; 0) {
+		pm_runtime_put_noidle(dev);
 		dev_err(dev, "Failed to resume: %d\n", ret);
 		return IRQ_NONE;
 	}</pre><hr><pre>commit 53865b3259554389e40aeead392151c819b52a71
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Wed May 27 16:43:24 2020 +0800

    ASoC: img-spdif-in: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    the call returns an error code. Thus a pairing decrement is needed
    on the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Link: https://lore.kernel.org/r/20200527084326.4131-1-dinghao.liu@zju.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/sound/soc/img/img-spdif-in.c b/sound/soc/img/img-spdif-in.c
index fd639f4d082b..46ff8a3621d5 100644
--- a/sound/soc/img/img-spdif-in.c
+++ b/sound/soc/img/img-spdif-in.c
@@ -753,8 +753,10 @@ static int img_spdif_in_probe(struct platform_device *pdev)
 			goto err_pm_disable;
 	}
 	ret = pm_runtime_get_sync(&amp;pdev-&gt;dev);
-	if (ret &lt; 0)
+	if (ret &lt; 0) {
+		pm_runtime_put_noidle(&amp;pdev-&gt;dev);
 		goto err_suspend;
+	}
 
 	rst = devm_reset_control_get_exclusive(&amp;pdev-&gt;dev, "rst");
 	if (IS_ERR(rst)) {</pre>
    <div class="pagination">
        <a href='6_33.html'>&lt;&lt;Prev</a><a href='6.html'>1</a><a href='6_2.html'>2</a><a href='6_3.html'>3</a><a href='6_4.html'>4</a><a href='6_5.html'>5</a><a href='6_6.html'>6</a><a href='6_7.html'>7</a><a href='6_8.html'>8</a><a href='6_9.html'>9</a><a href='6_10.html'>10</a><a href='6_11.html'>11</a><a href='6_12.html'>12</a><a href='6_13.html'>13</a><a href='6_14.html'>14</a><a href='6_15.html'>15</a><a href='6_16.html'>16</a><a href='6_17.html'>17</a><a href='6_18.html'>18</a><a href='6_19.html'>19</a><a href='6_20.html'>20</a><a href='6_21.html'>21</a><a href='6_22.html'>22</a><a href='6_23.html'>23</a><a href='6_24.html'>24</a><a href='6_25.html'>25</a><a href='6_26.html'>26</a><a href='6_27.html'>27</a><a href='6_28.html'>28</a><a href='6_29.html'>29</a><a href='6_30.html'>30</a><a href='6_31.html'>31</a><a href='6_32.html'>32</a><a href='6_33.html'>33</a><span>[34]</span><a href='6_35.html'>35</a><a href='6_36.html'>36</a><a href='6_35.html'>Next&gt;&gt;</a>
    <div>
</body>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Massachusetts Institute of Technology</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Massachusetts Institute of Technology</h1>
    <div class="pagination">
        <a href='1_108.html'>&lt;&lt;Prev</a><a href='1.html'>1</a><a href='1_2.html'>2</a><a href='1_3.html'>3</a><a href='1_4.html'>4</a><a href='1_5.html'>5</a><a href='1_6.html'>6</a><a href='1_7.html'>7</a><a href='1_8.html'>8</a><a href='1_9.html'>9</a><a href='1_10.html'>10</a><a href='1_11.html'>11</a><a href='1_12.html'>12</a><a href='1_13.html'>13</a><a href='1_14.html'>14</a><a href='1_15.html'>15</a><a href='1_16.html'>16</a><a href='1_17.html'>17</a><a href='1_18.html'>18</a><a href='1_19.html'>19</a><a href='1_20.html'>20</a><a href='1_21.html'>21</a><a href='1_22.html'>22</a><a href='1_23.html'>23</a><a href='1_24.html'>24</a><a href='1_25.html'>25</a><a href='1_26.html'>26</a><a href='1_27.html'>27</a><a href='1_28.html'>28</a><a href='1_29.html'>29</a><a href='1_30.html'>30</a><a href='1_31.html'>31</a><a href='1_32.html'>32</a><a href='1_33.html'>33</a><a href='1_34.html'>34</a><a href='1_35.html'>35</a><a href='1_36.html'>36</a><a href='1_37.html'>37</a><a href='1_38.html'>38</a><a href='1_39.html'>39</a><a href='1_40.html'>40</a><a href='1_41.html'>41</a><a href='1_42.html'>42</a><a href='1_43.html'>43</a><a href='1_44.html'>44</a><a href='1_45.html'>45</a><a href='1_46.html'>46</a><a href='1_47.html'>47</a><a href='1_48.html'>48</a><a href='1_49.html'>49</a><a href='1_50.html'>50</a><a href='1_51.html'>51</a><a href='1_52.html'>52</a><a href='1_53.html'>53</a><a href='1_54.html'>54</a><a href='1_55.html'>55</a><a href='1_56.html'>56</a><a href='1_57.html'>57</a><a href='1_58.html'>58</a><a href='1_59.html'>59</a><a href='1_60.html'>60</a><a href='1_61.html'>61</a><a href='1_62.html'>62</a><a href='1_63.html'>63</a><a href='1_64.html'>64</a><a href='1_65.html'>65</a><a href='1_66.html'>66</a><a href='1_67.html'>67</a><a href='1_68.html'>68</a><a href='1_69.html'>69</a><a href='1_70.html'>70</a><a href='1_71.html'>71</a><a href='1_72.html'>72</a><a href='1_73.html'>73</a><a href='1_74.html'>74</a><a href='1_75.html'>75</a><a href='1_76.html'>76</a><a href='1_77.html'>77</a><a href='1_78.html'>78</a><a href='1_79.html'>79</a><a href='1_80.html'>80</a><a href='1_81.html'>81</a><a href='1_82.html'>82</a><a href='1_83.html'>83</a><a href='1_84.html'>84</a><a href='1_85.html'>85</a><a href='1_86.html'>86</a><a href='1_87.html'>87</a><a href='1_88.html'>88</a><a href='1_89.html'>89</a><a href='1_90.html'>90</a><a href='1_91.html'>91</a><a href='1_92.html'>92</a><a href='1_93.html'>93</a><a href='1_94.html'>94</a><a href='1_95.html'>95</a><a href='1_96.html'>96</a><a href='1_97.html'>97</a><a href='1_98.html'>98</a><a href='1_99.html'>99</a><a href='1_100.html'>100</a><a href='1_101.html'>101</a><a href='1_102.html'>102</a><a href='1_103.html'>103</a><a href='1_104.html'>104</a><a href='1_105.html'>105</a><a href='1_106.html'>106</a><a href='1_107.html'>107</a><a href='1_108.html'>108</a><span>[109]</span><a href='1_110.html'>110</a><a href='1_111.html'>111</a><a href='1_112.html'>112</a><a href='1_113.html'>113</a><a href='1_114.html'>114</a><a href='1_115.html'>115</a><a href='1_116.html'>116</a><a href='1_117.html'>117</a><a href='1_118.html'>118</a><a href='1_119.html'>119</a><a href='1_120.html'>120</a><a href='1_121.html'>121</a><a href='1_122.html'>122</a><a href='1_123.html'>123</a><a href='1_124.html'>124</a><a href='1_125.html'>125</a><a href='1_126.html'>126</a><a href='1_127.html'>127</a><a href='1_128.html'>128</a><a href='1_129.html'>129</a><a href='1_130.html'>130</a><a href='1_131.html'>131</a><a href='1_132.html'>132</a><a href='1_133.html'>133</a><a href='1_134.html'>134</a><a href='1_135.html'>135</a><a href='1_136.html'>136</a><a href='1_137.html'>137</a><a href='1_138.html'>138</a><a href='1_139.html'>139</a><a href='1_140.html'>140</a><a href='1_141.html'>141</a><a href='1_142.html'>142</a><a href='1_143.html'>143</a><a href='1_144.html'>144</a><a href='1_145.html'>145</a><a href='1_146.html'>146</a><a href='1_147.html'>147</a><a href='1_148.html'>148</a><a href='1_149.html'>149</a><a href='1_150.html'>150</a><a href='1_151.html'>151</a><a href='1_152.html'>152</a><a href='1_153.html'>153</a><a href='1_154.html'>154</a><a href='1_110.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 825f1481ead4ce40671089bae7412ac3519e8caa
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Fri Feb 15 15:00:38 2008 -0500

    ext4: Don't use ext4_dec_count() if not needed
    
    The ext4_dec_count() function is only needed when dropping the i_nlink
    count on inodes which are (or which could be) directories.  If we
    *know* that the inode in question can't possibly be a directory, use
    drop_nlink or clear_nlink() if we know i_nlink is 1.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;

diff --git a/fs/ext4/namei.c b/fs/ext4/namei.c
index fffd0807a01b..5a79c6b6dc69 100644
--- a/fs/ext4/namei.c
+++ b/fs/ext4/namei.c
@@ -2161,7 +2161,7 @@ static int ext4_unlink(struct inode * dir, struct dentry *dentry)
 	dir-&gt;i_ctime = dir-&gt;i_mtime = ext4_current_time(dir);
 	ext4_update_dx_flag(dir);
 	ext4_mark_inode_dirty(handle, dir);
-	ext4_dec_count(handle, inode);
+	drop_nlink(inode);
 	if (!inode-&gt;i_nlink)
 		ext4_orphan_add(handle, inode);
 	inode-&gt;i_ctime = ext4_current_time(inode);
@@ -2211,7 +2211,7 @@ static int ext4_symlink (struct inode * dir,
 		err = __page_symlink(inode, symname, l,
 				mapping_gfp_mask(inode-&gt;i_mapping) &amp; ~__GFP_FS);
 		if (err) {
-			ext4_dec_count(handle, inode);
+			clear_nlink(inode);
 			ext4_mark_inode_dirty(handle, inode);
 			iput (inode);
 			goto out_stop;
@@ -2404,7 +2404,7 @@ static int ext4_rename (struct inode * old_dir, struct dentry *old_dentry,
 		ext4_dec_count(handle, old_dir);
 		if (new_inode) {
 			/* checked empty_dir above, can't have another parent,
-			 * ext3_dec_count() won't work for many-linked dirs */
+			 * ext4_dec_count() won't work for many-linked dirs */
 			new_inode-&gt;i_nlink = 0;
 		} else {
 			ext4_inc_count(handle, new_dir);</pre><hr><pre>commit b052ce4c840e2da3c72ab7dadb97d1094f6e3a89
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Fri Nov 2 21:53:01 2007 -0400

    kbuild: fix false positive -dirty tag caused by make-kpkg
    
    make-kpkg modifies scripts/package/Makefile and deletes
    scripts/package/builddeb as part of its build process.  Ignore these
    changes so the tree isn't marked as -dirty, when it is just an
    artifact of make-kpkg.  (make-kpkg clean restores the files to their
    original state, and these helper scripts won't affect the final
    compiled kernel in any way.)
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Sam Ravnborg &lt;sam@ravnborg.org&gt;

diff --git a/scripts/setlocalversion b/scripts/setlocalversion
index acce8ebc5d40..52f032e409a3 100644
--- a/scripts/setlocalversion
+++ b/scripts/setlocalversion
@@ -17,7 +17,8 @@ if head=`git rev-parse --verify HEAD 2&gt;/dev/null`; then
 
 	# Are there uncommitted changes?
 	git update-index --refresh --unmerged &gt; /dev/null
-	if git diff-index HEAD | read dummy; then
+	if git diff-index --name-only HEAD | grep -v "^scripts/package" \
+	    | read dummy; then
 		printf '%s' -dirty
 	fi
 </pre><hr><pre>commit 4e7434ff028c4280bed620f28fdbf9f4d77d77ce
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Fri Nov 2 21:53:00 2007 -0400

    kbuild: fix scripts/setlocalversion to avoid erroneous -dirty tag
    
    If git's index file is out of date, and some files have been touched
    such that their timestamp doesn't what is in the index, "git
    diff-index HEAD" may show that a particular file is dirty, when in
    fact it really isn't.  Running "git update-index" will update the
    index to avoid these false positives.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Sam Ravnborg &lt;sam@ravnborg.org&gt;

diff --git a/scripts/setlocalversion b/scripts/setlocalversion
index 1b31da843672..acce8ebc5d40 100644
--- a/scripts/setlocalversion
+++ b/scripts/setlocalversion
@@ -16,6 +16,7 @@ if head=`git rev-parse --verify HEAD 2&gt;/dev/null`; then
 	fi
 
 	# Are there uncommitted changes?
+	git update-index --refresh --unmerged &gt; /dev/null
 	if git diff-index HEAD | read dummy; then
 		printf '%s' -dirty
 	fi</pre><hr><pre>commit d882421f4e08ddf0a94245cdbe516db260aa6f41
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Fri Nov 2 21:52:59 2007 -0400

    kbuild: change CONFIG_LOCALVERSION_AUTO to use a git-describe-ish format
    
    Change the automatic local version to have the form -nnnnn-gSHA1SUMID,
    where 'nnnnn' is the number of commits since the last tag (i.e.,
    2.6.21-rc7).  This makes it much more likely that the package names created
    for the kernel will look "newer" to a package manager.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Sam Ravnborg &lt;sam@ravnborg.org&gt;

diff --git a/scripts/setlocalversion b/scripts/setlocalversion
index a80d6ea8a5bf..1b31da843672 100644
--- a/scripts/setlocalversion
+++ b/scripts/setlocalversion
@@ -12,7 +12,7 @@ cd "${1:-.}" || usage
 if head=`git rev-parse --verify HEAD 2&gt;/dev/null`; then
 	# Do we have an untagged version?
 	if git name-rev --tags HEAD | grep -E '^HEAD[[:space:]]+(.*~[0-9]*|undefined)$' &gt; /dev/null; then
-		printf '%s%s' -g `echo "$head" | cut -c1-8`
+	        git describe | awk -F- '{printf("-%05d-%s", $(NF-1),$(NF))}'
 	fi
 
 	# Are there uncommitted changes?</pre><hr><pre>commit 8232fd625217dc641ed05dd238a8bb5c82828082
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Mon Nov 26 20:42:19 2007 +0100

    x86: export the symbol empty_zero_page on the 32-bit x86 architecture
    
    The latest KVM driver wants to use the empty_zero_page symbol, and it's
    not exported in 32-bit x86 (although it is exported by x86_64, s390, and
    uml architectures).
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Cc: tglx@linutronix.de
    Cc: linux-kernel@vger.kernel.com
    Cc: kvm-devel@lists.sourceforge.net
    Signed-off-by: Thomas Gleixner &lt;tglx@linutronix.de&gt;
    Signed-off-by: Ingo Molnar &lt;mingo@elte.hu&gt;

diff --git a/arch/x86/kernel/i386_ksyms_32.c b/arch/x86/kernel/i386_ksyms_32.c
index edd39ccf139e..02112fcc0de7 100644
--- a/arch/x86/kernel/i386_ksyms_32.c
+++ b/arch/x86/kernel/i386_ksyms_32.c
@@ -2,6 +2,7 @@
 #include &lt;asm/semaphore.h&gt;
 #include &lt;asm/checksum.h&gt;
 #include &lt;asm/desc.h&gt;
+#include &lt;asm/pgtable.h&gt;
 
 EXPORT_SYMBOL(__down_failed);
 EXPORT_SYMBOL(__down_failed_interruptible);
@@ -29,3 +30,4 @@ EXPORT_SYMBOL(__read_lock_failed);
 #endif
 
 EXPORT_SYMBOL(csum_partial);
+EXPORT_SYMBOL(empty_zero_page);</pre><hr><pre>commit 436bd75e47cf804dfe89f805106bb53ff577e99a
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Thu May 31 12:43:28 2007 -0400

    Define/reserve new ext4 superblock fields
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;

diff --git a/include/linux/ext4_fs.h b/include/linux/ext4_fs.h
index 14886847a04c..de1f9f78625a 100644
--- a/include/linux/ext4_fs.h
+++ b/include/linux/ext4_fs.h
@@ -513,7 +513,14 @@ struct ext4_super_block {
 /*150*/	__le32	s_blocks_count_hi;	/* Blocks count */
 	__le32	s_r_blocks_count_hi;	/* Reserved blocks count */
 	__le32	s_free_blocks_count_hi;	/* Free blocks count */
-	__u32	s_reserved[169];	/* Padding to the end of the block */
+	__u16	s_min_extra_isize;	/* All inodes have at least # bytes */
+	__u16	s_want_extra_isize; 	/* New inodes should reserve # bytes */
+	__u32	s_flags;		/* Miscellaneous flags */
+	__u16   s_raid_stride;		/* RAID stride */
+	__u16   s_mmp_interval;         /* # seconds to wait in MMP checking */
+	__u64   s_mmp_block;            /* Block for multi-mount protection */
+	__u32   s_raid_stripe_width;    /* blocks on all data disks (N*stride)*/
+	__u32   s_reserved[163];        /* Padding to the end of the block */
 };
 
 #ifdef __KERNEL__</pre><hr><pre>commit 34f5a39899f3f3e815da64f48ddb72942d86c366
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Sat Feb 10 01:45:24 2007 -0800

    [PATCH] Add TAINT_USER and ability to set taint flags from userspace
    
    Allow taint flags to be set from userspace by writing to
    /proc/sys/kernel/tainted, and add a new taint flag, TAINT_USER, to be used
    when userspace has potentially done something dangerous that might
    compromise the kernel.  This will allow support personnel to ask further
    questions about what may have caused the user taint flag to have been set.
    
    For example, they might examine the logs of the realtime JVM to see if the
    Java program has used the really silly, stupid, dangerous, and
    completely-non-portable direct access to physical memory feature which MUST
    be implemented according to the Real-Time Specification for Java (RTSJ).
    Sigh.  What were those silly people at Sun thinking?
    
    [akpm@osdl.org: build fix]
    [bunk@stusta.de: cleanup]
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Adrian Bunk &lt;bunk@stusta.de&gt;
    Signed-off-by: Andrew Morton &lt;akpm@linux-foundation.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;

diff --git a/include/linux/kernel.h b/include/linux/kernel.h
index 63fb18dcac30..e1a429ada97f 100644
--- a/include/linux/kernel.h
+++ b/include/linux/kernel.h
@@ -200,6 +200,7 @@ extern enum system_states {
 #define TAINT_FORCED_RMMOD		(1&lt;&lt;3)
 #define TAINT_MACHINE_CHECK		(1&lt;&lt;4)
 #define TAINT_BAD_PAGE			(1&lt;&lt;5)
+#define TAINT_USER			(1&lt;&lt;6)
 
 extern void dump_stack(void);
 
diff --git a/kernel/panic.c b/kernel/panic.c
index 525e365f7239..623d1828259a 100644
--- a/kernel/panic.c
+++ b/kernel/panic.c
@@ -150,6 +150,7 @@ EXPORT_SYMBOL(panic);
  *  'R' - User forced a module unload.
  *  'M' - Machine had a machine check experience.
  *  'B' - System has hit bad_page.
+ *  'U' - Userspace-defined naughtiness.
  *
  *	The string is overwritten by the next call to print_taint().
  */
@@ -158,13 +159,14 @@ const char *print_tainted(void)
 {
 	static char buf[20];
 	if (tainted) {
-		snprintf(buf, sizeof(buf), "Tainted: %c%c%c%c%c%c",
+		snprintf(buf, sizeof(buf), "Tainted: %c%c%c%c%c%c%c",
 			tainted &amp; TAINT_PROPRIETARY_MODULE ? 'P' : 'G',
 			tainted &amp; TAINT_FORCED_MODULE ? 'F' : ' ',
 			tainted &amp; TAINT_UNSAFE_SMP ? 'S' : ' ',
 			tainted &amp; TAINT_FORCED_RMMOD ? 'R' : ' ',
  			tainted &amp; TAINT_MACHINE_CHECK ? 'M' : ' ',
-			tainted &amp; TAINT_BAD_PAGE ? 'B' : ' ');
+			tainted &amp; TAINT_BAD_PAGE ? 'B' : ' ',
+			tainted &amp; TAINT_USER ? 'U' : ' ');
 	}
 	else
 		snprintf(buf, sizeof(buf), "Not tainted");
diff --git a/kernel/sysctl.c b/kernel/sysctl.c
index 16ef870fa75a..7733ef58aaca 100644
--- a/kernel/sysctl.c
+++ b/kernel/sysctl.c
@@ -151,6 +151,8 @@ static int sysctl_ipc_data(ctl_table *table, int __user *name, int nlen,
 #ifdef CONFIG_PROC_SYSCTL
 static int proc_do_cad_pid(ctl_table *table, int write, struct file *filp,
 		  void __user *buffer, size_t *lenp, loff_t *ppos);
+static int proc_dointvec_taint(ctl_table *table, int write, struct file *filp,
+			       void __user *buffer, size_t *lenp, loff_t *ppos);
 #endif
 
 static ctl_table root_table[];
@@ -174,6 +176,7 @@ extern ctl_table inotify_table[];
 int sysctl_legacy_va_layout;
 #endif
 
+
 static void *get_uts(ctl_table *table, int write)
 {
 	char *which = table-&gt;data;
@@ -344,14 +347,16 @@ static ctl_table kern_table[] = {
 		.proc_handler	= &amp;proc_dostring,
 		.strategy	= &amp;sysctl_string,
 	},
+#ifdef CONFIG_PROC_SYSCTL
 	{
 		.ctl_name	= KERN_TAINTED,
 		.procname	= "tainted",
 		.data		= &amp;tainted,
 		.maxlen		= sizeof(int),
-		.mode		= 0444,
-		.proc_handler	= &amp;proc_dointvec,
+		.mode		= 0644,
+		.proc_handler	= &amp;proc_dointvec_taint,
 	},
+#endif
 	{
 		.ctl_name	= KERN_CAP_BSET,
 		.procname	= "cap-bound",
@@ -1927,6 +1932,7 @@ int proc_dointvec(ctl_table *table, int write, struct file *filp,
 
 #define OP_SET	0
 #define OP_AND	1
+#define OP_OR	2
 
 static int do_proc_dointvec_bset_conv(int *negp, unsigned long *lvalp,
 				      int *valp,
@@ -1938,6 +1944,7 @@ static int do_proc_dointvec_bset_conv(int *negp, unsigned long *lvalp,
 		switch(op) {
 		case OP_SET:	*valp = val; break;
 		case OP_AND:	*valp &amp;= val; break;
+		case OP_OR:	*valp |= val; break;
 		}
 	} else {
 		int val = *valp;
@@ -1970,6 +1977,22 @@ int proc_dointvec_bset(ctl_table *table, int write, struct file *filp,
 				do_proc_dointvec_bset_conv,&amp;op);
 }
 
+/*
+ *	Taint values can only be increased
+ */
+static int proc_dointvec_taint(ctl_table *table, int write, struct file *filp,
+			       void __user *buffer, size_t *lenp, loff_t *ppos)
+{
+	int op;
+
+	if (!capable(CAP_SYS_ADMIN))
+		return -EPERM;
+
+	op = OP_OR;
+	return do_proc_dointvec(table,write,filp,buffer,lenp,ppos,
+				do_proc_dointvec_bset_conv,&amp;op);
+}
+
 struct do_proc_dointvec_minmax_conv_param {
 	int *min;
 	int *max;</pre><hr><pre>commit 825f9075d74028d11d7f5932f04e1b5db3022b51
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Wed Sep 27 01:50:32 2006 -0700

    [GFS2] inode-diet: Eliminate i_blksize from the inode structure
    
    This eliminates the i_blksize field from struct inode.  Filesystems that want
    to provide a per-inode st_blksize can do so by providing their own getattr
    routine instead of using the generic_fillattr() function.
    
    Note that some filesystems were providing pretty much random (and incorrect)
    values for i_blksize.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Cc: Steven Whitehouse &lt;swhiteho@redhat.com&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;

diff --git a/fs/gfs2/inode.c b/fs/gfs2/inode.c
index 784d145058cb..57a4c8b68587 100644
--- a/fs/gfs2/inode.c
+++ b/fs/gfs2/inode.c
@@ -72,7 +72,6 @@ void gfs2_inode_attr_in(struct gfs2_inode *ip)
 	inode-&gt;i_atime.tv_nsec = 0;
 	inode-&gt;i_mtime.tv_nsec = 0;
 	inode-&gt;i_ctime.tv_nsec = 0;
-	inode-&gt;i_blksize = PAGE_SIZE;
 	inode-&gt;i_blocks = di-&gt;di_blocks &lt;&lt;
 		(GFS2_SB(inode)-&gt;sd_sb.sb_bsize_shift - GFS2_BASIC_BLOCK_SHIFT);
 </pre><hr><pre>commit bba9dfd83587017de1c55a94c077983e0dfa0251
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Wed Sep 27 01:50:31 2006 -0700

    [GFS2] inode_diet: Replace inode.u.generic_ip with inode.i_private (gfs)
    
    The following patches reduce the size of the VFS inode structure by 28 bytes
    on a UP x86.  (It would be more on an x86_64 system).  This is a 10% reduction
    in the inode size on a UP kernel that is configured in a production mode
    (i.e., with no spinlock or other debugging functions enabled; if you want to
    save memory taken up by in-core inodes, the first thing you should do is
    disable the debugging options; they are responsible for a huge amount of bloat
    in the VFS inode structure).
    
    This patch:
    
    The filesystem or device-specific pointer in the inode is inside a union,
    which is pretty pointless given that all 30+ users of this field have been
    using the void pointer.  Get rid of the union and rename it to i_private, with
    a comment to explain who is allowed to use the void pointer.  This is just a
    cleanup, but it allows us to reuse the union 'u' for something something where
    the union will actually be used.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Cc: Steven Whitehouse &lt;swhiteho@redhat.com&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;

diff --git a/fs/dlm/debug_fs.c b/fs/dlm/debug_fs.c
index 9c3aeddc8667..ca94a837a5bb 100644
--- a/fs/dlm/debug_fs.c
+++ b/fs/dlm/debug_fs.c
@@ -282,7 +282,7 @@ static int rsb_open(struct inode *inode, struct file *file)
 		return ret;
 
 	seq = file-&gt;private_data;
-	seq-&gt;private = inode-&gt;u.generic_ip;
+	seq-&gt;private = inode-&gt;i_private;
 
 	return 0;
 }
@@ -301,7 +301,7 @@ static struct file_operations rsb_fops = {
 
 static int waiters_open(struct inode *inode, struct file *file)
 {
-	file-&gt;private_data = inode-&gt;u.generic_ip;
+	file-&gt;private_data = inode-&gt;i_private;
 	return 0;
 }
 
diff --git a/fs/gfs2/inode.c b/fs/gfs2/inode.c
index ac9535be304f..784d145058cb 100644
--- a/fs/gfs2/inode.c
+++ b/fs/gfs2/inode.c
@@ -160,7 +160,7 @@ struct inode *gfs2_inode_lookup(struct super_block *sb, struct gfs2_inum *inum,
 	if (inode-&gt;i_state &amp; I_NEW) {
 		struct gfs2_sbd *sdp = GFS2_SB(inode);
 		umode_t mode = DT2IF(type);
-		inode-&gt;u.generic_ip = ip;
+		inode-&gt;i_private = ip;
 		inode-&gt;i_mode = mode;
 
 		if (S_ISREG(mode)) {
diff --git a/fs/gfs2/meta_io.c b/fs/gfs2/meta_io.c
index d3708af0a4d1..731799153187 100644
--- a/fs/gfs2/meta_io.c
+++ b/fs/gfs2/meta_io.c
@@ -78,7 +78,7 @@ struct inode *gfs2_aspace_get(struct gfs2_sbd *sdp)
 		mapping_set_gfp_mask(aspace-&gt;i_mapping, GFP_NOFS);
 		aspace-&gt;i_mapping-&gt;a_ops = &amp;aspace_aops;
 		aspace-&gt;i_size = ~0ULL;
-		aspace-&gt;u.generic_ip = NULL;
+		aspace-&gt;i_private = NULL;
 		insert_inode_hash(aspace);
 	}
 	return aspace;
diff --git a/fs/gfs2/ops_super.c b/fs/gfs2/ops_super.c
index 8cfda6452139..06f06f7773d0 100644
--- a/fs/gfs2/ops_super.c
+++ b/fs/gfs2/ops_super.c
@@ -53,7 +53,7 @@ static int gfs2_write_inode(struct inode *inode, int sync)
 	struct gfs2_inode *ip = GFS2_I(inode);
 
 	/* Check this is a "normal" inode */
-	if (inode-&gt;u.generic_ip) {
+	if (inode-&gt;i_private) {
 		if (current-&gt;flags &amp; PF_MEMALLOC)
 			return 0;
 		if (sync)
@@ -280,7 +280,7 @@ static void gfs2_clear_inode(struct inode *inode)
 	 * serves to contain an address space (see rgrp.c, meta_io.c)
 	 * which therefore doesn't have its own glocks.
 	 */
-	if (inode-&gt;u.generic_ip) {
+	if (inode-&gt;i_private) {
 		struct gfs2_inode *ip = GFS2_I(inode);
 		gfs2_glock_inode_squish(inode);
 		gfs2_assert(inode-&gt;i_sb-&gt;s_fs_info, ip-&gt;i_gl-&gt;gl_state == LM_ST_UNLOCKED);
@@ -381,7 +381,7 @@ static void gfs2_delete_inode(struct inode *inode)
 	struct gfs2_holder gh;
 	int error;
 
-	if (!inode-&gt;u.generic_ip)
+	if (!inode-&gt;i_private)
 		goto out;
 
 	error = gfs2_glock_nq_init(ip-&gt;i_gl, LM_ST_EXCLUSIVE, LM_FLAG_TRY_1CB | GL_NOCACHE, &amp;gh);</pre><hr><pre>commit ba52de123d454b57369f291348266d86f4b35070
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Wed Sep 27 01:50:49 2006 -0700

    [PATCH] inode-diet: Eliminate i_blksize from the inode structure
    
    This eliminates the i_blksize field from struct inode.  Filesystems that want
    to provide a per-inode st_blksize can do so by providing their own getattr
    routine instead of using the generic_fillattr() function.
    
    Note that some filesystems were providing pretty much random (and incorrect)
    values for i_blksize.
    
    [bunk@stusta.de: cleanup]
    [akpm@osdl.org: generic_fillattr() fix]
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Adrian Bunk &lt;bunk@stusta.de&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/powerpc/platforms/cell/spufs/inode.c b/arch/powerpc/platforms/cell/spufs/inode.c
index b837f12a84ae..3950ddccb2c8 100644
--- a/arch/powerpc/platforms/cell/spufs/inode.c
+++ b/arch/powerpc/platforms/cell/spufs/inode.c
@@ -82,7 +82,6 @@ spufs_new_inode(struct super_block *sb, int mode)
 	inode-&gt;i_mode = mode;
 	inode-&gt;i_uid = current-&gt;fsuid;
 	inode-&gt;i_gid = current-&gt;fsgid;
-	inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 out:
diff --git a/arch/s390/hypfs/inode.c b/arch/s390/hypfs/inode.c
index 8735024d235b..813fc21358f9 100644
--- a/arch/s390/hypfs/inode.c
+++ b/arch/s390/hypfs/inode.c
@@ -91,7 +91,6 @@ static struct inode *hypfs_make_inode(struct super_block *sb, int mode)
 		ret-&gt;i_mode = mode;
 		ret-&gt;i_uid = hypfs_info-&gt;uid;
 		ret-&gt;i_gid = hypfs_info-&gt;gid;
-		ret-&gt;i_blksize = PAGE_CACHE_SIZE;
 		ret-&gt;i_blocks = 0;
 		ret-&gt;i_atime = ret-&gt;i_mtime = ret-&gt;i_ctime = CURRENT_TIME;
 		if (mode &amp; S_IFDIR)
diff --git a/drivers/block/loop.c b/drivers/block/loop.c
index 7b3b94ddddcc..c774121684d7 100644
--- a/drivers/block/loop.c
+++ b/drivers/block/loop.c
@@ -662,7 +662,8 @@ static void do_loop_switch(struct loop_device *lo, struct switch_request *p)
 
 	mapping_set_gfp_mask(old_file-&gt;f_mapping, lo-&gt;old_gfp_mask);
 	lo-&gt;lo_backing_file = file;
-	lo-&gt;lo_blocksize = mapping-&gt;host-&gt;i_blksize;
+	lo-&gt;lo_blocksize = S_ISBLK(mapping-&gt;host-&gt;i_mode) ?
+		mapping-&gt;host-&gt;i_bdev-&gt;bd_block_size : PAGE_SIZE;
 	lo-&gt;old_gfp_mask = mapping_gfp_mask(mapping);
 	mapping_set_gfp_mask(mapping, lo-&gt;old_gfp_mask &amp; ~(__GFP_IO|__GFP_FS));
 	complete(&amp;p-&gt;wait);
@@ -794,7 +795,9 @@ static int loop_set_fd(struct loop_device *lo, struct file *lo_file,
 		if (!(lo_flags &amp; LO_FLAGS_USE_AOPS) &amp;&amp; !file-&gt;f_op-&gt;write)
 			lo_flags |= LO_FLAGS_READ_ONLY;
 
-		lo_blocksize = inode-&gt;i_blksize;
+		lo_blocksize = S_ISBLK(inode-&gt;i_mode) ?
+			inode-&gt;i_bdev-&gt;bd_block_size : PAGE_SIZE;
+
 		error = 0;
 	} else {
 		goto out_putf;
diff --git a/drivers/infiniband/hw/ipath/ipath_fs.c b/drivers/infiniband/hw/ipath/ipath_fs.c
index 055cdd089b28..c8a8af0fe471 100644
--- a/drivers/infiniband/hw/ipath/ipath_fs.c
+++ b/drivers/infiniband/hw/ipath/ipath_fs.c
@@ -61,7 +61,6 @@ static int ipathfs_mknod(struct inode *dir, struct dentry *dentry,
 	inode-&gt;i_mode = mode;
 	inode-&gt;i_uid = 0;
 	inode-&gt;i_gid = 0;
-	inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 	inode-&gt;i_private = data;
diff --git a/drivers/isdn/capi/capifs.c b/drivers/isdn/capi/capifs.c
index 9ea6bd0ddc35..2dd1b57b0ba4 100644
--- a/drivers/isdn/capi/capifs.c
+++ b/drivers/isdn/capi/capifs.c
@@ -104,7 +104,6 @@ capifs_fill_super(struct super_block *s, void *data, int silent)
 	inode-&gt;i_ino = 1;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME;
 	inode-&gt;i_blocks = 0;
-	inode-&gt;i_blksize = 1024;
 	inode-&gt;i_uid = inode-&gt;i_gid = 0;
 	inode-&gt;i_mode = S_IFDIR | S_IRUGO | S_IXUGO | S_IWUSR;
 	inode-&gt;i_op = &amp;simple_dir_inode_operations;
@@ -149,7 +148,6 @@ void capifs_new_ncci(unsigned int number, dev_t device)
 	if (!inode)
 		return;
 	inode-&gt;i_ino = number+2;
-	inode-&gt;i_blksize = 1024;
 	inode-&gt;i_uid = config.setuid ? config.uid : current-&gt;fsuid;
 	inode-&gt;i_gid = config.setgid ? config.gid : current-&gt;fsgid;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME;
diff --git a/drivers/misc/ibmasm/ibmasmfs.c b/drivers/misc/ibmasm/ibmasmfs.c
index 0e909b617226..b99dc507de2e 100644
--- a/drivers/misc/ibmasm/ibmasmfs.c
+++ b/drivers/misc/ibmasm/ibmasmfs.c
@@ -147,7 +147,6 @@ static struct inode *ibmasmfs_make_inode(struct super_block *sb, int mode)
 	if (ret) {
 		ret-&gt;i_mode = mode;
 		ret-&gt;i_uid = ret-&gt;i_gid = 0;
-		ret-&gt;i_blksize = PAGE_CACHE_SIZE;
 		ret-&gt;i_blocks = 0;
 		ret-&gt;i_atime = ret-&gt;i_mtime = ret-&gt;i_ctime = CURRENT_TIME;
 	}
diff --git a/drivers/oprofile/oprofilefs.c b/drivers/oprofile/oprofilefs.c
index deb37354785b..5756401fb15b 100644
--- a/drivers/oprofile/oprofilefs.c
+++ b/drivers/oprofile/oprofilefs.c
@@ -31,7 +31,6 @@ static struct inode * oprofilefs_get_inode(struct super_block * sb, int mode)
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = 0;
 		inode-&gt;i_gid = 0;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 	}
diff --git a/drivers/usb/core/inode.c b/drivers/usb/core/inode.c
index 482f253085e5..58b4b1012120 100644
--- a/drivers/usb/core/inode.c
+++ b/drivers/usb/core/inode.c
@@ -249,7 +249,6 @@ static struct inode *usbfs_get_inode (struct super_block *sb, int mode, dev_t de
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = current-&gt;fsuid;
 		inode-&gt;i_gid = current-&gt;fsgid;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 		switch (mode &amp; S_IFMT) {
diff --git a/drivers/usb/gadget/inode.c b/drivers/usb/gadget/inode.c
index ffaa8c1afad8..2a7162d89799 100644
--- a/drivers/usb/gadget/inode.c
+++ b/drivers/usb/gadget/inode.c
@@ -1966,7 +1966,6 @@ gadgetfs_make_inode (struct super_block *sb,
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = default_uid;
 		inode-&gt;i_gid = default_gid;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime
 				= CURRENT_TIME;
diff --git a/fs/9p/vfs_inode.c b/fs/9p/vfs_inode.c
index eae50c9d6dc4..7a7ec2d1d2f4 100644
--- a/fs/9p/vfs_inode.c
+++ b/fs/9p/vfs_inode.c
@@ -204,7 +204,6 @@ struct inode *v9fs_get_inode(struct super_block *sb, int mode)
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = current-&gt;fsuid;
 		inode-&gt;i_gid = current-&gt;fsgid;
-		inode-&gt;i_blksize = sb-&gt;s_blocksize;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_rdev = 0;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
@@ -950,9 +949,8 @@ v9fs_stat2inode(struct v9fs_stat *stat, struct inode *inode,
 
 	inode-&gt;i_size = stat-&gt;length;
 
-	inode-&gt;i_blksize = sb-&gt;s_blocksize;
 	inode-&gt;i_blocks =
-	    (inode-&gt;i_size + inode-&gt;i_blksize - 1) &gt;&gt; sb-&gt;s_blocksize_bits;
+	    (inode-&gt;i_size + sb-&gt;s_blocksize - 1) &gt;&gt; sb-&gt;s_blocksize_bits;
 }
 
 /**
diff --git a/fs/adfs/inode.c b/fs/adfs/inode.c
index 534f3eecc985..7e7a04be1278 100644
--- a/fs/adfs/inode.c
+++ b/fs/adfs/inode.c
@@ -269,7 +269,6 @@ adfs_iget(struct super_block *sb, struct object_info *obj)
 	inode-&gt;i_ino	 = obj-&gt;file_id;
 	inode-&gt;i_size	 = obj-&gt;size;
 	inode-&gt;i_nlink	 = 2;
-	inode-&gt;i_blksize = PAGE_SIZE;
 	inode-&gt;i_blocks	 = (inode-&gt;i_size + sb-&gt;s_blocksize - 1) &gt;&gt;
 			    sb-&gt;s_blocksize_bits;
 
diff --git a/fs/afs/inode.c b/fs/afs/inode.c
index 4ebb30a50ed5..6f37754906c2 100644
--- a/fs/afs/inode.c
+++ b/fs/afs/inode.c
@@ -72,7 +72,6 @@ static int afs_inode_map_status(struct afs_vnode *vnode)
 	inode-&gt;i_ctime.tv_sec	= vnode-&gt;status.mtime_server;
 	inode-&gt;i_ctime.tv_nsec	= 0;
 	inode-&gt;i_atime		= inode-&gt;i_mtime = inode-&gt;i_ctime;
-	inode-&gt;i_blksize	= PAGE_CACHE_SIZE;
 	inode-&gt;i_blocks		= 0;
 	inode-&gt;i_version	= vnode-&gt;fid.unique;
 	inode-&gt;i_mapping-&gt;a_ops	= &amp;afs_fs_aops;
diff --git a/fs/autofs/inode.c b/fs/autofs/inode.c
index d39d2acd9b38..2c9759baad61 100644
--- a/fs/autofs/inode.c
+++ b/fs/autofs/inode.c
@@ -216,7 +216,6 @@ static void autofs_read_inode(struct inode *inode)
 	inode-&gt;i_nlink = 2;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME;
 	inode-&gt;i_blocks = 0;
-	inode-&gt;i_blksize = 1024;
 
 	if ( ino == AUTOFS_ROOT_INO ) {
 		inode-&gt;i_mode = S_IFDIR | S_IRUGO | S_IXUGO | S_IWUSR;
diff --git a/fs/autofs4/inode.c b/fs/autofs4/inode.c
index 11a6a9ae51b7..800ce876caec 100644
--- a/fs/autofs4/inode.c
+++ b/fs/autofs4/inode.c
@@ -447,7 +447,6 @@ struct inode *autofs4_get_inode(struct super_block *sb,
 		inode-&gt;i_uid = 0;
 		inode-&gt;i_gid = 0;
 	}
-	inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 
diff --git a/fs/befs/linuxvfs.c b/fs/befs/linuxvfs.c
index f6676fbe9484..57020c7a7e65 100644
--- a/fs/befs/linuxvfs.c
+++ b/fs/befs/linuxvfs.c
@@ -365,7 +365,6 @@ befs_read_inode(struct inode *inode)
 	inode-&gt;i_mtime.tv_nsec = 0;   /* lower 16 bits are not a time */	
 	inode-&gt;i_ctime = inode-&gt;i_mtime;
 	inode-&gt;i_atime = inode-&gt;i_mtime;
-	inode-&gt;i_blksize = befs_sb-&gt;block_size;
 
 	befs_ino-&gt;i_inode_num = fsrun_to_cpu(sb, raw_inode-&gt;inode_num);
 	befs_ino-&gt;i_parent = fsrun_to_cpu(sb, raw_inode-&gt;parent);
diff --git a/fs/bfs/dir.c b/fs/bfs/dir.c
index 26fad9621738..dcf04cb13283 100644
--- a/fs/bfs/dir.c
+++ b/fs/bfs/dir.c
@@ -102,7 +102,7 @@ static int bfs_create(struct inode * dir, struct dentry * dentry, int mode,
 	inode-&gt;i_uid = current-&gt;fsuid;
 	inode-&gt;i_gid = (dir-&gt;i_mode &amp; S_ISGID) ? dir-&gt;i_gid : current-&gt;fsgid;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME_SEC;
-	inode-&gt;i_blocks = inode-&gt;i_blksize = 0;
+	inode-&gt;i_blocks = 0;
 	inode-&gt;i_op = &amp;bfs_file_inops;
 	inode-&gt;i_fop = &amp;bfs_file_operations;
 	inode-&gt;i_mapping-&gt;a_ops = &amp;bfs_aops;
diff --git a/fs/bfs/inode.c b/fs/bfs/inode.c
index 8fc2e8e49dbe..ed27ffb3459e 100644
--- a/fs/bfs/inode.c
+++ b/fs/bfs/inode.c
@@ -76,7 +76,6 @@ static void bfs_read_inode(struct inode * inode)
 	inode-&gt;i_size = BFS_FILESIZE(di);
 	inode-&gt;i_blocks = BFS_FILEBLOCKS(di);
         if (inode-&gt;i_size || inode-&gt;i_blocks) dprintf("Registered inode with %lld size, %ld blocks\n", inode-&gt;i_size, inode-&gt;i_blocks);
-	inode-&gt;i_blksize = PAGE_SIZE;
 	inode-&gt;i_atime.tv_sec =  le32_to_cpu(di-&gt;i_atime);
 	inode-&gt;i_mtime.tv_sec =  le32_to_cpu(di-&gt;i_mtime);
 	inode-&gt;i_ctime.tv_sec =  le32_to_cpu(di-&gt;i_ctime);
diff --git a/fs/binfmt_misc.c b/fs/binfmt_misc.c
index 6759b9839ce8..66ba137f8661 100644
--- a/fs/binfmt_misc.c
+++ b/fs/binfmt_misc.c
@@ -507,7 +507,6 @@ static struct inode *bm_get_inode(struct super_block *sb, int mode)
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = 0;
 		inode-&gt;i_gid = 0;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime =
 			current_fs_time(inode-&gt;i_sb);
diff --git a/fs/cifs/cifsfs.c b/fs/cifs/cifsfs.c
index 4197a5043f13..22bcf4d7e7ae 100644
--- a/fs/cifs/cifsfs.c
+++ b/fs/cifs/cifsfs.c
@@ -253,7 +253,6 @@ cifs_alloc_inode(struct super_block *sb)
 	file data or metadata */
 	cifs_inode-&gt;clientCanCacheRead = FALSE;
 	cifs_inode-&gt;clientCanCacheAll = FALSE;
-	cifs_inode-&gt;vfs_inode.i_blksize = CIFS_MAX_MSGSIZE;
 	cifs_inode-&gt;vfs_inode.i_blkbits = 14;  /* 2**14 = CIFS_MAX_MSGSIZE */
 	cifs_inode-&gt;vfs_inode.i_flags = S_NOATIME | S_NOCMTIME;
 	INIT_LIST_HEAD(&amp;cifs_inode-&gt;openFileList);
diff --git a/fs/cifs/readdir.c b/fs/cifs/readdir.c
index 9aeb58a7d369..b27b34537bf2 100644
--- a/fs/cifs/readdir.c
+++ b/fs/cifs/readdir.c
@@ -216,10 +216,9 @@ static void fill_in_inode(struct inode *tmp_inode, int new_buf_type,
 
 	if (allocation_size &lt; end_of_file)
 		cFYI(1, ("May be sparse file, allocation less than file size"));
-	cFYI(1, ("File Size %ld and blocks %llu and blocksize %ld",
+	cFYI(1, ("File Size %ld and blocks %llu",
 		(unsigned long)tmp_inode-&gt;i_size,
-		(unsigned long long)tmp_inode-&gt;i_blocks,
-		tmp_inode-&gt;i_blksize));
+		(unsigned long long)tmp_inode-&gt;i_blocks));
 	if (S_ISREG(tmp_inode-&gt;i_mode)) {
 		cFYI(1, ("File inode"));
 		tmp_inode-&gt;i_op = &amp;cifs_file_inode_ops;
diff --git a/fs/coda/coda_linux.c b/fs/coda/coda_linux.c
index 5597080cb811..95a54253c047 100644
--- a/fs/coda/coda_linux.c
+++ b/fs/coda/coda_linux.c
@@ -110,8 +110,6 @@ void coda_vattr_to_iattr(struct inode *inode, struct coda_vattr *attr)
 	        inode-&gt;i_nlink = attr-&gt;va_nlink;
 	if (attr-&gt;va_size != -1)
 	        inode-&gt;i_size = attr-&gt;va_size;
-	if (attr-&gt;va_blocksize != -1)
-		inode-&gt;i_blksize = attr-&gt;va_blocksize;
 	if (attr-&gt;va_size != -1)
 		inode-&gt;i_blocks = (attr-&gt;va_size + 511) &gt;&gt; 9;
 	if (attr-&gt;va_atime.tv_sec != -1) 
diff --git a/fs/configfs/inode.c b/fs/configfs/inode.c
index 5047e6a7581e..fb18917954a9 100644
--- a/fs/configfs/inode.c
+++ b/fs/configfs/inode.c
@@ -135,7 +135,6 @@ struct inode * configfs_new_inode(mode_t mode, struct configfs_dirent * sd)
 {
 	struct inode * inode = new_inode(configfs_sb);
 	if (inode) {
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_mapping-&gt;a_ops = &amp;configfs_aops;
 		inode-&gt;i_mapping-&gt;backing_dev_info = &amp;configfs_backing_dev_info;
diff --git a/fs/cramfs/inode.c b/fs/cramfs/inode.c
index d09b6777c41a..ad96b6990715 100644
--- a/fs/cramfs/inode.c
+++ b/fs/cramfs/inode.c
@@ -73,7 +73,6 @@ static int cramfs_iget5_set(struct inode *inode, void *opaque)
 	inode-&gt;i_uid = cramfs_inode-&gt;uid;
 	inode-&gt;i_size = cramfs_inode-&gt;size;
 	inode-&gt;i_blocks = (cramfs_inode-&gt;size - 1) / 512 + 1;
-	inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 	inode-&gt;i_gid = cramfs_inode-&gt;gid;
 	/* Struct copy intentional */
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = zerotime;
diff --git a/fs/debugfs/inode.c b/fs/debugfs/inode.c
index 717f4821ed02..269e649e6dc6 100644
--- a/fs/debugfs/inode.c
+++ b/fs/debugfs/inode.c
@@ -40,7 +40,6 @@ static struct inode *debugfs_get_inode(struct super_block *sb, int mode, dev_t d
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = 0;
 		inode-&gt;i_gid = 0;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 		switch (mode &amp; S_IFMT) {
diff --git a/fs/devpts/inode.c b/fs/devpts/inode.c
index 5bf06a10dddf..5f7b5a6025bf 100644
--- a/fs/devpts/inode.c
+++ b/fs/devpts/inode.c
@@ -113,7 +113,6 @@ devpts_fill_super(struct super_block *s, void *data, int silent)
 	inode-&gt;i_ino = 1;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME;
 	inode-&gt;i_blocks = 0;
-	inode-&gt;i_blksize = 1024;
 	inode-&gt;i_uid = inode-&gt;i_gid = 0;
 	inode-&gt;i_mode = S_IFDIR | S_IRUGO | S_IXUGO | S_IWUSR;
 	inode-&gt;i_op = &amp;simple_dir_inode_operations;
@@ -172,7 +171,6 @@ int devpts_pty_new(struct tty_struct *tty)
 		return -ENOMEM;
 
 	inode-&gt;i_ino = number+2;
-	inode-&gt;i_blksize = 1024;
 	inode-&gt;i_uid = config.setuid ? config.uid : current-&gt;fsuid;
 	inode-&gt;i_gid = config.setgid ? config.gid : current-&gt;fsgid;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME;
diff --git a/fs/eventpoll.c b/fs/eventpoll.c
index 3a3567433b92..8d544334bcd2 100644
--- a/fs/eventpoll.c
+++ b/fs/eventpoll.c
@@ -1590,7 +1590,6 @@ static struct inode *ep_eventpoll_inode(void)
 	inode-&gt;i_uid = current-&gt;fsuid;
 	inode-&gt;i_gid = current-&gt;fsgid;
 	inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
-	inode-&gt;i_blksize = PAGE_SIZE;
 	return inode;
 
 eexit_1:
diff --git a/fs/ext2/ialloc.c b/fs/ext2/ialloc.c
index 695f69ccf908..2cb545bf0f3c 100644
--- a/fs/ext2/ialloc.c
+++ b/fs/ext2/ialloc.c
@@ -574,7 +574,6 @@ struct inode *ext2_new_inode(struct inode *dir, int mode)
 	inode-&gt;i_mode = mode;
 
 	inode-&gt;i_ino = ino;
-	inode-&gt;i_blksize = PAGE_SIZE;	/* This is the optimal IO size (for stat), not the fs block size */
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME_SEC;
 	memset(ei-&gt;i_data, 0, sizeof(ei-&gt;i_data));
diff --git a/fs/ext2/inode.c b/fs/ext2/inode.c
index fb4d3220eb8d..dd4e14c221e0 100644
--- a/fs/ext2/inode.c
+++ b/fs/ext2/inode.c
@@ -1094,7 +1094,6 @@ void ext2_read_inode (struct inode * inode)
 		brelse (bh);
 		goto bad_inode;
 	}
-	inode-&gt;i_blksize = PAGE_SIZE;	/* This is the optimal IO size (for stat), not the fs block size */
 	inode-&gt;i_blocks = le32_to_cpu(raw_inode-&gt;i_blocks);
 	ei-&gt;i_flags = le32_to_cpu(raw_inode-&gt;i_flags);
 	ei-&gt;i_faddr = le32_to_cpu(raw_inode-&gt;i_faddr);
diff --git a/fs/ext3/ialloc.c b/fs/ext3/ialloc.c
index 1e4ded8aa3cd..e45dbd651736 100644
--- a/fs/ext3/ialloc.c
+++ b/fs/ext3/ialloc.c
@@ -559,7 +559,6 @@ struct inode *ext3_new_inode(handle_t *handle, struct inode * dir, int mode)
 
 	inode-&gt;i_ino = ino;
 	/* This is the optimal IO size (for stat), not the fs block size */
-	inode-&gt;i_blksize = PAGE_SIZE;
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME_SEC;
 
diff --git a/fs/ext3/inode.c b/fs/ext3/inode.c
index c9fc15f8b609..dcf4f1dd108b 100644
--- a/fs/ext3/inode.c
+++ b/fs/ext3/inode.c
@@ -2632,9 +2632,6 @@ void ext3_read_inode(struct inode * inode)
 		 * recovery code: that's fine, we're about to complete
 		 * the process of deleting those. */
 	}
-	inode-&gt;i_blksize = PAGE_SIZE;	/* This is the optimal IO size
-					 * (for stat), not the fs block
-					 * size */  
 	inode-&gt;i_blocks = le32_to_cpu(raw_inode-&gt;i_blocks);
 	ei-&gt;i_flags = le32_to_cpu(raw_inode-&gt;i_flags);
 #ifdef EXT3_FRAGMENTS
diff --git a/fs/fat/inode.c b/fs/fat/inode.c
index e1035a590664..ab96ae823753 100644
--- a/fs/fat/inode.c
+++ b/fs/fat/inode.c
@@ -370,8 +370,6 @@ static int fat_fill_inode(struct inode *inode, struct msdos_dir_entry *de)
 			inode-&gt;i_flags |= S_IMMUTABLE;
 	}
 	MSDOS_I(inode)-&gt;i_attrs = de-&gt;attr &amp; ATTR_UNUSED;
-	/* this is as close to the truth as we can get ... */
-	inode-&gt;i_blksize = sbi-&gt;cluster_size;
 	inode-&gt;i_blocks = ((inode-&gt;i_size + (sbi-&gt;cluster_size - 1))
 			   &amp; ~((loff_t)sbi-&gt;cluster_size - 1)) &gt;&gt; 9;
 	inode-&gt;i_mtime.tv_sec =
@@ -1131,7 +1129,6 @@ static int fat_read_root(struct inode *inode)
 		MSDOS_I(inode)-&gt;i_start = 0;
 		inode-&gt;i_size = sbi-&gt;dir_entries * sizeof(struct msdos_dir_entry);
 	}
-	inode-&gt;i_blksize = sbi-&gt;cluster_size;
 	inode-&gt;i_blocks = ((inode-&gt;i_size + (sbi-&gt;cluster_size - 1))
 			   &amp; ~((loff_t)sbi-&gt;cluster_size - 1)) &gt;&gt; 9;
 	MSDOS_I(inode)-&gt;i_logstart = 0;
diff --git a/fs/freevxfs/vxfs_inode.c b/fs/freevxfs/vxfs_inode.c
index 32a82ed108e4..4786d51ad3bd 100644
--- a/fs/freevxfs/vxfs_inode.c
+++ b/fs/freevxfs/vxfs_inode.c
@@ -239,7 +239,6 @@ vxfs_iinit(struct inode *ip, struct vxfs_inode_info *vip)
 	ip-&gt;i_ctime.tv_nsec = 0;
 	ip-&gt;i_mtime.tv_nsec = 0;
 
-	ip-&gt;i_blksize = PAGE_SIZE;
 	ip-&gt;i_blocks = vip-&gt;vii_blocks;
 	ip-&gt;i_generation = vip-&gt;vii_gen;
 
diff --git a/fs/fuse/inode.c b/fs/fuse/inode.c
index 7d25092262ae..cb7cadb0b790 100644
--- a/fs/fuse/inode.c
+++ b/fs/fuse/inode.c
@@ -118,7 +118,6 @@ void fuse_change_attributes(struct inode *inode, struct fuse_attr *attr)
 	inode-&gt;i_uid     = attr-&gt;uid;
 	inode-&gt;i_gid     = attr-&gt;gid;
 	i_size_write(inode, attr-&gt;size);
-	inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 	inode-&gt;i_blocks  = attr-&gt;blocks;
 	inode-&gt;i_atime.tv_sec   = attr-&gt;atime;
 	inode-&gt;i_atime.tv_nsec  = attr-&gt;atimensec;
diff --git a/fs/hfs/inode.c b/fs/hfs/inode.c
index 315cf44a90b2..d05641c35fc9 100644
--- a/fs/hfs/inode.c
+++ b/fs/hfs/inode.c
@@ -154,7 +154,6 @@ struct inode *hfs_new_inode(struct inode *dir, struct qstr *name, int mode)
 	inode-&gt;i_gid = current-&gt;fsgid;
 	inode-&gt;i_nlink = 1;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME_SEC;
-	inode-&gt;i_blksize = HFS_SB(sb)-&gt;alloc_blksz;
 	HFS_I(inode)-&gt;flags = 0;
 	HFS_I(inode)-&gt;rsrc_inode = NULL;
 	HFS_I(inode)-&gt;fs_blocks = 0;
@@ -284,7 +283,6 @@ static int hfs_read_inode(struct inode *inode, void *data)
 	inode-&gt;i_uid = hsb-&gt;s_uid;
 	inode-&gt;i_gid = hsb-&gt;s_gid;
 	inode-&gt;i_nlink = 1;
-	inode-&gt;i_blksize = HFS_SB(inode-&gt;i_sb)-&gt;alloc_blksz;
 
 	if (idata-&gt;key)
 		HFS_I(inode)-&gt;cat_key = *idata-&gt;key;
diff --git a/fs/hfsplus/inode.c b/fs/hfsplus/inode.c
index 924ecdef8091..0eb1a6092668 100644
--- a/fs/hfsplus/inode.c
+++ b/fs/hfsplus/inode.c
@@ -304,7 +304,6 @@ struct inode *hfsplus_new_inode(struct super_block *sb, int mode)
 	inode-&gt;i_gid = current-&gt;fsgid;
 	inode-&gt;i_nlink = 1;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME_SEC;
-	inode-&gt;i_blksize = HFSPLUS_SB(sb).alloc_blksz;
 	INIT_LIST_HEAD(&amp;HFSPLUS_I(inode).open_dir_list);
 	init_MUTEX(&amp;HFSPLUS_I(inode).extents_lock);
 	atomic_set(&amp;HFSPLUS_I(inode).opencnt, 0);
@@ -407,7 +406,6 @@ int hfsplus_cat_read_inode(struct inode *inode, struct hfs_find_data *fd)
 	type = hfs_bnode_read_u16(fd-&gt;bnode, fd-&gt;entryoffset);
 
 	HFSPLUS_I(inode).dev = 0;
-	inode-&gt;i_blksize = HFSPLUS_SB(inode-&gt;i_sb).alloc_blksz;
 	if (type == HFSPLUS_FOLDER) {
 		struct hfsplus_cat_folder *folder = &amp;entry.folder;
 
diff --git a/fs/hostfs/hostfs_kern.c b/fs/hostfs/hostfs_kern.c
index b82e3d9c8790..322e876c35ed 100644
--- a/fs/hostfs/hostfs_kern.c
+++ b/fs/hostfs/hostfs_kern.c
@@ -156,7 +156,6 @@ static int read_name(struct inode *ino, char *name)
 	ino-&gt;i_mode = i_mode;
 	ino-&gt;i_nlink = i_nlink;
 	ino-&gt;i_size = i_size;
-	ino-&gt;i_blksize = i_blksize;
 	ino-&gt;i_blocks = i_blocks;
 	return(0);
 }
diff --git a/fs/hpfs/inode.c b/fs/hpfs/inode.c
index 56f2c338c4d9..bcf6ee36e065 100644
--- a/fs/hpfs/inode.c
+++ b/fs/hpfs/inode.c
@@ -17,7 +17,6 @@ void hpfs_init_inode(struct inode *i)
 	i-&gt;i_gid = hpfs_sb(sb)-&gt;sb_gid;
 	i-&gt;i_mode = hpfs_sb(sb)-&gt;sb_mode;
 	hpfs_inode-&gt;i_conv = hpfs_sb(sb)-&gt;sb_conv;
-	i-&gt;i_blksize = 512;
 	i-&gt;i_size = -1;
 	i-&gt;i_blocks = -1;
 	
diff --git a/fs/hppfs/hppfs_kern.c b/fs/hppfs/hppfs_kern.c
index 3a9bdf58166f..dcb6d2e988b8 100644
--- a/fs/hppfs/hppfs_kern.c
+++ b/fs/hppfs/hppfs_kern.c
@@ -152,7 +152,6 @@ static void hppfs_read_inode(struct inode *ino)
 	ino-&gt;i_mode = proc_ino-&gt;i_mode;
 	ino-&gt;i_nlink = proc_ino-&gt;i_nlink;
 	ino-&gt;i_size = proc_ino-&gt;i_size;
-	ino-&gt;i_blksize = proc_ino-&gt;i_blksize;
 	ino-&gt;i_blocks = proc_ino-&gt;i_blocks;
 }
 
diff --git a/fs/hugetlbfs/inode.c b/fs/hugetlbfs/inode.c
index c3920c96dadf..e025a31b4c64 100644
--- a/fs/hugetlbfs/inode.c
+++ b/fs/hugetlbfs/inode.c
@@ -357,7 +357,6 @@ static struct inode *hugetlbfs_get_inode(struct super_block *sb, uid_t uid,
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = uid;
 		inode-&gt;i_gid = gid;
-		inode-&gt;i_blksize = HPAGE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_mapping-&gt;a_ops = &amp;hugetlbfs_aops;
 		inode-&gt;i_mapping-&gt;backing_dev_info =&amp;hugetlbfs_backing_dev_info;
diff --git a/fs/isofs/inode.c b/fs/isofs/inode.c
index 10e47897bac7..4527692f432b 100644
--- a/fs/isofs/inode.c
+++ b/fs/isofs/inode.c
@@ -1235,7 +1235,7 @@ static void isofs_read_inode(struct inode *inode)
 	}
 	inode-&gt;i_uid = sbi-&gt;s_uid;
 	inode-&gt;i_gid = sbi-&gt;s_gid;
-	inode-&gt;i_blocks = inode-&gt;i_blksize = 0;
+	inode-&gt;i_blocks = 0;
 
 	ei-&gt;i_format_parm[0] = 0;
 	ei-&gt;i_format_parm[1] = 0;
@@ -1291,7 +1291,6 @@ static void isofs_read_inode(struct inode *inode)
 			      isonum_711 (de-&gt;ext_attr_length));
 
 	/* Set the number of blocks for stat() - should be done before RR */
-	inode-&gt;i_blksize = PAGE_CACHE_SIZE; /* For stat() only */
 	inode-&gt;i_blocks  = (inode-&gt;i_size + 511) &gt;&gt; 9;
 
 	/*
diff --git a/fs/jffs/inode-v23.c b/fs/jffs/inode-v23.c
index 7358ef87f16b..f5cf9c93e243 100644
--- a/fs/jffs/inode-v23.c
+++ b/fs/jffs/inode-v23.c
@@ -364,7 +364,6 @@ jffs_new_inode(const struct inode * dir, struct jffs_raw_inode *raw_inode,
 	inode-&gt;i_ctime.tv_nsec = 0;
 	inode-&gt;i_mtime.tv_nsec = 0;
 	inode-&gt;i_atime.tv_nsec = 0;
-	inode-&gt;i_blksize = PAGE_SIZE;
 	inode-&gt;i_blocks = (inode-&gt;i_size + 511) &gt;&gt; 9;
 
 	f = jffs_find_file(c, raw_inode-&gt;ino);
@@ -1706,7 +1705,6 @@ jffs_read_inode(struct inode *inode)
 	inode-&gt;i_mtime.tv_nsec = 
 	inode-&gt;i_ctime.tv_nsec = 0;
 
-	inode-&gt;i_blksize = PAGE_SIZE;
 	inode-&gt;i_blocks = (inode-&gt;i_size + 511) &gt;&gt; 9;
 	if (S_ISREG(inode-&gt;i_mode)) {
 		inode-&gt;i_op = &amp;jffs_file_inode_operations;
diff --git a/fs/jffs2/fs.c b/fs/jffs2/fs.c
index 4780f82825d6..72d9909d95ff 100644
--- a/fs/jffs2/fs.c
+++ b/fs/jffs2/fs.c
@@ -263,7 +263,6 @@ void jffs2_read_inode (struct inode *inode)
 
 	inode-&gt;i_nlink = f-&gt;inocache-&gt;nlink;
 
-	inode-&gt;i_blksize = PAGE_SIZE;
 	inode-&gt;i_blocks = (inode-&gt;i_size + 511) &gt;&gt; 9;
 
 	switch (inode-&gt;i_mode &amp; S_IFMT) {
@@ -449,7 +448,6 @@ struct inode *jffs2_new_inode (struct inode *dir_i, int mode, struct jffs2_raw_i
 	inode-&gt;i_atime = inode-&gt;i_ctime = inode-&gt;i_mtime = CURRENT_TIME_SEC;
 	ri-&gt;atime = ri-&gt;mtime = ri-&gt;ctime = cpu_to_je32(I_SEC(inode-&gt;i_mtime));
 
-	inode-&gt;i_blksize = PAGE_SIZE;
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_size = 0;
 
diff --git a/fs/jfs/jfs_extent.c b/fs/jfs/jfs_extent.c
index 4d52593a5fc6..4c74f0944f7e 100644
--- a/fs/jfs/jfs_extent.c
+++ b/fs/jfs/jfs_extent.c
@@ -468,7 +468,7 @@ int extRecord(struct inode *ip, xad_t * xp)
 int extFill(struct inode *ip, xad_t * xp)
 {
 	int rc, nbperpage = JFS_SBI(ip-&gt;i_sb)-&gt;nbperpage;
-	s64 blkno = offsetXAD(xp) &gt;&gt; ip-&gt;i_blksize;
+	s64 blkno = offsetXAD(xp) &gt;&gt; ip-&gt;i_blkbits;
 
 //      assert(ISSPARSE(ip));
 
diff --git a/fs/jfs/jfs_imap.c b/fs/jfs/jfs_imap.c
index ccbe60aff83d..369d7f39c040 100644
--- a/fs/jfs/jfs_imap.c
+++ b/fs/jfs/jfs_imap.c
@@ -3115,7 +3115,6 @@ static int copy_from_dinode(struct dinode * dip, struct inode *ip)
 	ip-&gt;i_mtime.tv_nsec = le32_to_cpu(dip-&gt;di_mtime.tv_nsec);
 	ip-&gt;i_ctime.tv_sec = le32_to_cpu(dip-&gt;di_ctime.tv_sec);
 	ip-&gt;i_ctime.tv_nsec = le32_to_cpu(dip-&gt;di_ctime.tv_nsec);
-	ip-&gt;i_blksize = ip-&gt;i_sb-&gt;s_blocksize;
 	ip-&gt;i_blocks = LBLK2PBLK(ip-&gt;i_sb, le64_to_cpu(dip-&gt;di_nblocks));
 	ip-&gt;i_generation = le32_to_cpu(dip-&gt;di_gen);
 
diff --git a/fs/jfs/jfs_inode.c b/fs/jfs/jfs_inode.c
index 495df402916d..bffaca9ae3a2 100644
--- a/fs/jfs/jfs_inode.c
+++ b/fs/jfs/jfs_inode.c
@@ -115,7 +115,6 @@ struct inode *ialloc(struct inode *parent, umode_t mode)
 	}
 	jfs_inode-&gt;mode2 |= mode;
 
-	inode-&gt;i_blksize = sb-&gt;s_blocksize;
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME;
 	jfs_inode-&gt;otime = inode-&gt;i_ctime.tv_sec;
diff --git a/fs/jfs/jfs_metapage.c b/fs/jfs/jfs_metapage.c
index e1e0a6e6ebdf..f5afc129d6b1 100644
--- a/fs/jfs/jfs_metapage.c
+++ b/fs/jfs/jfs_metapage.c
@@ -257,7 +257,7 @@ static sector_t metapage_get_blocks(struct inode *inode, sector_t lblock,
 	int rc = 0;
 	int xflag;
 	s64 xaddr;
-	sector_t file_blocks = (inode-&gt;i_size + inode-&gt;i_blksize - 1) &gt;&gt;
+	sector_t file_blocks = (inode-&gt;i_size + inode-&gt;i_sb-&gt;s_blocksize - 1) &gt;&gt;
 			       inode-&gt;i_blkbits;
 
 	if (lblock &gt;= file_blocks)
diff --git a/fs/libfs.c b/fs/libfs.c
index 2751793beeaa..8db5afb7b0a7 100644
--- a/fs/libfs.c
+++ b/fs/libfs.c
@@ -383,7 +383,6 @@ int simple_fill_super(struct super_block *s, int magic, struct tree_descr *files
 		return -ENOMEM;
 	inode-&gt;i_mode = S_IFDIR | 0755;
 	inode-&gt;i_uid = inode-&gt;i_gid = 0;
-	inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 	inode-&gt;i_op = &amp;simple_dir_inode_operations;
@@ -405,7 +404,6 @@ int simple_fill_super(struct super_block *s, int magic, struct tree_descr *files
 			goto out;
 		inode-&gt;i_mode = S_IFREG | files-&gt;mode;
 		inode-&gt;i_uid = inode-&gt;i_gid = 0;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 		inode-&gt;i_fop = files-&gt;ops;
diff --git a/fs/minix/bitmap.c b/fs/minix/bitmap.c
index 4a6abc49418e..df6b1075b549 100644
--- a/fs/minix/bitmap.c
+++ b/fs/minix/bitmap.c
@@ -254,7 +254,7 @@ struct inode * minix_new_inode(const struct inode * dir, int * error)
 	inode-&gt;i_gid = (dir-&gt;i_mode &amp; S_ISGID) ? dir-&gt;i_gid : current-&gt;fsgid;
 	inode-&gt;i_ino = j;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME_SEC;
-	inode-&gt;i_blocks = inode-&gt;i_blksize = 0;
+	inode-&gt;i_blocks = 0;
 	memset(&amp;minix_i(inode)-&gt;u, 0, sizeof(minix_i(inode)-&gt;u));
 	insert_inode_hash(inode);
 	mark_inode_dirty(inode);
diff --git a/fs/minix/inode.c b/fs/minix/inode.c
index 826b9d830650..c11a4b9fb863 100644
--- a/fs/minix/inode.c
+++ b/fs/minix/inode.c
@@ -396,7 +396,7 @@ static void V1_minix_read_inode(struct inode * inode)
 	inode-&gt;i_mtime.tv_nsec = 0;
 	inode-&gt;i_atime.tv_nsec = 0;
 	inode-&gt;i_ctime.tv_nsec = 0;
-	inode-&gt;i_blocks = inode-&gt;i_blksize = 0;
+	inode-&gt;i_blocks = 0;
 	for (i = 0; i &lt; 9; i++)
 		minix_inode-&gt;u.i1_data[i] = raw_inode-&gt;i_zone[i];
 	minix_set_inode(inode, old_decode_dev(raw_inode-&gt;i_zone[0]));
@@ -429,7 +429,7 @@ static void V2_minix_read_inode(struct inode * inode)
 	inode-&gt;i_mtime.tv_nsec = 0;
 	inode-&gt;i_atime.tv_nsec = 0;
 	inode-&gt;i_ctime.tv_nsec = 0;
-	inode-&gt;i_blocks = inode-&gt;i_blksize = 0;
+	inode-&gt;i_blocks = 0;
 	for (i = 0; i &lt; 10; i++)
 		minix_inode-&gt;u.i2_data[i] = raw_inode-&gt;i_zone[i];
 	minix_set_inode(inode, old_decode_dev(raw_inode-&gt;i_zone[0]));
diff --git a/fs/ncpfs/inode.c b/fs/ncpfs/inode.c
index 8244710e97dd..42e3bef270c9 100644
--- a/fs/ncpfs/inode.c
+++ b/fs/ncpfs/inode.c
@@ -223,7 +223,6 @@ static void ncp_set_attr(struct inode *inode, struct ncp_entry_info *nwinfo)
 	inode-&gt;i_nlink = 1;
 	inode-&gt;i_uid = server-&gt;m.uid;
 	inode-&gt;i_gid = server-&gt;m.gid;
-	inode-&gt;i_blksize = NCP_BLOCK_SIZE;
 
 	ncp_update_dates(inode, &amp;nwinfo-&gt;i);
 	ncp_update_inode(inode, nwinfo);
diff --git a/fs/nfs/inode.c b/fs/nfs/inode.c
index 931f52a19579..bc9376ca86cd 100644
--- a/fs/nfs/inode.c
+++ b/fs/nfs/inode.c
@@ -277,10 +277,8 @@ nfs_fhget(struct super_block *sb, struct nfs_fh *fh, struct nfs_fattr *fattr)
 			 * report the blocks in 512byte units
 			 */
 			inode-&gt;i_blocks = nfs_calc_block_size(fattr-&gt;du.nfs3.used);
-			inode-&gt;i_blksize = inode-&gt;i_sb-&gt;s_blocksize;
 		} else {
 			inode-&gt;i_blocks = fattr-&gt;du.nfs2.blocks;
-			inode-&gt;i_blksize = fattr-&gt;du.nfs2.blocksize;
 		}
 		nfsi-&gt;attrtimeo = NFS_MINATTRTIMEO(inode);
 		nfsi-&gt;attrtimeo_timestamp = jiffies;
@@ -969,10 +967,8 @@ static int nfs_update_inode(struct inode *inode, struct nfs_fattr *fattr)
 		 * report the blocks in 512byte units
 		 */
 		inode-&gt;i_blocks = nfs_calc_block_size(fattr-&gt;du.nfs3.used);
-		inode-&gt;i_blksize = inode-&gt;i_sb-&gt;s_blocksize;
  	} else {
  		inode-&gt;i_blocks = fattr-&gt;du.nfs2.blocks;
- 		inode-&gt;i_blksize = fattr-&gt;du.nfs2.blocksize;
  	}
 
 	if ((fattr-&gt;valid &amp; NFS_ATTR_FATTR_V4) != 0 &amp;&amp;
diff --git a/fs/ntfs/inode.c b/fs/ntfs/inode.c
index 31852121b3f5..933dbd89c2a4 100644
--- a/fs/ntfs/inode.c
+++ b/fs/ntfs/inode.c
@@ -556,8 +556,6 @@ static int ntfs_read_locked_inode(struct inode *vi)
 
 	/* Setup the generic vfs inode parts now. */
 
-	/* This is the optimal IO size (for stat), not the fs block size. */
-	vi-&gt;i_blksize = PAGE_CACHE_SIZE;
 	/*
 	 * This is for checking whether an inode has changed w.r.t. a file so
 	 * that the file can be updated if necessary (compare with f_version).
@@ -1234,7 +1232,6 @@ static int ntfs_read_locked_attr_inode(struct inode *base_vi, struct inode *vi)
 	base_ni = NTFS_I(base_vi);
 
 	/* Just mirror the values from the base inode. */
-	vi-&gt;i_blksize	= base_vi-&gt;i_blksize;
 	vi-&gt;i_version	= base_vi-&gt;i_version;
 	vi-&gt;i_uid	= base_vi-&gt;i_uid;
 	vi-&gt;i_gid	= base_vi-&gt;i_gid;
@@ -1504,7 +1501,6 @@ static int ntfs_read_locked_index_inode(struct inode *base_vi, struct inode *vi)
 	ni	= NTFS_I(vi);
 	base_ni = NTFS_I(base_vi);
 	/* Just mirror the values from the base inode. */
-	vi-&gt;i_blksize	= base_vi-&gt;i_blksize;
 	vi-&gt;i_version	= base_vi-&gt;i_version;
 	vi-&gt;i_uid	= base_vi-&gt;i_uid;
 	vi-&gt;i_gid	= base_vi-&gt;i_gid;
diff --git a/fs/ntfs/mft.c b/fs/ntfs/mft.c
index 578fb3d5e803..584260fd6848 100644
--- a/fs/ntfs/mft.c
+++ b/fs/ntfs/mft.c
@@ -2637,11 +2637,6 @@ ntfs_inode *ntfs_mft_record_alloc(ntfs_volume *vol, const int mode,
 			goto undo_mftbmp_alloc;
 		}
 		vi-&gt;i_ino = bit;
-		/*
-		 * This is the optimal IO size (for stat), not the fs block
-		 * size.
-		 */
-		vi-&gt;i_blksize = PAGE_CACHE_SIZE;
 		/*
 		 * This is for checking whether an inode has changed w.r.t. a
 		 * file so that the file can be updated if necessary (compare
diff --git a/fs/ocfs2/dlm/dlmfs.c b/fs/ocfs2/dlm/dlmfs.c
index 0ff0898a0b9c..0368c6402182 100644
--- a/fs/ocfs2/dlm/dlmfs.c
+++ b/fs/ocfs2/dlm/dlmfs.c
@@ -335,7 +335,6 @@ static struct inode *dlmfs_get_root_inode(struct super_block *sb)
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = current-&gt;fsuid;
 		inode-&gt;i_gid = current-&gt;fsgid;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_mapping-&gt;backing_dev_info = &amp;dlmfs_backing_dev_info;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
@@ -362,7 +361,6 @@ static struct inode *dlmfs_get_inode(struct inode *parent,
 	inode-&gt;i_mode = mode;
 	inode-&gt;i_uid = current-&gt;fsuid;
 	inode-&gt;i_gid = current-&gt;fsgid;
-	inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_mapping-&gt;backing_dev_info = &amp;dlmfs_backing_dev_info;
 	inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
diff --git a/fs/ocfs2/inode.c b/fs/ocfs2/inode.c
index 69d3db569166..16e8e74dc966 100644
--- a/fs/ocfs2/inode.c
+++ b/fs/ocfs2/inode.c
@@ -269,7 +269,6 @@ int ocfs2_populate_inode(struct inode *inode, struct ocfs2_dinode *fe,
 	inode-&gt;i_mode = le16_to_cpu(fe-&gt;i_mode);
 	inode-&gt;i_uid = le32_to_cpu(fe-&gt;i_uid);
 	inode-&gt;i_gid = le32_to_cpu(fe-&gt;i_gid);
-	inode-&gt;i_blksize = (u32)osb-&gt;s_clustersize;
 
 	/* Fast symlinks will have i_size but no allocated clusters. */
 	if (S_ISLNK(inode-&gt;i_mode) &amp;&amp; !fe-&gt;i_clusters)
@@ -1258,8 +1257,6 @@ int ocfs2_mark_inode_dirty(struct ocfs2_journal_handle *handle,
 void ocfs2_refresh_inode(struct inode *inode,
 			 struct ocfs2_dinode *fe)
 {
-	struct ocfs2_super *osb = OCFS2_SB(inode-&gt;i_sb);
-
 	spin_lock(&amp;OCFS2_I(inode)-&gt;ip_lock);
 
 	OCFS2_I(inode)-&gt;ip_clusters = le32_to_cpu(fe-&gt;i_clusters);
@@ -1270,7 +1267,6 @@ void ocfs2_refresh_inode(struct inode *inode,
 	inode-&gt;i_uid = le32_to_cpu(fe-&gt;i_uid);
 	inode-&gt;i_gid = le32_to_cpu(fe-&gt;i_gid);
 	inode-&gt;i_mode = le16_to_cpu(fe-&gt;i_mode);
-	inode-&gt;i_blksize = (u32) osb-&gt;s_clustersize;
 	if (S_ISLNK(inode-&gt;i_mode) &amp;&amp; le32_to_cpu(fe-&gt;i_clusters) == 0)
 		inode-&gt;i_blocks = 0;
 	else
diff --git a/fs/pipe.c b/fs/pipe.c
index 20352573e025..f3b6f71e9d0b 100644
--- a/fs/pipe.c
+++ b/fs/pipe.c
@@ -879,7 +879,6 @@ static struct inode * get_pipe_inode(void)
 	inode-&gt;i_uid = current-&gt;fsuid;
 	inode-&gt;i_gid = current-&gt;fsgid;
 	inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
-	inode-&gt;i_blksize = PAGE_SIZE;
 
 	return inode;
 
diff --git a/fs/qnx4/inode.c b/fs/qnx4/inode.c
index fddbd61c68d0..5a41db2a218d 100644
--- a/fs/qnx4/inode.c
+++ b/fs/qnx4/inode.c
@@ -496,7 +496,6 @@ static void qnx4_read_inode(struct inode *inode)
 	inode-&gt;i_ctime.tv_sec   = le32_to_cpu(raw_inode-&gt;di_ctime);
 	inode-&gt;i_ctime.tv_nsec = 0;
 	inode-&gt;i_blocks  = le32_to_cpu(raw_inode-&gt;di_first_xtnt.xtnt_size);
-	inode-&gt;i_blksize = QNX4_DIR_ENTRY_SIZE;
 
 	memcpy(qnx4_inode, raw_inode, QNX4_DIR_ENTRY_SIZE);
 	if (S_ISREG(inode-&gt;i_mode)) {
diff --git a/fs/ramfs/inode.c b/fs/ramfs/inode.c
index b9677335cc8d..bc0e51662424 100644
--- a/fs/ramfs/inode.c
+++ b/fs/ramfs/inode.c
@@ -58,7 +58,6 @@ struct inode *ramfs_get_inode(struct super_block *sb, int mode, dev_t dev)
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = current-&gt;fsuid;
 		inode-&gt;i_gid = current-&gt;fsgid;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_mapping-&gt;a_ops = &amp;ramfs_aops;
 		inode-&gt;i_mapping-&gt;backing_dev_info = &amp;ramfs_backing_dev_info;
diff --git a/fs/reiserfs/inode.c b/fs/reiserfs/inode.c
index 52f1e2136546..8810fda0da46 100644
--- a/fs/reiserfs/inode.c
+++ b/fs/reiserfs/inode.c
@@ -17,8 +17,6 @@
 #include &lt;linux/writeback.h&gt;
 #include &lt;linux/quotaops.h&gt;
 
-extern int reiserfs_default_io_size;	/* default io size devuned in super.c */
-
 static int reiserfs_commit_write(struct file *f, struct page *page,
 				 unsigned from, unsigned to);
 static int reiserfs_prepare_write(struct file *f, struct page *page,
@@ -1122,7 +1120,6 @@ static void init_inode(struct inode *inode, struct path *path)
 	ih = PATH_PITEM_HEAD(path);
 
 	copy_key(INODE_PKEY(inode), &amp;(ih-&gt;ih_key));
-	inode-&gt;i_blksize = reiserfs_default_io_size;
 
 	INIT_LIST_HEAD(&amp;(REISERFS_I(inode)-&gt;i_prealloc_list));
 	REISERFS_I(inode)-&gt;i_flags = 0;
@@ -1877,7 +1874,6 @@ int reiserfs_new_inode(struct reiserfs_transaction_handle *th,
 	}
 	// these do not go to on-disk stat data
 	inode-&gt;i_ino = le32_to_cpu(ih.ih_key.k_objectid);
-	inode-&gt;i_blksize = reiserfs_default_io_size;
 
 	// store in in-core inode the key of stat data and version all
 	// object items will have (directory items will have old offset
diff --git a/fs/smbfs/inode.c b/fs/smbfs/inode.c
index 92cf60aa6121..2c122ee83adb 100644
--- a/fs/smbfs/inode.c
+++ b/fs/smbfs/inode.c
@@ -166,7 +166,6 @@ smb_get_inode_attr(struct inode *inode, struct smb_fattr *fattr)
 	fattr-&gt;f_mtime	= inode-&gt;i_mtime;
 	fattr-&gt;f_ctime	= inode-&gt;i_ctime;
 	fattr-&gt;f_atime	= inode-&gt;i_atime;
-	fattr-&gt;f_blksize= inode-&gt;i_blksize;
 	fattr-&gt;f_blocks	= inode-&gt;i_blocks;
 
 	fattr-&gt;attr	= SMB_I(inode)-&gt;attr;
@@ -200,7 +199,6 @@ smb_set_inode_attr(struct inode *inode, struct smb_fattr *fattr)
 	inode-&gt;i_uid	= fattr-&gt;f_uid;
 	inode-&gt;i_gid	= fattr-&gt;f_gid;
 	inode-&gt;i_ctime	= fattr-&gt;f_ctime;
-	inode-&gt;i_blksize= fattr-&gt;f_blksize;
 	inode-&gt;i_blocks = fattr-&gt;f_blocks;
 	inode-&gt;i_size	= fattr-&gt;f_size;
 	inode-&gt;i_mtime	= fattr-&gt;f_mtime;
diff --git a/fs/smbfs/proc.c b/fs/smbfs/proc.c
index c3495059889d..40e174db9872 100644
--- a/fs/smbfs/proc.c
+++ b/fs/smbfs/proc.c
@@ -1826,7 +1826,6 @@ smb_init_dirent(struct smb_sb_info *server, struct smb_fattr *fattr)
 	fattr-&gt;f_nlink = 1;
 	fattr-&gt;f_uid = server-&gt;mnt-&gt;uid;
 	fattr-&gt;f_gid = server-&gt;mnt-&gt;gid;
-	fattr-&gt;f_blksize = SMB_ST_BLKSIZE;
 	fattr-&gt;f_unix = 0;
 }
 
diff --git a/fs/stat.c b/fs/stat.c
index 3a44dcf97da2..60a31d5e5966 100644
--- a/fs/stat.c
+++ b/fs/stat.c
@@ -14,6 +14,7 @@
 #include &lt;linux/namei.h&gt;
 #include &lt;linux/security.h&gt;
 #include &lt;linux/syscalls.h&gt;
+#include &lt;linux/pagemap.h&gt;
 
 #include &lt;asm/uaccess.h&gt;
 #include &lt;asm/unistd.h&gt;
@@ -32,7 +33,7 @@ void generic_fillattr(struct inode *inode, struct kstat *stat)
 	stat-&gt;ctime = inode-&gt;i_ctime;
 	stat-&gt;size = i_size_read(inode);
 	stat-&gt;blocks = inode-&gt;i_blocks;
-	stat-&gt;blksize = inode-&gt;i_blksize;
+	stat-&gt;blksize = (1 &lt;&lt; inode-&gt;i_blkbits);
 }
 
 EXPORT_SYMBOL(generic_fillattr);
diff --git a/fs/sysfs/inode.c b/fs/sysfs/inode.c
index fd7cd5f843d2..e79e38d52c00 100644
--- a/fs/sysfs/inode.c
+++ b/fs/sysfs/inode.c
@@ -125,7 +125,6 @@ struct inode * sysfs_new_inode(mode_t mode, struct sysfs_dirent * sd)
 {
 	struct inode * inode = new_inode(sysfs_sb);
 	if (inode) {
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_mapping-&gt;a_ops = &amp;sysfs_aops;
 		inode-&gt;i_mapping-&gt;backing_dev_info = &amp;sysfs_backing_dev_info;
diff --git a/fs/sysv/ialloc.c b/fs/sysv/ialloc.c
index 9b585d1081c0..115ab0d6f4bc 100644
--- a/fs/sysv/ialloc.c
+++ b/fs/sysv/ialloc.c
@@ -170,7 +170,7 @@ struct inode * sysv_new_inode(const struct inode * dir, mode_t mode)
 	inode-&gt;i_uid = current-&gt;fsuid;
 	inode-&gt;i_ino = fs16_to_cpu(sbi, ino);
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME_SEC;
-	inode-&gt;i_blocks = inode-&gt;i_blksize = 0;
+	inode-&gt;i_blocks = 0;
 	memset(SYSV_I(inode)-&gt;i_data, 0, sizeof(SYSV_I(inode)-&gt;i_data));
 	SYSV_I(inode)-&gt;i_dir_start_lookup = 0;
 	insert_inode_hash(inode);
diff --git a/fs/sysv/inode.c b/fs/sysv/inode.c
index 58b2d22142ba..d63c5e48b050 100644
--- a/fs/sysv/inode.c
+++ b/fs/sysv/inode.c
@@ -201,7 +201,7 @@ static void sysv_read_inode(struct inode *inode)
 	inode-&gt;i_ctime.tv_nsec = 0;
 	inode-&gt;i_atime.tv_nsec = 0;
 	inode-&gt;i_mtime.tv_nsec = 0;
-	inode-&gt;i_blocks = inode-&gt;i_blksize = 0;
+	inode-&gt;i_blocks = 0;
 
 	si = SYSV_I(inode);
 	for (block = 0; block &lt; 10+1+1+1; block++)
diff --git a/fs/udf/ialloc.c b/fs/udf/ialloc.c
index d1d38238ce65..8206983f2ebf 100644
--- a/fs/udf/ialloc.c
+++ b/fs/udf/ialloc.c
@@ -121,7 +121,6 @@ struct inode * udf_new_inode (struct inode *dir, int mode, int * err)
 	UDF_I_LOCATION(inode).logicalBlockNum = block;
 	UDF_I_LOCATION(inode).partitionReferenceNum = UDF_I_LOCATION(dir).partitionReferenceNum;
 	inode-&gt;i_ino = udf_get_lb_pblock(sb, UDF_I_LOCATION(inode), 0);
-	inode-&gt;i_blksize = PAGE_SIZE;
 	inode-&gt;i_blocks = 0;
 	UDF_I_LENEATTR(inode) = 0;
 	UDF_I_LENALLOC(inode) = 0;
diff --git a/fs/udf/inode.c b/fs/udf/inode.c
index 605f5111b6d8..b223b32db991 100644
--- a/fs/udf/inode.c
+++ b/fs/udf/inode.c
@@ -916,8 +916,6 @@ __udf_read_inode(struct inode *inode)
 	 *      i_nlink = 1
 	 *      i_op = NULL;
 	 */
-	inode-&gt;i_blksize = PAGE_SIZE;
-
 	bh = udf_read_ptagged(inode-&gt;i_sb, UDF_I_LOCATION(inode), 0, &amp;ident);
 
 	if (!bh)
diff --git a/fs/ufs/ialloc.c b/fs/ufs/ialloc.c
index 9501dcd3b213..2ad1259c6eca 100644
--- a/fs/ufs/ialloc.c
+++ b/fs/ufs/ialloc.c
@@ -255,7 +255,6 @@ struct inode * ufs_new_inode(struct inode * dir, int mode)
 		inode-&gt;i_gid = current-&gt;fsgid;
 
 	inode-&gt;i_ino = cg * uspi-&gt;s_ipg + bit;
-	inode-&gt;i_blksize = PAGE_SIZE;	/* This is the optimal IO size (for stat), not the fs block size */
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME_SEC;
 	ufsi-&gt;i_flags = UFS_I(dir)-&gt;i_flags;
diff --git a/fs/ufs/inode.c b/fs/ufs/inode.c
index 30c6e8a9446c..ee1eaa6f4ec2 100644
--- a/fs/ufs/inode.c
+++ b/fs/ufs/inode.c
@@ -741,7 +741,6 @@ void ufs_read_inode(struct inode * inode)
 		ufs1_read_inode(inode, ufs_inode + ufs_inotofsbo(inode-&gt;i_ino));
 	}
 
-	inode-&gt;i_blksize = PAGE_SIZE;/*This is the optimal IO size (for stat)*/
 	inode-&gt;i_version++;
 	ufsi-&gt;i_lastfrag =
 		(inode-&gt;i_size + uspi-&gt;s_fsize - 1) &gt;&gt; uspi-&gt;s_fshift;
diff --git a/fs/xfs/linux-2.6/xfs_super.c b/fs/xfs/linux-2.6/xfs_super.c
index 4754f342a5d3..9df9ed37d219 100644
--- a/fs/xfs/linux-2.6/xfs_super.c
+++ b/fs/xfs/linux-2.6/xfs_super.c
@@ -171,7 +171,6 @@ xfs_revalidate_inode(
 		break;
 	}
 
-	inode-&gt;i_blksize = xfs_preferred_iosize(mp);
 	inode-&gt;i_generation = ip-&gt;i_d.di_gen;
 	i_size_write(inode, ip-&gt;i_d.di_size);
 	inode-&gt;i_blocks =
diff --git a/fs/xfs/linux-2.6/xfs_vnode.c b/fs/xfs/linux-2.6/xfs_vnode.c
index 6628d96b6fd6..553fa731ade5 100644
--- a/fs/xfs/linux-2.6/xfs_vnode.c
+++ b/fs/xfs/linux-2.6/xfs_vnode.c
@@ -122,7 +122,6 @@ vn_revalidate_core(
 	inode-&gt;i_blocks	    = vap-&gt;va_nblocks;
 	inode-&gt;i_mtime	    = vap-&gt;va_mtime;
 	inode-&gt;i_ctime	    = vap-&gt;va_ctime;
-	inode-&gt;i_blksize    = vap-&gt;va_blocksize;
 	if (vap-&gt;va_xflags &amp; XFS_XFLAG_IMMUTABLE)
 		inode-&gt;i_flags |= S_IMMUTABLE;
 	else
diff --git a/include/linux/fs.h b/include/linux/fs.h
index 192e69bb55b5..8f74dfbb2edd 100644
--- a/include/linux/fs.h
+++ b/include/linux/fs.h
@@ -512,7 +512,6 @@ struct inode {
 	struct timespec		i_mtime;
 	struct timespec		i_ctime;
 	unsigned int		i_blkbits;
-	unsigned long		i_blksize;
 	unsigned long		i_version;
 	blkcnt_t		i_blocks;
 	unsigned short          i_bytes;
diff --git a/include/linux/nfsd/nfsfh.h b/include/linux/nfsd/nfsfh.h
index f9edcd2ff3c8..31a3cb617ce0 100644
--- a/include/linux/nfsd/nfsfh.h
+++ b/include/linux/nfsd/nfsfh.h
@@ -269,14 +269,8 @@ fill_post_wcc(struct svc_fh *fhp)
 	fhp-&gt;fh_post_uid	= inode-&gt;i_uid;
 	fhp-&gt;fh_post_gid	= inode-&gt;i_gid;
 	fhp-&gt;fh_post_size       = inode-&gt;i_size;
-	if (inode-&gt;i_blksize) {
-		fhp-&gt;fh_post_blksize    = inode-&gt;i_blksize;
-		fhp-&gt;fh_post_blocks     = inode-&gt;i_blocks;
-	} else {
-		fhp-&gt;fh_post_blksize    = BLOCK_SIZE;
-		/* how much do we care for accuracy with MinixFS? */
-		fhp-&gt;fh_post_blocks     = (inode-&gt;i_size+511) &gt;&gt; 9;
-	}
+	fhp-&gt;fh_post_blksize    = BLOCK_SIZE;
+	fhp-&gt;fh_post_blocks     = inode-&gt;i_blocks;
 	fhp-&gt;fh_post_rdev[0]    = htonl((u32)imajor(inode));
 	fhp-&gt;fh_post_rdev[1]    = htonl((u32)iminor(inode));
 	fhp-&gt;fh_post_atime      = inode-&gt;i_atime;
diff --git a/include/linux/smb.h b/include/linux/smb.h
index 6df3b1501559..f098dff93f6b 100644
--- a/include/linux/smb.h
+++ b/include/linux/smb.h
@@ -89,7 +89,6 @@ struct smb_fattr {
 	struct timespec	f_atime;
 	struct timespec f_mtime;
 	struct timespec f_ctime;
-	unsigned long	f_blksize;
 	unsigned long	f_blocks;
 	int		f_unix;
 };
diff --git a/ipc/mqueue.c b/ipc/mqueue.c
index f8381f0660b2..840f8a6fb85f 100644
--- a/ipc/mqueue.c
+++ b/ipc/mqueue.c
@@ -115,7 +115,6 @@ static struct inode *mqueue_get_inode(struct super_block *sb, int mode,
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = current-&gt;fsuid;
 		inode-&gt;i_gid = current-&gt;fsgid;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_mtime = inode-&gt;i_ctime = inode-&gt;i_atime =
 				CURRENT_TIME;
diff --git a/kernel/cpuset.c b/kernel/cpuset.c
index cff41511269f..1b32c2c04c15 100644
--- a/kernel/cpuset.c
+++ b/kernel/cpuset.c
@@ -289,7 +289,6 @@ static struct inode *cpuset_new_inode(mode_t mode)
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = current-&gt;fsuid;
 		inode-&gt;i_gid = current-&gt;fsgid;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 		inode-&gt;i_mapping-&gt;backing_dev_info = &amp;cpuset_backing_dev_info;
diff --git a/mm/shmem.c b/mm/shmem.c
index 0a8e29cf87e0..eda907c3a86a 100644
--- a/mm/shmem.c
+++ b/mm/shmem.c
@@ -1351,7 +1351,6 @@ shmem_get_inode(struct super_block *sb, int mode, dev_t dev)
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = current-&gt;fsuid;
 		inode-&gt;i_gid = current-&gt;fsgid;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_mapping-&gt;a_ops = &amp;shmem_aops;
 		inode-&gt;i_mapping-&gt;backing_dev_info = &amp;shmem_backing_dev_info;
diff --git a/net/sunrpc/rpc_pipe.c b/net/sunrpc/rpc_pipe.c
index f65bea74734d..700c6e061a04 100644
--- a/net/sunrpc/rpc_pipe.c
+++ b/net/sunrpc/rpc_pipe.c
@@ -488,7 +488,6 @@ rpc_get_inode(struct super_block *sb, int mode)
 		return NULL;
 	inode-&gt;i_mode = mode;
 	inode-&gt;i_uid = inode-&gt;i_gid = 0;
-	inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 	switch(mode &amp; S_IFMT) {
diff --git a/security/inode.c b/security/inode.c
index 176aacea8ca4..49ee51529396 100644
--- a/security/inode.c
+++ b/security/inode.c
@@ -64,7 +64,6 @@ static struct inode *get_inode(struct super_block *sb, int mode, dev_t dev)
 		inode-&gt;i_mode = mode;
 		inode-&gt;i_uid = 0;
 		inode-&gt;i_gid = 0;
-		inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
 		switch (mode &amp; S_IFMT) {
diff --git a/security/selinux/selinuxfs.c b/security/selinux/selinuxfs.c
index 00534c302ba2..bab7b386cb8d 100644
--- a/security/selinux/selinuxfs.c
+++ b/security/selinux/selinuxfs.c
@@ -771,7 +771,6 @@ static struct inode *sel_make_inode(struct super_block *sb, int mode)
 	if (ret) {
 		ret-&gt;i_mode = mode;
 		ret-&gt;i_uid = ret-&gt;i_gid = 0;
-		ret-&gt;i_blksize = PAGE_CACHE_SIZE;
 		ret-&gt;i_blocks = 0;
 		ret-&gt;i_atime = ret-&gt;i_mtime = ret-&gt;i_ctime = CURRENT_TIME;
 	}</pre>
    <div class="pagination">
        <a href='1_108.html'>&lt;&lt;Prev</a><a href='1.html'>1</a><a href='1_2.html'>2</a><a href='1_3.html'>3</a><a href='1_4.html'>4</a><a href='1_5.html'>5</a><a href='1_6.html'>6</a><a href='1_7.html'>7</a><a href='1_8.html'>8</a><a href='1_9.html'>9</a><a href='1_10.html'>10</a><a href='1_11.html'>11</a><a href='1_12.html'>12</a><a href='1_13.html'>13</a><a href='1_14.html'>14</a><a href='1_15.html'>15</a><a href='1_16.html'>16</a><a href='1_17.html'>17</a><a href='1_18.html'>18</a><a href='1_19.html'>19</a><a href='1_20.html'>20</a><a href='1_21.html'>21</a><a href='1_22.html'>22</a><a href='1_23.html'>23</a><a href='1_24.html'>24</a><a href='1_25.html'>25</a><a href='1_26.html'>26</a><a href='1_27.html'>27</a><a href='1_28.html'>28</a><a href='1_29.html'>29</a><a href='1_30.html'>30</a><a href='1_31.html'>31</a><a href='1_32.html'>32</a><a href='1_33.html'>33</a><a href='1_34.html'>34</a><a href='1_35.html'>35</a><a href='1_36.html'>36</a><a href='1_37.html'>37</a><a href='1_38.html'>38</a><a href='1_39.html'>39</a><a href='1_40.html'>40</a><a href='1_41.html'>41</a><a href='1_42.html'>42</a><a href='1_43.html'>43</a><a href='1_44.html'>44</a><a href='1_45.html'>45</a><a href='1_46.html'>46</a><a href='1_47.html'>47</a><a href='1_48.html'>48</a><a href='1_49.html'>49</a><a href='1_50.html'>50</a><a href='1_51.html'>51</a><a href='1_52.html'>52</a><a href='1_53.html'>53</a><a href='1_54.html'>54</a><a href='1_55.html'>55</a><a href='1_56.html'>56</a><a href='1_57.html'>57</a><a href='1_58.html'>58</a><a href='1_59.html'>59</a><a href='1_60.html'>60</a><a href='1_61.html'>61</a><a href='1_62.html'>62</a><a href='1_63.html'>63</a><a href='1_64.html'>64</a><a href='1_65.html'>65</a><a href='1_66.html'>66</a><a href='1_67.html'>67</a><a href='1_68.html'>68</a><a href='1_69.html'>69</a><a href='1_70.html'>70</a><a href='1_71.html'>71</a><a href='1_72.html'>72</a><a href='1_73.html'>73</a><a href='1_74.html'>74</a><a href='1_75.html'>75</a><a href='1_76.html'>76</a><a href='1_77.html'>77</a><a href='1_78.html'>78</a><a href='1_79.html'>79</a><a href='1_80.html'>80</a><a href='1_81.html'>81</a><a href='1_82.html'>82</a><a href='1_83.html'>83</a><a href='1_84.html'>84</a><a href='1_85.html'>85</a><a href='1_86.html'>86</a><a href='1_87.html'>87</a><a href='1_88.html'>88</a><a href='1_89.html'>89</a><a href='1_90.html'>90</a><a href='1_91.html'>91</a><a href='1_92.html'>92</a><a href='1_93.html'>93</a><a href='1_94.html'>94</a><a href='1_95.html'>95</a><a href='1_96.html'>96</a><a href='1_97.html'>97</a><a href='1_98.html'>98</a><a href='1_99.html'>99</a><a href='1_100.html'>100</a><a href='1_101.html'>101</a><a href='1_102.html'>102</a><a href='1_103.html'>103</a><a href='1_104.html'>104</a><a href='1_105.html'>105</a><a href='1_106.html'>106</a><a href='1_107.html'>107</a><a href='1_108.html'>108</a><span>[109]</span><a href='1_110.html'>110</a><a href='1_111.html'>111</a><a href='1_112.html'>112</a><a href='1_113.html'>113</a><a href='1_114.html'>114</a><a href='1_115.html'>115</a><a href='1_116.html'>116</a><a href='1_117.html'>117</a><a href='1_118.html'>118</a><a href='1_119.html'>119</a><a href='1_120.html'>120</a><a href='1_121.html'>121</a><a href='1_122.html'>122</a><a href='1_123.html'>123</a><a href='1_124.html'>124</a><a href='1_125.html'>125</a><a href='1_126.html'>126</a><a href='1_127.html'>127</a><a href='1_128.html'>128</a><a href='1_129.html'>129</a><a href='1_130.html'>130</a><a href='1_131.html'>131</a><a href='1_132.html'>132</a><a href='1_133.html'>133</a><a href='1_134.html'>134</a><a href='1_135.html'>135</a><a href='1_136.html'>136</a><a href='1_137.html'>137</a><a href='1_138.html'>138</a><a href='1_139.html'>139</a><a href='1_140.html'>140</a><a href='1_141.html'>141</a><a href='1_142.html'>142</a><a href='1_143.html'>143</a><a href='1_144.html'>144</a><a href='1_145.html'>145</a><a href='1_146.html'>146</a><a href='1_147.html'>147</a><a href='1_148.html'>148</a><a href='1_149.html'>149</a><a href='1_150.html'>150</a><a href='1_151.html'>151</a><a href='1_152.html'>152</a><a href='1_153.html'>153</a><a href='1_154.html'>154</a><a href='1_110.html'>Next&gt;&gt;</a>
    <div>
</body>

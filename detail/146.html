<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Tennessee Technological University</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Tennessee Technological University</h1>
    <div class="pagination">
        <span>[1]</span>
    </div>
    <hr>
    <pre>commit bce7d5e0e1fc0c1f1251b7f21a19cb48207408b6
Author: Jeff Norden &lt;jnorden@math.tntech.edu&gt;
Date:   Tue Sep 4 11:07:20 2007 -0500

    pata_it821x: fix lost interrupt with atapi devices
    
    Fix "lost" interrupt problem when using dma with CD/DVD drives in some
    configurations.  This problem can make installing linux from media
    impossible for distro's that have switched to libata-only configurations.
    
    The simple fix is to eliminate the use of dma for reading drive status, etc,
    by checking the number of bytes to transferred.
    
    This change will only affect the behavior of atapi devices, not disks.
    There is more info at http://bugzilla.redhat.com/show_bug.cgi?id=242229
    This patch is for 2.6.22.1
    
    Signed-off-by: Jeff Norden &lt;jnorden@math.tntech.edu&gt;
    Reviewed-by: Alan Cox &lt;alan@redhat.com&gt;
    Signed-off-by: Jeff Garzik &lt;jeff@garzik.org&gt;

diff --git a/drivers/ata/pata_it821x.c b/drivers/ata/pata_it821x.c
index ed637ae33ece..5d8b91e70ecd 100644
--- a/drivers/ata/pata_it821x.c
+++ b/drivers/ata/pata_it821x.c
@@ -533,6 +533,10 @@ static int it821x_check_atapi_dma(struct ata_queued_cmd *qc)
 	struct ata_port *ap = qc-&gt;ap;
 	struct it821x_dev *itdev = ap-&gt;private_data;
 
+	/* Only use dma for transfers to/from the media. */
+	if (qc-&gt;nbytes &lt; 2048)
+		return -EOPNOTSUPP;
+
 	/* No ATAPI DMA in smart mode */
 	if (itdev-&gt;smart)
 		return -EOPNOTSUPP;</pre>
    <div class="pagination">
        <span>[1]</span>
    <div>
</body>

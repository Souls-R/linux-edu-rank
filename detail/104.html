<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by University of Warsaw</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by University of Warsaw</h1>
    <div class="pagination">
        <span>[1]</span>
    </div>
    <hr>
    <pre>commit 4352b47ab7918108b389a48d2163c9a4c2aaf139
Author: Marek Marczykowski &lt;marmarek@mimuw.edu.pl&gt;
Date:   Tue May 3 12:04:52 2011 -0400

    xen-blkfront: fix data size for xenbus_gather in blkfront_connect
    
    barrier variable is int, not long. This overflow caused another variable
    override: "err" (in PV code) and "binfo" (in xenlinux code -
    drivers/xen/blkfront/blkfront.c). The later caused incorrect device
    flags (RO/removable etc).
    
    Signed-off-by: Marek Marczykowski &lt;marmarek@mimuw.edu.pl&gt;
    Acked-by: Ian Campbell &lt;Ian.Campbell@citrix.com&gt;
    [v1: Changed title]
    Signed-off-by: Konrad Rzeszutek Wilk &lt;konrad.wilk@oracle.com&gt;

diff --git a/drivers/block/xen-blkfront.c b/drivers/block/xen-blkfront.c
index 9cb8668ff5f4..20759817ad57 100644
--- a/drivers/block/xen-blkfront.c
+++ b/drivers/block/xen-blkfront.c
@@ -1141,7 +1141,7 @@ static void blkfront_connect(struct blkfront_info *info)
 	}
 
 	err = xenbus_gather(XBT_NIL, info-&gt;xbdev-&gt;otherend,
-			    "feature-barrier", "%lu", &amp;barrier,
+			    "feature-barrier", "%d", &amp;barrier,
 			    NULL);
 
 	/*</pre><hr><pre>commit 8ec6dba2581754e375be66f7bedd708d856d8b30
Author: Jan Rekorajski &lt;baggins@sith.mimuw.edu.pl&gt;
Date:   Mon Nov 16 11:57:02 2009 +0000

    XFS bug in log recover with quota (bugzilla id 855)
    
    Hi,
    I was hit by a bug in linux 2.6.31 when XFS is not able to recover the
    log after a crash if fs was mounted with quotas. Gory details in XFS
    bugzilla: http://oss.sgi.com/bugzilla/show_bug.cgi?id=855.
    
    It looks like wrong struct is used in buffer length check, and the following
    patch should fix the problem.
    
    xfs_dqblk_t has a size of 104+32 bytes, while xfs_disk_dquot_t is 104 bytes
    long, and this is exactly what I see in system logs - "XFS: dquot too small
    (104) in xlog_recover_do_dquot_trans."
    
    Signed-off-by: Jan Rekorajski &lt;baggins@sith.mimuw.edu.pl&gt;
    Reviewed-by: Christoph Hellwig &lt;hch@lst.de&gt;
    Signed-off-by: Alex Elder &lt;aelder@sgi.com&gt;

diff --git a/fs/xfs/xfs_log_recover.c b/fs/xfs/xfs_log_recover.c
index 1099395d7d6c..fb17f8226b09 100644
--- a/fs/xfs/xfs_log_recover.c
+++ b/fs/xfs/xfs_log_recover.c
@@ -1980,7 +1980,7 @@ xlog_recover_do_reg_buffer(
 					"XFS: NULL dquot in %s.", __func__);
 				goto next;
 			}
-			if (item-&gt;ri_buf[i].i_len &lt; sizeof(xfs_dqblk_t)) {
+			if (item-&gt;ri_buf[i].i_len &lt; sizeof(xfs_disk_dquot_t)) {
 				cmn_err(CE_ALERT,
 					"XFS: dquot too small (%d) in %s.",
 					item-&gt;ri_buf[i].i_len, __func__);
@@ -2635,7 +2635,7 @@ xlog_recover_do_dquot_trans(
 			"XFS: NULL dquot in %s.", __func__);
 		return XFS_ERROR(EIO);
 	}
-	if (item-&gt;ri_buf[1].i_len &lt; sizeof(xfs_dqblk_t)) {
+	if (item-&gt;ri_buf[1].i_len &lt; sizeof(xfs_disk_dquot_t)) {
 		cmn_err(CE_ALERT,
 			"XFS: dquot too small (%d) in %s.",
 			item-&gt;ri_buf[1].i_len, __func__);</pre>
    <div class="pagination">
        <span>[1]</span>
    <div>
</body>

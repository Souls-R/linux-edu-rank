<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by State University of New York at Stony Brook</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by State University of New York at Stony Brook</h1>
    <div class="pagination">
        <a href='9_7.html'>&lt;&lt;Prev</a><a href='9.html'>1</a><a href='9_2.html'>2</a><a href='9_3.html'>3</a><a href='9_4.html'>4</a><a href='9_5.html'>5</a><a href='9_6.html'>6</a><a href='9_7.html'>7</a><span>[8]</span><a href='9_9.html'>9</a><a href='9_10.html'>10</a><a href='9_11.html'>11</a><a href='9_12.html'>12</a><a href='9_13.html'>13</a><a href='9_14.html'>14</a><a href='9_9.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit cc5ef55fd0d81f70b0afc86817aa1d305fd6aeaa
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:59 2006 -0800

    [PATCH] struct path: convert drm
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/drivers/char/drm/drm_ioc32.c b/drivers/char/drm/drm_ioc32.c
index d4f874520082..fafeb34f89d5 100644
--- a/drivers/char/drm/drm_ioc32.c
+++ b/drivers/char/drm/drm_ioc32.c
@@ -102,7 +102,7 @@ static int compat_drm_version(struct file *file, unsigned int cmd,
 			  &amp;version-&gt;desc))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_VERSION, (unsigned long)version);
 	if (err)
 		return err;
@@ -143,7 +143,7 @@ static int compat_drm_getunique(struct file *file, unsigned int cmd,
 			  &amp;u-&gt;unique))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_GET_UNIQUE, (unsigned long)u);
 	if (err)
 		return err;
@@ -172,7 +172,7 @@ static int compat_drm_setunique(struct file *file, unsigned int cmd,
 			  &amp;u-&gt;unique))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_SET_UNIQUE, (unsigned long)u);
 }
 
@@ -203,7 +203,7 @@ static int compat_drm_getmap(struct file *file, unsigned int cmd,
 	if (__put_user(idx, &amp;map-&gt;offset))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_GET_MAP, (unsigned long)map);
 	if (err)
 		return err;
@@ -244,7 +244,7 @@ static int compat_drm_addmap(struct file *file, unsigned int cmd,
 	    || __put_user(m32.flags, &amp;map-&gt;flags))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_ADD_MAP, (unsigned long)map);
 	if (err)
 		return err;
@@ -282,7 +282,7 @@ static int compat_drm_rmmap(struct file *file, unsigned int cmd,
 	if (__put_user((void *)(unsigned long)handle, &amp;map-&gt;handle))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_RM_MAP, (unsigned long)map);
 }
 
@@ -312,7 +312,7 @@ static int compat_drm_getclient(struct file *file, unsigned int cmd,
 	if (__put_user(idx, &amp;client-&gt;idx))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_GET_CLIENT, (unsigned long)client);
 	if (err)
 		return err;
@@ -349,7 +349,7 @@ static int compat_drm_getstats(struct file *file, unsigned int cmd,
 	if (!access_ok(VERIFY_WRITE, stats, sizeof(*stats)))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_GET_STATS, (unsigned long)stats);
 	if (err)
 		return err;
@@ -393,7 +393,7 @@ static int compat_drm_addbufs(struct file *file, unsigned int cmd,
 	    || __put_user(agp_start, &amp;buf-&gt;agp_start))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_ADD_BUFS, (unsigned long)buf);
 	if (err)
 		return err;
@@ -425,7 +425,7 @@ static int compat_drm_markbufs(struct file *file, unsigned int cmd,
 	    || __put_user(b32.high_mark, &amp;buf-&gt;high_mark))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_MARK_BUFS, (unsigned long)buf);
 }
 
@@ -467,7 +467,7 @@ static int compat_drm_infobufs(struct file *file, unsigned int cmd,
 	    || __put_user(list, &amp;request-&gt;list))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_INFO_BUFS, (unsigned long)request);
 	if (err)
 		return err;
@@ -529,7 +529,7 @@ static int compat_drm_mapbufs(struct file *file, unsigned int cmd,
 	    || __put_user(list, &amp;request-&gt;list))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_MAP_BUFS, (unsigned long)request);
 	if (err)
 		return err;
@@ -576,7 +576,7 @@ static int compat_drm_freebufs(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;list))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_FREE_BUFS, (unsigned long)request);
 }
 
@@ -603,7 +603,7 @@ static int compat_drm_setsareactx(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;handle))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_SET_SAREA_CTX, (unsigned long)request);
 }
 
@@ -626,7 +626,7 @@ static int compat_drm_getsareactx(struct file *file, unsigned int cmd,
 	if (__put_user(ctx_id, &amp;request-&gt;ctx_id))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_GET_SAREA_CTX, (unsigned long)request);
 	if (err)
 		return err;
@@ -662,7 +662,7 @@ static int compat_drm_resctx(struct file *file, unsigned int cmd,
 			  &amp;res-&gt;contexts))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_RES_CTX, (unsigned long)res);
 	if (err)
 		return err;
@@ -716,7 +716,7 @@ static int compat_drm_dma(struct file *file, unsigned int cmd,
 			  &amp;d-&gt;request_sizes))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_DMA, (unsigned long)d);
 	if (err)
 		return err;
@@ -749,7 +749,7 @@ static int compat_drm_agp_enable(struct file *file, unsigned int cmd,
 	if (put_user(m32.mode, &amp;mode-&gt;mode))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_AGP_ENABLE, (unsigned long)mode);
 }
 
@@ -779,7 +779,7 @@ static int compat_drm_agp_info(struct file *file, unsigned int cmd,
 	if (!access_ok(VERIFY_WRITE, info, sizeof(*info)))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_AGP_INFO, (unsigned long)info);
 	if (err)
 		return err;
@@ -825,7 +825,7 @@ static int compat_drm_agp_alloc(struct file *file, unsigned int cmd,
 	    || __put_user(req32.type, &amp;request-&gt;type))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_AGP_ALLOC, (unsigned long)request);
 	if (err)
 		return err;
@@ -833,7 +833,7 @@ static int compat_drm_agp_alloc(struct file *file, unsigned int cmd,
 	if (__get_user(req32.handle, &amp;request-&gt;handle)
 	    || __get_user(req32.physical, &amp;request-&gt;physical)
 	    || copy_to_user(argp, &amp;req32, sizeof(req32))) {
-		drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+		drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			  DRM_IOCTL_AGP_FREE, (unsigned long)request);
 		return -EFAULT;
 	}
@@ -854,7 +854,7 @@ static int compat_drm_agp_free(struct file *file, unsigned int cmd,
 	    || __put_user(handle, &amp;request-&gt;handle))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_AGP_FREE, (unsigned long)request);
 }
 
@@ -879,7 +879,7 @@ static int compat_drm_agp_bind(struct file *file, unsigned int cmd,
 	    || __put_user(req32.offset, &amp;request-&gt;offset))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_AGP_BIND, (unsigned long)request);
 }
 
@@ -896,7 +896,7 @@ static int compat_drm_agp_unbind(struct file *file, unsigned int cmd,
 	    || __put_user(handle, &amp;request-&gt;handle))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_AGP_UNBIND, (unsigned long)request);
 }
 #endif				/* __OS_HAS_AGP */
@@ -921,7 +921,7 @@ static int compat_drm_sg_alloc(struct file *file, unsigned int cmd,
 	    || __put_user(x, &amp;request-&gt;size))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_SG_ALLOC, (unsigned long)request);
 	if (err)
 		return err;
@@ -948,7 +948,7 @@ static int compat_drm_sg_free(struct file *file, unsigned int cmd,
 	    || __put_user(x &lt;&lt; PAGE_SHIFT, &amp;request-&gt;handle))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_SG_FREE, (unsigned long)request);
 }
 
@@ -988,7 +988,7 @@ static int compat_drm_wait_vblank(struct file *file, unsigned int cmd,
 	    || __put_user(req32.request.signal, &amp;request-&gt;request.signal))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_WAIT_VBLANK, (unsigned long)request);
 	if (err)
 		return err;
@@ -1060,7 +1060,7 @@ long drm_compat_ioctl(struct file *filp, unsigned int cmd, unsigned long arg)
 	if (fn != NULL)
 		ret = (*fn) (filp, cmd, arg);
 	else
-		ret = drm_ioctl(filp-&gt;f_dentry-&gt;d_inode, filp, cmd, arg);
+		ret = drm_ioctl(filp-&gt;f_path.dentry-&gt;d_inode, filp, cmd, arg);
 	unlock_kernel();
 
 	return ret;
diff --git a/drivers/char/drm/i915_ioc32.c b/drivers/char/drm/i915_ioc32.c
index 296248cdc767..1fe68a251b75 100644
--- a/drivers/char/drm/i915_ioc32.c
+++ b/drivers/char/drm/i915_ioc32.c
@@ -66,7 +66,7 @@ static int compat_i915_batchbuffer(struct file *file, unsigned int cmd,
 			  &amp;batchbuffer-&gt;cliprects))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_I915_BATCHBUFFER,
 			 (unsigned long)batchbuffer);
 }
@@ -102,7 +102,7 @@ static int compat_i915_cmdbuffer(struct file *file, unsigned int cmd,
 			  &amp;cmdbuffer-&gt;cliprects))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_I915_CMDBUFFER, (unsigned long)cmdbuffer);
 }
 
@@ -125,7 +125,7 @@ static int compat_i915_irq_emit(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;irq_seq))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_I915_IRQ_EMIT, (unsigned long)request);
 }
 typedef struct drm_i915_getparam32 {
@@ -149,7 +149,7 @@ static int compat_i915_getparam(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;value))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_I915_GETPARAM, (unsigned long)request);
 }
 
@@ -178,7 +178,7 @@ static int compat_i915_alloc(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;region_offset))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_I915_ALLOC, (unsigned long)request);
 }
 
@@ -215,7 +215,7 @@ long i915_compat_ioctl(struct file *filp, unsigned int cmd, unsigned long arg)
 	if (fn != NULL)
 		ret = (*fn) (filp, cmd, arg);
 	else
-		ret = drm_ioctl(filp-&gt;f_dentry-&gt;d_inode, filp, cmd, arg);
+		ret = drm_ioctl(filp-&gt;f_path.dentry-&gt;d_inode, filp, cmd, arg);
 	unlock_kernel();
 
 	return ret;
diff --git a/drivers/char/drm/mga_ioc32.c b/drivers/char/drm/mga_ioc32.c
index 54a18eb2fc04..30d00478ddee 100644
--- a/drivers/char/drm/mga_ioc32.c
+++ b/drivers/char/drm/mga_ioc32.c
@@ -100,7 +100,7 @@ static int compat_mga_init(struct file *file, unsigned int cmd,
 	if (err)
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_MGA_INIT, (unsigned long)init);
 }
 
@@ -125,7 +125,7 @@ static int compat_mga_getparam(struct file *file, unsigned int cmd,
 			  &amp;getparam-&gt;value))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_MGA_GETPARAM, (unsigned long)getparam);
 }
 
@@ -166,7 +166,7 @@ static int compat_mga_dma_bootstrap(struct file *file, unsigned int cmd,
 	    || __put_user(dma_bootstrap32.agp_size, &amp;dma_bootstrap-&gt;agp_size))
 		return -EFAULT;
 
-	err = drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	err = drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			DRM_IOCTL_MGA_DMA_BOOTSTRAP,
 			(unsigned long)dma_bootstrap);
 	if (err)
@@ -224,7 +224,7 @@ long mga_compat_ioctl(struct file *filp, unsigned int cmd, unsigned long arg)
 	if (fn != NULL)
 		ret = (*fn) (filp, cmd, arg);
 	else
-		ret = drm_ioctl(filp-&gt;f_dentry-&gt;d_inode, filp, cmd, arg);
+		ret = drm_ioctl(filp-&gt;f_path.dentry-&gt;d_inode, filp, cmd, arg);
 	unlock_kernel();
 
 	return ret;
diff --git a/drivers/char/drm/r128_ioc32.c b/drivers/char/drm/r128_ioc32.c
index 9dd6d4116e47..d3cb676eee84 100644
--- a/drivers/char/drm/r128_ioc32.c
+++ b/drivers/char/drm/r128_ioc32.c
@@ -95,7 +95,7 @@ static int compat_r128_init(struct file *file, unsigned int cmd,
 			  &amp;init-&gt;agp_textures_offset))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_R128_INIT, (unsigned long)init);
 }
 
@@ -129,7 +129,7 @@ static int compat_r128_depth(struct file *file, unsigned int cmd,
 			  &amp;depth-&gt;mask))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_R128_DEPTH, (unsigned long)depth);
 
 }
@@ -153,7 +153,7 @@ static int compat_r128_stipple(struct file *file, unsigned int cmd,
 			  &amp;stipple-&gt;mask))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_R128_STIPPLE, (unsigned long)stipple);
 }
 
@@ -178,7 +178,7 @@ static int compat_r128_getparam(struct file *file, unsigned int cmd,
 			  &amp;getparam-&gt;value))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_R128_GETPARAM, (unsigned long)getparam);
 }
 
@@ -214,7 +214,7 @@ long r128_compat_ioctl(struct file *filp, unsigned int cmd, unsigned long arg)
 	if (fn != NULL)
 		ret = (*fn) (filp, cmd, arg);
 	else
-		ret = drm_ioctl(filp-&gt;f_dentry-&gt;d_inode, filp, cmd, arg);
+		ret = drm_ioctl(filp-&gt;f_path.dentry-&gt;d_inode, filp, cmd, arg);
 	unlock_kernel();
 
 	return ret;
diff --git a/drivers/char/drm/radeon_ioc32.c b/drivers/char/drm/radeon_ioc32.c
index 0ccfd3618ff1..1f1f9cc055a4 100644
--- a/drivers/char/drm/radeon_ioc32.c
+++ b/drivers/char/drm/radeon_ioc32.c
@@ -92,7 +92,7 @@ static int compat_radeon_cp_init(struct file *file, unsigned int cmd,
 			  &amp;init-&gt;gart_textures_offset))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_RADEON_CP_INIT, (unsigned long)init);
 }
 
@@ -125,7 +125,7 @@ static int compat_radeon_cp_clear(struct file *file, unsigned int cmd,
 			  &amp;clr-&gt;depth_boxes))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_RADEON_CLEAR, (unsigned long)clr);
 }
 
@@ -149,7 +149,7 @@ static int compat_radeon_cp_stipple(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;mask))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_RADEON_STIPPLE, (unsigned long)request);
 }
 
@@ -204,7 +204,7 @@ static int compat_radeon_cp_texture(struct file *file, unsigned int cmd,
 			  &amp;image-&gt;data))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_RADEON_TEXTURE, (unsigned long)request);
 }
 
@@ -238,7 +238,7 @@ static int compat_radeon_cp_vertex2(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;prim))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_RADEON_VERTEX2, (unsigned long)request);
 }
 
@@ -268,7 +268,7 @@ static int compat_radeon_cp_cmdbuf(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;boxes))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_RADEON_CMDBUF, (unsigned long)request);
 }
 
@@ -293,7 +293,7 @@ static int compat_radeon_cp_getparam(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;value))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_RADEON_GETPARAM, (unsigned long)request);
 }
 
@@ -322,7 +322,7 @@ static int compat_radeon_mem_alloc(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;region_offset))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_RADEON_ALLOC, (unsigned long)request);
 }
 
@@ -345,7 +345,7 @@ static int compat_radeon_irq_emit(struct file *file, unsigned int cmd,
 			  &amp;request-&gt;irq_seq))
 		return -EFAULT;
 
-	return drm_ioctl(file-&gt;f_dentry-&gt;d_inode, file,
+	return drm_ioctl(file-&gt;f_path.dentry-&gt;d_inode, file,
 			 DRM_IOCTL_RADEON_IRQ_EMIT, (unsigned long)request);
 }
 
@@ -386,7 +386,7 @@ long radeon_compat_ioctl(struct file *filp, unsigned int cmd, unsigned long arg)
 	if (fn != NULL)
 		ret = (*fn) (filp, cmd, arg);
 	else
-		ret = drm_ioctl(filp-&gt;f_dentry-&gt;d_inode, filp, cmd, arg);
+		ret = drm_ioctl(filp-&gt;f_path.dentry-&gt;d_inode, filp, cmd, arg);
 	unlock_kernel();
 
 	return ret;</pre><hr><pre>commit d817be9ca8766b521f6195f57281284c5ab0ff4c
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:58 2006 -0800

    [PATCH] struct path: convert cris
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/cris/arch-v32/drivers/sync_serial.c b/arch/cris/arch-v32/drivers/sync_serial.c
index e067806b2208..424eb0eb1cd5 100644
--- a/arch/cris/arch-v32/drivers/sync_serial.c
+++ b/arch/cris/arch-v32/drivers/sync_serial.c
@@ -504,7 +504,7 @@ static int sync_serial_release(struct inode *inode, struct file *file)
 
 static unsigned int sync_serial_poll(struct file *file, poll_table *wait)
 {
-	int dev = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int dev = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	unsigned int mask = 0;
 	sync_port* port;
 	DEBUGPOLL( static unsigned int prev_mask = 0; );
@@ -531,7 +531,7 @@ static int sync_serial_ioctl(struct inode *inode, struct file *file,
 		  unsigned int cmd, unsigned long arg)
 {
 	int return_val = 0;
-	int dev = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int dev = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	sync_port* port;
 	reg_sser_rw_tr_cfg tr_cfg;
 	reg_sser_rw_rec_cfg rec_cfg;
@@ -789,7 +789,7 @@ static int sync_serial_ioctl(struct inode *inode, struct file *file,
 static ssize_t sync_serial_write(struct file * file, const char * buf,
                                  size_t count, loff_t *ppos)
 {
-	int dev = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int dev = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	DECLARE_WAITQUEUE(wait, current);
 	sync_port *port;
 	unsigned long c, c1;
@@ -919,7 +919,7 @@ static ssize_t sync_serial_write(struct file * file, const char * buf,
 static ssize_t sync_serial_read(struct file * file, char * buf,
 				size_t count, loff_t *ppos)
 {
-	int dev = iminor(file-&gt;f_dentry-&gt;d_inode);
+	int dev = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	int avail;
 	sync_port *port;
 	unsigned char* start;</pre><hr><pre>commit 352d8af748a1bee0935987b811c9fc4693803d99
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:58 2006 -0800

    [PATCH] struct path: convert cramfs
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/cramfs/inode.c b/fs/cramfs/inode.c
index 0509cedd415c..6db03fb089dc 100644
--- a/fs/cramfs/inode.c
+++ b/fs/cramfs/inode.c
@@ -338,7 +338,7 @@ static int cramfs_statfs(struct dentry *dentry, struct kstatfs *buf)
  */
 static int cramfs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct super_block *sb = inode-&gt;i_sb;
 	char *buf;
 	unsigned int offset;</pre><hr><pre>commit f04538c38134edf5f424dc24fda6ef46da736734
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:57 2006 -0800

    [PATCH] struct path: convert cosa
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/drivers/net/wan/cosa.c b/drivers/net/wan/cosa.c
index e1bf8b93f958..6c7dfb50143f 100644
--- a/drivers/net/wan/cosa.c
+++ b/drivers/net/wan/cosa.c
@@ -974,12 +974,12 @@ static int cosa_open(struct inode *inode, struct file *file)
 	unsigned long flags;
 	int n;
 
-	if ((n=iminor(file-&gt;f_dentry-&gt;d_inode)&gt;&gt;CARD_MINOR_BITS)
+	if ((n=iminor(file-&gt;f_path.dentry-&gt;d_inode)&gt;&gt;CARD_MINOR_BITS)
 		&gt;= nr_cards)
 		return -ENODEV;
 	cosa = cosa_cards+n;
 
-	if ((n=iminor(file-&gt;f_dentry-&gt;d_inode)
+	if ((n=iminor(file-&gt;f_path.dentry-&gt;d_inode)
 		&amp; ((1&lt;&lt;CARD_MINOR_BITS)-1)) &gt;= cosa-&gt;nchannels)
 		return -ENODEV;
 	chan = cosa-&gt;chan + n;</pre><hr><pre>commit d4176d326d76ddea457a5e42ac8c2e3aed3430b1
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:56 2006 -0800

    [PATCH] struct path: convert coda
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/coda/dir.c b/fs/coda/dir.c
index 0102b28a15fb..0c6f7f3b3dd7 100644
--- a/fs/coda/dir.c
+++ b/fs/coda/dir.c
@@ -441,7 +441,7 @@ static int coda_rename(struct inode *old_dir, struct dentry *old_dentry,
 /* file operations for directories */
 int coda_readdir(struct file *coda_file, void *dirent, filldir_t filldir)
 {
-	struct dentry *coda_dentry = coda_file-&gt;f_dentry;
+	struct dentry *coda_dentry = coda_file-&gt;f_path.dentry;
 	struct coda_file_info *cfi;
 	struct file *host_file;
 	struct inode *host_inode;
@@ -453,7 +453,7 @@ int coda_readdir(struct file *coda_file, void *dirent, filldir_t filldir)
 
 	coda_vfs_stat.readdir++;
 
-	host_inode = host_file-&gt;f_dentry-&gt;d_inode;
+	host_inode = host_file-&gt;f_path.dentry-&gt;d_inode;
 	mutex_lock(&amp;host_inode-&gt;i_mutex);
 	host_file-&gt;f_pos = coda_file-&gt;f_pos;
 
@@ -544,14 +544,14 @@ static int coda_venus_readdir(struct file *filp, filldir_t filldir,
 		/* catch truncated reads */
 		if (ret &lt; vdir_size || ret &lt; vdir_size + vdir-&gt;d_namlen) {
 			printk("coda_venus_readdir: short read: %ld\n",
-			       filp-&gt;f_dentry-&gt;d_inode-&gt;i_ino);
+			       filp-&gt;f_path.dentry-&gt;d_inode-&gt;i_ino);
 			ret = -EBADF;
 			break;
 		}
 		/* validate whether the directory file actually makes sense */
 		if (vdir-&gt;d_reclen &lt; vdir_size + vdir-&gt;d_namlen) {
 			printk("coda_venus_readdir: Invalid dir: %ld\n",
-			       filp-&gt;f_dentry-&gt;d_inode-&gt;i_ino);
+			       filp-&gt;f_path.dentry-&gt;d_inode-&gt;i_ino);
 			ret = -EBADF;
 			break;
 		}
diff --git a/fs/coda/file.c b/fs/coda/file.c
index dbfbcfa5b3c0..5ef2b609ec7d 100644
--- a/fs/coda/file.c
+++ b/fs/coda/file.c
@@ -66,7 +66,7 @@ coda_file_sendfile(struct file *coda_file, loff_t *ppos, size_t count,
 static ssize_t
 coda_file_write(struct file *coda_file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	struct inode *host_inode, *coda_inode = coda_file-&gt;f_dentry-&gt;d_inode;
+	struct inode *host_inode, *coda_inode = coda_file-&gt;f_path.dentry-&gt;d_inode;
 	struct coda_file_info *cfi;
 	struct file *host_file;
 	ssize_t ret;
@@ -78,7 +78,7 @@ coda_file_write(struct file *coda_file, const char __user *buf, size_t count, lo
 	if (!host_file-&gt;f_op || !host_file-&gt;f_op-&gt;write)
 		return -EINVAL;
 
-	host_inode = host_file-&gt;f_dentry-&gt;d_inode;
+	host_inode = host_file-&gt;f_path.dentry-&gt;d_inode;
 	mutex_lock(&amp;coda_inode-&gt;i_mutex);
 
 	ret = host_file-&gt;f_op-&gt;write(host_file, buf, count, ppos);
@@ -106,8 +106,8 @@ coda_file_mmap(struct file *coda_file, struct vm_area_struct *vma)
 	if (!host_file-&gt;f_op || !host_file-&gt;f_op-&gt;mmap)
 		return -ENODEV;
 
-	coda_inode = coda_file-&gt;f_dentry-&gt;d_inode;
-	host_inode = host_file-&gt;f_dentry-&gt;d_inode;
+	coda_inode = coda_file-&gt;f_path.dentry-&gt;d_inode;
+	host_inode = host_file-&gt;f_path.dentry-&gt;d_inode;
 	coda_file-&gt;f_mapping = host_file-&gt;f_mapping;
 	if (coda_inode-&gt;i_mapping == &amp;coda_inode-&gt;i_data)
 		coda_inode-&gt;i_mapping = host_inode-&gt;i_mapping;
@@ -190,7 +190,7 @@ int coda_flush(struct file *coda_file, fl_owner_t id)
 	cfi = CODA_FTOC(coda_file);
 	BUG_ON(!cfi || cfi-&gt;cfi_magic != CODA_MAGIC);
 
-	coda_inode = coda_file-&gt;f_dentry-&gt;d_inode;
+	coda_inode = coda_file-&gt;f_path.dentry-&gt;d_inode;
 
 	err = venus_store(coda_inode-&gt;i_sb, coda_i2f(coda_inode), coda_flags,
 			  coda_file-&gt;f_uid);
@@ -233,7 +233,7 @@ int coda_release(struct inode *coda_inode, struct file *coda_file)
 		err = venus_close(coda_inode-&gt;i_sb, coda_i2f(coda_inode),
 				  coda_flags, coda_file-&gt;f_uid);
 
-	host_inode = cfi-&gt;cfi_container-&gt;f_dentry-&gt;d_inode;
+	host_inode = cfi-&gt;cfi_container-&gt;f_path.dentry-&gt;d_inode;
 	cii = ITOC(coda_inode);
 
 	/* did we mmap this file? */
@@ -270,7 +270,7 @@ int coda_fsync(struct file *coda_file, struct dentry *coda_dentry, int datasync)
 	coda_vfs_stat.fsync++;
 
 	if (host_file-&gt;f_op &amp;&amp; host_file-&gt;f_op-&gt;fsync) {
-		host_dentry = host_file-&gt;f_dentry;
+		host_dentry = host_file-&gt;f_path.dentry;
 		host_inode = host_dentry-&gt;d_inode;
 		mutex_lock(&amp;host_inode-&gt;i_mutex);
 		err = host_file-&gt;f_op-&gt;fsync(host_file, host_dentry, datasync);
diff --git a/fs/coda/inode.c b/fs/coda/inode.c
index b64659fa82d0..01395defed85 100644
--- a/fs/coda/inode.c
+++ b/fs/coda/inode.c
@@ -119,7 +119,7 @@ static int get_device_index(struct coda_mount_data *data)
 	file = fget(data-&gt;fd);
 	inode = NULL;
 	if(file)
-		inode = file-&gt;f_dentry-&gt;d_inode;
+		inode = file-&gt;f_path.dentry-&gt;d_inode;
 	
 	if(!inode || !S_ISCHR(inode-&gt;i_mode) ||
 	   imajor(inode) != CODA_PSDEV_MAJOR) {</pre><hr><pre>commit a7113a966241b700aecc7b8cb326cecb62e3c4b2
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:55 2006 -0800

    [PATCH] struct path: convert char-drivers
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/drivers/char/cs5535_gpio.c b/drivers/char/cs5535_gpio.c
index 8ce3f34cfc22..c02d9e99e050 100644
--- a/drivers/char/cs5535_gpio.c
+++ b/drivers/char/cs5535_gpio.c
@@ -82,7 +82,7 @@ static inline u32 cs5535_lowhigh_base(int reg)
 static ssize_t cs5535_gpio_write(struct file *file, const char __user *data,
 				 size_t len, loff_t *ppos)
 {
-	u32	m = iminor(file-&gt;f_dentry-&gt;d_inode);
+	u32	m = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	int	i, j;
 	u32	base = gpio_base + cs5535_lowhigh_base(m);
 	u32	m0, m1;
@@ -117,7 +117,7 @@ static ssize_t cs5535_gpio_write(struct file *file, const char __user *data,
 static ssize_t cs5535_gpio_read(struct file *file, char __user *buf,
 				size_t len, loff_t *ppos)
 {
-	u32	m = iminor(file-&gt;f_dentry-&gt;d_inode);
+	u32	m = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	u32	base = gpio_base + cs5535_lowhigh_base(m);
 	int	rd_bit = 1 &lt;&lt; (m &amp; 0x0f);
 	int	i;
diff --git a/drivers/char/dsp56k.c b/drivers/char/dsp56k.c
index 9b1bf60ffbe7..06f2dbf17710 100644
--- a/drivers/char/dsp56k.c
+++ b/drivers/char/dsp56k.c
@@ -201,7 +201,7 @@ static int dsp56k_upload(u_char __user *bin, int len)
 static ssize_t dsp56k_read(struct file *file, char __user *buf, size_t count,
 			   loff_t *ppos)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	int dev = iminor(inode) &amp; 0x0f;
 
 	switch(dev)
@@ -264,7 +264,7 @@ static ssize_t dsp56k_read(struct file *file, char __user *buf, size_t count,
 static ssize_t dsp56k_write(struct file *file, const char __user *buf, size_t count,
 			    loff_t *ppos)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	int dev = iminor(inode) &amp; 0x0f;
 
 	switch(dev)
@@ -420,7 +420,7 @@ static int dsp56k_ioctl(struct inode *inode, struct file *file,
 #if 0
 static unsigned int dsp56k_poll(struct file *file, poll_table *wait)
 {
-	int dev = iminor(file-&gt;f_dentry-&gt;d_inode) &amp; 0x0f;
+	int dev = iminor(file-&gt;f_path.dentry-&gt;d_inode) &amp; 0x0f;
 
 	switch(dev)
 	{
diff --git a/drivers/char/dtlk.c b/drivers/char/dtlk.c
index 5e82c3bad2e3..d4005e94fe5f 100644
--- a/drivers/char/dtlk.c
+++ b/drivers/char/dtlk.c
@@ -122,7 +122,7 @@ static void dtlk_timer_tick(unsigned long data);
 static ssize_t dtlk_read(struct file *file, char __user *buf,
 			 size_t count, loff_t * ppos)
 {
-	unsigned int minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	unsigned int minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	char ch;
 	int i = 0, retries;
 
@@ -174,7 +174,7 @@ static ssize_t dtlk_write(struct file *file, const char __user *buf,
 	}
 #endif
 
-	if (iminor(file-&gt;f_dentry-&gt;d_inode) != DTLK_MINOR)
+	if (iminor(file-&gt;f_path.dentry-&gt;d_inode) != DTLK_MINOR)
 		return -EINVAL;
 
 	while (1) {
diff --git a/drivers/char/ip2/ip2main.c b/drivers/char/ip2/ip2main.c
index cda2459c1d60..6810b7bbcbb7 100644
--- a/drivers/char/ip2/ip2main.c
+++ b/drivers/char/ip2/ip2main.c
@@ -2700,7 +2700,7 @@ static
 ssize_t
 ip2_ipl_read(struct file *pFile, char __user *pData, size_t count, loff_t *off )
 {
-	unsigned int minor = iminor(pFile-&gt;f_dentry-&gt;d_inode);
+	unsigned int minor = iminor(pFile-&gt;f_path.dentry-&gt;d_inode);
 	int rc = 0;
 
 #ifdef IP2DEBUG_IPL
diff --git a/drivers/char/istallion.c b/drivers/char/istallion.c
index 8f591945ebd9..b6f0d036a760 100644
--- a/drivers/char/istallion.c
+++ b/drivers/char/istallion.c
@@ -4194,7 +4194,7 @@ static ssize_t stli_memread(struct file *fp, char __user *buf, size_t count, lof
 	void *p;
 	loff_t off = *offp;
 
-	brdnr = iminor(fp-&gt;f_dentry-&gt;d_inode);
+	brdnr = iminor(fp-&gt;f_path.dentry-&gt;d_inode);
 	if (brdnr &gt;= stli_nrbrds)
 		return -ENODEV;
 	brdp = stli_brds[brdnr];
@@ -4258,7 +4258,7 @@ static ssize_t stli_memwrite(struct file *fp, const char __user *buf, size_t cou
 	void *p;
 	loff_t off = *offp;
 
-	brdnr = iminor(fp-&gt;f_dentry-&gt;d_inode);
+	brdnr = iminor(fp-&gt;f_path.dentry-&gt;d_inode);
 
 	if (brdnr &gt;= stli_nrbrds)
 		return -ENODEV;
diff --git a/drivers/char/lp.c b/drivers/char/lp.c
index 1ecea7d448f1..b70b5388b5a8 100644
--- a/drivers/char/lp.c
+++ b/drivers/char/lp.c
@@ -296,7 +296,7 @@ static int lp_wait_ready(int minor, int nonblock)
 static ssize_t lp_write(struct file * file, const char __user * buf,
 		        size_t count, loff_t *ppos)
 {
-	unsigned int minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	unsigned int minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	struct parport *port = lp_table[minor].dev-&gt;port;
 	char *kbuf = lp_table[minor].lp_buffer;
 	ssize_t retv = 0;
@@ -415,7 +415,7 @@ static ssize_t lp_read(struct file * file, char __user * buf,
 		       size_t count, loff_t *ppos)
 {
 	DEFINE_WAIT(wait);
-	unsigned int minor=iminor(file-&gt;f_dentry-&gt;d_inode);
+	unsigned int minor=iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	struct parport *port = lp_table[minor].dev-&gt;port;
 	ssize_t retval = 0;
 	char *kbuf = lp_table[minor].lp_buffer;
diff --git a/drivers/char/mem.c b/drivers/char/mem.c
index e67eef4867ba..089020e0ee5a 100644
--- a/drivers/char/mem.c
+++ b/drivers/char/mem.c
@@ -774,7 +774,7 @@ static loff_t memory_lseek(struct file * file, loff_t offset, int orig)
 {
 	loff_t ret;
 
-	mutex_lock(&amp;file-&gt;f_dentry-&gt;d_inode-&gt;i_mutex);
+	mutex_lock(&amp;file-&gt;f_path.dentry-&gt;d_inode-&gt;i_mutex);
 	switch (orig) {
 		case 0:
 			file-&gt;f_pos = offset;
@@ -789,7 +789,7 @@ static loff_t memory_lseek(struct file * file, loff_t offset, int orig)
 		default:
 			ret = -EINVAL;
 	}
-	mutex_unlock(&amp;file-&gt;f_dentry-&gt;d_inode-&gt;i_mutex);
+	mutex_unlock(&amp;file-&gt;f_path.dentry-&gt;d_inode-&gt;i_mutex);
 	return ret;
 }
 
diff --git a/drivers/char/nsc_gpio.c b/drivers/char/nsc_gpio.c
index 4d47d79bcea7..808d44e9a32a 100644
--- a/drivers/char/nsc_gpio.c
+++ b/drivers/char/nsc_gpio.c
@@ -41,7 +41,7 @@ void nsc_gpio_dump(struct nsc_gpio_ops *amp, unsigned index)
 ssize_t nsc_gpio_write(struct file *file, const char __user *data,
 		       size_t len, loff_t *ppos)
 {
-	unsigned m = iminor(file-&gt;f_dentry-&gt;d_inode);
+	unsigned m = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	struct nsc_gpio_ops *amp = file-&gt;private_data;
 	struct device *dev = amp-&gt;dev;
 	size_t i;
@@ -104,7 +104,7 @@ ssize_t nsc_gpio_write(struct file *file, const char __user *data,
 ssize_t nsc_gpio_read(struct file *file, char __user * buf,
 		      size_t len, loff_t * ppos)
 {
-	unsigned m = iminor(file-&gt;f_dentry-&gt;d_inode);
+	unsigned m = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	int value;
 	struct nsc_gpio_ops *amp = file-&gt;private_data;
 
diff --git a/drivers/char/ppdev.c b/drivers/char/ppdev.c
index c1e3dd837fc8..4abd1eff61d6 100644
--- a/drivers/char/ppdev.c
+++ b/drivers/char/ppdev.c
@@ -106,7 +106,7 @@ static inline void pp_enable_irq (struct pp_struct *pp)
 static ssize_t pp_read (struct file * file, char __user * buf, size_t count,
 			loff_t * ppos)
 {
-	unsigned int minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	unsigned int minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	struct pp_struct *pp = file-&gt;private_data;
 	char * kbuffer;
 	ssize_t bytes_read = 0;
@@ -189,7 +189,7 @@ static ssize_t pp_read (struct file * file, char __user * buf, size_t count,
 static ssize_t pp_write (struct file * file, const char __user * buf,
 			 size_t count, loff_t * ppos)
 {
-	unsigned int minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	unsigned int minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	struct pp_struct *pp = file-&gt;private_data;
 	char * kbuffer;
 	ssize_t bytes_written = 0;
diff --git a/drivers/char/random.c b/drivers/char/random.c
index 4c6782a1ecdb..092a01cc02da 100644
--- a/drivers/char/random.c
+++ b/drivers/char/random.c
@@ -1048,7 +1048,7 @@ random_write(struct file * file, const char __user * buffer,
 	if (p == buffer) {
 		return (ssize_t)ret;
 	} else {
-		struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+		struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	        inode-&gt;i_mtime = current_fs_time(inode-&gt;i_sb);
 		mark_inode_dirty(inode);
 		return (ssize_t)(p - buffer);
diff --git a/drivers/char/raw.c b/drivers/char/raw.c
index 3b32313f6eb4..645e20a06ece 100644
--- a/drivers/char/raw.c
+++ b/drivers/char/raw.c
@@ -75,7 +75,7 @@ static int raw_open(struct inode *inode, struct file *filp)
 	filp-&gt;f_flags |= O_DIRECT;
 	filp-&gt;f_mapping = bdev-&gt;bd_inode-&gt;i_mapping;
 	if (++raw_devices[minor].inuse == 1)
-		filp-&gt;f_dentry-&gt;d_inode-&gt;i_mapping =
+		filp-&gt;f_path.dentry-&gt;d_inode-&gt;i_mapping =
 			bdev-&gt;bd_inode-&gt;i_mapping;
 	filp-&gt;private_data = bdev;
 	mutex_unlock(&amp;raw_mutex);
diff --git a/drivers/char/sonypi.c b/drivers/char/sonypi.c
index fc87070f1866..17d54e1331b2 100644
--- a/drivers/char/sonypi.c
+++ b/drivers/char/sonypi.c
@@ -979,7 +979,7 @@ static ssize_t sonypi_misc_read(struct file *file, char __user *buf,
 	}
 
 	if (ret &gt; 0) {
-		struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+		struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 		inode-&gt;i_atime = current_fs_time(inode-&gt;i_sb);
 	}
 
diff --git a/drivers/char/tb0219.c b/drivers/char/tb0219.c
index bb1bad4c18f9..4c431cb7cf1b 100644
--- a/drivers/char/tb0219.c
+++ b/drivers/char/tb0219.c
@@ -164,7 +164,7 @@ static ssize_t tanbac_tb0219_read(struct file *file, char __user *buf, size_t le
 	unsigned int minor;
 	char value;
 
-	minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	switch (minor) {
 	case 0:
 		value = get_led();
@@ -200,7 +200,7 @@ static ssize_t tanbac_tb0219_write(struct file *file, const char __user *data,
 	int retval = 0;
 	char c;
 
-	minor = iminor(file-&gt;f_dentry-&gt;d_inode);
+	minor = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	switch (minor) {
 	case 0:
 		type = TYPE_LED;
diff --git a/drivers/char/tipar.c b/drivers/char/tipar.c
index 9df0ca1be0e3..47fb20f69695 100644
--- a/drivers/char/tipar.c
+++ b/drivers/char/tipar.c
@@ -285,7 +285,7 @@ static ssize_t
 tipar_write (struct file *file, const char __user *buf, size_t count,
 		loff_t * ppos)
 {
-	unsigned int minor = iminor(file-&gt;f_dentry-&gt;d_inode) - TIPAR_MINOR;
+	unsigned int minor = iminor(file-&gt;f_path.dentry-&gt;d_inode) - TIPAR_MINOR;
 	ssize_t n;
 
 	parport_claim_or_block(table[minor].dev);
@@ -313,7 +313,7 @@ static ssize_t
 tipar_read(struct file *file, char __user *buf, size_t count, loff_t * ppos)
 {
 	int b = 0;
-	unsigned int minor = iminor(file-&gt;f_dentry-&gt;d_inode) - TIPAR_MINOR;
+	unsigned int minor = iminor(file-&gt;f_path.dentry-&gt;d_inode) - TIPAR_MINOR;
 	ssize_t retval = 0;
 	ssize_t n = 0;
 
diff --git a/drivers/char/tty_io.c b/drivers/char/tty_io.c
index 0c856a6f3677..8a2d26e98ac4 100644
--- a/drivers/char/tty_io.c
+++ b/drivers/char/tty_io.c
@@ -1629,7 +1629,7 @@ static ssize_t tty_read(struct file * file, char __user * buf, size_t count,
 	struct tty_ldisc *ld;
 
 	tty = (struct tty_struct *)file-&gt;private_data;
-	inode = file-&gt;f_dentry-&gt;d_inode;
+	inode = file-&gt;f_path.dentry-&gt;d_inode;
 	if (tty_paranoia_check(tty, inode, "tty_read"))
 		return -EIO;
 	if (!tty || (test_bit(TTY_IO_ERROR, &amp;tty-&gt;flags)))
@@ -1732,7 +1732,7 @@ static inline ssize_t do_tty_write(
 		cond_resched();
 	}
 	if (written) {
-		struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+		struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 		inode-&gt;i_mtime = current_fs_time(inode-&gt;i_sb);
 		ret = written;
 	}
@@ -1763,7 +1763,7 @@ static ssize_t tty_write(struct file * file, const char __user * buf, size_t cou
 			 loff_t *ppos)
 {
 	struct tty_struct * tty;
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	ssize_t ret;
 	struct tty_ldisc *ld;
 	
@@ -2170,7 +2170,7 @@ static void release_dev(struct file * filp)
 	unsigned long flags;
 	
 	tty = (struct tty_struct *)filp-&gt;private_data;
-	if (tty_paranoia_check(tty, filp-&gt;f_dentry-&gt;d_inode, "release_dev"))
+	if (tty_paranoia_check(tty, filp-&gt;f_path.dentry-&gt;d_inode, "release_dev"))
 		return;
 
 	check_tty_count(tty, "release_dev");
@@ -2680,7 +2680,7 @@ static unsigned int tty_poll(struct file * filp, poll_table * wait)
 	int ret = 0;
 
 	tty = (struct tty_struct *)filp-&gt;private_data;
-	if (tty_paranoia_check(tty, filp-&gt;f_dentry-&gt;d_inode, "tty_poll"))
+	if (tty_paranoia_check(tty, filp-&gt;f_path.dentry-&gt;d_inode, "tty_poll"))
 		return 0;
 		
 	ld = tty_ldisc_ref_wait(tty);
@@ -2696,7 +2696,7 @@ static int tty_fasync(int fd, struct file * filp, int on)
 	int retval;
 
 	tty = (struct tty_struct *)filp-&gt;private_data;
-	if (tty_paranoia_check(tty, filp-&gt;f_dentry-&gt;d_inode, "tty_fasync"))
+	if (tty_paranoia_check(tty, filp-&gt;f_path.dentry-&gt;d_inode, "tty_fasync"))
 		return 0;
 	
 	retval = fasync_helper(fd, filp, on, &amp;tty-&gt;fasync);
diff --git a/drivers/char/vc_screen.c b/drivers/char/vc_screen.c
index f442b574b44a..26776517f04c 100644
--- a/drivers/char/vc_screen.c
+++ b/drivers/char/vc_screen.c
@@ -72,7 +72,7 @@ static loff_t vcs_lseek(struct file *file, loff_t offset, int orig)
 	int size;
 
 	down(&amp;con_buf_sem);
-	size = vcs_size(file-&gt;f_dentry-&gt;d_inode);
+	size = vcs_size(file-&gt;f_path.dentry-&gt;d_inode);
 	switch (orig) {
 		default:
 			up(&amp;con_buf_sem);
@@ -98,7 +98,7 @@ static loff_t vcs_lseek(struct file *file, loff_t offset, int orig)
 static ssize_t
 vcs_read(struct file *file, char __user *buf, size_t count, loff_t *ppos)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	unsigned int currcons = iminor(inode);
 	struct vc_data *vc;
 	long pos;
@@ -271,7 +271,7 @@ vcs_read(struct file *file, char __user *buf, size_t count, loff_t *ppos)
 static ssize_t
 vcs_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	unsigned int currcons = iminor(inode);
 	struct vc_data *vc;
 	long pos;
diff --git a/drivers/char/viotape.c b/drivers/char/viotape.c
index 73c78bf75d7f..94d79cb8ce8d 100644
--- a/drivers/char/viotape.c
+++ b/drivers/char/viotape.c
@@ -442,7 +442,7 @@ static ssize_t viotap_write(struct file *file, const char *buf,
 	if (op == NULL)
 		return -ENOMEM;
 
-	get_dev_info(file-&gt;f_dentry-&gt;d_inode, &amp;devi);
+	get_dev_info(file-&gt;f_path.dentry-&gt;d_inode, &amp;devi);
 
 	/*
 	 * We need to make sure we can send a request.  We use
@@ -532,7 +532,7 @@ static ssize_t viotap_read(struct file *file, char *buf, size_t count,
 	if (op == NULL)
 		return -ENOMEM;
 
-	get_dev_info(file-&gt;f_dentry-&gt;d_inode, &amp;devi);
+	get_dev_info(file-&gt;f_path.dentry-&gt;d_inode, &amp;devi);
 
 	/*
 	 * We need to make sure we can send a request.  We use
@@ -612,7 +612,7 @@ static int viotap_ioctl(struct inode *inode, struct file *file,
 	if (op == NULL)
 		return -ENOMEM;
 
-	get_dev_info(file-&gt;f_dentry-&gt;d_inode, &amp;devi);
+	get_dev_info(file-&gt;f_path.dentry-&gt;d_inode, &amp;devi);
 
 	down(&amp;reqSem);
 
@@ -777,7 +777,7 @@ static int viotap_open(struct inode *inode, struct file *file)
 	if (op == NULL)
 		return -ENOMEM;
 
-	get_dev_info(file-&gt;f_dentry-&gt;d_inode, &amp;devi);
+	get_dev_info(file-&gt;f_path.dentry-&gt;d_inode, &amp;devi);
 
 	/* Note: We currently only support one mode! */
 	if ((devi.devno &gt;= viotape_numdev) || (devi.mode)) {
@@ -822,7 +822,7 @@ static int viotap_release(struct inode *inode, struct file *file)
 		return -ENOMEM;
 	init_completion(&amp;op-&gt;com);
 
-	get_dev_info(file-&gt;f_dentry-&gt;d_inode, &amp;devi);
+	get_dev_info(file-&gt;f_path.dentry-&gt;d_inode, &amp;devi);
 
 	if (devi.devno &gt;= viotape_numdev) {
 		ret = -ENODEV;
diff --git a/drivers/char/vr41xx_giu.c b/drivers/char/vr41xx_giu.c
index 8e7949305171..a744dad9cf45 100644
--- a/drivers/char/vr41xx_giu.c
+++ b/drivers/char/vr41xx_giu.c
@@ -506,7 +506,7 @@ static ssize_t gpio_read(struct file *file, char __user *buf, size_t len,
 	unsigned int pin;
 	char value = '0';
 
-	pin = iminor(file-&gt;f_dentry-&gt;d_inode);
+	pin = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	if (pin &gt;= giu_nr_pins)
 		return -EBADF;
 
@@ -530,7 +530,7 @@ static ssize_t gpio_write(struct file *file, const char __user *data,
 	char c;
 	int retval = 0;
 
-	pin = iminor(file-&gt;f_dentry-&gt;d_inode);
+	pin = iminor(file-&gt;f_path.dentry-&gt;d_inode);
 	if (pin &gt;= giu_nr_pins)
 		return -EBADF;
 </pre><hr><pre>commit 6c648be6f4183775679c1f2cc4d094128f104fb2
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:55 2006 -0800

    [PATCH] struct path: convert block_drivers
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/drivers/block/acsi_slm.c b/drivers/block/acsi_slm.c
index 8e41c87b026e..e04be94d195c 100644
--- a/drivers/block/acsi_slm.c
+++ b/drivers/block/acsi_slm.c
@@ -363,7 +363,7 @@ static ssize_t slm_read( struct file *file, char *buf, size_t count,
 						 loff_t *ppos )
 
 {
-	struct inode *node = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *node = file-&gt;f_path.dentry-&gt;d_inode;
 	unsigned long page;
 	int length;
 	int end;
@@ -618,7 +618,7 @@ static ssize_t slm_write( struct file *file, const char *buf, size_t count,
 						  loff_t *ppos )
 
 {
-	struct inode *node = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *node = file-&gt;f_path.dentry-&gt;d_inode;
 	int		device = iminor(node);
 	int		n, filled, w, h;
 
diff --git a/drivers/block/cciss.c b/drivers/block/cciss.c
index 892e092afe9a..ee159edb6b88 100644
--- a/drivers/block/cciss.c
+++ b/drivers/block/cciss.c
@@ -535,7 +535,7 @@ static int do_ioctl(struct file *f, unsigned cmd, unsigned long arg)
 {
 	int ret;
 	lock_kernel();
-	ret = cciss_ioctl(f-&gt;f_dentry-&gt;d_inode, f, cmd, arg);
+	ret = cciss_ioctl(f-&gt;f_path.dentry-&gt;d_inode, f, cmd, arg);
 	unlock_kernel();
 	return ret;
 }
diff --git a/drivers/block/loop.c b/drivers/block/loop.c
index beab6d2643cb..6b5b64207407 100644
--- a/drivers/block/loop.c
+++ b/drivers/block/loop.c
@@ -1000,7 +1000,7 @@ loop_get_status(struct loop_device *lo, struct loop_info64 *info)
 
 	if (lo-&gt;lo_state != Lo_bound)
 		return -ENXIO;
-	error = vfs_getattr(file-&gt;f_vfsmnt, file-&gt;f_dentry, &amp;stat);
+	error = vfs_getattr(file-&gt;f_path.mnt, file-&gt;f_path.dentry, &amp;stat);
 	if (error)
 		return error;
 	memset(info, 0, sizeof(*info));
@@ -1287,7 +1287,7 @@ loop_get_status_compat(struct loop_device *lo,
 
 static long lo_compat_ioctl(struct file *file, unsigned int cmd, unsigned long arg)
 {
-	struct inode *inode = file-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
 	struct loop_device *lo = inode-&gt;i_bdev-&gt;bd_disk-&gt;private_data;
 	int err;
 </pre><hr><pre>commit c5a20b6c26efb58c2ba2ebebcc65748f5b92f662
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:54 2006 -0800

    [PATCH] struct path: convert block
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/block/ioctl.c b/block/ioctl.c
index 9fddb99c3efb..f6962b64660e 100644
--- a/block/ioctl.c
+++ b/block/ioctl.c
@@ -290,7 +290,7 @@ int blkdev_ioctl(struct inode *inode, struct file *file, unsigned cmd,
    ENOIOCTLCMD for unknown ioctls. */
 long compat_blkdev_ioctl(struct file *file, unsigned cmd, unsigned long arg)
 {
-	struct block_device *bdev = file-&gt;f_dentry-&gt;d_inode-&gt;i_bdev;
+	struct block_device *bdev = file-&gt;f_path.dentry-&gt;d_inode-&gt;i_bdev;
 	struct gendisk *disk = bdev-&gt;bd_disk;
 	int ret = -ENOIOCTLCMD;
 	if (disk-&gt;fops-&gt;compat_ioctl) {</pre><hr><pre>commit 61a8424ab8f611d199bfc8ca329ec0ea77a4d4ea
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:53 2006 -0800

    [PATCH] struct path: convert bfs
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/bfs/dir.c b/fs/bfs/dir.c
index a650f1d0b85e..2a746e688df5 100644
--- a/fs/bfs/dir.c
+++ b/fs/bfs/dir.c
@@ -27,7 +27,7 @@ static struct buffer_head * bfs_find_entry(struct inode * dir,
 
 static int bfs_readdir(struct file * f, void * dirent, filldir_t filldir)
 {
-	struct inode * dir = f-&gt;f_dentry-&gt;d_inode;
+	struct inode * dir = f-&gt;f_path.dentry-&gt;d_inode;
 	struct buffer_head * bh;
 	struct bfs_dirent * de;
 	unsigned int offset;</pre><hr><pre>commit 28f375fd6ff266d8e321648b36456f696cfae220
Author: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
Date:   Fri Dec 8 02:36:52 2006 -0800

    [PATCH] struct path: convert befs
    
    Signed-off-by: Josef Sipek &lt;jsipek@fsl.cs.sunysb.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/befs/linuxvfs.c b/fs/befs/linuxvfs.c
index bce402eee554..481e59b9d91c 100644
--- a/fs/befs/linuxvfs.c
+++ b/fs/befs/linuxvfs.c
@@ -212,7 +212,7 @@ befs_lookup(struct inode *dir, struct dentry *dentry, struct nameidata *nd)
 static int
 befs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 {
-	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
+	struct inode *inode = filp-&gt;f_path.dentry-&gt;d_inode;
 	struct super_block *sb = inode-&gt;i_sb;
 	befs_data_stream *ds = &amp;BEFS_I(inode)-&gt;i_data.ds;
 	befs_off_t value;
@@ -222,7 +222,7 @@ befs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 	char keybuf[BEFS_NAME_LEN + 1];
 	char *nlsname;
 	int nlsnamelen;
-	const char *dirname = filp-&gt;f_dentry-&gt;d_name.name;
+	const char *dirname = filp-&gt;f_path.dentry-&gt;d_name.name;
 
 	befs_debug(sb, "---&gt; befs_readdir() "
 		   "name %s, inode %ld, filp-&gt;f_pos %Ld",</pre>
    <div class="pagination">
        <a href='9_7.html'>&lt;&lt;Prev</a><a href='9.html'>1</a><a href='9_2.html'>2</a><a href='9_3.html'>3</a><a href='9_4.html'>4</a><a href='9_5.html'>5</a><a href='9_6.html'>6</a><a href='9_7.html'>7</a><span>[8]</span><a href='9_9.html'>9</a><a href='9_10.html'>10</a><a href='9_11.html'>11</a><a href='9_12.html'>12</a><a href='9_13.html'>13</a><a href='9_14.html'>14</a><a href='9_9.html'>Next&gt;&gt;</a>
    <div>
</body>

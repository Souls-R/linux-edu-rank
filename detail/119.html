<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Shenandoah University</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Shenandoah University</h1>
    <div class="pagination">
        <span>[1]</span>
    </div>
    <hr>
    <pre>commit 68e34f4e89e2bb64d53e77a18e0cfddc3c7f24e9
Author: Jonathan Haws &lt;jhaws@sdl.usu.edu&gt;
Date:   Tue Feb 6 15:40:52 2018 -0800

    ipc/mqueue.c: have RT tasks queue in by priority in wq_add()
    
    Previous behavior added tasks to the work queue using the static_prio
    value instead of the dynamic priority value in prio.  This caused RT tasks
    to be added to the work queue in a FIFO manner rather than by priority.
    Normal tasks were handled by priority.
    
    This fix utilizes the dynamic priority of the task to ensure that both RT
    and normal tasks are added to the work queue in priority order.  Utilizing
    the dynamic priority (prio) rather than the base priority (normal_prio)
    was chosen to ensure that if a task had a boosted priority when it was
    added to the work queue, it would be woken sooner to to ensure that it
    releases any other locks it may be holding in a more timely manner.  It is
    understood that the task could have a lower priority when it wakes than
    when it was added to the queue in this (unlikely) case.
    
    Link: http://lkml.kernel.org/r/1513006652-7014-1-git-send-email-jhaws@sdl.usu.edu
    Signed-off-by: Jonathan Haws &lt;jhaws@sdl.usu.edu&gt;
    Reviewed-by: Steven Rostedt (VMware) &lt;rostedt@goodmis.org&gt;
    Reviewed-by: Davidlohr Bueso &lt;dbueso@suse.de&gt;
    Cc: Ingo Molnar &lt;mingo@kernel.org&gt;
    Cc: Al Viro &lt;viro@zeniv.linux.org.uk&gt;
    Cc: Arnd Bergmann &lt;arnd@arndb.de&gt;
    Cc: Deepa Dinamani &lt;deepa.kernel@gmail.com&gt;
    Cc: Thomas Gleixner &lt;tglx@linutronix.de&gt;
    Cc: Sebastian Andrzej Siewior &lt;bigeasy@linutronix.de&gt;
    Cc: Manfred Spraul &lt;manfred@colorfullife.com&gt;
    Signed-off-by: Andrew Morton &lt;akpm@linux-foundation.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;

diff --git a/ipc/mqueue.c b/ipc/mqueue.c
index 690ae6665500..360e564ae7d1 100644
--- a/ipc/mqueue.c
+++ b/ipc/mqueue.c
@@ -596,7 +596,7 @@ static void wq_add(struct mqueue_inode_info *info, int sr,
 	ewp-&gt;task = current;
 
 	list_for_each_entry(walk, &amp;info-&gt;e_wait_q[sr].list, list) {
-		if (walk-&gt;task-&gt;static_prio &lt;= current-&gt;static_prio) {
+		if (walk-&gt;task-&gt;prio &lt;= current-&gt;prio) {
 			list_add_tail(&amp;ewp-&gt;list, &amp;walk-&gt;list);
 			return;
 		}</pre>
    <div class="pagination">
        <span>[1]</span>
    <div>
</body>

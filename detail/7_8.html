<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by University of Minnesota</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by University of Minnesota</h1>
    <div class="pagination">
        <a href='7_7.html'>&lt;&lt;Prev</a><a href='7.html'>1</a><a href='7_2.html'>2</a><a href='7_3.html'>3</a><a href='7_4.html'>4</a><a href='7_5.html'>5</a><a href='7_6.html'>6</a><a href='7_7.html'>7</a><span>[8]</span><a href='7_9.html'>9</a><a href='7_10.html'>10</a><a href='7_11.html'>11</a><a href='7_12.html'>12</a><a href='7_13.html'>13</a><a href='7_14.html'>14</a><a href='7_15.html'>15</a><a href='7_16.html'>16</a><a href='7_17.html'>17</a><a href='7_18.html'>18</a><a href='7_19.html'>19</a><a href='7_20.html'>20</a><a href='7_21.html'>21</a><a href='7_22.html'>22</a><a href='7_23.html'>23</a><a href='7_24.html'>24</a><a href='7_25.html'>25</a><a href='7_26.html'>26</a><a href='7_27.html'>27</a><a href='7_28.html'>28</a><a href='7_29.html'>29</a><a href='7_30.html'>30</a><a href='7_9.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit febfd9d3c7f74063e8e630b15413ca91b567f963
Author: Qiushi Wu &lt;wu000273@umn.edu&gt;
Date:   Fri May 22 14:07:15 2020 -0500

    net/mlx4_core: fix a memory leak bug.
    
    In function mlx4_opreq_action(), pointer "mailbox" is not released,
    when mlx4_cmd_box() return and error, causing a memory leak bug.
    Fix this issue by going to "out" label, mlx4_free_cmd_mailbox() can
    free this pointer.
    
    Fixes: fe6f700d6cbb ("net/mlx4_core: Respond to operation request by firmware")
    Signed-off-by: Qiushi Wu &lt;wu000273@umn.edu&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/net/ethernet/mellanox/mlx4/fw.c b/drivers/net/ethernet/mellanox/mlx4/fw.c
index 6e501af0e532..f6ff9620a137 100644
--- a/drivers/net/ethernet/mellanox/mlx4/fw.c
+++ b/drivers/net/ethernet/mellanox/mlx4/fw.c
@@ -2734,7 +2734,7 @@ void mlx4_opreq_action(struct work_struct *work)
 		if (err) {
 			mlx4_err(dev, "Failed to retrieve required operation: %d\n",
 				 err);
-			return;
+			goto out;
 		}
 		MLX4_GET(modifier, outbox, GET_OP_REQ_MODIFIER_OFFSET);
 		MLX4_GET(token, outbox, GET_OP_REQ_TOKEN_OFFSET);</pre><hr><pre>commit f45d01f4f30b53c3a0a1c6c1c154acb7ff74ab9f
Author: Qiushi Wu &lt;wu000273@umn.edu&gt;
Date:   Fri May 22 13:45:18 2020 -0500

    rxrpc: Fix a memory leak in rxkad_verify_response()
    
    A ticket was not released after a call of the function
    "rxkad_decrypt_ticket" failed. Thus replace the jump target
    "temporary_error_free_resp" by "temporary_error_free_ticket".
    
    Fixes: 8c2f826dc3631 ("rxrpc: Don't put crypto buffers on the stack")
    Signed-off-by: Qiushi Wu &lt;wu000273@umn.edu&gt;
    Signed-off-by: David Howells &lt;dhowells@redhat.com&gt;
    cc: Markus Elfring &lt;Markus.Elfring@web.de&gt;

diff --git a/net/rxrpc/rxkad.c b/net/rxrpc/rxkad.c
index 098f1f9ec53b..52a24d4ef5d8 100644
--- a/net/rxrpc/rxkad.c
+++ b/net/rxrpc/rxkad.c
@@ -1148,7 +1148,7 @@ static int rxkad_verify_response(struct rxrpc_connection *conn,
 	ret = rxkad_decrypt_ticket(conn, skb, ticket, ticket_len, &amp;session_key,
 				   &amp;expiry, _abort_code);
 	if (ret &lt; 0)
-		goto temporary_error_free_resp;
+		goto temporary_error_free_ticket;
 
 	/* use the session key from inside the ticket to decrypt the
 	 * response */
@@ -1230,7 +1230,6 @@ static int rxkad_verify_response(struct rxrpc_connection *conn,
 
 temporary_error_free_ticket:
 	kfree(ticket);
-temporary_error_free_resp:
 	kfree(response);
 temporary_error:
 	/* Ignore the response packet if we got a temporary error such as</pre><hr><pre>commit 5a730153984dd13f82ffae93d7170d76eba204e9
Author: Qiushi Wu &lt;wu000273@umn.edu&gt;
Date:   Fri May 22 16:50:27 2020 -0500

    net: sun: fix missing release regions in cas_init_one().
    
    In cas_init_one(), "pdev" is requested by "pci_request_regions", but it
    was not released after a call of the function “pci_write_config_byte”
    failed. Thus replace the jump target “err_write_cacheline” by
    "err_out_free_res".
    
    Fixes: 1f26dac32057 ("[NET]: Add Sun Cassini driver.")
    Signed-off-by: Qiushi Wu &lt;wu000273@umn.edu&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/net/ethernet/sun/cassini.c b/drivers/net/ethernet/sun/cassini.c
index e6d1aa882fa5..f1c8615ab6f0 100644
--- a/drivers/net/ethernet/sun/cassini.c
+++ b/drivers/net/ethernet/sun/cassini.c
@@ -4963,7 +4963,7 @@ static int cas_init_one(struct pci_dev *pdev, const struct pci_device_id *ent)
 					  cas_cacheline_size)) {
 			dev_err(&amp;pdev-&gt;dev, "Could not set PCI cache "
 			       "line size\n");
-			goto err_write_cacheline;
+			goto err_out_free_res;
 		}
 	}
 #endif
@@ -5136,7 +5136,6 @@ static int cas_init_one(struct pci_dev *pdev, const struct pci_device_id *ent)
 err_out_free_res:
 	pci_release_regions(pdev);
 
-err_write_cacheline:
 	/* Try to restore it in case the error occurred after we
 	 * set it.
 	 */</pre><hr><pre>commit b975abbd382fe442713a4c233549abb90e57c22b
Author: Qiushi Wu &lt;wu000273@umn.edu&gt;
Date:   Fri May 22 09:34:51 2020 +0100

    agp/intel: Fix a memory leak on module initialisation failure
    
    In intel_gtt_setup_scratch_page(), pointer "page" is not released if
    pci_dma_mapping_error() return an error, leading to a memory leak on
    module initialisation failure.  Simply fix this issue by freeing "page"
    before return.
    
    Fixes: 0e87d2b06cb46 ("intel-gtt: initialize our own scratch page")
    Signed-off-by: Qiushi Wu &lt;wu000273@umn.edu&gt;
    Reviewed-by: Chris Wilson &lt;chris@chris-wilson.co.uk&gt;
    Signed-off-by: Chris Wilson &lt;chris@chris-wilson.co.uk&gt;
    Link: https://patchwork.freedesktop.org/patch/msgid/20200522083451.7448-1-chris@chris-wilson.co.uk

diff --git a/drivers/char/agp/intel-gtt.c b/drivers/char/agp/intel-gtt.c
index 4b34a5195c65..5bfdf222d5f9 100644
--- a/drivers/char/agp/intel-gtt.c
+++ b/drivers/char/agp/intel-gtt.c
@@ -304,8 +304,10 @@ static int intel_gtt_setup_scratch_page(void)
 	if (intel_private.needs_dmar) {
 		dma_addr = pci_map_page(intel_private.pcidev, page, 0,
 				    PAGE_SIZE, PCI_DMA_BIDIRECTIONAL);
-		if (pci_dma_mapping_error(intel_private.pcidev, dma_addr))
+		if (pci_dma_mapping_error(intel_private.pcidev, dma_addr)) {
+			__free_page(page);
 			return -EINVAL;
+		}
 
 		intel_private.scratch_page_dma = dma_addr;
 	} else</pre><hr><pre>commit 8816cd726a4fee197af2d851cbe25991ae19ea14
Author: Qiushi Wu &lt;wu000273@umn.edu&gt;
Date:   Sun May 3 13:22:35 2020 -0500

    rtc: mc13xxx: fix a double-unlock issue
    
    In function mc13xxx_rtc_probe, the mc13xxx_unlock() is called
    before rtc_register_device(). But in the error path of
    rtc_register_device(), the mc13xxx_unlock() is called again,
    which causes a double-unlock problem. Thus add a call of the
    function “mc13xxx_lock” in an if branch for the completion
    of the exception handling.
    
    Fixes: e4ae7023e182a ("rtc: mc13xxx: set range")
    Signed-off-by: Qiushi Wu &lt;wu000273@umn.edu&gt;
    Link: https://lore.kernel.org/r/20200503182235.1652-1-wu000273@umn.edu
    Signed-off-by: Alexandre Belloni &lt;alexandre.belloni@bootlin.com&gt;

diff --git a/drivers/rtc/rtc-mc13xxx.c b/drivers/rtc/rtc-mc13xxx.c
index afce2c0b4bd6..d6802e6191cb 100644
--- a/drivers/rtc/rtc-mc13xxx.c
+++ b/drivers/rtc/rtc-mc13xxx.c
@@ -308,8 +308,10 @@ static int __init mc13xxx_rtc_probe(struct platform_device *pdev)
 	mc13xxx_unlock(mc13xxx);
 
 	ret = rtc_register_device(priv-&gt;rtc);
-	if (ret)
+	if (ret) {
+		mc13xxx_lock(mc13xxx);
 		goto err_irq_request;
+	}
 
 	return 0;
 </pre><hr><pre>commit bd4af432cc71b5fbfe4833510359a6ad3ada250d
Author: Qiushi Wu &lt;wu000273@umn.edu&gt;
Date:   Sat May 2 17:42:59 2020 -0500

    nfp: abm: fix a memory leak bug
    
    In function nfp_abm_vnic_set_mac, pointer nsp is allocated by nfp_nsp_open.
    But when nfp_nsp_has_hwinfo_lookup fail, the pointer is not released,
    which can lead to a memory leak bug. Fix this issue by adding
    nfp_nsp_close(nsp) in the error path.
    
    Fixes: f6e71efdf9fb1 ("nfp: abm: look up MAC addresses via management FW")
    Signed-off-by: Qiushi Wu &lt;wu000273@umn.edu&gt;
    Acked-by: Jakub Kicinski &lt;kuba@kernel.org&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/net/ethernet/netronome/nfp/abm/main.c b/drivers/net/ethernet/netronome/nfp/abm/main.c
index 9183b3e85d21..354efffac0f9 100644
--- a/drivers/net/ethernet/netronome/nfp/abm/main.c
+++ b/drivers/net/ethernet/netronome/nfp/abm/main.c
@@ -283,6 +283,7 @@ nfp_abm_vnic_set_mac(struct nfp_pf *pf, struct nfp_abm *abm, struct nfp_net *nn,
 	if (!nfp_nsp_has_hwinfo_lookup(nsp)) {
 		nfp_warn(pf-&gt;cpp, "NSP doesn't support PF MAC generation\n");
 		eth_hw_addr_random(nn-&gt;dp.netdev);
+		nfp_nsp_close(nsp);
 		return;
 	}
 </pre><hr><pre>commit 1d7a7128a2e9e1f137c99b0a44e94d70a77343e3
Author: Qiushi Wu &lt;wu000273@umn.edu&gt;
Date:   Sat May 2 18:33:38 2020 -0500

    power: supply: core: fix memory leak in HWMON error path
    
    In function power_supply_add_hwmon_sysfs(), psyhw-&gt;props is
    allocated by bitmap_zalloc(). But this pointer is not deallocated
    when devm_add_action fail,  which lead to a memory leak bug. To fix
    this, we replace devm_add_action with devm_add_action_or_reset.
    
    Cc: stable@kernel.org
    Fixes: e67d4dfc9ff19 ("power: supply: Add HWMON compatibility layer")
    Signed-off-by: Qiushi Wu &lt;wu000273@umn.edu&gt;
    Signed-off-by: Sebastian Reichel &lt;sebastian.reichel@collabora.com&gt;

diff --git a/drivers/power/supply/power_supply_hwmon.c b/drivers/power/supply/power_supply_hwmon.c
index f5d538485aaa..7fe4b6b6ddc8 100644
--- a/drivers/power/supply/power_supply_hwmon.c
+++ b/drivers/power/supply/power_supply_hwmon.c
@@ -358,7 +358,7 @@ int power_supply_add_hwmon_sysfs(struct power_supply *psy)
 		goto error;
 	}
 
-	ret = devm_add_action(dev, power_supply_hwmon_bitmap_free,
+	ret = devm_add_action_or_reset(dev, power_supply_hwmon_bitmap_free,
 			      psyhw-&gt;props);
 	if (ret)
 		goto error;</pre><hr><pre>commit 639c0a5b0503fb57127fa8972208d43020a9bcf6
Author: Aditya Pakki &lt;pakki001@umn.edu&gt;
Date:   Thu Dec 19 21:29:24 2019 +0100

    media: media/saa7146: fix incorrect assertion in saa7146_buffer_finish
    
    In saa7146_buffer_finish, the code for q-&gt;curr to be NULL is
    already present and asserting for NULL is unnecessary. This patch
    elimiates such a check.
    
    Signed-off-by: Aditya Pakki &lt;pakki001@umn.edu&gt;
    Signed-off-by: Hans Verkuil &lt;hverkuil-cisco@xs4all.nl&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/media/common/saa7146/saa7146_fops.c b/drivers/media/common/saa7146/saa7146_fops.c
index aabb830e7468..d7e83b55ddca 100644
--- a/drivers/media/common/saa7146/saa7146_fops.c
+++ b/drivers/media/common/saa7146/saa7146_fops.c
@@ -97,8 +97,6 @@ void saa7146_buffer_finish(struct saa7146_dev *dev,
 	DEB_EE("dev:%p, dmaq:%p, state:%d\n", dev, q, state);
 	DEB_EE("q-&gt;curr:%p\n", q-&gt;curr);
 
-	BUG_ON(!q-&gt;curr);
-
 	/* finish current buffer */
 	if (NULL == q-&gt;curr) {
 		DEB_D("aiii. no current buffer\n");</pre><hr><pre>commit 2c2a7552dd6465e8fde6bc9cccf8d66ed1c1eb72
Author: Aditya Pakki &lt;pakki001@umn.edu&gt;
Date:   Fri Feb 14 12:21:01 2020 -0600

    ecryptfs: replace BUG_ON with error handling code
    
    In crypt_scatterlist, if the crypt_stat argument is not set up
    correctly, the kernel crashes. Instead, by returning an error code
    upstream, the error is handled safely.
    
    The issue is detected via a static analysis tool written by us.
    
    Fixes: 237fead619984 (ecryptfs: fs/Makefile and fs/Kconfig)
    Signed-off-by: Aditya Pakki &lt;pakki001@umn.edu&gt;
    Signed-off-by: Tyler Hicks &lt;code@tyhicks.com&gt;

diff --git a/fs/ecryptfs/crypto.c b/fs/ecryptfs/crypto.c
index f91db24bbf3b..a064b408d841 100644
--- a/fs/ecryptfs/crypto.c
+++ b/fs/ecryptfs/crypto.c
@@ -311,8 +311,10 @@ static int crypt_scatterlist(struct ecryptfs_crypt_stat *crypt_stat,
 	struct extent_crypt_result ecr;
 	int rc = 0;
 
-	BUG_ON(!crypt_stat || !crypt_stat-&gt;tfm
-	       || !(crypt_stat-&gt;flags &amp; ECRYPTFS_STRUCT_INITIALIZED));
+	if (!crypt_stat || !crypt_stat-&gt;tfm
+	       || !(crypt_stat-&gt;flags &amp; ECRYPTFS_STRUCT_INITIALIZED))
+		return -EINVAL;
+
 	if (unlikely(ecryptfs_verbosity &gt; 0)) {
 		ecryptfs_printk(KERN_DEBUG, "Key size [%zd]; key:\n",
 				crypt_stat-&gt;key_size);</pre><hr><pre>commit 8d7a577d04e8ce24b1b81ee44ec8cd1dda2a9cd9
Author: Aditya Pakki &lt;pakki001@umn.edu&gt;
Date:   Tue Jan 21 17:33:49 2020 -0600

    clk: samsung: Remove redundant check in samsung_cmu_register_one
    
    Consistent with other instances of samsung_clk_init, the check
    if ctx is NULL is redundant. The function currently does not
    return NULL.
    
    Signed-off-by: Aditya Pakki &lt;pakki001@umn.edu&gt;
    Link: https://lkml.kernel.org/r/20200121233349.28627-1-pakki001@umn.edu
    Acked-by: Chanwoo Choi &lt;cw00.choi@samsung.com&gt;
    Signed-off-by: Stephen Boyd &lt;sboyd@kernel.org&gt;

diff --git a/drivers/clk/samsung/clk.c b/drivers/clk/samsung/clk.c
index dad31308c071..1949ae7851b2 100644
--- a/drivers/clk/samsung/clk.c
+++ b/drivers/clk/samsung/clk.c
@@ -356,10 +356,6 @@ struct samsung_clk_provider * __init samsung_cmu_register_one(
 	}
 
 	ctx = samsung_clk_init(np, reg_base, cmu-&gt;nr_clk_ids);
-	if (!ctx) {
-		panic("%s: unable to allocate ctx\n", __func__);
-		return ctx;
-	}
 
 	if (cmu-&gt;pll_clks)
 		samsung_clk_register_pll(ctx, cmu-&gt;pll_clks, cmu-&gt;nr_pll_clks,</pre>
    <div class="pagination">
        <a href='7_7.html'>&lt;&lt;Prev</a><a href='7.html'>1</a><a href='7_2.html'>2</a><a href='7_3.html'>3</a><a href='7_4.html'>4</a><a href='7_5.html'>5</a><a href='7_6.html'>6</a><a href='7_7.html'>7</a><span>[8]</span><a href='7_9.html'>9</a><a href='7_10.html'>10</a><a href='7_11.html'>11</a><a href='7_12.html'>12</a><a href='7_13.html'>13</a><a href='7_14.html'>14</a><a href='7_15.html'>15</a><a href='7_16.html'>16</a><a href='7_17.html'>17</a><a href='7_18.html'>18</a><a href='7_19.html'>19</a><a href='7_20.html'>20</a><a href='7_21.html'>21</a><a href='7_22.html'>22</a><a href='7_23.html'>23</a><a href='7_24.html'>24</a><a href='7_25.html'>25</a><a href='7_26.html'>26</a><a href='7_27.html'>27</a><a href='7_28.html'>28</a><a href='7_29.html'>29</a><a href='7_30.html'>30</a><a href='7_9.html'>Next&gt;&gt;</a>
    <div>
</body>

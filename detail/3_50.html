<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by University of Virginia, Charlottesville</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by University of Virginia, Charlottesville</h1>
    <div class="pagination">
        <a href='3_49.html'>&lt;&lt;Prev</a><a href='3.html'>1</a><a href='3_2.html'>2</a><a href='3_3.html'>3</a><a href='3_4.html'>4</a><a href='3_5.html'>5</a><a href='3_6.html'>6</a><a href='3_7.html'>7</a><a href='3_8.html'>8</a><a href='3_9.html'>9</a><a href='3_10.html'>10</a><a href='3_11.html'>11</a><a href='3_12.html'>12</a><a href='3_13.html'>13</a><a href='3_14.html'>14</a><a href='3_15.html'>15</a><a href='3_16.html'>16</a><a href='3_17.html'>17</a><a href='3_18.html'>18</a><a href='3_19.html'>19</a><a href='3_20.html'>20</a><a href='3_21.html'>21</a><a href='3_22.html'>22</a><a href='3_23.html'>23</a><a href='3_24.html'>24</a><a href='3_25.html'>25</a><a href='3_26.html'>26</a><a href='3_27.html'>27</a><a href='3_28.html'>28</a><a href='3_29.html'>29</a><a href='3_30.html'>30</a><a href='3_31.html'>31</a><a href='3_32.html'>32</a><a href='3_33.html'>33</a><a href='3_34.html'>34</a><a href='3_35.html'>35</a><a href='3_36.html'>36</a><a href='3_37.html'>37</a><a href='3_38.html'>38</a><a href='3_39.html'>39</a><a href='3_40.html'>40</a><a href='3_41.html'>41</a><a href='3_42.html'>42</a><a href='3_43.html'>43</a><a href='3_44.html'>44</a><a href='3_45.html'>45</a><a href='3_46.html'>46</a><a href='3_47.html'>47</a><a href='3_48.html'>48</a><a href='3_49.html'>49</a><span>[50]</span><a href='3_51.html'>51</a><a href='3_52.html'>52</a><a href='3_53.html'>53</a><a href='3_54.html'>54</a><a href='3_55.html'>55</a><a href='3_56.html'>56</a><a href='3_57.html'>57</a><a href='3_58.html'>58</a><a href='3_59.html'>59</a><a href='3_60.html'>60</a><a href='3_61.html'>61</a><a href='3_62.html'>62</a><a href='3_63.html'>63</a><a href='3_64.html'>64</a><a href='3_65.html'>65</a><a href='3_66.html'>66</a><a href='3_67.html'>67</a><a href='3_68.html'>68</a><a href='3_69.html'>69</a><a href='3_70.html'>70</a><a href='3_71.html'>71</a><a href='3_72.html'>72</a><a href='3_73.html'>73</a><a href='3_74.html'>74</a><a href='3_75.html'>75</a><a href='3_76.html'>76</a><a href='3_77.html'>77</a><a href='3_78.html'>78</a><a href='3_79.html'>79</a><a href='3_80.html'>80</a><a href='3_81.html'>81</a><a href='3_82.html'>82</a><a href='3_83.html'>83</a><a href='3_51.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit aedb444a577184f7e113e1461fccc0ef10ffde55
Author: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
Date:   Tue Jul 28 13:46:24 2009 -0400

    Staging: hv: remove WAITEVENT typedef
    
    Remove the WAITEVENT typedef and also replace HANDLE types that use
    the WaitEvent calls with struct osd_waitevent.
    
    Signed-off-by: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
    Cc: Hank Janssen &lt;hjanssen@microsoft.com&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@suse.de&gt;

diff --git a/drivers/staging/hv/ChannelMgmt.h b/drivers/staging/hv/ChannelMgmt.h
index 6208cd847e10..7cf01738e42c 100644
--- a/drivers/staging/hv/ChannelMgmt.h
+++ b/drivers/staging/hv/ChannelMgmt.h
@@ -115,7 +115,7 @@ typedef struct _VMBUS_CHANNEL_MSGINFO {
 	LIST_ENTRY		SubMsgList;
 
 	/* Synchronize the request/response if needed */
-	HANDLE			WaitEvent;
+	struct osd_waitevent *WaitEvent;
 
 	VMBUS_CHANNEL_MESSAGE_RESPONSE Response;
 
diff --git a/drivers/staging/hv/NetVsc.h b/drivers/staging/hv/NetVsc.h
index f7c16801eb3e..7636654c2528 100644
--- a/drivers/staging/hv/NetVsc.h
+++ b/drivers/staging/hv/NetVsc.h
@@ -78,7 +78,7 @@ struct NETVSC_DEVICE {
 	PNVSP_1_RECEIVE_BUFFER_SECTION	ReceiveSections;
 
 	/* Used for NetVSP initialization protocol */
-	HANDLE							ChannelInitEvent;
+	struct osd_waitevent *ChannelInitEvent;
 	NVSP_MESSAGE					ChannelInitPacket;
 
 	NVSP_MESSAGE					RevokePacket;
diff --git a/drivers/staging/hv/RndisFilter.c b/drivers/staging/hv/RndisFilter.c
index cac07273ca30..38b9a11542a6 100644
--- a/drivers/staging/hv/RndisFilter.c
+++ b/drivers/staging/hv/RndisFilter.c
@@ -61,7 +61,7 @@ typedef struct _RNDIS_DEVICE {
 
 typedef struct _RNDIS_REQUEST {
 	LIST_ENTRY					ListEntry;
-	HANDLE						WaitEvent;
+	struct osd_waitevent *WaitEvent;
 
 	/* FIXME: We assumed a fixed size response here. If we do ever need to handle a bigger response, */
 	/* we can either define a max response message or add a response buffer variable above this field */
diff --git a/drivers/staging/hv/StorVsc.c b/drivers/staging/hv/StorVsc.c
index 26d3f1418318..c55146c6c7a4 100644
--- a/drivers/staging/hv/StorVsc.c
+++ b/drivers/staging/hv/StorVsc.c
@@ -47,7 +47,7 @@ typedef struct _STORVSC_REQUEST_EXTENSION {
 	struct hv_device *Device;
 
 	/* Synchronize the request/response if needed */
-	HANDLE							WaitEvent;
+	struct osd_waitevent *WaitEvent;
 
 	VSTOR_PACKET					VStorPacket;
 } STORVSC_REQUEST_EXTENSION;
diff --git a/drivers/staging/hv/VmbusPrivate.h b/drivers/staging/hv/VmbusPrivate.h
index 75013bc9e255..bf47408258e0 100644
--- a/drivers/staging/hv/VmbusPrivate.h
+++ b/drivers/staging/hv/VmbusPrivate.h
@@ -102,7 +102,7 @@ struct VMBUS_MSGINFO {
 	LIST_ENTRY			MsgListEntry;
 
 	/* Synchronize the request/response if needed */
-	HANDLE				WaitEvent;
+	struct osd_waitevent *WaitEvent;
 
 	/* The message itself */
 	unsigned char		Msg[0];
diff --git a/drivers/staging/hv/include/osd.h b/drivers/staging/hv/include/osd.h
index 6a5675f4b266..470d8021b030 100644
--- a/drivers/staging/hv/include/osd.h
+++ b/drivers/staging/hv/include/osd.h
@@ -52,6 +52,12 @@ typedef struct {
 	unsigned char	Data[16];
 } GUID;
 
+struct osd_waitevent {
+	int	condition;
+	wait_queue_head_t event;
+};
+
+
 typedef void (*PFN_WORKITEM_CALLBACK)(void* context);
 typedef void (*PFN_TIMER_CALLBACK)(void* context);
 
@@ -122,13 +128,13 @@ extern void TimerClose(HANDLE hTimer);
 extern int TimerStop(HANDLE hTimer);
 extern void TimerStart(HANDLE hTimer, u32 expirationInUs);
 
-extern HANDLE WaitEventCreate(void);
-extern void WaitEventClose(HANDLE hWait);
-extern void WaitEventSet(HANDLE hWait);
-extern int	WaitEventWait(HANDLE hWait);
+extern struct osd_waitevent *WaitEventCreate(void);
+extern void WaitEventClose(struct osd_waitevent *waitEvent);
+extern void WaitEventSet(struct osd_waitevent *waitEvent);
+extern int	WaitEventWait(struct osd_waitevent *waitEvent);
 
-/* If &gt;0, hWait got signaled. If ==0, timeout. If &lt; 0, error */
-extern int	WaitEventWaitEx(HANDLE hWait, u32 TimeoutInMs);
+/* If &gt;0, waitEvent got signaled. If ==0, timeout. If &lt; 0, error */
+extern int	WaitEventWaitEx(struct osd_waitevent *waitEvent, u32 TimeoutInMs);
 
 
 #define GetVirtualAddress Physical2LogicalAddr
diff --git a/drivers/staging/hv/osd.c b/drivers/staging/hv/osd.c
index 4cee746d01c4..50a2ca7dde2e 100644
--- a/drivers/staging/hv/osd.c
+++ b/drivers/staging/hv/osd.c
@@ -55,12 +55,6 @@ typedef struct _TIMER {
 	void* context;
 }TIMER;
 
-
-typedef struct _WAITEVENT {
-	int	condition;
-	wait_queue_head_t event;
-} WAITEVENT;
-
 typedef struct _WORKITEM {
 	struct work_struct work;
 	PFN_WORKITEM_CALLBACK callback;
@@ -220,9 +214,9 @@ void TimerClose(HANDLE hTimer)
 	kfree(t);
 }
 
-HANDLE WaitEventCreate(void)
+struct osd_waitevent *WaitEventCreate(void)
 {
-	WAITEVENT* wait = kmalloc(sizeof(WAITEVENT), GFP_KERNEL);
+	struct osd_waitevent *wait = kmalloc(sizeof(struct osd_waitevent), GFP_KERNEL);
 	if (!wait)
 	{
 		return NULL;
@@ -233,38 +227,34 @@ HANDLE WaitEventCreate(void)
 	return wait;
 }
 
-void WaitEventClose(HANDLE hWait)
+void WaitEventClose(struct osd_waitevent *waitEvent)
 {
-	WAITEVENT* waitEvent = (WAITEVENT* )hWait;
 	kfree(waitEvent);
 }
 
-void WaitEventSet(HANDLE hWait)
+void WaitEventSet(struct osd_waitevent *waitEvent)
 {
-	WAITEVENT* waitEvent = (WAITEVENT* )hWait;
 	waitEvent-&gt;condition = 1;
 	wake_up_interruptible(&amp;waitEvent-&gt;event);
 }
 
-int WaitEventWait(HANDLE hWait)
+int WaitEventWait(struct osd_waitevent *waitEvent)
 {
 	int ret=0;
-	WAITEVENT* waitEvent = (WAITEVENT* )hWait;
 
-	ret= wait_event_interruptible(waitEvent-&gt;event,
-		waitEvent-&gt;condition);
+	ret = wait_event_interruptible(waitEvent-&gt;event,
+				       waitEvent-&gt;condition);
 	waitEvent-&gt;condition = 0;
 	return ret;
 }
 
-int WaitEventWaitEx(HANDLE hWait, u32 TimeoutInMs)
+int WaitEventWaitEx(struct osd_waitevent *waitEvent, u32 TimeoutInMs)
 {
 	int ret=0;
-	WAITEVENT* waitEvent = (WAITEVENT* )hWait;
 
-	ret= wait_event_interruptible_timeout(waitEvent-&gt;event,
-											waitEvent-&gt;condition,
-											msecs_to_jiffies(TimeoutInMs));
+	ret = wait_event_interruptible_timeout(waitEvent-&gt;event,
+					       waitEvent-&gt;condition,
+					       msecs_to_jiffies(TimeoutInMs));
 	waitEvent-&gt;condition = 0;
 	return ret;
 }</pre><hr><pre>commit b578852955765bfbe12bd31ac1e7888a3deaff40
Author: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
Date:   Tue Jul 28 13:46:23 2009 -0400

    Staging: hv: comment out blkdev variable in blkvsc_ioctl
    
    This variable generated an unused variable warning due to other code
    in the fuction being commented out.  This comments out the variable
    defination so that the code compiles without warnings.
    
    Signed-off-by: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
    Cc: Hank Janssen &lt;hjanssen@microsoft.com&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@suse.de&gt;

diff --git a/drivers/staging/hv/blkvsc_drv.c b/drivers/staging/hv/blkvsc_drv.c
index dff950b591c1..988de64be675 100644
--- a/drivers/staging/hv/blkvsc_drv.c
+++ b/drivers/staging/hv/blkvsc_drv.c
@@ -1461,7 +1461,7 @@ int blkvsc_getgeo(struct block_device *bd, struct hd_geometry *hg)
 static int blkvsc_ioctl(struct block_device *bd, fmode_t mode,
 			unsigned cmd, unsigned long argument)
 {
-	struct block_device_context *blkdev = bd-&gt;bd_disk-&gt;private_data;
+/*	struct block_device_context *blkdev = bd-&gt;bd_disk-&gt;private_data; */
 	int ret=0;
 
 	switch (cmd)</pre><hr><pre>commit 2295ba2e7c4141e864f66830b07e635245233a3d
Author: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
Date:   Tue Jul 28 13:46:22 2009 -0400

    Staging: hv: check return value of driver_for_each_device()
    
    The return value of driver_for_each_device() is now checked.  A
    non-zero value simply generates a warning message, but it's better
    than not checking at all.
    
    Signed-off-by: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
    Cc: Hank Janssen &lt;hjanssen@microsoft.com&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@suse.de&gt;

diff --git a/drivers/staging/hv/blkvsc_drv.c b/drivers/staging/hv/blkvsc_drv.c
index d595c3b9cdf6..dff950b591c1 100644
--- a/drivers/staging/hv/blkvsc_drv.c
+++ b/drivers/staging/hv/blkvsc_drv.c
@@ -218,8 +218,8 @@ void blkvsc_drv_exit(void)
 {
 	STORVSC_DRIVER_OBJECT *storvsc_drv_obj=&amp;g_blkvsc_drv.drv_obj;
 	struct driver_context *drv_ctx=&amp;g_blkvsc_drv.drv_ctx;
-
 	struct device *current_dev=NULL;
+	int ret;
 
 	DPRINT_ENTER(BLKVSC_DRV);
 
@@ -228,7 +228,14 @@ void blkvsc_drv_exit(void)
 		current_dev = NULL;
 
 		/* Get the device */
-		driver_for_each_device(&amp;drv_ctx-&gt;driver, NULL, (void*)&amp;current_dev, blkvsc_drv_exit_cb);
+		ret = driver_for_each_device(&amp;drv_ctx-&gt;driver, NULL,
+					     (void *) &amp;current_dev,
+					     blkvsc_drv_exit_cb);
+
+		if (ret)
+			DPRINT_WARN(BLKVSC_DRV,
+				    "driver_for_each_device returned %d", ret);
+
 
 		if (current_dev == NULL)
 			break;
diff --git a/drivers/staging/hv/netvsc_drv.c b/drivers/staging/hv/netvsc_drv.c
index f0df216028ad..9010f0e2ce68 100644
--- a/drivers/staging/hv/netvsc_drv.c
+++ b/drivers/staging/hv/netvsc_drv.c
@@ -638,8 +638,8 @@ void netvsc_drv_exit(void)
 {
 	NETVSC_DRIVER_OBJECT *netvsc_drv_obj=&amp;g_netvsc_drv.drv_obj;
 	struct driver_context *drv_ctx=&amp;g_netvsc_drv.drv_ctx;
-
 	struct device *current_dev=NULL;
+	int ret;
 
 	DPRINT_ENTER(NETVSC_DRV);
 
@@ -648,7 +648,14 @@ void netvsc_drv_exit(void)
 		current_dev = NULL;
 
 		/* Get the device */
-		driver_for_each_device(&amp;drv_ctx-&gt;driver, NULL, (void*)&amp;current_dev, netvsc_drv_exit_cb);
+		ret = driver_for_each_device(&amp;drv_ctx-&gt;driver, NULL,
+					     (void *) &amp;current_dev,
+					     netvsc_drv_exit_cb);
+
+		if (ret)
+			DPRINT_WARN(NETVSC_DRV,
+				    "driver_for_each_device returned %d", ret);
+
 
 		if (current_dev == NULL)
 			break;
diff --git a/drivers/staging/hv/storvsc_drv.c b/drivers/staging/hv/storvsc_drv.c
index 385e84bd52cc..120ec52fe9fd 100644
--- a/drivers/staging/hv/storvsc_drv.c
+++ b/drivers/staging/hv/storvsc_drv.c
@@ -188,8 +188,8 @@ void storvsc_drv_exit(void)
 {
 	STORVSC_DRIVER_OBJECT *storvsc_drv_obj=&amp;g_storvsc_drv.drv_obj;
 	struct driver_context *drv_ctx=&amp;g_storvsc_drv.drv_ctx;
-
 	struct device *current_dev=NULL;
+	int ret;
 
 	DPRINT_ENTER(STORVSC_DRV);
 
@@ -198,7 +198,13 @@ void storvsc_drv_exit(void)
 		current_dev = NULL;
 
 		/* Get the device */
-		driver_for_each_device(&amp;drv_ctx-&gt;driver, NULL, (void*)&amp;current_dev, storvsc_drv_exit_cb);
+		ret = driver_for_each_device(&amp;drv_ctx-&gt;driver, NULL,
+					     (void *) &amp;current_dev,
+					     storvsc_drv_exit_cb);
+
+		if (ret)
+			DPRINT_WARN(STORVSC_DRV,
+				    "driver_for_each_device returned %d", ret);
 
 		if (current_dev == NULL)
 			break;</pre><hr><pre>commit df8d9b1f6deb468dd6752f0cd1029157c15248fd
Author: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
Date:   Mon Jul 27 16:47:45 2009 -0400

    Staging: hv: Remove WORKQUEUE typedef
    
    WORKQUEUE was a wrapper around struct workqueue_struct so just use
    that instead.
    
    Signed-off-by: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
    Cc: Hank Janssen &lt;hjanssen@microsoft.com&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@suse.de&gt;

diff --git a/drivers/staging/hv/ChannelMgmt.h b/drivers/staging/hv/ChannelMgmt.h
index c4aa95c3f39a..5831d1929f7e 100644
--- a/drivers/staging/hv/ChannelMgmt.h
+++ b/drivers/staging/hv/ChannelMgmt.h
@@ -64,7 +64,7 @@ typedef struct _VMBUS_CHANNEL {
 	RING_BUFFER_INFO			Outbound;	/* send to parent */
 	RING_BUFFER_INFO			Inbound;	/* receive from parent */
 	spinlock_t inbound_lock;
-	HANDLE						ControlWQ;
+	struct workqueue_struct *ControlWQ;
 
 	/* Channel callback are invoked in this workqueue context */
 	/* HANDLE						dataWorkQueue; */
diff --git a/drivers/staging/hv/VmbusPrivate.h b/drivers/staging/hv/VmbusPrivate.h
index 40e5962dfb72..7182d4d200f3 100644
--- a/drivers/staging/hv/VmbusPrivate.h
+++ b/drivers/staging/hv/VmbusPrivate.h
@@ -93,7 +93,7 @@ struct VMBUS_CONNECTION {
 	LIST_ENTRY							ChannelList;
 	spinlock_t channel_lock;
 
-	HANDLE								WorkQueue;
+	struct workqueue_struct *WorkQueue;
 };
 
 
diff --git a/drivers/staging/hv/include/osd.h b/drivers/staging/hv/include/osd.h
index faae7cc5ec0d..6a5675f4b266 100644
--- a/drivers/staging/hv/include/osd.h
+++ b/drivers/staging/hv/include/osd.h
@@ -143,9 +143,11 @@ void* PageMapVirtualAddress(unsigned long Pfn);
 void PageUnmapVirtualAddress(void* VirtAddr);
 
 
-extern HANDLE WorkQueueCreate(char* name);
-extern void WorkQueueClose(HANDLE hWorkQueue);
-extern int WorkQueueQueueWorkItem(HANDLE hWorkQueue, PFN_WORKITEM_CALLBACK workItem, void* context);
+extern struct workqueue_struct *WorkQueueCreate(char* name);
+extern void WorkQueueClose(struct workqueue_struct *hWorkQueue);
+extern int WorkQueueQueueWorkItem(struct workqueue_struct *hWorkQueue,
+				  PFN_WORKITEM_CALLBACK workItem,
+				  void *context);
 
 extern void QueueWorkItem(PFN_WORKITEM_CALLBACK workItem, void* context);
 
diff --git a/drivers/staging/hv/osd.c b/drivers/staging/hv/osd.c
index e683735706d1..4cee746d01c4 100644
--- a/drivers/staging/hv/osd.c
+++ b/drivers/staging/hv/osd.c
@@ -61,10 +61,6 @@ typedef struct _WAITEVENT {
 	wait_queue_head_t event;
 } WAITEVENT;
 
-typedef struct _WORKQUEUE {
-	struct workqueue_struct *queue;
-} WORKQUEUE;
-
 typedef struct _WORKITEM {
 	struct work_struct work;
 	PFN_WORKITEM_CALLBACK callback;
@@ -303,31 +299,25 @@ void WorkItemCallback(struct work_struct *work)
 	kfree(w);
 }
 
-HANDLE WorkQueueCreate(char* name)
+struct workqueue_struct *WorkQueueCreate(char *name)
 {
-	WORKQUEUE *wq = kmalloc(sizeof(WORKQUEUE), GFP_KERNEL);
-	if (!wq)
-	{
+	struct workqueue_struct *wq;
+	wq = create_workqueue(name);
+	if (unlikely(!wq))
 		return NULL;
-	}
-	wq-&gt;queue = create_workqueue(name);
-
 	return wq;
 }
 
-void WorkQueueClose(HANDLE hWorkQueue)
+void WorkQueueClose(struct workqueue_struct *hWorkQueue)
 {
-	WORKQUEUE *wq = (WORKQUEUE *)hWorkQueue;
-
-	destroy_workqueue(wq-&gt;queue);
-
+	destroy_workqueue(hWorkQueue);
 	return;
 }
 
-int WorkQueueQueueWorkItem(HANDLE hWorkQueue, PFN_WORKITEM_CALLBACK workItem, void* context)
+int WorkQueueQueueWorkItem(struct workqueue_struct *hWorkQueue,
+			   PFN_WORKITEM_CALLBACK workItem,
+			   void* context)
 {
-	WORKQUEUE *wq = (WORKQUEUE *)hWorkQueue;
-
 	WORKITEM* w = kmalloc(sizeof(WORKITEM), GFP_ATOMIC);
 	if (!w)
 	{
@@ -337,7 +327,7 @@ int WorkQueueQueueWorkItem(HANDLE hWorkQueue, PFN_WORKITEM_CALLBACK workItem, vo
 	w-&gt;callback = workItem,
 	w-&gt;context = context;
 	INIT_WORK(&amp;w-&gt;work, WorkItemCallback);
-	return queue_work(wq-&gt;queue, &amp;w-&gt;work);
+	return queue_work(hWorkQueue, &amp;w-&gt;work);
 }
 
 void QueueWorkItem(PFN_WORKITEM_CALLBACK workItem, void* context)</pre><hr><pre>commit d1af1db7d6cd7818e92531e170cc65510dd57692
Author: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
Date:   Mon Jul 27 16:47:44 2009 -0400

    Staging: hv: remove NETVSC_DEVICE typedef
    
    Signed-off-by: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
    Cc: Hank Janssen &lt;hjanssen@microsoft.com&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@suse.de&gt;

diff --git a/drivers/staging/hv/NetVsc.c b/drivers/staging/hv/NetVsc.c
index 111e149d88bb..c0d5dc39ccd1 100644
--- a/drivers/staging/hv/NetVsc.c
+++ b/drivers/staging/hv/NetVsc.c
@@ -71,12 +71,12 @@ NetVscInitializeReceiveBufferWithNetVsp(
 
 static int
 NetVscDestroySendBuffer(
-	NETVSC_DEVICE	*NetDevice
+	struct NETVSC_DEVICE	*NetDevice
 	);
 
 static int
 NetVscDestroyReceiveBuffer(
-	NETVSC_DEVICE	*NetDevice
+	struct NETVSC_DEVICE	*NetDevice
 	);
 
 static int
@@ -113,11 +113,11 @@ NetVscSendReceiveCompletion(
 	u64			TransactionId
 	);
 
-static inline NETVSC_DEVICE* AllocNetDevice(DEVICE_OBJECT *Device)
+static inline struct NETVSC_DEVICE *AllocNetDevice(DEVICE_OBJECT *Device)
 {
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 
-	netDevice = kzalloc(sizeof(NETVSC_DEVICE), GFP_KERNEL);
+	netDevice = kzalloc(sizeof(struct NETVSC_DEVICE), GFP_KERNEL);
 	if (!netDevice)
 		return NULL;
 
@@ -130,7 +130,7 @@ static inline NETVSC_DEVICE* AllocNetDevice(DEVICE_OBJECT *Device)
 	return netDevice;
 }
 
-static inline void FreeNetDevice(NETVSC_DEVICE *Device)
+static inline void FreeNetDevice(struct NETVSC_DEVICE *Device)
 {
 	ASSERT(Device-&gt;RefCount == 0);
 	Device-&gt;Device-&gt;Extension = NULL;
@@ -139,11 +139,11 @@ static inline void FreeNetDevice(NETVSC_DEVICE *Device)
 
 
 /* Get the net device object iff exists and its refcount &gt; 1 */
-static inline NETVSC_DEVICE* GetOutboundNetDevice(DEVICE_OBJECT	*Device)
+static inline struct NETVSC_DEVICE *GetOutboundNetDevice(DEVICE_OBJECT	*Device)
 {
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 
-	netDevice = (NETVSC_DEVICE*)Device-&gt;Extension;
+	netDevice = (struct NETVSC_DEVICE*)Device-&gt;Extension;
 	if (netDevice &amp;&amp; netDevice-&gt;RefCount &gt; 1)
 	{
 		InterlockedIncrement(&amp;netDevice-&gt;RefCount);
@@ -157,11 +157,11 @@ static inline NETVSC_DEVICE* GetOutboundNetDevice(DEVICE_OBJECT	*Device)
 }
 
 /* Get the net device object iff exists and its refcount &gt; 0 */
-static inline NETVSC_DEVICE* GetInboundNetDevice(DEVICE_OBJECT	*Device)
+static inline struct NETVSC_DEVICE *GetInboundNetDevice(DEVICE_OBJECT	*Device)
 {
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 
-	netDevice = (NETVSC_DEVICE*)Device-&gt;Extension;
+	netDevice = (struct NETVSC_DEVICE*)Device-&gt;Extension;
 	if (netDevice &amp;&amp; netDevice-&gt;RefCount)
 	{
 		InterlockedIncrement(&amp;netDevice-&gt;RefCount);
@@ -176,19 +176,19 @@ static inline NETVSC_DEVICE* GetInboundNetDevice(DEVICE_OBJECT	*Device)
 
 static inline void PutNetDevice(DEVICE_OBJECT *Device)
 {
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 
-	netDevice = (NETVSC_DEVICE*)Device-&gt;Extension;
+	netDevice = (struct NETVSC_DEVICE*)Device-&gt;Extension;
 	ASSERT(netDevice);
 
 	InterlockedDecrement(&amp;netDevice-&gt;RefCount);
 }
 
-static inline NETVSC_DEVICE* ReleaseOutboundNetDevice(DEVICE_OBJECT *Device)
+static inline struct NETVSC_DEVICE *ReleaseOutboundNetDevice(DEVICE_OBJECT *Device)
 {
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 
-	netDevice = (NETVSC_DEVICE*)Device-&gt;Extension;
+	netDevice = (struct NETVSC_DEVICE*)Device-&gt;Extension;
 	if (netDevice == NULL)
 		return NULL;
 
@@ -201,11 +201,11 @@ static inline NETVSC_DEVICE* ReleaseOutboundNetDevice(DEVICE_OBJECT *Device)
 	return netDevice;
 }
 
-static inline NETVSC_DEVICE* ReleaseInboundNetDevice(DEVICE_OBJECT *Device)
+static inline struct NETVSC_DEVICE *ReleaseInboundNetDevice(DEVICE_OBJECT *Device)
 {
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 
-	netDevice = (NETVSC_DEVICE*)Device-&gt;Extension;
+	netDevice = (struct NETVSC_DEVICE*)Device-&gt;Extension;
 	if (netDevice == NULL)
 		return NULL;
 
@@ -272,7 +272,7 @@ NetVscInitializeReceiveBufferWithNetVsp(
 	)
 {
 	int ret=0;
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 	NVSP_MESSAGE *initPacket;
 
 	DPRINT_ENTER(NETVSC);
@@ -401,7 +401,7 @@ NetVscInitializeSendBufferWithNetVsp(
 	)
 {
 	int ret=0;
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 	NVSP_MESSAGE *initPacket;
 
 	DPRINT_ENTER(NETVSC);
@@ -496,7 +496,7 @@ NetVscInitializeSendBufferWithNetVsp(
 
 static int
 NetVscDestroyReceiveBuffer(
-	NETVSC_DEVICE	*NetDevice
+	struct NETVSC_DEVICE	*NetDevice
 	)
 {
 	NVSP_MESSAGE *revokePacket;
@@ -584,7 +584,7 @@ NetVscDestroyReceiveBuffer(
 
 static int
 NetVscDestroySendBuffer(
-	NETVSC_DEVICE	*NetDevice
+	struct NETVSC_DEVICE	*NetDevice
 	)
 {
 	NVSP_MESSAGE *revokePacket;
@@ -665,7 +665,7 @@ NetVscConnectToVsp(
 	)
 {
 	int ret=0;
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 	NVSP_MESSAGE *initPacket;
 	int ndisVersion;
 
@@ -771,7 +771,7 @@ NetVscConnectToVsp(
 
 static void
 NetVscDisconnectFromVsp(
-	NETVSC_DEVICE	*NetDevice
+	struct NETVSC_DEVICE	*NetDevice
 	)
 {
 	DPRINT_ENTER(NETVSC);
@@ -801,7 +801,7 @@ NetVscOnDeviceAdd(
 	int ret=0;
 	int i;
 
-	NETVSC_DEVICE* netDevice;
+	struct NETVSC_DEVICE *netDevice;
 	NETVSC_PACKET* packet;
 	LIST_ENTRY *entry;
 
@@ -914,7 +914,7 @@ NetVscOnDeviceRemove(
 	DEVICE_OBJECT *Device
 	)
 {
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 	NETVSC_PACKET *netvscPacket;
 	int ret=0;
 	LIST_ENTRY *entry;
@@ -997,7 +997,7 @@ NetVscOnSendCompletion(
 	VMPACKET_DESCRIPTOR *Packet
 	)
 {
-	NETVSC_DEVICE* netDevice;
+	struct NETVSC_DEVICE *netDevice;
 	NVSP_MESSAGE *nvspPacket;
 	NETVSC_PACKET *nvscPacket;
 
@@ -1051,7 +1051,7 @@ NetVscOnSend(
 	NETVSC_PACKET *Packet
 	)
 {
-	NETVSC_DEVICE* netDevice;
+	struct NETVSC_DEVICE *netDevice;
 	int ret=0;
 
 	NVSP_MESSAGE sendMessage;
@@ -1115,7 +1115,7 @@ NetVscOnReceive(
 	VMPACKET_DESCRIPTOR *Packet
 	)
 {
-	NETVSC_DEVICE* netDevice;
+	struct NETVSC_DEVICE *netDevice;
 	VMTRANSFER_PAGE_PACKET_HEADER *vmxferpagePacket;
 	NVSP_MESSAGE *nvspPacket;
 	NETVSC_PACKET *netvscPacket=NULL;
@@ -1359,7 +1359,7 @@ NetVscOnReceiveCompletion(
 {
 	NETVSC_PACKET *packet = (NETVSC_PACKET*)Context;
 	DEVICE_OBJECT *device = (DEVICE_OBJECT*)packet-&gt;Device;
-	NETVSC_DEVICE* netDevice;
+	struct NETVSC_DEVICE *netDevice;
 	u64	transactionId=0;
 	bool fSendReceiveComp = false;
 	unsigned long flags;
@@ -1418,7 +1418,7 @@ NetVscOnChannelCallback(
 	const int netPacketSize=2048;
 	int ret=0;
 	DEVICE_OBJECT *device=(DEVICE_OBJECT*)Context;
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 
 	u32 bytesRecvd;
 	u64 requestId;
diff --git a/drivers/staging/hv/NetVsc.h b/drivers/staging/hv/NetVsc.h
index acc4217fd41a..145b1c5317c1 100644
--- a/drivers/staging/hv/NetVsc.h
+++ b/drivers/staging/hv/NetVsc.h
@@ -54,7 +54,7 @@
 
 
 /* Per netvsc channel-specific */
-typedef struct _NETVSC_DEVICE {
+struct NETVSC_DEVICE {
 	DEVICE_OBJECT					*Device;
 
 	int								RefCount;
@@ -86,6 +86,6 @@ typedef struct _NETVSC_DEVICE {
 
 	/* Holds rndis device info */
 	void							*Extension;
-} NETVSC_DEVICE;
+};
 
 #endif /* _NETVSC_H_ */
diff --git a/drivers/staging/hv/RndisFilter.c b/drivers/staging/hv/RndisFilter.c
index 919166761743..fd483fc88aaf 100644
--- a/drivers/staging/hv/RndisFilter.c
+++ b/drivers/staging/hv/RndisFilter.c
@@ -46,7 +46,7 @@ typedef enum {
 } RNDIS_DEVICE_STATE;
 
 typedef struct _RNDIS_DEVICE {
-	NETVSC_DEVICE			*NetDevice;
+	struct NETVSC_DEVICE			*NetDevice;
 
 	RNDIS_DEVICE_STATE		State;
 	u32					LinkStatus;
@@ -494,7 +494,7 @@ RndisFilterOnReceive(
 	NETVSC_PACKET		*Packet
 	)
 {
-	NETVSC_DEVICE *netDevice = (NETVSC_DEVICE*)Device-&gt;Extension;
+	struct NETVSC_DEVICE *netDevice = (struct NETVSC_DEVICE*)Device-&gt;Extension;
 	RNDIS_DEVICE *rndisDevice;
 	RNDIS_MESSAGE rndisMessage;
 	RNDIS_MESSAGE *rndisHeader;
@@ -933,7 +933,7 @@ RndisFilterOnDeviceAdd(
 	)
 {
 	int ret;
-	NETVSC_DEVICE *netDevice;
+	struct NETVSC_DEVICE *netDevice;
 	RNDIS_DEVICE *rndisDevice;
 	NETVSC_DEVICE_INFO *deviceInfo = (NETVSC_DEVICE_INFO*)AdditionalInfo;
 
@@ -962,7 +962,7 @@ RndisFilterOnDeviceAdd(
 
 	/* Initialize the rndis device */
 
-	netDevice = (NETVSC_DEVICE*)Device-&gt;Extension;
+	netDevice = (struct NETVSC_DEVICE*)Device-&gt;Extension;
 	ASSERT(netDevice);
 	ASSERT(netDevice-&gt;Device);
 
@@ -1010,7 +1010,7 @@ RndisFilterOnDeviceRemove(
 	DEVICE_OBJECT *Device
 	)
 {
-	NETVSC_DEVICE *netDevice = (NETVSC_DEVICE*)Device-&gt;Extension;
+	struct NETVSC_DEVICE *netDevice = (struct NETVSC_DEVICE*)Device-&gt;Extension;
 	RNDIS_DEVICE *rndisDevice = (RNDIS_DEVICE*)netDevice-&gt;Extension;
 
 	DPRINT_ENTER(NETVSC);
@@ -1046,7 +1046,7 @@ RndisFilterOnOpen(
 	)
 {
 	int ret;
-	NETVSC_DEVICE *netDevice = (NETVSC_DEVICE*)Device-&gt;Extension;
+	struct NETVSC_DEVICE *netDevice = (struct NETVSC_DEVICE*)Device-&gt;Extension;
 
 	DPRINT_ENTER(NETVSC);
 
@@ -1064,7 +1064,7 @@ RndisFilterOnClose(
 	)
 {
 	int ret;
-	NETVSC_DEVICE *netDevice = (NETVSC_DEVICE*)Device-&gt;Extension;
+	struct NETVSC_DEVICE *netDevice = (struct NETVSC_DEVICE*)Device-&gt;Extension;
 
 	DPRINT_ENTER(NETVSC);
 </pre><hr><pre>commit a9a71354b07dc1a3ee6a4053b43d5219fcda7a42
Author: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
Date:   Mon Jul 27 16:47:43 2009 -0400

    Staging: hv: remove VMBUS_MSGINFO typedef
    
    Note that this struct doesn't appear to be used anywhere and can
    probably be removed.
    
    Signed-off-by: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
    Cc: Hank Janssen &lt;hjanssen@microsoft.com&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@suse.de&gt;

diff --git a/drivers/staging/hv/VmbusPrivate.h b/drivers/staging/hv/VmbusPrivate.h
index 0adc02abf66b..40e5962dfb72 100644
--- a/drivers/staging/hv/VmbusPrivate.h
+++ b/drivers/staging/hv/VmbusPrivate.h
@@ -97,7 +97,7 @@ struct VMBUS_CONNECTION {
 };
 
 
-typedef struct _VMBUS_MSGINFO {
+struct VMBUS_MSGINFO {
 	/* Bookkeeping stuff */
 	LIST_ENTRY			MsgListEntry;
 
@@ -106,7 +106,7 @@ typedef struct _VMBUS_MSGINFO {
 
 	/* The message itself */
 	unsigned char		Msg[0];
-} VMBUS_MSGINFO;
+};
 
 
 </pre><hr><pre>commit 662e66b0e4f91f08e0d57e30b0bd83421e04bf79
Author: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
Date:   Mon Jul 27 16:47:42 2009 -0400

    Staging: hv: remove VMBUS_CONNECTION typedef
    
    Signed-off-by: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
    Cc: Hank Janssen &lt;hjanssen@microsoft.com&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@suse.de&gt;

diff --git a/drivers/staging/hv/Connection.c b/drivers/staging/hv/Connection.c
index 68f3a07371ed..7b480f0de5b0 100644
--- a/drivers/staging/hv/Connection.c
+++ b/drivers/staging/hv/Connection.c
@@ -29,7 +29,7 @@
 /* Globals */
 
 
-VMBUS_CONNECTION gVmbusConnection = {
+struct VMBUS_CONNECTION gVmbusConnection = {
 	.ConnectState		= Disconnected,
 	.NextGpadlHandle	= 0xE1E10,
 };
diff --git a/drivers/staging/hv/VmbusPrivate.h b/drivers/staging/hv/VmbusPrivate.h
index ec9bfa409550..0adc02abf66b 100644
--- a/drivers/staging/hv/VmbusPrivate.h
+++ b/drivers/staging/hv/VmbusPrivate.h
@@ -63,7 +63,7 @@ enum VMBUS_CONNECT_STATE {
 
 #define MAX_SIZE_CHANNEL_MESSAGE			HV_MESSAGE_PAYLOAD_BYTE_COUNT
 
-typedef struct _VMBUS_CONNECTION {
+struct VMBUS_CONNECTION {
 
 	enum VMBUS_CONNECT_STATE					ConnectState;
 
@@ -94,7 +94,7 @@ typedef struct _VMBUS_CONNECTION {
 	spinlock_t channel_lock;
 
 	HANDLE								WorkQueue;
-} VMBUS_CONNECTION;
+};
 
 
 typedef struct _VMBUS_MSGINFO {
@@ -112,7 +112,7 @@ typedef struct _VMBUS_MSGINFO {
 
 /* Externs */
 
-extern VMBUS_CONNECTION gVmbusConnection;
+extern struct VMBUS_CONNECTION gVmbusConnection;
 
 
 /* General vmbus interface */</pre><hr><pre>commit 5c3e375cf5cf709c95c705d564001c5a0ca3c50e
Author: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
Date:   Mon Jul 27 16:47:41 2009 -0400

    Staging: hv: remove VMBUS_CONNECT_STATE typedef
    
    Signed-off-by: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
    Cc: Hank Janssen &lt;hjanssen@microsoft.com&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@suse.de&gt;

diff --git a/drivers/staging/hv/VmbusPrivate.h b/drivers/staging/hv/VmbusPrivate.h
index ad17088f601e..ec9bfa409550 100644
--- a/drivers/staging/hv/VmbusPrivate.h
+++ b/drivers/staging/hv/VmbusPrivate.h
@@ -54,18 +54,18 @@
 /* Data types */
 
 
-typedef enum {
+enum VMBUS_CONNECT_STATE {
 	Disconnected,
 	Connecting,
 	Connected,
 	Disconnecting
-} VMBUS_CONNECT_STATE;
+};
 
 #define MAX_SIZE_CHANNEL_MESSAGE			HV_MESSAGE_PAYLOAD_BYTE_COUNT
 
 typedef struct _VMBUS_CONNECTION {
 
-	VMBUS_CONNECT_STATE					ConnectState;
+	enum VMBUS_CONNECT_STATE					ConnectState;
 
 	u32								NextGpadlHandle;
 </pre><hr><pre>commit 3fcc523adca8e979eb710d54f467f8fc890a77da
Author: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
Date:   Mon Jul 27 16:47:40 2009 -0400

    Staging: hv: remove VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER typedef
    
    Signed-off-by: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
    Cc: Hank Janssen &lt;hjanssen@microsoft.com&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@suse.de&gt;

diff --git a/drivers/staging/hv/Channel.c b/drivers/staging/hv/Channel.c
index e2c833fb923f..674f141a648f 100644
--- a/drivers/staging/hv/Channel.c
+++ b/drivers/staging/hv/Channel.c
@@ -912,7 +912,7 @@ VmbusChannelSendPacketMultiPageBuffer(
 )
 {
 	int ret=0;
-	VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER desc;
+	struct VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER desc;
 	u32 descSize;
 	u32 packetLen;
 	u32 packetLenAligned;
@@ -930,7 +930,7 @@ VmbusChannelSendPacketMultiPageBuffer(
 	ASSERT(PfnCount &lt;= MAX_MULTIPAGE_BUFFER_COUNT);
 
 	/* Adjust the size down since VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER is the largest size we support */
-	descSize = sizeof(VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER) - ((MAX_MULTIPAGE_BUFFER_COUNT - PfnCount)*sizeof(u64));
+	descSize = sizeof(struct VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER) - ((MAX_MULTIPAGE_BUFFER_COUNT - PfnCount)*sizeof(u64));
 	packetLen = descSize + BufferLen;
 	packetLenAligned = ALIGN_UP(packetLen, sizeof(u64));
 
diff --git a/drivers/staging/hv/Channel.h b/drivers/staging/hv/Channel.h
index 54b79f083fbf..5dac07b7b18c 100644
--- a/drivers/staging/hv/Channel.h
+++ b/drivers/staging/hv/Channel.h
@@ -45,7 +45,7 @@ struct VMBUS_CHANNEL_PACKET_PAGE_BUFFER {
 
 
 /* The format must be the same as VMDATA_GPA_DIRECT */
-typedef struct _VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER {
+struct VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER {
     u16				Type;
     u16				DataOffset8;
     u16				Length8;
@@ -54,7 +54,7 @@ typedef struct _VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER {
 	u32				Reserved;
 	u32				RangeCount;		/* Always 1 in this case */
 	MULTIPAGE_BUFFER	Range;
-} VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER;
+};
 
 #pragma pack(pop)
 
diff --git a/drivers/staging/hv/Vmbus.c b/drivers/staging/hv/Vmbus.c
index cc5c61a94843..91b226f73415 100644
--- a/drivers/staging/hv/Vmbus.c
+++ b/drivers/staging/hv/Vmbus.c
@@ -126,7 +126,7 @@ VmbusInitialize(
 	DPRINT_INFO(VMBUS, "+++++++ Vmbus using SINT %d +++++++", VMBUS_MESSAGE_SINT);
 
 	DPRINT_DBG(VMBUS, "sizeof(VMBUS_CHANNEL_PACKET_PAGE_BUFFER)=%ld, sizeof(VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER)=%ld",
-		sizeof(struct VMBUS_CHANNEL_PACKET_PAGE_BUFFER), sizeof(VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER));
+		sizeof(struct VMBUS_CHANNEL_PACKET_PAGE_BUFFER), sizeof(struct VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER));
 
 	drv-&gt;name = gDriverName;
 	memcpy(&amp;drv-&gt;deviceType, &amp;gVmbusDeviceType, sizeof(GUID));</pre><hr><pre>commit 0cf4fa80781dcdb5bf6096fa221f3fc6c7073405
Author: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
Date:   Mon Jul 27 16:47:39 2009 -0400

    Staging: hv: remove VMBUS_CHANNEL_PACKET_PAGE_BUFFER typedef
    
    Signed-off-by: Bill Pemberton &lt;wfp5p@virginia.edu&gt;
    Cc: Hank Janssen &lt;hjanssen@microsoft.com&gt;
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@suse.de&gt;

diff --git a/drivers/staging/hv/Channel.c b/drivers/staging/hv/Channel.c
index bd82154e69f1..e2c833fb923f 100644
--- a/drivers/staging/hv/Channel.c
+++ b/drivers/staging/hv/Channel.c
@@ -831,7 +831,7 @@ VmbusChannelSendPacketPageBuffer(
 {
 	int ret=0;
 	int i=0;
-	VMBUS_CHANNEL_PACKET_PAGE_BUFFER desc;
+	struct VMBUS_CHANNEL_PACKET_PAGE_BUFFER desc;
 	u32 descSize;
 	u32 packetLen;
 	u32 packetLenAligned;
@@ -845,7 +845,7 @@ VmbusChannelSendPacketPageBuffer(
 	DumpVmbusChannel(Channel);
 
 	/* Adjust the size down since VMBUS_CHANNEL_PACKET_PAGE_BUFFER is the largest size we support */
-	descSize = sizeof(VMBUS_CHANNEL_PACKET_PAGE_BUFFER) - ((MAX_PAGE_BUFFER_COUNT - PageCount)*sizeof(PAGE_BUFFER));
+	descSize = sizeof(struct VMBUS_CHANNEL_PACKET_PAGE_BUFFER) - ((MAX_PAGE_BUFFER_COUNT - PageCount)*sizeof(PAGE_BUFFER));
 	packetLen = descSize + BufferLen;
 	packetLenAligned = ALIGN_UP(packetLen, sizeof(u64));
 
diff --git a/drivers/staging/hv/Channel.h b/drivers/staging/hv/Channel.h
index be65d64e4590..54b79f083fbf 100644
--- a/drivers/staging/hv/Channel.h
+++ b/drivers/staging/hv/Channel.h
@@ -32,7 +32,7 @@
 
 
 /* The format must be the same as VMDATA_GPA_DIRECT */
-typedef struct _VMBUS_CHANNEL_PACKET_PAGE_BUFFER {
+struct VMBUS_CHANNEL_PACKET_PAGE_BUFFER {
     u16				Type;
     u16				DataOffset8;
     u16				Length8;
@@ -41,7 +41,7 @@ typedef struct _VMBUS_CHANNEL_PACKET_PAGE_BUFFER {
 	u32				Reserved;
 	u32				RangeCount;
     PAGE_BUFFER			Range[MAX_PAGE_BUFFER_COUNT];
-} VMBUS_CHANNEL_PACKET_PAGE_BUFFER;
+};
 
 
 /* The format must be the same as VMDATA_GPA_DIRECT */
diff --git a/drivers/staging/hv/Vmbus.c b/drivers/staging/hv/Vmbus.c
index 81b86c270661..cc5c61a94843 100644
--- a/drivers/staging/hv/Vmbus.c
+++ b/drivers/staging/hv/Vmbus.c
@@ -126,7 +126,7 @@ VmbusInitialize(
 	DPRINT_INFO(VMBUS, "+++++++ Vmbus using SINT %d +++++++", VMBUS_MESSAGE_SINT);
 
 	DPRINT_DBG(VMBUS, "sizeof(VMBUS_CHANNEL_PACKET_PAGE_BUFFER)=%ld, sizeof(VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER)=%ld",
-		sizeof(VMBUS_CHANNEL_PACKET_PAGE_BUFFER), sizeof(VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER));
+		sizeof(struct VMBUS_CHANNEL_PACKET_PAGE_BUFFER), sizeof(VMBUS_CHANNEL_PACKET_MULITPAGE_BUFFER));
 
 	drv-&gt;name = gDriverName;
 	memcpy(&amp;drv-&gt;deviceType, &amp;gVmbusDeviceType, sizeof(GUID));</pre>
    <div class="pagination">
        <a href='3_49.html'>&lt;&lt;Prev</a><a href='3.html'>1</a><a href='3_2.html'>2</a><a href='3_3.html'>3</a><a href='3_4.html'>4</a><a href='3_5.html'>5</a><a href='3_6.html'>6</a><a href='3_7.html'>7</a><a href='3_8.html'>8</a><a href='3_9.html'>9</a><a href='3_10.html'>10</a><a href='3_11.html'>11</a><a href='3_12.html'>12</a><a href='3_13.html'>13</a><a href='3_14.html'>14</a><a href='3_15.html'>15</a><a href='3_16.html'>16</a><a href='3_17.html'>17</a><a href='3_18.html'>18</a><a href='3_19.html'>19</a><a href='3_20.html'>20</a><a href='3_21.html'>21</a><a href='3_22.html'>22</a><a href='3_23.html'>23</a><a href='3_24.html'>24</a><a href='3_25.html'>25</a><a href='3_26.html'>26</a><a href='3_27.html'>27</a><a href='3_28.html'>28</a><a href='3_29.html'>29</a><a href='3_30.html'>30</a><a href='3_31.html'>31</a><a href='3_32.html'>32</a><a href='3_33.html'>33</a><a href='3_34.html'>34</a><a href='3_35.html'>35</a><a href='3_36.html'>36</a><a href='3_37.html'>37</a><a href='3_38.html'>38</a><a href='3_39.html'>39</a><a href='3_40.html'>40</a><a href='3_41.html'>41</a><a href='3_42.html'>42</a><a href='3_43.html'>43</a><a href='3_44.html'>44</a><a href='3_45.html'>45</a><a href='3_46.html'>46</a><a href='3_47.html'>47</a><a href='3_48.html'>48</a><a href='3_49.html'>49</a><span>[50]</span><a href='3_51.html'>51</a><a href='3_52.html'>52</a><a href='3_53.html'>53</a><a href='3_54.html'>54</a><a href='3_55.html'>55</a><a href='3_56.html'>56</a><a href='3_57.html'>57</a><a href='3_58.html'>58</a><a href='3_59.html'>59</a><a href='3_60.html'>60</a><a href='3_61.html'>61</a><a href='3_62.html'>62</a><a href='3_63.html'>63</a><a href='3_64.html'>64</a><a href='3_65.html'>65</a><a href='3_66.html'>66</a><a href='3_67.html'>67</a><a href='3_68.html'>68</a><a href='3_69.html'>69</a><a href='3_70.html'>70</a><a href='3_71.html'>71</a><a href='3_72.html'>72</a><a href='3_73.html'>73</a><a href='3_74.html'>74</a><a href='3_75.html'>75</a><a href='3_76.html'>76</a><a href='3_77.html'>77</a><a href='3_78.html'>78</a><a href='3_79.html'>79</a><a href='3_80.html'>80</a><a href='3_81.html'>81</a><a href='3_82.html'>82</a><a href='3_83.html'>83</a><a href='3_51.html'>Next&gt;&gt;</a>
    <div>
</body>

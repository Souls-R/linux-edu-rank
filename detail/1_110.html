<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Massachusetts Institute of Technology</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Massachusetts Institute of Technology</h1>
    <div class="pagination">
        <a href='1_109.html'>&lt;&lt;Prev</a><a href='1.html'>1</a><a href='1_2.html'>2</a><a href='1_3.html'>3</a><a href='1_4.html'>4</a><a href='1_5.html'>5</a><a href='1_6.html'>6</a><a href='1_7.html'>7</a><a href='1_8.html'>8</a><a href='1_9.html'>9</a><a href='1_10.html'>10</a><a href='1_11.html'>11</a><a href='1_12.html'>12</a><a href='1_13.html'>13</a><a href='1_14.html'>14</a><a href='1_15.html'>15</a><a href='1_16.html'>16</a><a href='1_17.html'>17</a><a href='1_18.html'>18</a><a href='1_19.html'>19</a><a href='1_20.html'>20</a><a href='1_21.html'>21</a><a href='1_22.html'>22</a><a href='1_23.html'>23</a><a href='1_24.html'>24</a><a href='1_25.html'>25</a><a href='1_26.html'>26</a><a href='1_27.html'>27</a><a href='1_28.html'>28</a><a href='1_29.html'>29</a><a href='1_30.html'>30</a><a href='1_31.html'>31</a><a href='1_32.html'>32</a><a href='1_33.html'>33</a><a href='1_34.html'>34</a><a href='1_35.html'>35</a><a href='1_36.html'>36</a><a href='1_37.html'>37</a><a href='1_38.html'>38</a><a href='1_39.html'>39</a><a href='1_40.html'>40</a><a href='1_41.html'>41</a><a href='1_42.html'>42</a><a href='1_43.html'>43</a><a href='1_44.html'>44</a><a href='1_45.html'>45</a><a href='1_46.html'>46</a><a href='1_47.html'>47</a><a href='1_48.html'>48</a><a href='1_49.html'>49</a><a href='1_50.html'>50</a><a href='1_51.html'>51</a><a href='1_52.html'>52</a><a href='1_53.html'>53</a><a href='1_54.html'>54</a><a href='1_55.html'>55</a><a href='1_56.html'>56</a><a href='1_57.html'>57</a><a href='1_58.html'>58</a><a href='1_59.html'>59</a><a href='1_60.html'>60</a><a href='1_61.html'>61</a><a href='1_62.html'>62</a><a href='1_63.html'>63</a><a href='1_64.html'>64</a><a href='1_65.html'>65</a><a href='1_66.html'>66</a><a href='1_67.html'>67</a><a href='1_68.html'>68</a><a href='1_69.html'>69</a><a href='1_70.html'>70</a><a href='1_71.html'>71</a><a href='1_72.html'>72</a><a href='1_73.html'>73</a><a href='1_74.html'>74</a><a href='1_75.html'>75</a><a href='1_76.html'>76</a><a href='1_77.html'>77</a><a href='1_78.html'>78</a><a href='1_79.html'>79</a><a href='1_80.html'>80</a><a href='1_81.html'>81</a><a href='1_82.html'>82</a><a href='1_83.html'>83</a><a href='1_84.html'>84</a><a href='1_85.html'>85</a><a href='1_86.html'>86</a><a href='1_87.html'>87</a><a href='1_88.html'>88</a><a href='1_89.html'>89</a><a href='1_90.html'>90</a><a href='1_91.html'>91</a><a href='1_92.html'>92</a><a href='1_93.html'>93</a><a href='1_94.html'>94</a><a href='1_95.html'>95</a><a href='1_96.html'>96</a><a href='1_97.html'>97</a><a href='1_98.html'>98</a><a href='1_99.html'>99</a><a href='1_100.html'>100</a><a href='1_101.html'>101</a><a href='1_102.html'>102</a><a href='1_103.html'>103</a><a href='1_104.html'>104</a><a href='1_105.html'>105</a><a href='1_106.html'>106</a><a href='1_107.html'>107</a><a href='1_108.html'>108</a><a href='1_109.html'>109</a><span>[110]</span><a href='1_111.html'>111</a><a href='1_112.html'>112</a><a href='1_113.html'>113</a><a href='1_114.html'>114</a><a href='1_115.html'>115</a><a href='1_116.html'>116</a><a href='1_117.html'>117</a><a href='1_118.html'>118</a><a href='1_119.html'>119</a><a href='1_120.html'>120</a><a href='1_121.html'>121</a><a href='1_122.html'>122</a><a href='1_123.html'>123</a><a href='1_124.html'>124</a><a href='1_125.html'>125</a><a href='1_126.html'>126</a><a href='1_127.html'>127</a><a href='1_128.html'>128</a><a href='1_129.html'>129</a><a href='1_130.html'>130</a><a href='1_131.html'>131</a><a href='1_132.html'>132</a><a href='1_133.html'>133</a><a href='1_134.html'>134</a><a href='1_135.html'>135</a><a href='1_136.html'>136</a><a href='1_137.html'>137</a><a href='1_138.html'>138</a><a href='1_139.html'>139</a><a href='1_140.html'>140</a><a href='1_141.html'>141</a><a href='1_142.html'>142</a><a href='1_143.html'>143</a><a href='1_144.html'>144</a><a href='1_145.html'>145</a><a href='1_146.html'>146</a><a href='1_147.html'>147</a><a href='1_148.html'>148</a><a href='1_149.html'>149</a><a href='1_150.html'>150</a><a href='1_151.html'>151</a><a href='1_152.html'>152</a><a href='1_153.html'>153</a><a href='1_154.html'>154</a><a href='1_111.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 577c4eb09d1034d0739e3135fd2cff50588024be
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Wed Sep 27 01:50:49 2006 -0700

    [PATCH] inode-diet: Move i_cdev into a union
    
    Move the i_cdev pointer in struct inode into a union.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/file_table.c b/fs/file_table.c
index 0131ba06e1ee..bc35a40417d7 100644
--- a/fs/file_table.c
+++ b/fs/file_table.c
@@ -169,7 +169,7 @@ void fastcall __fput(struct file *file)
 	if (file-&gt;f_op &amp;&amp; file-&gt;f_op-&gt;release)
 		file-&gt;f_op-&gt;release(inode, file);
 	security_file_free(file);
-	if (unlikely(inode-&gt;i_cdev != NULL))
+	if (unlikely(S_ISCHR(inode-&gt;i_mode) &amp;&amp; inode-&gt;i_cdev != NULL))
 		cdev_put(inode-&gt;i_cdev);
 	fops_put(file-&gt;f_op);
 	if (file-&gt;f_mode &amp; FMODE_WRITE)
diff --git a/fs/inode.c b/fs/inode.c
index 41b462232f7f..f5c04dd9ae8a 100644
--- a/fs/inode.c
+++ b/fs/inode.c
@@ -256,7 +256,7 @@ void clear_inode(struct inode *inode)
 		inode-&gt;i_sb-&gt;s_op-&gt;clear_inode(inode);
 	if (S_ISBLK(inode-&gt;i_mode) &amp;&amp; inode-&gt;i_bdev)
 		bd_forget(inode);
-	if (inode-&gt;i_cdev)
+	if (S_ISCHR(inode-&gt;i_mode) &amp;&amp; inode-&gt;i_cdev)
 		cd_forget(inode);
 	inode-&gt;i_state = I_CLEAR;
 }
diff --git a/include/linux/fs.h b/include/linux/fs.h
index 98ff684a5b1c..192e69bb55b5 100644
--- a/include/linux/fs.h
+++ b/include/linux/fs.h
@@ -532,8 +532,8 @@ struct inode {
 	union {
 		struct pipe_inode_info	*i_pipe;
 		struct block_device	*i_bdev;
+		struct cdev		*i_cdev;
 	};
-	struct cdev		*i_cdev;
 	int			i_cindex;
 
 	__u32			i_generation;</pre><hr><pre>commit eaf796e7ef6014f208c409b2b14fddcfaafe7e3a
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Wed Sep 27 01:50:48 2006 -0700

    [PATCH] inode-diet: Move i_bdev into a union
    
    Move the i_bdev pointer in struct inode into a union.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/inode.c b/fs/inode.c
index 77e254792025..41b462232f7f 100644
--- a/fs/inode.c
+++ b/fs/inode.c
@@ -254,7 +254,7 @@ void clear_inode(struct inode *inode)
 	DQUOT_DROP(inode);
 	if (inode-&gt;i_sb &amp;&amp; inode-&gt;i_sb-&gt;s_op-&gt;clear_inode)
 		inode-&gt;i_sb-&gt;s_op-&gt;clear_inode(inode);
-	if (inode-&gt;i_bdev)
+	if (S_ISBLK(inode-&gt;i_mode) &amp;&amp; inode-&gt;i_bdev)
 		bd_forget(inode);
 	if (inode-&gt;i_cdev)
 		cd_forget(inode);
diff --git a/include/linux/fs.h b/include/linux/fs.h
index ca695fc8d69c..98ff684a5b1c 100644
--- a/include/linux/fs.h
+++ b/include/linux/fs.h
@@ -531,8 +531,8 @@ struct inode {
 	struct list_head	i_devices;
 	union {
 		struct pipe_inode_info	*i_pipe;
+		struct block_device	*i_bdev;
 	};
-	struct block_device	*i_bdev;
 	struct cdev		*i_cdev;
 	int			i_cindex;
 </pre><hr><pre>commit 4c1541680f8d189d21dd07b053bc12996574646e
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Wed Sep 27 01:50:47 2006 -0700

    [PATCH] inode-diet: Move i_pipe into a union
    
    Move the i_pipe pointer into a union that will be shared with i_bdev and
    i_cdev.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/include/linux/fs.h b/include/linux/fs.h
index 4f77ec9c3353..ca695fc8d69c 100644
--- a/include/linux/fs.h
+++ b/include/linux/fs.h
@@ -528,9 +528,10 @@ struct inode {
 #ifdef CONFIG_QUOTA
 	struct dquot		*i_dquot[MAXQUOTAS];
 #endif
-	/* These three should probably be a union */
 	struct list_head	i_devices;
-	struct pipe_inode_info	*i_pipe;
+	union {
+		struct pipe_inode_info	*i_pipe;
+	};
 	struct block_device	*i_bdev;
 	struct cdev		*i_cdev;
 	int			i_cindex;</pre><hr><pre>commit 8e18e2941c53416aa219708e7dcad21fb4bd6794
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Wed Sep 27 01:50:46 2006 -0700

    [PATCH] inode_diet: Replace inode.u.generic_ip with inode.i_private
    
    The following patches reduce the size of the VFS inode structure by 28 bytes
    on a UP x86.  (It would be more on an x86_64 system).  This is a 10% reduction
    in the inode size on a UP kernel that is configured in a production mode
    (i.e., with no spinlock or other debugging functions enabled; if you want to
    save memory taken up by in-core inodes, the first thing you should do is
    disable the debugging options; they are responsible for a huge amount of bloat
    in the VFS inode structure).
    
    This patch:
    
    The filesystem or device-specific pointer in the inode is inside a union,
    which is pretty pointless given that all 30+ users of this field have been
    using the void pointer.  Get rid of the union and rename it to i_private, with
    a comment to explain who is allowed to use the void pointer.  This is just a
    cleanup, but it allows us to reuse the union 'u' for something something where
    the union will actually be used.
    
    [judith@osdl.org: powerpc build fix]
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Judith Lebzelter &lt;judith@osdl.org&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/powerpc/platforms/cell/spufs/inode.c b/arch/powerpc/platforms/cell/spufs/inode.c
index 7b4572805db9..b837f12a84ae 100644
--- a/arch/powerpc/platforms/cell/spufs/inode.c
+++ b/arch/powerpc/platforms/cell/spufs/inode.c
@@ -120,7 +120,7 @@ spufs_new_file(struct super_block *sb, struct dentry *dentry,
 	ret = 0;
 	inode-&gt;i_op = &amp;spufs_file_iops;
 	inode-&gt;i_fop = fops;
-	inode-&gt;u.generic_ip = SPUFS_I(inode)-&gt;i_ctx = get_spu_context(ctx);
+	inode-&gt;i_private = SPUFS_I(inode)-&gt;i_ctx = get_spu_context(ctx);
 	d_add(dentry, inode);
 out:
 	return ret;
diff --git a/arch/powerpc/platforms/pseries/hvCall_inst.c b/arch/powerpc/platforms/pseries/hvCall_inst.c
index 641e6511cf06..446e17d162a5 100644
--- a/arch/powerpc/platforms/pseries/hvCall_inst.c
+++ b/arch/powerpc/platforms/pseries/hvCall_inst.c
@@ -85,7 +85,7 @@ static int hcall_inst_seq_open(struct inode *inode, struct file *file)
 
 	rc = seq_open(file, &amp;hcall_inst_seq_ops);
 	seq = file-&gt;private_data;
-	seq-&gt;private = file-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	seq-&gt;private = file-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 
 	return rc;
 }
diff --git a/arch/s390/hypfs/inode.c b/arch/s390/hypfs/inode.c
index bdade5f2e325..8735024d235b 100644
--- a/arch/s390/hypfs/inode.c
+++ b/arch/s390/hypfs/inode.c
@@ -104,13 +104,13 @@ static struct inode *hypfs_make_inode(struct super_block *sb, int mode)
 
 static void hypfs_drop_inode(struct inode *inode)
 {
-	kfree(inode-&gt;u.generic_ip);
+	kfree(inode-&gt;i_private);
 	generic_delete_inode(inode);
 }
 
 static int hypfs_open(struct inode *inode, struct file *filp)
 {
-	char *data = filp-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	char *data = filp-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 	struct hypfs_sb_info *fs_info;
 
 	if (filp-&gt;f_mode &amp; FMODE_WRITE) {
@@ -352,7 +352,7 @@ static struct dentry *hypfs_create_file(struct super_block *sb,
 		parent-&gt;d_inode-&gt;i_nlink++;
 	} else
 		BUG();
-	inode-&gt;u.generic_ip = data;
+	inode-&gt;i_private = data;
 	d_instantiate(dentry, inode);
 	dget(dentry);
 	return dentry;
diff --git a/arch/s390/kernel/debug.c b/arch/s390/kernel/debug.c
index 7ba20922a535..43f3d0c7e132 100644
--- a/arch/s390/kernel/debug.c
+++ b/arch/s390/kernel/debug.c
@@ -603,7 +603,7 @@ debug_open(struct inode *inode, struct file *file)
 	debug_info_t *debug_info, *debug_info_snapshot;
 
 	down(&amp;debug_lock);
-	debug_info = (struct debug_info*)file-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	debug_info = file-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 	/* find debug view */
 	for (i = 0; i &lt; DEBUG_MAX_VIEWS; i++) {
 		if (!debug_info-&gt;views[i])
diff --git a/block/blktrace.c b/block/blktrace.c
index 265f7a830619..2b4ef2b89b8d 100644
--- a/block/blktrace.c
+++ b/block/blktrace.c
@@ -217,7 +217,7 @@ static int blk_trace_remove(request_queue_t *q)
 
 static int blk_dropped_open(struct inode *inode, struct file *filp)
 {
-	filp-&gt;private_data = inode-&gt;u.generic_ip;
+	filp-&gt;private_data = inode-&gt;i_private;
 
 	return 0;
 }
diff --git a/drivers/i2c/chips/tps65010.c b/drivers/i2c/chips/tps65010.c
index 0be6fd6a267d..6a7578217177 100644
--- a/drivers/i2c/chips/tps65010.c
+++ b/drivers/i2c/chips/tps65010.c
@@ -305,7 +305,7 @@ static int dbg_show(struct seq_file *s, void *_)
 
 static int dbg_tps_open(struct inode *inode, struct file *file)
 {
-	return single_open(file, dbg_show, inode-&gt;u.generic_ip);
+	return single_open(file, dbg_show, inode-&gt;i_private);
 }
 
 static struct file_operations debug_fops = {
diff --git a/drivers/infiniband/hw/ipath/ipath_fs.c b/drivers/infiniband/hw/ipath/ipath_fs.c
index a5eb30a06a5c..055cdd089b28 100644
--- a/drivers/infiniband/hw/ipath/ipath_fs.c
+++ b/drivers/infiniband/hw/ipath/ipath_fs.c
@@ -64,7 +64,7 @@ static int ipathfs_mknod(struct inode *dir, struct dentry *dentry,
 	inode-&gt;i_blksize = PAGE_CACHE_SIZE;
 	inode-&gt;i_blocks = 0;
 	inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime = CURRENT_TIME;
-	inode-&gt;u.generic_ip = data;
+	inode-&gt;i_private = data;
 	if ((mode &amp; S_IFMT) == S_IFDIR) {
 		inode-&gt;i_op = &amp;simple_dir_inode_operations;
 		inode-&gt;i_nlink++;
@@ -119,7 +119,7 @@ static ssize_t atomic_counters_read(struct file *file, char __user *buf,
 	u16 i;
 	struct ipath_devdata *dd;
 
-	dd = file-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	dd = file-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 
 	for (i = 0; i &lt; NUM_COUNTERS; i++)
 		counters[i] = ipath_snap_cntr(dd, i);
@@ -139,7 +139,7 @@ static ssize_t atomic_node_info_read(struct file *file, char __user *buf,
 	struct ipath_devdata *dd;
 	u64 guid;
 
-	dd = file-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	dd = file-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 
 	guid = be64_to_cpu(dd-&gt;ipath_guid);
 
@@ -178,7 +178,7 @@ static ssize_t atomic_port_info_read(struct file *file, char __user *buf,
 	u32 tmp, tmp2;
 	struct ipath_devdata *dd;
 
-	dd = file-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	dd = file-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 
 	/* so we only initialize non-zero fields. */
 	memset(portinfo, 0, sizeof portinfo);
@@ -325,7 +325,7 @@ static ssize_t flash_read(struct file *file, char __user *buf,
 		goto bail;
 	}
 
-	dd = file-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	dd = file-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 	if (ipath_eeprom_read(dd, pos, tmp, count)) {
 		ipath_dev_err(dd, "failed to read from flash\n");
 		ret = -ENXIO;
@@ -381,7 +381,7 @@ static ssize_t flash_write(struct file *file, const char __user *buf,
 		goto bail_tmp;
 	}
 
-	dd = file-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	dd = file-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 	if (ipath_eeprom_write(dd, pos, tmp, count)) {
 		ret = -ENXIO;
 		ipath_dev_err(dd, "failed to write to flash\n");
diff --git a/drivers/infiniband/ulp/ipoib/ipoib_fs.c b/drivers/infiniband/ulp/ipoib/ipoib_fs.c
index 5dde380e8dbe..f1cb83688b31 100644
--- a/drivers/infiniband/ulp/ipoib/ipoib_fs.c
+++ b/drivers/infiniband/ulp/ipoib/ipoib_fs.c
@@ -141,7 +141,7 @@ static int ipoib_mcg_open(struct inode *inode, struct file *file)
 		return ret;
 
 	seq = file-&gt;private_data;
-	seq-&gt;private = inode-&gt;u.generic_ip;
+	seq-&gt;private = inode-&gt;i_private;
 
 	return 0;
 }
@@ -247,7 +247,7 @@ static int ipoib_path_open(struct inode *inode, struct file *file)
 		return ret;
 
 	seq = file-&gt;private_data;
-	seq-&gt;private = inode-&gt;u.generic_ip;
+	seq-&gt;private = inode-&gt;i_private;
 
 	return 0;
 }
diff --git a/drivers/misc/ibmasm/ibmasmfs.c b/drivers/misc/ibmasm/ibmasmfs.c
index 4a35caff5d02..0e909b617226 100644
--- a/drivers/misc/ibmasm/ibmasmfs.c
+++ b/drivers/misc/ibmasm/ibmasmfs.c
@@ -175,7 +175,7 @@ static struct dentry *ibmasmfs_create_file (struct super_block *sb,
 	}
 
 	inode-&gt;i_fop = fops;
-	inode-&gt;u.generic_ip = data;
+	inode-&gt;i_private = data;
 
 	d_add(dentry, inode);
 	return dentry;
@@ -244,7 +244,7 @@ static int command_file_open(struct inode *inode, struct file *file)
 {
 	struct ibmasmfs_command_data *command_data;
 
-	if (!inode-&gt;u.generic_ip)
+	if (!inode-&gt;i_private)
 		return -ENODEV;
 
 	command_data = kmalloc(sizeof(struct ibmasmfs_command_data), GFP_KERNEL);
@@ -252,7 +252,7 @@ static int command_file_open(struct inode *inode, struct file *file)
 		return -ENOMEM;
 
 	command_data-&gt;command = NULL;
-	command_data-&gt;sp = inode-&gt;u.generic_ip;
+	command_data-&gt;sp = inode-&gt;i_private;
 	file-&gt;private_data = command_data;
 	return 0;
 }
@@ -351,10 +351,10 @@ static int event_file_open(struct inode *inode, struct file *file)
 	struct ibmasmfs_event_data *event_data;
 	struct service_processor *sp; 
 
-	if (!inode-&gt;u.generic_ip)
+	if (!inode-&gt;i_private)
 		return -ENODEV;
 
-	sp = inode-&gt;u.generic_ip;
+	sp = inode-&gt;i_private;
 
 	event_data = kmalloc(sizeof(struct ibmasmfs_event_data), GFP_KERNEL);
 	if (!event_data)
@@ -439,14 +439,14 @@ static int r_heartbeat_file_open(struct inode *inode, struct file *file)
 {
 	struct ibmasmfs_heartbeat_data *rhbeat;
 
-	if (!inode-&gt;u.generic_ip)
+	if (!inode-&gt;i_private)
 		return -ENODEV;
 
 	rhbeat = kmalloc(sizeof(struct ibmasmfs_heartbeat_data), GFP_KERNEL);
 	if (!rhbeat)
 		return -ENOMEM;
 
-	rhbeat-&gt;sp = (struct service_processor *)inode-&gt;u.generic_ip;
+	rhbeat-&gt;sp = inode-&gt;i_private;
 	rhbeat-&gt;active = 0;
 	ibmasm_init_reverse_heartbeat(rhbeat-&gt;sp, &amp;rhbeat-&gt;heartbeat);
 	file-&gt;private_data = rhbeat;
@@ -508,7 +508,7 @@ static ssize_t r_heartbeat_file_write(struct file *file, const char __user *buf,
 
 static int remote_settings_file_open(struct inode *inode, struct file *file)
 {
-	file-&gt;private_data = inode-&gt;u.generic_ip;
+	file-&gt;private_data = inode-&gt;i_private;
 	return 0;
 }
 
diff --git a/drivers/net/irda/vlsi_ir.h b/drivers/net/irda/vlsi_ir.h
index a82a4ba8de4f..c37f0bc4c7f9 100644
--- a/drivers/net/irda/vlsi_ir.h
+++ b/drivers/net/irda/vlsi_ir.h
@@ -58,7 +58,7 @@ typedef void irqreturn_t;
 
 /* PDE() introduced in 2.5.4 */
 #ifdef CONFIG_PROC_FS
-#define PDE(inode) ((inode)-&gt;u.generic_ip)
+#define PDE(inode) ((inode)-&gt;i_private)
 #endif
 
 /* irda crc16 calculation exported in 2.5.42 */
diff --git a/drivers/net/wireless/bcm43xx/bcm43xx_debugfs.c b/drivers/net/wireless/bcm43xx/bcm43xx_debugfs.c
index 923275ea0789..b9df06a06ea9 100644
--- a/drivers/net/wireless/bcm43xx/bcm43xx_debugfs.c
+++ b/drivers/net/wireless/bcm43xx/bcm43xx_debugfs.c
@@ -54,7 +54,7 @@ static ssize_t write_file_dummy(struct file *file, const char __user *buf,
 
 static int open_file_generic(struct inode *inode, struct file *file)
 {
-	file-&gt;private_data = inode-&gt;u.generic_ip;
+	file-&gt;private_data = inode-&gt;i_private;
 	return 0;
 }
 
diff --git a/drivers/oprofile/oprofilefs.c b/drivers/oprofile/oprofilefs.c
index 71c2da277d6e..deb37354785b 100644
--- a/drivers/oprofile/oprofilefs.c
+++ b/drivers/oprofile/oprofilefs.c
@@ -110,8 +110,8 @@ static ssize_t ulong_write_file(struct file * file, char const __user * buf, siz
 
 static int default_open(struct inode * inode, struct file * filp)
 {
-	if (inode-&gt;u.generic_ip)
-		filp-&gt;private_data = inode-&gt;u.generic_ip;
+	if (inode-&gt;i_private)
+		filp-&gt;private_data = inode-&gt;i_private;
 	return 0;
 }
 
@@ -158,7 +158,7 @@ int oprofilefs_create_ulong(struct super_block * sb, struct dentry * root,
 	if (!d)
 		return -EFAULT;
 
-	d-&gt;d_inode-&gt;u.generic_ip = val;
+	d-&gt;d_inode-&gt;i_private = val;
 	return 0;
 }
 
@@ -171,7 +171,7 @@ int oprofilefs_create_ro_ulong(struct super_block * sb, struct dentry * root,
 	if (!d)
 		return -EFAULT;
 
-	d-&gt;d_inode-&gt;u.generic_ip = val;
+	d-&gt;d_inode-&gt;i_private = val;
 	return 0;
 }
 
@@ -197,7 +197,7 @@ int oprofilefs_create_ro_atomic(struct super_block * sb, struct dentry * root,
 	if (!d)
 		return -EFAULT;
 
-	d-&gt;d_inode-&gt;u.generic_ip = val;
+	d-&gt;d_inode-&gt;i_private = val;
 	return 0;
 }
 
diff --git a/drivers/pci/hotplug/cpqphp_sysfs.c b/drivers/pci/hotplug/cpqphp_sysfs.c
index 8b3da007e859..5bab666cd67e 100644
--- a/drivers/pci/hotplug/cpqphp_sysfs.c
+++ b/drivers/pci/hotplug/cpqphp_sysfs.c
@@ -140,7 +140,7 @@ struct ctrl_dbg {
 
 static int open(struct inode *inode, struct file *file)
 {
-	struct controller *ctrl = inode-&gt;u.generic_ip;
+	struct controller *ctrl = inode-&gt;i_private;
 	struct ctrl_dbg *dbg;
 	int retval = -ENOMEM;
 
diff --git a/drivers/usb/core/devio.c b/drivers/usb/core/devio.c
index 218621b9958e..32e03000420c 100644
--- a/drivers/usb/core/devio.c
+++ b/drivers/usb/core/devio.c
@@ -555,7 +555,7 @@ static int usbdev_open(struct inode *inode, struct file *file)
 	if (imajor(inode) == USB_DEVICE_MAJOR)
 		dev = usbdev_lookup_minor(iminor(inode));
 	if (!dev)
-		dev = inode-&gt;u.generic_ip;
+		dev = inode-&gt;i_private;
 	if (!dev) {
 		kfree(ps);
 		goto out;
diff --git a/drivers/usb/core/inode.c b/drivers/usb/core/inode.c
index 3182c2224ba2..482f253085e5 100644
--- a/drivers/usb/core/inode.c
+++ b/drivers/usb/core/inode.c
@@ -402,8 +402,8 @@ static loff_t default_file_lseek (struct file *file, loff_t offset, int orig)
 
 static int default_open (struct inode *inode, struct file *file)
 {
-	if (inode-&gt;u.generic_ip)
-		file-&gt;private_data = inode-&gt;u.generic_ip;
+	if (inode-&gt;i_private)
+		file-&gt;private_data = inode-&gt;i_private;
 
 	return 0;
 }
@@ -509,7 +509,7 @@ static struct dentry *fs_create_file (const char *name, mode_t mode,
 	} else {
 		if (dentry-&gt;d_inode) {
 			if (data)
-				dentry-&gt;d_inode-&gt;u.generic_ip = data;
+				dentry-&gt;d_inode-&gt;i_private = data;
 			if (fops)
 				dentry-&gt;d_inode-&gt;i_fop = fops;
 			dentry-&gt;d_inode-&gt;i_uid = uid;
diff --git a/drivers/usb/gadget/inode.c b/drivers/usb/gadget/inode.c
index 3bdc5e3ba234..ffaa8c1afad8 100644
--- a/drivers/usb/gadget/inode.c
+++ b/drivers/usb/gadget/inode.c
@@ -844,7 +844,7 @@ ep_config (struct file *fd, const char __user *buf, size_t len, loff_t *ptr)
 static int
 ep_open (struct inode *inode, struct file *fd)
 {
-	struct ep_data		*data = inode-&gt;u.generic_ip;
+	struct ep_data		*data = inode-&gt;i_private;
 	int			value = -EBUSY;
 
 	if (down_interruptible (&amp;data-&gt;lock) != 0)
@@ -1909,7 +1909,7 @@ dev_config (struct file *fd, const char __user *buf, size_t len, loff_t *ptr)
 static int
 dev_open (struct inode *inode, struct file *fd)
 {
-	struct dev_data		*dev = inode-&gt;u.generic_ip;
+	struct dev_data		*dev = inode-&gt;i_private;
 	int			value = -EBUSY;
 
 	if (dev-&gt;state == STATE_DEV_DISABLED) {
@@ -1970,7 +1970,7 @@ gadgetfs_make_inode (struct super_block *sb,
 		inode-&gt;i_blocks = 0;
 		inode-&gt;i_atime = inode-&gt;i_mtime = inode-&gt;i_ctime
 				= CURRENT_TIME;
-		inode-&gt;u.generic_ip = data;
+		inode-&gt;i_private = data;
 		inode-&gt;i_fop = fops;
 	}
 	return inode;
diff --git a/drivers/usb/host/isp116x-hcd.c b/drivers/usb/host/isp116x-hcd.c
index 5147ed4a6662..8c6b38a0b5bb 100644
--- a/drivers/usb/host/isp116x-hcd.c
+++ b/drivers/usb/host/isp116x-hcd.c
@@ -1204,7 +1204,7 @@ static int isp116x_show_dbg(struct seq_file *s, void *unused)
 
 static int isp116x_open_seq(struct inode *inode, struct file *file)
 {
-	return single_open(file, isp116x_show_dbg, inode-&gt;u.generic_ip);
+	return single_open(file, isp116x_show_dbg, inode-&gt;i_private);
 }
 
 static struct file_operations isp116x_debug_fops = {
diff --git a/drivers/usb/host/uhci-debug.c b/drivers/usb/host/uhci-debug.c
index dc286a48cafd..d1372cb27f33 100644
--- a/drivers/usb/host/uhci-debug.c
+++ b/drivers/usb/host/uhci-debug.c
@@ -428,7 +428,7 @@ struct uhci_debug {
 
 static int uhci_debug_open(struct inode *inode, struct file *file)
 {
-	struct uhci_hcd *uhci = inode-&gt;u.generic_ip;
+	struct uhci_hcd *uhci = inode-&gt;i_private;
 	struct uhci_debug *up;
 	int ret = -ENOMEM;
 	unsigned long flags;
diff --git a/drivers/usb/mon/mon_stat.c b/drivers/usb/mon/mon_stat.c
index 1fe01d994a79..86ad2b381c4b 100644
--- a/drivers/usb/mon/mon_stat.c
+++ b/drivers/usb/mon/mon_stat.c
@@ -28,7 +28,7 @@ static int mon_stat_open(struct inode *inode, struct file *file)
 	if ((sp = kmalloc(sizeof(struct snap), GFP_KERNEL)) == NULL)
 		return -ENOMEM;
 
-	mbus = inode-&gt;u.generic_ip;
+	mbus = inode-&gt;i_private;
 
 	sp-&gt;slen = snprintf(sp-&gt;str, STAT_BUF_SIZE,
 	    "nreaders %d events %u text_lost %u\n",
diff --git a/drivers/usb/mon/mon_text.c b/drivers/usb/mon/mon_text.c
index f961a770cee2..2fd39b4fa166 100644
--- a/drivers/usb/mon/mon_text.c
+++ b/drivers/usb/mon/mon_text.c
@@ -238,7 +238,7 @@ static int mon_text_open(struct inode *inode, struct file *file)
 	int rc;
 
 	mutex_lock(&amp;mon_lock);
-	mbus = inode-&gt;u.generic_ip;
+	mbus = inode-&gt;i_private;
 	ubus = mbus-&gt;u_bus;
 
 	rp = kzalloc(sizeof(struct mon_reader_text), GFP_KERNEL);
@@ -401,7 +401,7 @@ static int mon_text_release(struct inode *inode, struct file *file)
 	struct mon_event_text *ep;
 
 	mutex_lock(&amp;mon_lock);
-	mbus = inode-&gt;u.generic_ip;
+	mbus = inode-&gt;i_private;
 
 	if (mbus-&gt;nreaders &lt;= 0) {
 		printk(KERN_ERR TAG ": consistency error on close\n");
diff --git a/fs/autofs/inode.c b/fs/autofs/inode.c
index c81d6b8c2828..d39d2acd9b38 100644
--- a/fs/autofs/inode.c
+++ b/fs/autofs/inode.c
@@ -241,7 +241,7 @@ static void autofs_read_inode(struct inode *inode)
 		
 		inode-&gt;i_op = &amp;autofs_symlink_inode_operations;
 		sl = &amp;sbi-&gt;symlink[n];
-		inode-&gt;u.generic_ip = sl;
+		inode-&gt;i_private = sl;
 		inode-&gt;i_mode = S_IFLNK | S_IRWXUGO;
 		inode-&gt;i_mtime.tv_sec = inode-&gt;i_ctime.tv_sec = sl-&gt;mtime;
 		inode-&gt;i_mtime.tv_nsec = inode-&gt;i_ctime.tv_nsec = 0;
diff --git a/fs/autofs/symlink.c b/fs/autofs/symlink.c
index 52e8772b066e..c74f2eb65775 100644
--- a/fs/autofs/symlink.c
+++ b/fs/autofs/symlink.c
@@ -15,7 +15,7 @@
 /* Nothing to release.. */
 static void *autofs_follow_link(struct dentry *dentry, struct nameidata *nd)
 {
-	char *s=((struct autofs_symlink *)dentry-&gt;d_inode-&gt;u.generic_ip)-&gt;data;
+	char *s=((struct autofs_symlink *)dentry-&gt;d_inode-&gt;i_private)-&gt;data;
 	nd_set_link(nd, s);
 	return NULL;
 }
diff --git a/fs/binfmt_misc.c b/fs/binfmt_misc.c
index 34ebbc191e46..6759b9839ce8 100644
--- a/fs/binfmt_misc.c
+++ b/fs/binfmt_misc.c
@@ -517,7 +517,7 @@ static struct inode *bm_get_inode(struct super_block *sb, int mode)
 
 static void bm_clear_inode(struct inode *inode)
 {
-	kfree(inode-&gt;u.generic_ip);
+	kfree(inode-&gt;i_private);
 }
 
 static void kill_node(Node *e)
@@ -545,7 +545,7 @@ static void kill_node(Node *e)
 static ssize_t
 bm_entry_read(struct file * file, char __user * buf, size_t nbytes, loff_t *ppos)
 {
-	Node *e = file-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	Node *e = file-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 	loff_t pos = *ppos;
 	ssize_t res;
 	char *page;
@@ -579,7 +579,7 @@ static ssize_t bm_entry_write(struct file *file, const char __user *buffer,
 				size_t count, loff_t *ppos)
 {
 	struct dentry *root;
-	Node *e = file-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	Node *e = file-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 	int res = parse_command(buffer, count);
 
 	switch (res) {
@@ -646,7 +646,7 @@ static ssize_t bm_register_write(struct file *file, const char __user *buffer,
 	}
 
 	e-&gt;dentry = dget(dentry);
-	inode-&gt;u.generic_ip = e;
+	inode-&gt;i_private = e;
 	inode-&gt;i_fop = &amp;bm_entry_operations;
 
 	d_instantiate(dentry, inode);
diff --git a/fs/debugfs/file.c b/fs/debugfs/file.c
index e4b430552c88..bf3901ab1744 100644
--- a/fs/debugfs/file.c
+++ b/fs/debugfs/file.c
@@ -32,8 +32,8 @@ static ssize_t default_write_file(struct file *file, const char __user *buf,
 
 static int default_open(struct inode *inode, struct file *file)
 {
-	if (inode-&gt;u.generic_ip)
-		file-&gt;private_data = inode-&gt;u.generic_ip;
+	if (inode-&gt;i_private)
+		file-&gt;private_data = inode-&gt;i_private;
 
 	return 0;
 }
diff --git a/fs/debugfs/inode.c b/fs/debugfs/inode.c
index 3ca268d2e5a2..717f4821ed02 100644
--- a/fs/debugfs/inode.c
+++ b/fs/debugfs/inode.c
@@ -168,7 +168,7 @@ static int debugfs_create_by_name(const char *name, mode_t mode,
  *          directory dentry if set.  If this paramater is NULL, then the
  *          file will be created in the root of the debugfs filesystem.
  * @data: a pointer to something that the caller will want to get to later
- *        on.  The inode.u.generic_ip pointer will point to this value on
+ *        on.  The inode.i_private pointer will point to this value on
  *        the open() call.
  * @fops: a pointer to a struct file_operations that should be used for
  *        this file.
@@ -209,7 +209,7 @@ struct dentry *debugfs_create_file(const char *name, mode_t mode,
 
 	if (dentry-&gt;d_inode) {
 		if (data)
-			dentry-&gt;d_inode-&gt;u.generic_ip = data;
+			dentry-&gt;d_inode-&gt;i_private = data;
 		if (fops)
 			dentry-&gt;d_inode-&gt;i_fop = fops;
 	}
diff --git a/fs/devpts/inode.c b/fs/devpts/inode.c
index f7aef5bb584a..5bf06a10dddf 100644
--- a/fs/devpts/inode.c
+++ b/fs/devpts/inode.c
@@ -177,7 +177,7 @@ int devpts_pty_new(struct tty_struct *tty)
 	inode-&gt;i_gid = config.setgid ? config.gid : current-&gt;fsgid;
 	inode-&gt;i_mtime = inode-&gt;i_atime = inode-&gt;i_ctime = CURRENT_TIME;
 	init_special_inode(inode, S_IFCHR|config.mode, device);
-	inode-&gt;u.generic_ip = tty;
+	inode-&gt;i_private = tty;
 
 	dentry = get_node(number);
 	if (!IS_ERR(dentry) &amp;&amp; !dentry-&gt;d_inode)
@@ -196,7 +196,7 @@ struct tty_struct *devpts_get_tty(int number)
 	tty = NULL;
 	if (!IS_ERR(dentry)) {
 		if (dentry-&gt;d_inode)
-			tty = dentry-&gt;d_inode-&gt;u.generic_ip;
+			tty = dentry-&gt;d_inode-&gt;i_private;
 		dput(dentry);
 	}
 
diff --git a/fs/freevxfs/vxfs.h b/fs/freevxfs/vxfs.h
index d35979a58743..c8a92652612a 100644
--- a/fs/freevxfs/vxfs.h
+++ b/fs/freevxfs/vxfs.h
@@ -252,7 +252,7 @@ enum {
  * Get filesystem private data from VFS inode.
  */
 #define VXFS_INO(ip) \
-	((struct vxfs_inode_info *)(ip)-&gt;u.generic_ip)
+	((struct vxfs_inode_info *)(ip)-&gt;i_private)
 
 /*
  * Get filesystem private data from VFS superblock.
diff --git a/fs/freevxfs/vxfs_inode.c b/fs/freevxfs/vxfs_inode.c
index ca6a39714771..32a82ed108e4 100644
--- a/fs/freevxfs/vxfs_inode.c
+++ b/fs/freevxfs/vxfs_inode.c
@@ -243,7 +243,7 @@ vxfs_iinit(struct inode *ip, struct vxfs_inode_info *vip)
 	ip-&gt;i_blocks = vip-&gt;vii_blocks;
 	ip-&gt;i_generation = vip-&gt;vii_gen;
 
-	ip-&gt;u.generic_ip = (void *)vip;
+	ip-&gt;i_private = vip;
 	
 }
 
@@ -338,5 +338,5 @@ vxfs_read_inode(struct inode *ip)
 void
 vxfs_clear_inode(struct inode *ip)
 {
-	kmem_cache_free(vxfs_inode_cachep, ip-&gt;u.generic_ip);
+	kmem_cache_free(vxfs_inode_cachep, ip-&gt;i_private);
 }
diff --git a/fs/fuse/control.c b/fs/fuse/control.c
index 46fe60b2da23..79ec1f23d4d2 100644
--- a/fs/fuse/control.c
+++ b/fs/fuse/control.c
@@ -23,7 +23,7 @@ static struct fuse_conn *fuse_ctl_file_conn_get(struct file *file)
 {
 	struct fuse_conn *fc;
 	mutex_lock(&amp;fuse_mutex);
-	fc = file-&gt;f_dentry-&gt;d_inode-&gt;u.generic_ip;
+	fc = file-&gt;f_dentry-&gt;d_inode-&gt;i_private;
 	if (fc)
 		fc = fuse_conn_get(fc);
 	mutex_unlock(&amp;fuse_mutex);
@@ -98,7 +98,7 @@ static struct dentry *fuse_ctl_add_dentry(struct dentry *parent,
 		inode-&gt;i_op = iop;
 	inode-&gt;i_fop = fop;
 	inode-&gt;i_nlink = nlink;
-	inode-&gt;u.generic_ip = fc;
+	inode-&gt;i_private = fc;
 	d_add(dentry, inode);
 	return dentry;
 }
@@ -150,7 +150,7 @@ void fuse_ctl_remove_conn(struct fuse_conn *fc)
 
 	for (i = fc-&gt;ctl_ndents - 1; i &gt;= 0; i--) {
 		struct dentry *dentry = fc-&gt;ctl_dentry[i];
-		dentry-&gt;d_inode-&gt;u.generic_ip = NULL;
+		dentry-&gt;d_inode-&gt;i_private = NULL;
 		d_drop(dentry);
 		dput(dentry);
 	}
diff --git a/fs/inode.c b/fs/inode.c
index 0bf9f0444a96..77e254792025 100644
--- a/fs/inode.c
+++ b/fs/inode.c
@@ -163,7 +163,7 @@ static struct inode *alloc_inode(struct super_block *sb)
 				bdi = sb-&gt;s_bdev-&gt;bd_inode-&gt;i_mapping-&gt;backing_dev_info;
 			mapping-&gt;backing_dev_info = bdi;
 		}
-		memset(&amp;inode-&gt;u, 0, sizeof(inode-&gt;u));
+		inode-&gt;i_private = 0;
 		inode-&gt;i_mapping = mapping;
 	}
 	return inode;
diff --git a/fs/jffs/inode-v23.c b/fs/jffs/inode-v23.c
index b59553d28d13..7358ef87f16b 100644
--- a/fs/jffs/inode-v23.c
+++ b/fs/jffs/inode-v23.c
@@ -369,7 +369,7 @@ jffs_new_inode(const struct inode * dir, struct jffs_raw_inode *raw_inode,
 
 	f = jffs_find_file(c, raw_inode-&gt;ino);
 
-	inode-&gt;u.generic_ip = (void *)f;
+	inode-&gt;i_private = (void *)f;
 	insert_inode_hash(inode);
 
 	return inode;
@@ -442,7 +442,7 @@ jffs_rename(struct inode *old_dir, struct dentry *old_dentry,
 	});
 
 	result = -ENOTDIR;
-	if (!(old_dir_f = (struct jffs_file *)old_dir-&gt;u.generic_ip)) {
+	if (!(old_dir_f = old_dir-&gt;i_private)) {
 		D(printk("jffs_rename(): Old dir invalid.\n"));
 		goto jffs_rename_end;
 	}
@@ -456,7 +456,7 @@ jffs_rename(struct inode *old_dir, struct dentry *old_dentry,
 
 	/* Find the new directory.  */
 	result = -ENOTDIR;
-	if (!(new_dir_f = (struct jffs_file *)new_dir-&gt;u.generic_ip)) {
+	if (!(new_dir_f = new_dir-&gt;i_private)) {
 		D(printk("jffs_rename(): New dir invalid.\n"));
 		goto jffs_rename_end;
 	}
@@ -593,7 +593,7 @@ jffs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 		}
 		else {
 			ddino = ((struct jffs_file *)
-				 inode-&gt;u.generic_ip)-&gt;pino;
+				 inode-&gt;i_private)-&gt;pino;
 		}
 		D3(printk("jffs_readdir(): \"..\" %u\n", ddino));
 		if (filldir(dirent, "..", 2, filp-&gt;f_pos, ddino, DT_DIR) &lt; 0) {
@@ -604,7 +604,7 @@ jffs_readdir(struct file *filp, void *dirent, filldir_t filldir)
 		}
 		filp-&gt;f_pos++;
 	}
-	f = ((struct jffs_file *)inode-&gt;u.generic_ip)-&gt;children;
+	f = ((struct jffs_file *)inode-&gt;i_private)-&gt;children;
 
 	j = 2;
 	while(f &amp;&amp; (f-&gt;deleted || j++ &lt; filp-&gt;f_pos )) {
@@ -668,7 +668,7 @@ jffs_lookup(struct inode *dir, struct dentry *dentry, struct nameidata *nd)
 	}
 
 	r = -EACCES;
-	if (!(d = (struct jffs_file *)dir-&gt;u.generic_ip)) {
+	if (!(d = (struct jffs_file *)dir-&gt;i_private)) {
 		D(printk("jffs_lookup(): No such inode! (%lu)\n",
 			 dir-&gt;i_ino));
 		goto jffs_lookup_end;
@@ -739,7 +739,7 @@ jffs_do_readpage_nolock(struct file *file, struct page *page)
 	unsigned long read_len;
 	int result;
 	struct inode *inode = (struct inode*)page-&gt;mapping-&gt;host;
-	struct jffs_file *f = (struct jffs_file *)inode-&gt;u.generic_ip;
+	struct jffs_file *f = (struct jffs_file *)inode-&gt;i_private;
 	struct jffs_control *c = (struct jffs_control *)inode-&gt;i_sb-&gt;s_fs_info;
 	int r;
 	loff_t offset;
@@ -828,7 +828,7 @@ jffs_mkdir(struct inode *dir, struct dentry *dentry, int mode)
 	});
 
 	lock_kernel();
-	dir_f = (struct jffs_file *)dir-&gt;u.generic_ip;
+	dir_f = dir-&gt;i_private;
 
 	ASSERT(if (!dir_f) {
 		printk(KERN_ERR "jffs_mkdir(): No reference to a "
@@ -972,7 +972,7 @@ jffs_remove(struct inode *dir, struct dentry *dentry, int type)
 		kfree(_name);
 	});
 
-	dir_f = (struct jffs_file *) dir-&gt;u.generic_ip;
+	dir_f = dir-&gt;i_private;
 	c = dir_f-&gt;c;
 
 	result = -ENOENT;
@@ -1082,7 +1082,7 @@ jffs_mknod(struct inode *dir, struct dentry *dentry, int mode, dev_t rdev)
 	if (!old_valid_dev(rdev))
 		return -EINVAL;
 	lock_kernel();
-	dir_f = (struct jffs_file *)dir-&gt;u.generic_ip;
+	dir_f = dir-&gt;i_private;
 	c = dir_f-&gt;c;
 
 	D3(printk (KERN_NOTICE "mknod(): down biglock\n"));
@@ -1186,7 +1186,7 @@ jffs_symlink(struct inode *dir, struct dentry *dentry, const char *symname)
 		kfree(_symname);
 	});
 
-	dir_f = (struct jffs_file *)dir-&gt;u.generic_ip;
+	dir_f = dir-&gt;i_private;
 	ASSERT(if (!dir_f) {
 		printk(KERN_ERR "jffs_symlink(): No reference to a "
 		       "jffs_file struct in inode.\n");
@@ -1289,7 +1289,7 @@ jffs_create(struct inode *dir, struct dentry *dentry, int mode,
 		kfree(s);
 	});
 
-	dir_f = (struct jffs_file *)dir-&gt;u.generic_ip;
+	dir_f = dir-&gt;i_private;
 	ASSERT(if (!dir_f) {
 		printk(KERN_ERR "jffs_create(): No reference to a "
 		       "jffs_file struct in inode.\n");
@@ -1403,9 +1403,9 @@ jffs_file_write(struct file *filp, const char *buf, size_t count,
 		goto out_isem;
 	}
 
-	if (!(f = (struct jffs_file *)inode-&gt;u.generic_ip)) {
-		D(printk("jffs_file_write(): inode-&gt;u.generic_ip = 0x%p\n",
-				inode-&gt;u.generic_ip));
+	if (!(f = inode-&gt;i_private)) {
+		D(printk("jffs_file_write(): inode-&gt;i_private = 0x%p\n",
+				inode-&gt;i_private));
 		goto out_isem;
 	}
 
@@ -1693,7 +1693,7 @@ jffs_read_inode(struct inode *inode)
 		mutex_unlock(&amp;c-&gt;fmc-&gt;biglock);
 		return;
 	}
-	inode-&gt;u.generic_ip = (void *)f;
+	inode-&gt;i_private = f;
 	inode-&gt;i_mode = f-&gt;mode;
 	inode-&gt;i_nlink = f-&gt;nlink;
 	inode-&gt;i_uid = f-&gt;uid;
@@ -1748,7 +1748,7 @@ jffs_delete_inode(struct inode *inode)
 	lock_kernel();
 	inode-&gt;i_size = 0;
 	inode-&gt;i_blocks = 0;
-	inode-&gt;u.generic_ip = NULL;
+	inode-&gt;i_private = NULL;
 	clear_inode(inode);
 	if (inode-&gt;i_nlink == 0) {
 		c = (struct jffs_control *) inode-&gt;i_sb-&gt;s_fs_info;
diff --git a/fs/libfs.c b/fs/libfs.c
index ac02ea602c3d..2751793beeaa 100644
--- a/fs/libfs.c
+++ b/fs/libfs.c
@@ -547,7 +547,7 @@ int simple_attr_open(struct inode *inode, struct file *file,
 
 	attr-&gt;get = get;
 	attr-&gt;set = set;
-	attr-&gt;data = inode-&gt;u.generic_ip;
+	attr-&gt;data = inode-&gt;i_private;
 	attr-&gt;fmt = fmt;
 	mutex_init(&amp;attr-&gt;mutex);
 
diff --git a/fs/ocfs2/dlmglue.c b/fs/ocfs2/dlmglue.c
index de887063dcfc..8801e41afe80 100644
--- a/fs/ocfs2/dlmglue.c
+++ b/fs/ocfs2/dlmglue.c
@@ -2052,7 +2052,7 @@ static int ocfs2_dlm_debug_open(struct inode *inode, struct file *file)
 		mlog_errno(ret);
 		goto out;
 	}
-	osb = (struct ocfs2_super *) inode-&gt;u.generic_ip;
+	osb = inode-&gt;i_private;
 	ocfs2_get_dlm_debug(osb-&gt;osb_dlm_debug);
 	priv-&gt;p_dlm_debug = osb-&gt;osb_dlm_debug;
 	INIT_LIST_HEAD(&amp;priv-&gt;p_iter_res.l_debug_list);
diff --git a/include/linux/fs.h b/include/linux/fs.h
index 1d3e601ece73..4f77ec9c3353 100644
--- a/include/linux/fs.h
+++ b/include/linux/fs.h
@@ -554,9 +554,7 @@ struct inode {
 
 	atomic_t		i_writecount;
 	void			*i_security;
-	union {
-		void		*generic_ip;
-	} u;
+	void			*i_private; /* fs or device private pointer */
 #ifdef __NEED_I_SIZE_ORDERED
 	seqcount_t		i_size_seqcount;
 #endif
diff --git a/kernel/relay.c b/kernel/relay.c
index 33345e73485c..85786ff2a4f9 100644
--- a/kernel/relay.c
+++ b/kernel/relay.c
@@ -669,7 +669,7 @@ EXPORT_SYMBOL_GPL(relay_flush);
  */
 static int relay_file_open(struct inode *inode, struct file *filp)
 {
-	struct rchan_buf *buf = inode-&gt;u.generic_ip;
+	struct rchan_buf *buf = inode-&gt;i_private;
 	kref_get(&amp;buf-&gt;kref);
 	filp-&gt;private_data = buf;
 
diff --git a/security/inode.c b/security/inode.c
index 47eb63480dac..176aacea8ca4 100644
--- a/security/inode.c
+++ b/security/inode.c
@@ -44,8 +44,8 @@ static ssize_t default_write_file(struct file *file, const char __user *buf,
 
 static int default_open(struct inode *inode, struct file *file)
 {
-	if (inode-&gt;u.generic_ip)
-		file-&gt;private_data = inode-&gt;u.generic_ip;
+	if (inode-&gt;i_private)
+		file-&gt;private_data = inode-&gt;i_private;
 
 	return 0;
 }
@@ -194,7 +194,7 @@ static int create_by_name(const char *name, mode_t mode,
  *          directory dentry if set.  If this paramater is NULL, then the
  *          file will be created in the root of the securityfs filesystem.
  * @data: a pointer to something that the caller will want to get to later
- *        on.  The inode.u.generic_ip pointer will point to this value on
+ *        on.  The inode.i_private pointer will point to this value on
  *        the open() call.
  * @fops: a pointer to a struct file_operations that should be used for
  *        this file.
@@ -240,7 +240,7 @@ struct dentry *securityfs_create_file(const char *name, mode_t mode,
 		if (fops)
 			dentry-&gt;d_inode-&gt;i_fop = fops;
 		if (data)
-			dentry-&gt;d_inode-&gt;u.generic_ip = data;
+			dentry-&gt;d_inode-&gt;i_private = data;
 	}
 exit:
 	return dentry;</pre><hr><pre>commit c61a8416ed3db84481651270032696a4781cac17
Author: Theodore Tso &lt;tytso@mit.edu&gt;
Date:   Mon Jul 3 00:24:09 2006 -0700

    [PATCH] uml build fix
    
    This is needed to fix UML compilation given that alternatives_smp_module_add
    and alternatives_smp_module_del are null inline functions if !CONFIG_SMP.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Cc: Jeff Dike &lt;jdike@addtoit.com&gt;
    Cc: Paolo 'Blaisorblade' Giarrusso &lt;blaisorblade@yahoo.it&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/arch/um/kernel/um_arch.c b/arch/um/kernel/um_arch.c
index 7d51dd7201c3..37cfe7701f06 100644
--- a/arch/um/kernel/um_arch.c
+++ b/arch/um/kernel/um_arch.c
@@ -495,6 +495,7 @@ void apply_alternatives(struct alt_instr *start, struct alt_instr *end)
 {
 }
 
+#ifdef CONFIG_SMP
 void alternatives_smp_module_add(struct module *mod, char *name,
 				 void *locks, void *locks_end,
 				 void *text,  void *text_end)
@@ -504,3 +505,4 @@ void alternatives_smp_module_add(struct module *mod, char *name,
 void alternatives_smp_module_del(struct module *mod)
 {
 }
+#endif</pre><hr><pre>commit d2e5b13c4a7c68fdbcf389c9fffc12cfa2c185af
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Sun Jun 25 05:47:52 2006 -0700

    [PATCH] ext3: remove inconsistent space before exclamation point in mount code
    
    This was reported as Debian bug #336604.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/ext3/super.c b/fs/ext3/super.c
index df98a7709252..e0fc0c83be90 100644
--- a/fs/ext3/super.c
+++ b/fs/ext3/super.c
@@ -1603,7 +1603,7 @@ static int ext3_fill_super (struct super_block *sb, void *data, int silent)
 		}
 	}
 	if (!ext3_check_descriptors (sb)) {
-		printk (KERN_ERR "EXT3-fs: group descriptors corrupted !\n");
+		printk(KERN_ERR "EXT3-fs: group descriptors corrupted!\n");
 		goto failed_mount2;
 	}
 	sbi-&gt;s_gdb_count = db_count;</pre><hr><pre>commit e8f1c6227a0bc9b1e3a7e87cd31f650a909f647f
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Sun Jun 25 05:47:51 2006 -0700

    [PATCH] ext3: fix memory leak when the journal file is corrupted
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/jbd/recovery.c b/fs/jbd/recovery.c
index 80d7f53fd0a7..de5bafb4e853 100644
--- a/fs/jbd/recovery.c
+++ b/fs/jbd/recovery.c
@@ -531,6 +531,7 @@ static int do_one_pass(journal_t *journal,
 		default:
 			jbd_debug(3, "Unrecognised magic %d, end of scan.\n",
 				  blocktype);
+			brelse(bh);
 			goto done;
 		}
 	}</pre><hr><pre>commit f16fdadba28add689b567cf03c21dd6dec8e43be
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Sun Jun 25 05:47:50 2006 -0700

    [PATCH] ext2: clean up dead code from mount code
    
    The variable i is guaranteed to be the same as db_count given the previous
    for loop.  So get rid of it since it's dead code.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/fs/ext2/super.c b/fs/ext2/super.c
index ee4ba759581e..fec55ff23dea 100644
--- a/fs/ext2/super.c
+++ b/fs/ext2/super.c
@@ -854,7 +854,6 @@ static int ext2_fill_super(struct super_block *sb, void *data, int silent)
 	}
 	if (!ext2_check_descriptors (sb)) {
 		printk ("EXT2-fs: group descriptors corrupted!\n");
-		db_count = i;
 		goto failed_mount2;
 	}
 	sbi-&gt;s_gdb_count = db_count;</pre><hr><pre>commit ac031f26e89cc04fc7504f31ae137857eb83a051
Author: Theodore Ts'o &lt;tytso@mit.edu&gt;
Date:   Wed Jun 21 20:53:09 2006 -0400

    kbuild: add option for stripping modules while installing them
    
    Add option for stripping modules while installing them.
    
    This function adds support for stripping modules while they are being
    installed.  CONFIG_DEBUG_KERNEL (which will probably become more
    popular as developers use kdump) causes the size of the installed
    modules to grow by a factor of 9 or so.
    
    Some kernel package systems solve this problem by stripping the debug
    information from /lib/modules after running "make modules_install",
    but that may not work for people who are installing directly into
    /lib/modules --- root partitions that were sized to handle 16 megs
    worth of modules may not be quite so happy with 145 megs of modules,
    so the "make modules_install" never succeeds.
    
    This patch allows such users to request modules_install to strip the
    modules as they are installed.
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Sam Ravnborg &lt;sam@ravnborg.org&gt;

diff --git a/Documentation/kbuild/makefiles.txt b/Documentation/kbuild/makefiles.txt
index a9c00facdf40..14ef3868a328 100644
--- a/Documentation/kbuild/makefiles.txt
+++ b/Documentation/kbuild/makefiles.txt
@@ -1123,6 +1123,14 @@ The top Makefile exports the following variables:
 	$(INSTALL_MOD_PATH)/lib/modules/$(KERNELRELEASE).  The user may
 	override this value on the command line if desired.
 
+    INSTALL_MOD_STRIP
+
+	If this variable is specified, will cause modules to be stripped
+	after they are installed.  If INSTALL_MOD_STRIP is '1', then the
+	default option --strip-debug will be used.  Otherwise,
+	INSTALL_MOD_STRIP will used as the option(s) to the strip command.
+
+
 === 8 Makefile language
 
 The kernel Makefiles are designed to run with GNU Make.  The Makefiles
diff --git a/Makefile b/Makefile
index 1b2fd97f503a..d810d6cb4d08 100644
--- a/Makefile
+++ b/Makefile
@@ -512,6 +512,23 @@ export	INSTALL_PATH ?= /boot
 MODLIB	= $(INSTALL_MOD_PATH)/lib/modules/$(KERNELRELEASE)
 export MODLIB
 
+#
+#  INSTALL_MOD_STRIP, if defined, will cause modules to be
+#  stripped after they are installed.  If INSTALL_MOD_STRIP is '1', then
+#  the default option --strip-debug will be used.  Otherwise,
+#  INSTALL_MOD_STRIP will used as the options to the strip command.
+
+ifdef INSTALL_MOD_STRIP
+ifeq ($(INSTALL_MOD_STRIP),1)
+mod_strip_cmd = $STRIP) --strip-debug
+else
+mod_strip_cmd = $(STRIP) $(INSTALL_MOD_STRIP)
+endif # INSTALL_MOD_STRIP=1
+else
+mod_strip_cmd = true
+endif # INSTALL_MOD_STRIP
+export mod_strip_cmd
+
 
 ifeq ($(KBUILD_EXTMOD),)
 core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/
diff --git a/scripts/Makefile.modinst b/scripts/Makefile.modinst
index 2686dd5dce8c..f0ff248f5e6f 100644
--- a/scripts/Makefile.modinst
+++ b/scripts/Makefile.modinst
@@ -17,7 +17,7 @@ __modinst: $(modules)
 	@:
 
 quiet_cmd_modules_install = INSTALL $@
-      cmd_modules_install = mkdir -p $(2); cp $@ $(2)
+      cmd_modules_install = mkdir -p $(2); cp $@ $(2) ; $(mod_strip_cmd) $(2)/$(notdir $@)
 
 # Modules built outside the kernel source tree go into extra by default
 INSTALL_MOD_DIR ?= extra</pre><hr><pre>commit ae0718f8e3fcfa3e4863f63db90d24bbec6b14a2
Author: Theodore Tso &lt;tytso@mit.edu&gt;
Date:   Sat May 20 15:00:13 2006 -0700

    [PATCH] Update ext2/ext3/jbd MAINTAINERS entries
    
    Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
    Signed-off-by: Andrew Morton &lt;akpm@osdl.org&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;

diff --git a/MAINTAINERS b/MAINTAINERS
index 89c066be5489..bd10b2af2223 100644
--- a/MAINTAINERS
+++ b/MAINTAINERS
@@ -978,7 +978,7 @@ S:	Maintained
 EXT3 FILE SYSTEM
 P:	Stephen Tweedie, Andrew Morton
 M:	sct@redhat.com, akpm@osdl.org, adilger@clusterfs.com
-L:	ext3-users@redhat.com
+L:	ext2-devel@lists.sourceforge.net
 S:	Maintained
 
 F71805F HARDWARE MONITORING DRIVER
@@ -1539,6 +1539,12 @@ W:	http://jfs.sourceforge.net/
 T:	git kernel.org:/pub/scm/linux/kernel/git/shaggy/jfs-2.6.git
 S:	Supported
 
+JOURNALLING LAYER FOR BLOCK DEVICS (JBD)
+P:	Stephen Tweedie, Andrew Morton
+M:	sct@redhat.com, akpm@osdl.org
+L:	ext2-devel@lists.sourceforge.net
+S:	Maintained
+
 KCONFIG
 P:	Roman Zippel
 M:	zippel@linux-m68k.org</pre>
    <div class="pagination">
        <a href='1_109.html'>&lt;&lt;Prev</a><a href='1.html'>1</a><a href='1_2.html'>2</a><a href='1_3.html'>3</a><a href='1_4.html'>4</a><a href='1_5.html'>5</a><a href='1_6.html'>6</a><a href='1_7.html'>7</a><a href='1_8.html'>8</a><a href='1_9.html'>9</a><a href='1_10.html'>10</a><a href='1_11.html'>11</a><a href='1_12.html'>12</a><a href='1_13.html'>13</a><a href='1_14.html'>14</a><a href='1_15.html'>15</a><a href='1_16.html'>16</a><a href='1_17.html'>17</a><a href='1_18.html'>18</a><a href='1_19.html'>19</a><a href='1_20.html'>20</a><a href='1_21.html'>21</a><a href='1_22.html'>22</a><a href='1_23.html'>23</a><a href='1_24.html'>24</a><a href='1_25.html'>25</a><a href='1_26.html'>26</a><a href='1_27.html'>27</a><a href='1_28.html'>28</a><a href='1_29.html'>29</a><a href='1_30.html'>30</a><a href='1_31.html'>31</a><a href='1_32.html'>32</a><a href='1_33.html'>33</a><a href='1_34.html'>34</a><a href='1_35.html'>35</a><a href='1_36.html'>36</a><a href='1_37.html'>37</a><a href='1_38.html'>38</a><a href='1_39.html'>39</a><a href='1_40.html'>40</a><a href='1_41.html'>41</a><a href='1_42.html'>42</a><a href='1_43.html'>43</a><a href='1_44.html'>44</a><a href='1_45.html'>45</a><a href='1_46.html'>46</a><a href='1_47.html'>47</a><a href='1_48.html'>48</a><a href='1_49.html'>49</a><a href='1_50.html'>50</a><a href='1_51.html'>51</a><a href='1_52.html'>52</a><a href='1_53.html'>53</a><a href='1_54.html'>54</a><a href='1_55.html'>55</a><a href='1_56.html'>56</a><a href='1_57.html'>57</a><a href='1_58.html'>58</a><a href='1_59.html'>59</a><a href='1_60.html'>60</a><a href='1_61.html'>61</a><a href='1_62.html'>62</a><a href='1_63.html'>63</a><a href='1_64.html'>64</a><a href='1_65.html'>65</a><a href='1_66.html'>66</a><a href='1_67.html'>67</a><a href='1_68.html'>68</a><a href='1_69.html'>69</a><a href='1_70.html'>70</a><a href='1_71.html'>71</a><a href='1_72.html'>72</a><a href='1_73.html'>73</a><a href='1_74.html'>74</a><a href='1_75.html'>75</a><a href='1_76.html'>76</a><a href='1_77.html'>77</a><a href='1_78.html'>78</a><a href='1_79.html'>79</a><a href='1_80.html'>80</a><a href='1_81.html'>81</a><a href='1_82.html'>82</a><a href='1_83.html'>83</a><a href='1_84.html'>84</a><a href='1_85.html'>85</a><a href='1_86.html'>86</a><a href='1_87.html'>87</a><a href='1_88.html'>88</a><a href='1_89.html'>89</a><a href='1_90.html'>90</a><a href='1_91.html'>91</a><a href='1_92.html'>92</a><a href='1_93.html'>93</a><a href='1_94.html'>94</a><a href='1_95.html'>95</a><a href='1_96.html'>96</a><a href='1_97.html'>97</a><a href='1_98.html'>98</a><a href='1_99.html'>99</a><a href='1_100.html'>100</a><a href='1_101.html'>101</a><a href='1_102.html'>102</a><a href='1_103.html'>103</a><a href='1_104.html'>104</a><a href='1_105.html'>105</a><a href='1_106.html'>106</a><a href='1_107.html'>107</a><a href='1_108.html'>108</a><a href='1_109.html'>109</a><span>[110]</span><a href='1_111.html'>111</a><a href='1_112.html'>112</a><a href='1_113.html'>113</a><a href='1_114.html'>114</a><a href='1_115.html'>115</a><a href='1_116.html'>116</a><a href='1_117.html'>117</a><a href='1_118.html'>118</a><a href='1_119.html'>119</a><a href='1_120.html'>120</a><a href='1_121.html'>121</a><a href='1_122.html'>122</a><a href='1_123.html'>123</a><a href='1_124.html'>124</a><a href='1_125.html'>125</a><a href='1_126.html'>126</a><a href='1_127.html'>127</a><a href='1_128.html'>128</a><a href='1_129.html'>129</a><a href='1_130.html'>130</a><a href='1_131.html'>131</a><a href='1_132.html'>132</a><a href='1_133.html'>133</a><a href='1_134.html'>134</a><a href='1_135.html'>135</a><a href='1_136.html'>136</a><a href='1_137.html'>137</a><a href='1_138.html'>138</a><a href='1_139.html'>139</a><a href='1_140.html'>140</a><a href='1_141.html'>141</a><a href='1_142.html'>142</a><a href='1_143.html'>143</a><a href='1_144.html'>144</a><a href='1_145.html'>145</a><a href='1_146.html'>146</a><a href='1_147.html'>147</a><a href='1_148.html'>148</a><a href='1_149.html'>149</a><a href='1_150.html'>150</a><a href='1_151.html'>151</a><a href='1_152.html'>152</a><a href='1_153.html'>153</a><a href='1_154.html'>154</a><a href='1_111.html'>Next&gt;&gt;</a>
    <div>
</body>
